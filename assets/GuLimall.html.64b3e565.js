import{_ as e}from"./plugin-vue_export-helper.21dcd24c.js";import{r as o,o as c,c as i,a as n,b as t,d as s,e as p}from"./app.95807bc9.js";const l={},u=n("blockquote",null,[n("p",null,"\u4ECB\u7ECD")],-1),r=n("h1",{id:"\u65B0\u5B66\u56DB\u95EE",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u65B0\u5B66\u56DB\u95EE","aria-hidden":"true"},"#"),s(" \u65B0\u5B66\u56DB\u95EE")],-1),k=n("strong",null,"WHY\u3010\u4E0E\u524D\u4EE3\u4F18\u5316\u4E86\u4EC0\u4E48\uFF0C\u5F25\u8865\u4E86\u4EC0\u4E48\u7A7A\u767D\u3011",-1),d=s("\uFF1A\u5B66\u4E60\u5B9E\u8DF5\u5206\u5E03\u5F0F\u7EC4\u4EF6\uFF0C\u9AD8\u5E76\u53D1\u7B49\u4E1A\u52A1"),m=n("br",null,null,-1),v=n("strong",null,"WHAT\u3010\u6846\u67B6\uFF0C\u601D\u7EF4\u5BFC\u56FE\uFF0C\u4E3B\u9898\u6846\u67B6\u3011",-1),g=s("\uFF1A\u901A\u8FC7\u9879\u76EE\u624E\u5B9E\u6280\u672F\uFF0CSpringBoot+SpringCloud+Docker+VUE+Element-UI"),b=n("br",null,null,-1),h=n("strong",null,"HOW\u3010\u5982\u4F55\u8BB0\u5FC6\uFF0C\u5B66\u4E60\u8D44\u6E90\uFF08\u5B98\u65B9\u6587\u6863\u3001\u89C6\u9891\u8D44\u6E90\u3001\u9879\u76EE\u5730\u5740\uFF09\u3011",-1),y=s("\uFF1A"),f={href:"https://share.weiyun.com/z0DElpTd",target:"_blank",rel:"noopener noreferrer"},q=s("\u8C37\u7C92\u5546\u57CE\u6E90\u7801\u548C\u8F6F\u4EF6"),w=s("\u3001"),_={href:"https://www.bilibili.com/video/BV1np4y1C7Yf?spm_id_from=333.999.0.0",target:"_blank",rel:"noopener noreferrer"},S=s("\u5728\u7EBF\u6559\u7A0B"),x=n("br",null,null,-1),E=n("strong",null,"LEVEL\u3010\u4E0D\u662F\u6BCF\u4E2A\u90FD\u5B66\u7CBE\u3011",-1),I=s("\uFF1A\u6E05\u6670\u660E\u4E86"),C=p('<h1 id="\u8FDB\u5EA6-\u301085-5-25\u3011" tabindex="-1"><a class="header-anchor" href="#\u8FDB\u5EA6-\u301085-5-25\u3011" aria-hidden="true">#</a> \u8FDB\u5EA6\uFF1A \u301085 -5.25\u3011</h1><h1 id="\u5206\u5E03\u5F0F\u57FA\u7840\u7BC7" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u57FA\u7840\u7BC7" aria-hidden="true">#</a> =<mark><mark><strong>\u5206\u5E03\u5F0F\u57FA\u7840\u7BC7</strong></mark></mark>=</h1><hr><h1 id="\u4E00\u3001\u9879\u76EE\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u4E00\u3001\u9879\u76EE\u4ECB\u7ECD" aria-hidden="true">#</a> \u4E00\u3001\u9879\u76EE\u4ECB\u7ECD</h1><h2 id="_1-1-\u9879\u76EE\u80CC\u666F" tabindex="-1"><a class="header-anchor" href="#_1-1-\u9879\u76EE\u80CC\u666F" aria-hidden="true">#</a> 1.1 \u9879\u76EE\u80CC\u666F</h2>',5),A=s("\u9879\u76EE\u5728\u7EBF\u63A5\u53E3\u6587\u6863\uFF1A"),j={href:"https://easydoc.net/s/78237135/ZUqEdvA4/hKJTcbfd",target:"_blank",rel:"noopener noreferrer"},R=s("1\u3001\u5206\u9875\u8BF7\u6C42\u53C2\u6570 - \u8C37\u7C92\u5546\u57CE (easydoc.net)"),O=p('<h2 id="_1-2-\u7535\u5546\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1-2-\u7535\u5546\u6A21\u5F0F" aria-hidden="true">#</a> 1.2 \u7535\u5546\u6A21\u5F0F</h2><p>\u5E02\u9762\u4E0A\u67095\u79CD\u5E38\u89C1\u7684\u7535\u5546\u6A21\u5F0F B2B \u3001B2C\u3001C2B \u3001C2C\u3001O2O</p><h3 id="_1-2-1-b2b-\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1-2-1-b2b-\u6A21\u5F0F" aria-hidden="true">#</a> 1.2.1 B2B \u6A21\u5F0F</h3><p>B2B \uFF08 Business to Business\uFF09 \u662F\u6307\u5546\u5BB6\u548C\u5546\u5BB6\u5EFA\u7ACB\u7684\u5546\u4E1A\u5173\u7CFB\uFF0C\u5982\u963F\u91CC\u5DF4\u5DF4\u3002</p><h3 id="_1-2-2-b2c-\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1-2-2-b2c-\u6A21\u5F0F" aria-hidden="true">#</a> 1.2.2 B2C \u6A21\u5F0F</h3><p>B2C(Business to Consumer) \u5C31\u662F\u6211\u4EEC\u7ECF\u5E38\u770B\u5230\u7684\u4F9B\u5E94\u5546\u76F4\u63A5\u628A\u5546\u54C1\u4E70\u4E2A\u7528\u6237\uFF0C\u5373 \u201C\u5546\u5BF9\u5BA2\u201D \u6A21\u5F0F\uFF0C\u4E5F\u5C31\u662F\u6211\u4EEC\u5462\u8BF4\u7684\u5546\u4E1A\u96F6\u552E\uFF0C\u76F4\u63A5\u9762\u5411\u6D88\u8D39\u9500\u552E\u4EA7\u54C1\u548C\u670D\u52A1\uFF0C\u5982\u82CF\u5B81\u6613\u8D2D\uFF0C\u4EAC\u4E1C\uFF0C\u5929\u732B\uFF0C\u5C0F\u7C73\u5546\u57CE</p><h3 id="_1-2-3-c2b-\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1-2-3-c2b-\u6A21\u5F0F" aria-hidden="true">#</a> 1.2.3 C2B \u6A21\u5F0F</h3><p>C2B (Customer to Business),\u5373\u6D88\u8D39\u8005\u5BF9\u4F01\u4E1A\uFF0C\u5148\u6709\u6D88\u8D39\u8005\u9700\u6C42\u4EA7\u751F\u800C\u540E\u6709\u4F01\u4E1A\u751F\u4EA7\uFF0C\u5373\u5148\u6709\u6D88\u8D39\u8005\u63D0\u51FA\u9700\u6C42\uFF0C\u540E\u53C8\u751F\u4EA7\u4F01\u4E1A\u6309\u9700\u6C42\u7EC4\u7EC7\u751F\u4EA7</p><h3 id="_1-2-4-c2c-\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1-2-4-c2c-\u6A21\u5F0F" aria-hidden="true">#</a> 1.2.4 C2C \u6A21\u5F0F</h3><p>C2C (Customer to Consumer) \u5BA2\u6237\u4E4B\u95F4\u5427\u81EA\u5DF1\u7684\u4E1C\u897F\u653E\u5230\u7F51\u4E0A\u53BB\u5356 \u5982 \u6DD8\u5B9D \u54B8\u9C7C</p><h3 id="_1-2-5-o2o" tabindex="-1"><a class="header-anchor" href="#_1-2-5-o2o" aria-hidden="true">#</a> 1.2.5 O2O</h3><p>O2O \u5373 Online To Offline\uFF0C\u4E5F\u5373\u5C06\u7EBF\u4E0B\u5546\u52A1\u7684\u673A\u4F1A\u4E0E\u4E92\u8054\u7F51\u7ED3\u5408\u5728\u4E00\u8D77\uFF0C\u8BA9\u4E92\u8054\u7F51\u6210\u4E3A\u7EBF\u4E0B\u4EA4\u6613\u524D\u53F0\uFF0C\u7EBF\u4E0A\u5FEB\u901F\u652F\u4ED8\uFF0C\u7EBF\u4E0B\u4F18\u8D28\u670D\u52A1\uFF0C\u5982\uFF1A\u997F\u4E86\u4E48\uFF0C\u7F8E\u56E2\uFF0C\u6DD8\u7968\u7968\uFF0C\u4EAC\u4E1C\u5230\u5BB6</p><h2 id="_1-3-\u8C37\u7C92\u5546\u57CE" tabindex="-1"><a class="header-anchor" href="#_1-3-\u8C37\u7C92\u5546\u57CE" aria-hidden="true">#</a> 1.3 \u8C37\u7C92\u5546\u57CE</h2><p>\u8C37\u7C92\u5546\u57CE\u662F\u4E00\u4E2A B2C \u6A21\u5F0F\u7684\u7535\u5546\u5E73\u53F0\uFF0C\u9500\u552E\u81EA\u8425\u5546\u54C1\u7ED9\u5BA2\u6237</p><h2 id="_1-4-\u9879\u76EE\u67B6\u6784\u56FE" tabindex="-1"><a class="header-anchor" href="#_1-4-\u9879\u76EE\u67B6\u6784\u56FE" aria-hidden="true">#</a> 1.4 \u9879\u76EE\u67B6\u6784\u56FE</h2><ol><li><h3 id="\u9879\u76EE\u5FAE\u670D\u52A1\u67B6\u6784\u56FE" tabindex="-1"><a class="header-anchor" href="#\u9879\u76EE\u5FAE\u670D\u52A1\u67B6\u6784\u56FE" aria-hidden="true">#</a> \u9879\u76EE\u5FAE\u670D\u52A1\u67B6\u6784\u56FE</h3></li></ol><p><img src="http://qnimg.gisfsde.com/work/1610937357129-af7e3c78-9872-4db0-8d77-1a982788a193.jpeg" alt="\u8C37\u7C92\u5546\u57CE-\u5FAE\u670D\u52A1\u67B6\u6784\u56FE.jpg" loading="lazy"></p><ol start="2"><li><h3 id="\u5FAE\u670D\u52A1\u5212\u5206\u56FE" tabindex="-1"><a class="header-anchor" href="#\u5FAE\u670D\u52A1\u5212\u5206\u56FE" aria-hidden="true">#</a> \u5FAE\u670D\u52A1\u5212\u5206\u56FE</h3></li></ol><p><img src="http://qnimg.gisfsde.com/work/1610938057423-20a6e87f-c156-4a6b-96dc-69b8fe3c9686.png" alt="image-20201015112852613.png" loading="lazy"></p><h2 id="_1-5-\u9879\u76EE\u6280\u672F\u548C\u7279\u8272" tabindex="-1"><a class="header-anchor" href="#_1-5-\u9879\u76EE\u6280\u672F\u548C\u7279\u8272" aria-hidden="true">#</a> 1.5 \u9879\u76EE\u6280\u672F\u548C\u7279\u8272</h2><p>\u25CF \u524D\u540E\u5206\u79BB\u6280\u672F\u3001\u5E76\u5F00\u53D1\u57FA\u4E8E vue \u7684\u540E\u53F0\u7BA1\u7406\u7CFB\u7EDF\u3002</p><p>\u25CFSpringCloud \u5168\u65B0\u7684\u89E3\u51B3\u65B9\u6848</p><p>\u25CF\u5E94\u7528\u76D1\u63A7\u3001\u9650\u6D41\u3001\u7F51\u5173\u3001\u7194\u65AD\u964D\u7EA7\u3001\u7B49\u5206\u5E03\u5F0F\u65B9\u6848\uFF0C\u5168\u65B9\u4F4D\u6D89\u53CA</p><p>\u25CF\u900F\u5F7B\u8BB2\u89E3\u5206\u5E03\u5F0F\u4E8B\u52A1\uFF0C\u5206\u5E03\u5F0F\u9501\u7B49\u5206\u5E03\u5F0F\u7CFB\u7EDF\u7684\u96BE\u70B9</p><p>\u25CF\u538B\u529B\u6D4B\u8BD5\u4E0E\u6027\u80FD\u4F18\u5316</p><p>\u25CF\u5404\u79CD\u96C6\u7FA4\u6280\u672F\u7684\u533A\u522B\u4EE5\u53CA\u4F7F\u7528</p><p>\u25CFCI/CD\u7684\u4F7F\u7528</p><h2 id="_1-6-\u9879\u76EE\u524D\u7F6E\u8981\u6C42" tabindex="-1"><a class="header-anchor" href="#_1-6-\u9879\u76EE\u524D\u7F6E\u8981\u6C42" aria-hidden="true">#</a> 1.6 \u9879\u76EE\u524D\u7F6E\u8981\u6C42</h2><p>\u5B66\u4E60\u9879\u76EE\u7684\u524D\u7F6E\u77E5\u8BC6</p><p>\u25CF\u719F\u6089 Springboot \u4EE5\u53CA\u5E38\u89C1\u7684\u6574\u5408\u65B9\u6848</p><p>\u25CF\u4E86\u89E3 SpringCloud</p><p>\u25CF\u719F\u6089 git maven</p><p>\u25CF\u719F\u6089 Linux \u3001 redis docker \u57FA\u672C\u64CD\u4F5C</p><p>\u25CF\u4E86\u89E3html\u3001css\u3001js \u3001vue</p><p>\u25CF\u719F\u6089\u4F7F\u7528 idea \u5F00\u53D1\u9879\u76EE</p><h1 id="\u4E8C\u3001\u5206\u5E03\u5F0F\u57FA\u7840\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001\u5206\u5E03\u5F0F\u57FA\u7840\u6982\u5FF5" aria-hidden="true">#</a> \u4E8C\u3001\u5206\u5E03\u5F0F\u57FA\u7840\u6982\u5FF5</h1><h2 id="_2-1-\u5FAE\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_2-1-\u5FAE\u670D\u52A1" aria-hidden="true">#</a> 2.1 \u5FAE\u670D\u52A1</h2><p>\u5FAE\u670D\u52A1\u67B6\u6784\u98CE\u683C\uFF0C\u5C31\u50CF\u662F\u628A\u4E00\u4E2A\u5355\u72EC\u7684\u5E94\u7528\u7A0B\u5E8F\u5F00\u53D1\u6210\u4E00\u5957\u5C0F\u670D\u52A1\uFF0C\u6BCF\u4E2A\u5C0F\u670D\u52A1\u8FD0\u884C\u5728\u81EA\u5DF1\u7684\u8FDB\u7A0B\u4E2D\uFF0C\u5E76\u4F7F\u7528\u8F7B\u91CF\u7EA7\u673A\u5236\u901A\u4FE1\uFF0C\u901A\u5E38\u662FHTTP API \u8FD9\u4E9B\u670D\u52A1\u56F4\u7ED5\u4E1A\u52A1\u80FD\u529B\u6765\u6784\u5EFA\uFF0C\u5E76\u901A\u8FC7\u5B8C\u5168\u81EA\u52A8\u5316\u90E8\u7F72\u673A\u5236\u6765\u72EC\u7ACB\u90E8\u7F72\uFF0C\u8FD9\u4E9B\u670D\u52A1\u4F7F\u7528\u4E0D\u540C\u7684\u7F16\u7A0B\u8BED\u8A00\u6765\u5199\uFF0C\u4EE5\u53CA\u4E0D\u540C\u7684\u6570\u636E\u5B58\u50A8\u6280\u672F\uFF0C\u5E76\u4FDD\u6301\u6700\u4F4E\u9650\u5EA6\u7684\u96C6\u4E2D\u5F0F\u7BA1\u7406\u3002</p><p>\u7B80\u800C\u8A00\u4E4B\uFF0C\u62D2\u7EDD\u5927\u578B\u5355\u4F53\u5E94\u7528\uFF0C\u57FA\u4E8E\u4E1A\u52A1\u8FB9\u754C\u8FDB\u884C\u670D\u52A1\u62C6\u5206\uFF0C\u6BCF\u4E2A\u670D\u52A1\u72EC\u7ACB\u90E8\u7F72\u8FD0\u884C\u3002</p><p><img src="http://qnimg.gisfsde.com/work/1610943441881-f899ea10-7007-46a8-870a-331b680ac9ac.png" alt="image-20201015101317095.png" loading="lazy"></p><h2 id="_2-2-\u96C6\u7FA4-\u5206\u5E03\u5F0F-\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#_2-2-\u96C6\u7FA4-\u5206\u5E03\u5F0F-\u8282\u70B9" aria-hidden="true">#</a> 2.2 \u96C6\u7FA4 &amp; \u5206\u5E03\u5F0F &amp; \u8282\u70B9</h2><p>\u96C6\u7FA4\u662F\u4E2A\u7269\u7406\u72B6\u6001\uFF0C\u5206\u5E03\u5F0F\u662F\u4E2A\u5DE5\u4F5C\u65B9\u5F0F\u3002</p><p>\u53EA\u8981\u662F\u4E00\u5BF9\u673A\u5668\uFF0C\u4E5F\u53EF\u4EE5\u53EB\u505A\u96C6\u7FA4\uFF0C\u4ED6\u4E0D\u662F\u4E00\u8D77\u534F\u4F5C\u5E72\u6D3B\uFF0C\u8FD9\u8C01\u4E5F\u4E0D\u77E5\u9053\u3002</p><p>\u300A\u5206\u5E03\u5F0F\u7CFB\u7EDF\u539F\u7406\u4E0E\u8303\u578B\u300B\u5B9A\u4E49\uFF1A</p><p>\u201C\u5206\u5E03\u5F0F\u7CFB\u7EDF\u662F\u82E5\u5E72\u72EC\u7ACB\u8BA1\u7B97\u673A\u7684\u96C6\u5408\uFF0C\u8FD9\u4E9B\u8BA1\u7B97\u673A\u5BF9\u4E8E\u7528\u6237\u6765\u8BF4\u50CF\u4F46\u5404\u76F8\u5173\u7CFB\u7EDF\u201D</p><p>\u5206\u5E03\u5F0F\u7CFB\u7EDF (distributed system) \u662F\u5EFA\u7ACB\u7F51\u7EDC\u4E4B\u4E0A\u7684\u8F6F\u4EF6\u7CFB\u7EDF \u5206\u5E03\u5F0F\u662F\u6307\u8BB2\u4E0D\u901A\u7684\u4E1A\u52A1\u5206\u5E03\u5728\u4E0D\u540C\u7684\u5730\u65B9 \u96C6\u7FA4\u5B9E\u8D28\u662F\u5C06\u51E0\u53F0\u670D\u52A1\u5668\u96C6\u4E2D\u5728\u4E00\u8D77\uFF0C\u5B9E\u73B0\u540C\u4E00\u4E1A\u52A1 \u4F8B\u5982\uFF1A\u4EAC\u4E1C\u662F\u4E00\u4E2A\u5206\u5E03\u5F0F\u7CFB\u7EDF\uFF0C\u4F17\u591A\u4E1A\u52A1\u8FD0\u884C\u5728\u4E0D\u540C\u7684\u673A\u5668\u4E0A\uFF0C\u6240\u6709\u4E1A\u52A1\u6784\u6210\u4E00\u4E2A\u5927\u578B\u7684\u4E1A\u52A1\u96C6\u7FA4\uFF0C\u6BCF\u4E00\u4E2A\u5C0F\u7684\u4E1A\u52A1\uFF0C\u6BD4\u5982\u7528\u6237\u7CFB\u7EDF\uFF0C\u8BBF\u95EE\u538B\u529B\u5927\u7684\u65F6\u5019\u4E00\u53F0\u670D\u52A1\u5668\u662F\u4E0D\u591F\u7684\uFF0C\u6211\u4EEC\u5C31\u5E94\u8BE5\u5C06\u7528\u6237\u7CFB\u7EDF\u90E8\u7F72\u5230\u591A\u4E2A\u670D\u52A1\u5668\uFF0C\u4E5F\u5C31\u662F\u6BCF\u4E2A\u4E00\u4E1A\u52A1\u7CFB\u7EDF\u4E5F\u53EF\u4EE5\u505A\u96C6\u7FA4\u5316</p><p>\u5206\u5E03\u5F0F\u4E2D\u7684\u6BCF\u4E00\u4E2A\u8282\u70B9\uFF0C\u90FD\u53EF\u4EE5\u505A\u96C6\u7FA4\uFF0C\u800C\u96C6\u7FA4\u5E76\u4E0D\u4E00\u5B9A\u5C31\u662F\u5206\u5E03\u5F0F\u7684</p><p>\u8282\u70B9\uFF1A\u96C6\u7FA4\u4E2D\u7684\u4E00\u4E2A\u670D\u52A1\u5668</p><h2 id="_2-3-\u8FDC\u7A0B\u8C03\u7528" tabindex="-1"><a class="header-anchor" href="#_2-3-\u8FDC\u7A0B\u8C03\u7528" aria-hidden="true">#</a> 2.3 \u8FDC\u7A0B\u8C03\u7528</h2><p>\u5728\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\uFF0C\u5404\u4E2A\u670D\u52A1\u53EF\u80FD\u5904\u4E8E\u4E0D\u540C\u4E3B\u673A\uFF0C\u4F46\u662F\u670D\u52A1\u4E4B\u95F4\u4E0D\u53EF\u907F\u514D\u7684\u9700\u8981\u4E92\u76F8\u8C03\u7528\uFF0C\u6211\u4EEC\u79F0\u4E4B\u4E3A\u8FDC\u7A0B\u8C03\u7528</p><p>SpringCloud \u4E2D\u4F7F\u7528 HTTP + JSON \u7684\u65B9\u5F0F\u6765\u5B8C\u6210\u8FDC\u7A0B\u8C03\u7528\u3002</p><p>HTTP+JSON</p><p><img src="http://qnimg.gisfsde.com/work/1610943854828-5998cdc5-0ece-453f-976d-5866876f02fa.png" alt="image-20201015103427667.png" loading="lazy"></p><h2 id="_2-4-\u8D1F\u8F7D\u5747\u8861" tabindex="-1"><a class="header-anchor" href="#_2-4-\u8D1F\u8F7D\u5747\u8861" aria-hidden="true">#</a> 2.4 \u8D1F\u8F7D\u5747\u8861</h2><p><img src="http://qnimg.gisfsde.com/work/1610943916861-7de530e5-43b4-4543-8f87-104f0da5af10.png" alt="image-20201015103547907.png" loading="lazy"></p><p>\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\uFF0CA \u670D\u52A1\u9700\u8981\u8C03\u7528 B \u670D\u52A1\uFF0CB \u670D\u52A1\u5728\u591A\u53F0\u673A\u5668\u4E2D\u90FD\u5B58\u5728\uFF0CA \u8C03\u7528\u4EFB\u610F\u4E00\u4E2A\u670D\u52A1\u5668\u5747\u53EF\u5B8C\u6210\u529F\u80FD\u3002</p><p>\u4E3A\u4E86\u4F7F\u6BCF\u4E00\u4E2A\u670D\u52A1\u5668\u90FD\u4E0D\u8981\u592A\u5FD9\u540E\u8005\u592A\u95F2\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8D1F\u8F7D\u5747\u8861\u8C03\u7528\u6BCF\u4E00\u4E2A\u670D\u52A1\u5668\uFF0C\u63D0\u5347\u7F51\u7AD9\u7684\u5065\u58EE\u6027\u3002</p><p>\u5E38\u89C1\u7684\u8D1F\u8F7D\u5747\u7B97\u6CD5\uFF1A</p><p>\u8F6E\u8BE2\uFF1A \u4E3A\u7B2C\u4E00\u4E2A\u8BF7\u6C42\u9009\u62E9\u5065\u5EB7\u6C60\u4E2D\u7684\u7B2C\u4E00\u4E2A\u540E\u7AEF\u670D\u52A1\u5668\uFF0C\u7136\u540E\u6309\u987A\u5E8F\u5F80\u540E\u4F9D\u6B21\u9009\u62E9\uFF0C\u76F4\u5230\u6700\u540E\u4E00\u4E2A\uFF0C\u7136\u540E\u5FAA\u73AF\u3002 \u6700\u5C0F\u8FDE\u63A5\uFF1A \u4F18\u5148\u9009\u62E9\u8FDE\u63A5\u6570\u6700\u5C11\uFF0C\u4E5F\u5C31\u662F\u538B\u529B\u6700\u5C0F\u7684\u540E\u7AEF\u670D\u52A1\u5668\uFF0C\u5728\u4F1A\u8BDD\u8F83\u957F\u7684\u60C5\u51B5\u4E0B\u53EF\u4EE5\u8003\u8651\u91C7\u53D6\u8FD9\u79CD\u65B9\u5F0F\u3002</p><h2 id="_2-5-\u670D\u52A1\u6CE8\u518C-\u53D1\u73B0-\u6CE8\u518C\u4E2D\u5FC3" tabindex="-1"><a class="header-anchor" href="#_2-5-\u670D\u52A1\u6CE8\u518C-\u53D1\u73B0-\u6CE8\u518C\u4E2D\u5FC3" aria-hidden="true">#</a> 2.5 \u670D\u52A1\u6CE8\u518C/\u53D1\u73B0 &amp; \u6CE8\u518C\u4E2D\u5FC3</h2><p>A \u670D\u52A1\u8C03\u7528 B \u670D\u52A1\uFF0C A \u670D\u52A1 \u4E0D\u77E5\u9053 B \u670D\u52A1\u5F53\u524D\u5728\u54EA\u51E0\u53F0\u670D\u52A1\u5668\u4E0A\u6709\uFF0C\u90A3\u4E9B\u6B63\u5E38\u7684\uFF0C\u90A3\u4E9B\u670D\u52A1\u5DF2\u7ECF\u4E0B\u7EBF\uFF0C\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u53EF\u4EE5\u5F15\u5165\u6CE8\u518C\u4E2D\u5FC3\u3002</p><p><img src="http://qnimg.gisfsde.com/work/1610946745993-411f3672-87aa-4440-8974-fecb57c54204.png" alt="image-20201015104330935.png" loading="lazy"></p><p>\u5982\u679C\u67D0\u4E9B\u670D\u52A1\u4E0B\u7EBF\uFF0C\u6211\u4EEC\u5176\u4ED6\u4EBA\u53EF\u4EE5\u5B9E\u65F6\u7684\u611F\u77E5\u5230\u5176\u4ED6\u670D\u52A1\u7684\u72B6\u6001\uFF0C\u4ECE\u800C\u907F\u514D\u8C03\u7528\u4E0D\u53EF\u7528\u7684\u670D\u52A1\u3002</p><h2 id="_2-6-\u914D\u7F6E\u4E2D\u5FC3" tabindex="-1"><a class="header-anchor" href="#_2-6-\u914D\u7F6E\u4E2D\u5FC3" aria-hidden="true">#</a> 2.6 \u914D\u7F6E\u4E2D\u5FC3</h2><p><img src="http://qnimg.gisfsde.com/work/1610946879552-b1d838ea-605c-4ee3-871c-25dd9123faa0.png" alt="image-20201015104450711.png" loading="lazy"></p><p>\u6BCF\u4E00\u4E2A\u670D\u52A1\u6700\u7EC8\u90FD\u6709\u5927\u91CF\u914D\u7F6E\uFF0C\u5E76\u4E14\u6BCF\u4E2A\u670D\u52A1\u90FD\u53EF\u80FD\u90E8\u7F72\u5728\u591A\u4E2A\u670D\u52A1\u5668\u4E0A\uFF0C\u6211\u4EEC\u7ECF\u5E38\u9700\u8981\u53D8\u66F4\u914D\u7F6E\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8BA9\u6BCF\u4E2A\u670D\u52A1\u5728\u914D\u7F6E\u4E2D\u5FC3\u83B7\u53D6\u81EA\u5DF1\u7684\u914D\u7F6E\uFF0C\u914D\u7F6E\u4E2D\u5FC3\u7528\u6765\u96C6\u4E2D\u7BA1\u7406\u5FAE\u670D\u52A1\u7684\u914D\u7F6E\u4FE1\u606F\u3002</p><h2 id="_2-7-\u670D\u52A1\u7194\u65AD-\u670D\u52A1\u964D\u7EA7" tabindex="-1"><a class="header-anchor" href="#_2-7-\u670D\u52A1\u7194\u65AD-\u670D\u52A1\u964D\u7EA7" aria-hidden="true">#</a> 2.7 \u670D\u52A1\u7194\u65AD &amp; \u670D\u52A1\u964D\u7EA7</h2><p>\u5728\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\uFF0C\u5FAE\u670D\u52A1\u4E4B\u95F4\u901A\u8FC7\u7F51\u7EDC\u6765\u8FDB\u884C\u901A\u4FE1\uFF0C\u5B58\u5728\u76F8\u4E92\u4F9D\u8D56\uFF0C\u5F53\u5176\u4E2D\u4E00\u4E2A\u670D\u52A1\u4E0D\u53EF\u7528\u65F6\uFF0C\u6709\u53EF\u80FD\u4F1A\u9020\u6210\u96EA\u5D29\u6548\u5E94\uFF0C\u8981\u9632\u6B62\u8FD9\u79CD\u60C5\u51B5\uFF0C\u5FC5\u987B\u8981\u6709\u5BB9\u9519\u673A\u5236\u6765\u4FDD\u8BC1\u670D\u52A1\u3002</p><p><img src="http://qnimg.gisfsde.com/work/1610947257467-3299ac4c-69de-4553-aec8-7972fa6da25e.png" alt="image-20201015105256207.png" loading="lazy"></p><ol><li><h3 id="\u670D\u52A1\u7194\u65AD" tabindex="-1"><a class="header-anchor" href="#\u670D\u52A1\u7194\u65AD" aria-hidden="true">#</a> \u670D\u52A1\u7194\u65AD</h3></li></ol><p>\u25CF\u8BBE\u7F6E\u670D\u52A1\u7684\u8D85\u65F6\uFF0C\u5F53\u88AB\u8C03\u7528\u7684\u670D\u52A1\u7ECF\u5E38\u5931\u8D25\u8FBE\u5230\u67D0\u4E2A\u9608\u503C\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5F00\u542F\u77ED\u8DEF\u4FDD\u62A4\u673A\u5236\uFF0C\u540E\u6765\u7684\u8BF7\u6C42\u4E0D\u518D\u53BB\u8C03\u7528\u8FD9\u4E2A\u670D\u52A1\uFF0C\u672C\u5730\u76F4\u63A5\u8FD4\u56DE\u9ED8\u8BA4\u7684\u6570\u636E\u3002</p><ol start="2"><li><h3 id="\u670D\u52A1\u964D\u7EA7" tabindex="-1"><a class="header-anchor" href="#\u670D\u52A1\u964D\u7EA7" aria-hidden="true">#</a> \u670D\u52A1\u964D\u7EA7</h3></li></ol><p>\u25CF\u5728\u8FD0\u7EF4\u671F\u95F4\uFF0C\u5F53\u7CFB\u7EDF\u5904\u4E8E\u9AD8\u5CF0\u671F\uFF0C\u7CFB\u7EDF\u8D44\u6E90\u7D27\u5F20\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8BA9\u975E\u6838\u5FC3\u4E1A\u52A1\u964D\u7EA7\u8FD0\u884C\uFF0C\u964D\u7EA7\u67D0\u4E9B\u670D\u52A1\u4E0D\u5904\u7406\uFF0C\u6216\u8005\u7B80\u5355\u5904\u7406\u3010\u629B\u5F02\u5E38\uFF0C\u8FD4\u56DENULL\uFF0C\u8C03\u7528MOCk\u6570\u636E\uFF0C\u8C03\u7528FallBack\u5904\u7406\u903B\u8F91\u3011</p><h2 id="_2-8-api\u7F51\u5173" tabindex="-1"><a class="header-anchor" href="#_2-8-api\u7F51\u5173" aria-hidden="true">#</a> 2.8 Api\u7F51\u5173</h2><p>\u5728\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\uFF0C Api Gateway \u4F5C\u4E3A\u6574\u4F53\u67B6\u6784\u7684\u91CD\u8981\u7EC4\u4EF6\uFF0C\u5B83\u62BD\u8C61\u670D\u52A1\u4E2D\u9700\u8981\u7684\u516C\u5171\u529F\u80FD\uFF0C\u540C\u65F6\u5B83\u63D0\u4F9B\u7ED9\u4E86\u5BA2\u6237\u7AEF\u8D1F\u8F7D\u5747\u8861\u3001\u670D\u52A1\u81EA\u52A8\u7194\u65AD\u3001\u7070\u5EA6\u53D1\u5E03\u3001\u7EDF\u4E00\u8BA4\u8BC1\u3001\u9650\u6D41\u76D1\u63A7\u3001\u65E5\u5FD7\u7EDF\u8BA1 \u7B49 \u4E30\u5BCC\u529F\u80FD\uFF0C\u5E2E\u52A9\u6211\u4EEC\u89E3\u51B3\u4E86\u5F88\u591A API \u7BA1\u7406\u7684\u96BE\u9898 \u3002</p><p><img src="http://qnimg.gisfsde.com/work/1610947741988-1bfd6a06-45bb-48f4-9849-a6fa424c30e9.png" alt="image-20201015110148578.png" loading="lazy"></p><h1 id="\u4E09\u3001\u642D\u5EFA\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#\u4E09\u3001\u642D\u5EFA\u73AF\u5883" aria-hidden="true">#</a> \u4E09\u3001\u642D\u5EFA\u73AF\u5883</h1><h2 id="_3-1-\u5B89\u88C5-linux-\u865A\u62DF\u673A" tabindex="-1"><a class="header-anchor" href="#_3-1-\u5B89\u88C5-linux-\u865A\u62DF\u673A" aria-hidden="true">#</a> 3.1 \u5B89\u88C5 Linux \u865A\u62DF\u673A</h2>',78),P=s("\u4E0B\u8F7D&\u5B89\u88C5 VirtualBox "),T={href:"https://www.virtualbox.org/",target:"_blank",rel:"noopener noreferrer"},L=s("https://www.virtualbox.org/"),V=s(" \u8981\u5F00\u542F CPU \u865A\u62DF\u5316"),D=n("h3",{id:"\u4E0B\u8F7D-\u5B89\u88C5-vagrant",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u4E0B\u8F7D-\u5B89\u88C5-vagrant","aria-hidden":"true"},"#"),s(" \u4E0B\u8F7D& \u5B89\u88C5 Vagrant")],-1),B={href:"https://app.vagrantup.com/boxes/search",target:"_blank",rel:"noopener noreferrer"},M=s("https://app.vagrantup.com/boxes/search"),U=s(" Vagrant \u5B98\u65B9\u955C\u50CF\u4ED3\u5E93"),N={href:"https://www.vagrantup.com/downloads.html",target:"_blank",rel:"noopener noreferrer"},z=s("https://www.vagrantup.com/downloads.html"),F=s(" Vagrant\u4E0B\u8F7D"),G=p(`<p>\u6253\u5F00window cmd\u7A97\u53E3\uFF0C\u8FD0\u884C<strong>Vagrant init centos/7</strong> ,\u5373\u53EF<strong>\u521D\u59CB\u5316</strong>\u4E00\u4E2Acentos\u7CFB\u7EDF</p><p>\u8FD0\u884C<strong>vagrant up</strong>\u5373\u53EF<strong>\u542F\u52A8</strong>\u865A\u62DF\u673A\u3002<strong>\u7CFB\u7EDFroot\u7528\u6237\u7684\u5BC6\u7801\u662Fvagrant</strong></p><p><strong>vagrant\u5176\u4ED6\u5E38\u7528\u547D\u4EE4</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>vagrant <span class="token function">ssh</span> \u81EA\u52A8\u4F7F\u7528 vagrant \u7528\u6237\u8FDE\u63A5\u865A\u62DF\u673A

vagrant upload <span class="token builtin class-name">source</span> <span class="token punctuation">[</span>destination<span class="token punctuation">]</span> <span class="token punctuation">[</span>name<span class="token operator">|</span>id<span class="token punctuation">]</span> \u4E0A\u4F20\u6587\u4EF6

https://www.vagrantup.com/docs/cli/init.html Vagrant \u547D\u4EE4\u884C

vagrant reload \u91CD\u542F\u5E76\u91CD\u65B0\u52A0\u8F7DVagrantfile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9ED8\u8BA4\u865A\u62DF\u673A\u7684ip \u5730\u5740\u4E0D\u662F\u56FA\u5B9Aip \u5F00\u53D1\u4E0D\u65B9\u4FBF</p><p>Vagrant \u548C VirtualBox \u7248\u672C\u6709\u5BF9\u5E94\u95EE\u9898 \u90FD\u5B89\u88C5\u6700\u65B0\u7248\u672C \u5219\u5B89\u88C5\u6210\u529F</p><p><strong>\u4FEE\u6539 Vagrantfile</strong></p><p>config.vm.network &quot;private_network&quot;, ip: &quot;192.168.56.10&quot;</p><p>\u8FD9\u91CC ip \u9700\u8981\u5728 \u7269\u7406\u673A\u4E0B\u4F7F\u7528 ipconfig \u547D\u4EE4\u627E\u5230</p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/440247/1610948554518-f1099be6-606a-455c-b1bf-402c52057afe.png" alt="image-20201015141629387.png" loading="lazy"></p><h2 id="_3-2-\u5B89\u88C5-docker" tabindex="-1"><a class="header-anchor" href="#_3-2-\u5B89\u88C5-docker" aria-hidden="true">#</a> 3.2 \u5B89\u88C5 docker</h2>`,11),Q=s("Docker \u53C2\u8003 "),H={href:"https://www.docker.com/",target:"_blank",rel:"noopener noreferrer"},W=s("Docker"),J=p(`<h3 id="_3-2-1-\u5378\u8F7D\u7CFB\u7EDF\u4E4B\u524D\u5B89\u88C5\u7684docker" tabindex="-1"><a class="header-anchor" href="#_3-2-1-\u5378\u8F7D\u7CFB\u7EDF\u4E4B\u524D\u5B89\u88C5\u7684docker" aria-hidden="true">#</a> 3.2.1 \u5378\u8F7D\u7CFB\u7EDF\u4E4B\u524D\u5B89\u88C5\u7684docker</h3><p>Uninstall old versions.</p><p>\u4E00\u6B65\u4E00\u6B65\u5F80\u4E0B\u6267\u884C\u5C31\u884C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum remove <span class="token function">docker</span> <span class="token punctuation">\\</span>
                  docker-client <span class="token punctuation">\\</span>
                  docker-client-latest <span class="token punctuation">\\</span>
                  docker-common <span class="token punctuation">\\</span>
                  docker-latest <span class="token punctuation">\\</span>
                  docker-latest-logrotate <span class="token punctuation">\\</span>
                  docker-logrotate <span class="token punctuation">\\</span>
                  docker-engine
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SET UP THE REPOSITORY</p><p>Install the yum-utils package (which provides the yum-config-manager utility) and set up the stable repository.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils
<span class="token function">sudo</span> yum-config-manager <span class="token punctuation">\\</span>
    --add-repo <span class="token punctuation">\\</span>
    https://download.docker.com/linux/centos/docker-ce.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>INSTALL DOCKER ENGINE 1.Install the latest version of Docker Engine and containerd, or go to the next step to install a specific version:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Start Docker</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl start <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Verify that Docker Engine is installed correctly by running the hello-world image.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">docker</span> run hello-world
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8BBE\u7F6E docker \u5F00\u673A\u81EA\u542F\u52A8</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u67E5\u770BDocker\u7684\u955C\u50CF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">docker</span> images
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8BBE\u7F6E Docker \u955C\u50CF\u52A0\u901F</p>`,18),K=s("\u767B\u5F55 "),$={href:"http://aliyun.com",target:"_blank",rel:"noopener noreferrer"},X=s("aliyun.com"),Y=s(" \u5728\u63A7\u5236\u53F0\u627E\u5230\u5BB9\u5668\u955C\u50CF\u670D\u52A1"),Z=p(`<p><img src="https://cdn.nlark.com/yuque/0/2021/png/440247/1610948939792-421b248d-416d-4c57-b18d-33b5b9a3fbbb.png" alt="image-20201015144524435.png" loading="lazy"></p><p>docker \u8FDB\u5165 \u5BF9\u5E94\u5BB9\u5668</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">ps</span>  <span class="token comment">#\u67E5\u770B\u4E3B\u673A\u6709\u54EA\u4E9B\u5BB9\u5668\u6B63\u5728\u8FD0\u884C</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it \u5BB9\u5668ID/NAME /bin/bash  <span class="token comment">#\u8FDB\u5165\u5BF9\u5E94\u5BB9\u5668</span>
<span class="token builtin class-name">exit</span><span class="token punctuation">;</span> <span class="token comment">#\u9000\u51FA\u5BB9\u5668[\u5FEB\u6377\u952E ctrl + p/q]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-3-docker-\u5B89\u88C5-mysql" tabindex="-1"><a class="header-anchor" href="#_3-3-docker-\u5B89\u88C5-mysql" aria-hidden="true">#</a> 3.3 docker \u5B89\u88C5 mysql</h2><h3 id="_3-3-1-\u4E0B\u8F7D\u955C\u50CF\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_3-3-1-\u4E0B\u8F7D\u955C\u50CF\u6587\u4EF6" aria-hidden="true">#</a> 3.3.1 \u4E0B\u8F7D\u955C\u50CF\u6587\u4EF6</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">docker</span> pull mysql:5.7
<span class="token function">sudo</span> <span class="token function">docker</span> images
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>3.3.2 \u521B\u5EFA\u5B9E\u4F8B\u5E76\u542F\u52A8</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># --name\u6307\u5B9A\u5BB9\u5668\u540D\u5B57 -v\u76EE\u5F55\u6302\u8F7D -p\u6307\u5B9A\u7AEF\u53E3\u6620\u5C04  -e\u8BBE\u7F6Emysql\u53C2\u6570 -d\u540E\u53F0\u8FD0\u884C</span>
<span class="token function">sudo</span> <span class="token function">docker</span> run -p <span class="token number">3306</span>:3306 --name mysql <span class="token punctuation">\\</span>
-v /mydata/mysql/log:/var/log/mysql <span class="token punctuation">\\</span>
-v /mydata/mysql/data:/var/lib/mysql <span class="token punctuation">\\</span>
-v /mydata/mysql/conf:/etc/mysql <span class="token punctuation">\\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root <span class="token punctuation">\\</span>
-d mysql:5.7
<span class="token comment">####</span>
-v \u5C06\u5BF9\u5E94\u6587\u4EF6\u6302\u8F7D\u5230\u4E3B\u673A\u3010\u7C7B\u4F3C\u5FEB\u6377\u65B9\u5F0F\uFF0C\u4E24\u8005\u5185\u5BB9\u540C\u6B65\u3011\uFF0C\u6BD4\u5982-v /mydata/mysql/log\u3010\u4E3B\u673A\u5FEB\u6377\u65B9\u5F0F\u3011:/var/log/mysql\u3010\u5BB9\u5668\u4E2D\u6587\u4EF6\u5939\u3011
-e \u521D\u59CB\u5316\u5BF9\u5E94MYSQL\u53C2\u6570
-p \u5BB9\u5668\u7AEF\u53E3\u6620\u5C04\u5230\u4E3B\u673A\u7684\u7AEF\u53E3
<span class="token function">su</span> root
<span class="token function">docker</span> <span class="token function">ps</span>  <span class="token comment">#\u67E5\u770B\u4E3B\u673A\u6709\u54EA\u4E9B\u5BB9\u5668\u6B63\u5728\u8FD0\u884C</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>MySQL \u914D\u7F6E</p><p>vi /mydata/mysql/conf/my.cnf \u521B\u5EFA&amp;\u4FEE\u6539\u8BE5\u6587\u4EF6</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[client]
default-character-set=utf8
[mysql]
default-character-set=utf8
[mysqld]
init_connect=&#39;SET collation_connection = utf8_unicode_ci&#39;
init_connect=&#39;SET NAMES utf8&#39;
character-set-server=utf8
collation-server=utf8_unicode_ci
skip-character-set-client-handshake
skip-name-resolve
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u91CD\u542Fmysql</span>
<span class="token function">docker</span> restart mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-3-\u901A\u8FC7\u5BB9\u5668\u7684mysql-\u547D\u4EE4\u5DE5\u5177\u8FDE\u63A5" tabindex="-1"><a class="header-anchor" href="#_3-3-3-\u901A\u8FC7\u5BB9\u5668\u7684mysql-\u547D\u4EE4\u5DE5\u5177\u8FDE\u63A5" aria-hidden="true">#</a> 3.3.3 \u901A\u8FC7\u5BB9\u5668\u7684mysql \u547D\u4EE4\u5DE5\u5177\u8FDE\u63A5</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/440247/1610949284748-a37e0692-eb52-449c-861c-2fb73d627668.png" alt="image.png" loading="lazy"></p><h2 id="_3-4-docker-\u5B89\u88C5-redis" tabindex="-1"><a class="header-anchor" href="#_3-4-docker-\u5B89\u88C5-redis" aria-hidden="true">#</a> 3.4 docker \u5B89\u88C5 redis</h2><h3 id="_3-4-1-\u4E0B\u8F7D\u955C\u50CF\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_3-4-1-\u4E0B\u8F7D\u955C\u50CF\u6587\u4EF6" aria-hidden="true">#</a> 3.4.1 \u4E0B\u8F7D\u955C\u50CF\u6587\u4EF6</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker pull redis
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-4-2-\u521B\u5EFA\u5B9E\u4F8B\u5E76\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#_3-4-2-\u521B\u5EFA\u5B9E\u4F8B\u5E76\u542F\u52A8" aria-hidden="true">#</a> 3.4.2 \u521B\u5EFA\u5B9E\u4F8B\u5E76\u542F\u52A8</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u5148\u521B\u5EFA\u6587\u4EF6\u5939\u548C\u6587\u4EF6\u518D\u6302\u8F7D\uFF0C\u5426\u5219\u4F1A\u5C06\u5176\u6587\u4EF6\u540D\u521B\u5EFA\u4E3A\u6587\u4EF6\u5939</span>
<span class="token function">mkdir</span> -p /mydata/redis/conf
<span class="token function">touch</span> /mydata/redis/conf/redis.conf
<span class="token comment"># \u542F\u52A8 \u540C\u65F6 \u6620\u5C04\u5230\u5BF9\u5E94\u6587\u4EF6\u5939</span>
<span class="token comment"># \u540E\u9762 \\ \u4EE3\u8868\u6362\u884C</span>
<span class="token function">docker</span> run -p <span class="token number">6379</span>:6379 --name redis <span class="token punctuation">\\</span>
-v /mydata/redis/data:/data <span class="token punctuation">\\</span>
-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\\</span>
-d redis redis-server /etc/redis/redis.conf

<span class="token function">docker</span> <span class="token function">ps</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-3-\u4F7F\u7528-redis-\u955C\u50CF\u6267\u884C-redis-cli-\u547D\u4EE4\u8FDE\u63A5" tabindex="-1"><a class="header-anchor" href="#_3-4-3-\u4F7F\u7528-redis-\u955C\u50CF\u6267\u884C-redis-cli-\u547D\u4EE4\u8FDE\u63A5" aria-hidden="true">#</a> 3.4.3 \u4F7F\u7528 redis \u955C\u50CF\u6267\u884C redis-cli \u547D\u4EE4\u8FDE\u63A5</h3><p>\u8FDB\u5165docker cli</p><p>docker exec -it redis redis-cli</p><p>\u6301\u4E45\u5316 \u9ED8\u8BA4 appendonly on \u6CA1\u6709\u5F00\u542F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vi</span> /mydata/redis/conf/redis.conf
<span class="token comment"># \u63D2\u5165\u4E0B\u9762\u5185\u5BB9</span>
appendonly <span class="token function">yes</span>
<span class="token function">docker</span> restart redis
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-5-\u5F00\u53D1\u73AF\u5883\u7EDF\u4E00" tabindex="-1"><a class="header-anchor" href="#_3-5-\u5F00\u53D1\u73AF\u5883\u7EDF\u4E00" aria-hidden="true">#</a> 3.5 \u5F00\u53D1\u73AF\u5883\u7EDF\u4E00</h2><h3 id="_3-5-1-maven\u7248\u672C\u4E0E\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3-5-1-maven\u7248\u672C\u4E0E\u914D\u7F6E" aria-hidden="true">#</a> 3.5.1 Maven\u7248\u672C\u4E0E\u914D\u7F6E</h3><h4 id="_1-\u914D\u7F6E\u963F\u91CC\u4E91\u955C\u50CF" tabindex="-1"><a class="header-anchor" href="#_1-\u914D\u7F6E\u963F\u91CC\u4E91\u955C\u50CF" aria-hidden="true">#</a> 1.\u914D\u7F6E\u963F\u91CC\u4E91\u955C\u50CF</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrors</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>nexus-aliyun\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>central\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Nexus aliyun\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://maven.aliyun.com/nexus/content/groups/public\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrors</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><h4 id="\u914D\u7F6E-jdk-1-8-\u7F16\u8BD1\u9879\u76EE" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E-jdk-1-8-\u7F16\u8BD1\u9879\u76EE" aria-hidden="true">#</a> \u914D\u7F6E jdk 1.8 \u7F16\u8BD1\u9879\u76EE</h4></li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>jdk-1.8\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>true\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdk</span><span class="token punctuation">&gt;</span></span>1.8\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdk</span><span class="token punctuation">&gt;</span></span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">&gt;</span></span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>1.8\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>1.8\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.compilerVersion</span><span class="token punctuation">&gt;</span></span>1.8\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.compilerVersion</span><span class="token punctuation">&gt;</span></span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>
  \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-2-idea-vscode" tabindex="-1"><a class="header-anchor" href="#_3-5-2-idea-vscode" aria-hidden="true">#</a> 3.5.2 idea &amp; vscode</h3>`,31),nn={href:"https://github.com/varHarrie/varharrie.github.io/issues/10",target:"_blank",rel:"noopener noreferrer"},sn=s("VSCode\u63D2\u4EF6"),an=p(`<p>Vetur \u2014\u2014\u8BED\u6CD5\u9AD8\u4EAE\uFF0C\u667A\u80FD\u611F\u77E5 \u5305\u542B\u683C\u5F0F\u5316\u529F\u80FD\uFF0CAlt+Shift+F (\u683C\u5F0F\u5316\u5168\u6587) \uFF0CCtrl+K Ctrl+F (\u683C\u5F0F\u5316\u9009\u4E2D\u4EE3\u7801\uFF0C\u4E24\u4E2ACtrl\u9700\u8981\u540C\u65F6\u6309\u7740) EsLint \u4E00\u4E00 \u8BED\u6CD5\u7EA0\u9519 Auto Close Tag \u4E00\u4E00 \u81EA\u52A8\u95ED\u5408HTML/XML\u6807\u7B7E Auto Rename Tag \u4E00\u4E00 \u81EA\u52A8\u5B8C\u6210\u53E6-\u4FA7\u6807\u7B7E\u7684\u540C\u6B65\u4FEE\u6539 JavaScript(ES6) code snippets \u4E00\u4E00 ES6 \u8BED\u6CD5\u667A\u80FD\u63D0\u793A\u4EE5\u53CA\u5FEB\u901F\u8F93\u5165\uFF0C\u9664j\u5916\u8FD8\u652F\u6301.ts, .jsx\uFF0C .tsx\uFF0C .html, .vue;\u7701\u53BB\u4E86\u914D\u7F6E\u5176\u652F\u6301\u5404\u79CD\u5305\u542Bis\u4EE3\u7801\u6587\u4EF6\u7684\u65F6\u95F4</p><h3 id="_3-5-3-mybatisplus\u6574\u5408" tabindex="-1"><a class="header-anchor" href="#_3-5-3-mybatisplus\u6574\u5408" aria-hidden="true">#</a> 3.5.3 MybatisPlus\u6574\u5408</h3><h4 id="_4-1-\u914D\u7F6E\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#_4-1-\u914D\u7F6E\u73AF\u5883" aria-hidden="true">#</a> 4.1 \u914D\u7F6E\u73AF\u5883</h4><h5 id="_4-1-1\u3001\u5BFC\u5165\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_4-1-1\u3001\u5BFC\u5165\u4F9D\u8D56" aria-hidden="true">#</a> 4.1.1\u3001\u5BFC\u5165\u4F9D\u8D56</h5><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-2-2\u3001\u914D\u7F6E\u6570\u636E\u6E90" tabindex="-1"><a class="header-anchor" href="#_4-2-2\u3001\u914D\u7F6E\u6570\u636E\u6E90" aria-hidden="true">#</a> 4.2.2\u3001\u914D\u7F6E\u6570\u636E\u6E90</h5><p>\u914D\u7F6E\u6570\u636E\u6E90</p>`,7),tn=n("h6",{id:"\u5BFC\u5165\u6570\u636E\u5E93\u9A71\u52A8",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5BFC\u5165\u6570\u636E\u5E93\u9A71\u52A8","aria-hidden":"true"},"#"),s(" \u5BFC\u5165\u6570\u636E\u5E93\u9A71\u52A8")],-1),pn={href:"https://mvnrepository.com/artifact/mysql/mysql-connector-java",target:"_blank",rel:"noopener noreferrer"},en=s("https://mvnrepository.com/artifact/mysql/mysql-connector-java"),on=p(`<div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token comment">&lt;!--\u5BFC\u5165mysql\u9A71\u52A8--&gt;</span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.17\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),cn=p(`<li><h6 id="\u5728application-yml\u914D\u7F6E\u6570\u636E\u6E90\u76F8\u5173\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#\u5728application-yml\u914D\u7F6E\u6570\u636E\u6E90\u76F8\u5173\u4FE1\u606F" aria-hidden="true">#</a> \u5728application.yml\u914D\u7F6E\u6570\u636E\u6E90\u76F8\u5173\u4FE1\u606F</h6><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.56.10<span class="token punctuation">:</span>3306/gulimall_pms
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
	<span class="token comment"># mapper\u6587\u4EF6\u626B\u63CF</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token important">*:/mapper/**/*.xml</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto <span class="token comment"># \u6570\u636E\u5E93\u4E3B\u952E\u81EA\u589E</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>`,1),ln=p(`<p>\u914D\u7F6EMyBatis-Plus\u5305\u626B\u63CF\uFF1A</p><ol><li><p>\u4F7F\u7528@MapperScanner</p></li><li><p>\u544A\u8BC9MyBatis-Plus,Sql\u6620\u5C04\u6587\u4EF6\u4F4D\u7F6E</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.gulimall.product.dao&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallProductApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">GulimallProductApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol>`,2),un=s("\u5177\u4F53\u8FC7\u7A0B\u53C2\u8003\u5B98\u7F51\uFF1A "),rn={href:"https://baomidou.com/guide/install.html#release",target:"_blank",rel:"noopener noreferrer"},kn=s("https://baomidou.com/guide/install.html#release"),dn=p(`<h4 id="_4-2-\u5206\u9875\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_4-2-\u5206\u9875\u914D\u7F6E" aria-hidden="true">#</a> 4.2 \u5206\u9875\u914D\u7F6E</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span> <span class="token comment">// \u58F0\u660E\u914D\u7F6E\u7C7B</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span> <span class="token comment">// \u5F00\u542F\u6CE8\u89E3</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.gulimall.product.dao&quot;</span><span class="token punctuation">)</span> <span class="token comment">// \u6307\u5B9A\u626B\u63CF\u5305</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisConfig</span> <span class="token punctuation">{</span>


    <span class="token doc-comment comment">/**
     * \u5F15\u5165\u5206\u9875\u63D2\u4EF6 \u62E6\u622A\u5668
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PaginationInterceptor</span> <span class="token function">paginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PaginationInterceptor</span> paginationInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaginationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E\u8BF7\u6C42\u7684\u9875\u9762\u5927\u4E8E\u6700\u5927\u9875\u540E\u64CD\u4F5C\uFF0C true\u8C03\u56DE\u5230\u9996\u9875\uFF0Cfalse \u7EE7\u7EED\u8BF7\u6C42  \u9ED8\u8BA4false</span>
         paginationInterceptor<span class="token punctuation">.</span><span class="token function">setOverflow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E\u6700\u5927\u5355\u9875\u9650\u5236\u6570\u91CF\uFF0C\u9ED8\u8BA4 500 \u6761\uFF0C-1 \u4E0D\u53D7\u9650\u5236</span>
         paginationInterceptor<span class="token punctuation">.</span><span class="token function">setLimit</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5F00\u542F count \u7684 join \u4F18\u5316,\u53EA\u9488\u5BF9\u90E8\u5206 left join</span>
        paginationInterceptor<span class="token punctuation">.</span><span class="token function">setCountSqlParser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JsqlParserCountOptimize</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> paginationInterceptor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-\u903B\u8F91\u5220\u9664" tabindex="-1"><a class="header-anchor" href="#_4-3-\u903B\u8F91\u5220\u9664" aria-hidden="true">#</a> 4.3 \u903B\u8F91\u5220\u9664</h4><p>\u8BF4\u660E:</p><p>\u53EA\u5BF9\u81EA\u52A8\u6CE8\u5165\u7684sql\u8D77\u6548:</p><ul><li>\u63D2\u5165: \u4E0D\u4F5C\u9650\u5236</li><li>\u67E5\u627E: \u8FFD\u52A0where\u6761\u4EF6\u8FC7\u6EE4\u6389\u5DF2\u5220\u9664\u6570\u636E,\u4E14\u4F7F\u7528 wrapper.entity \u751F\u6210\u7684where\u6761\u4EF6\u4F1A\u5FFD\u7565\u8BE5\u5B57\u6BB5</li><li>\u66F4\u65B0: \u8FFD\u52A0where\u6761\u4EF6\u9632\u6B62\u66F4\u65B0\u5230\u5DF2\u5220\u9664\u6570\u636E,\u4E14\u4F7F\u7528 wrapper.entity \u751F\u6210\u7684where\u6761\u4EF6\u4F1A\u5FFD\u7565\u8BE5\u5B57\u6BB5</li><li>\u5220\u9664: \u8F6C\u53D8\u4E3A \u66F4\u65B0</li></ul><p>\u4F8B\u5982:</p><ul><li>\u5220\u9664: <code>update user set deleted=1 where id = 1 and deleted=0</code></li><li>\u67E5\u627E: <code>select id,name,deleted from user where deleted=0</code></li></ul><h5 id="\u6B65\u9AA41-\u914D\u7F6E-application-yml" tabindex="-1"><a class="header-anchor" href="#\u6B65\u9AA41-\u914D\u7F6E-application-yml" aria-hidden="true">#</a> \u6B65\u9AA41\uFF1A\u914D\u7F6E application.yml</h5><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token important">*:/mapper/**/*.xml</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto <span class="token comment"># \u6570\u636E\u5E93\u4E3B\u952E\u81EA\u589E</span>
      <span class="token key atrule">logic-delete-value</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># \u903B\u8F91\u5DF2\u5220\u9664\u503C(\u9ED8\u8BA4\u4E3A 1)</span>
      <span class="token key atrule">logic-not-delete-value</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment"># \u903B\u8F91\u672A\u5220\u9664\u503C(\u9ED8\u8BA4\u4E3A 0)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u6B65\u9AA42-\u5B9E\u4F53\u7C7B\u5B57\u6BB5\u4E0A\u52A0\u4E0A-tablelogic\u6CE8\u89E3" tabindex="-1"><a class="header-anchor" href="#\u6B65\u9AA42-\u5B9E\u4F53\u7C7B\u5B57\u6BB5\u4E0A\u52A0\u4E0A-tablelogic\u6CE8\u89E3" aria-hidden="true">#</a> \u6B65\u9AA42: \u5B9E\u4F53\u7C7B\u5B57\u6BB5\u4E0A\u52A0\u4E0A<code>@TableLogic</code>\u6CE8\u89E3</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u662F\u5426\u663E\u793A[0-\u4E0D\u663E\u793A\uFF0C1\u663E\u793A]
 */</span>
<span class="token annotation punctuation">@TableLogic</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>delval <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> showStatus<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-4-\u5B89\u88C5\u914D\u7F6Egit" tabindex="-1"><a class="header-anchor" href="#_3-5-4-\u5B89\u88C5\u914D\u7F6Egit" aria-hidden="true">#</a> 3.5.4 \u5B89\u88C5\u914D\u7F6Egit</h3><ol><li><h4 id="\u4E0B\u8F7Dgit" tabindex="-1"><a class="header-anchor" href="#\u4E0B\u8F7Dgit" aria-hidden="true">#</a> \u4E0B\u8F7Dgit</h4></li></ol>`,14),mn={href:"https://git-scm.com/",target:"_blank",rel:"noopener noreferrer"},vn=s("https://git-scm.com/"),gn=p(`<ol start="2"><li><h4 id="\u914D\u7F6E-git-\u8FDB\u5165-git-bash" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E-git-\u8FDB\u5165-git-bash" aria-hidden="true">#</a> \u914D\u7F6E git \u8FDB\u5165 git bash</h4></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># \u914D\u7F6E\u7528\u6237\u540D
git config --global user.name &quot;user.name&quot;
# \u914D\u7F6E\u90AE\u7BB1
git config --global user.email &quot;username@email.com&quot; # \u6CE8\u518C\u8D26\u53F7\u4F7F\u7528\u7684\u90AE\u7BB1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><h3 id="\u914D\u7F6E-ssh-\u514D\u5BC6\u7801\u767B\u5F55" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E-ssh-\u514D\u5BC6\u7801\u767B\u5F55" aria-hidden="true">#</a> \u914D\u7F6E ssh \u514D\u5BC6\u7801\u767B\u5F55</h3></li></ol>`,3),bn={href:"https://github.com/settings/keys",target:"_blank",rel:"noopener noreferrer"},hn=s("https://github.com/settings/keys"),yn=p(`<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>git bash \u4F7F\u7528 ssh-keygen -t rsa -C &quot;XXX@xxx.com&quot; \u547D\u4EE4 \u8FDE\u7EED\u4E09\u6B21\u56DE\u8F66
\u4E00\u822C\u7528\u6237\u76EE\u5F55\u4E0B\u90FD\u4F1A\u6709
id_rsa \u6587\u4EF6
id_rsa.pub \u6587\u4EF6
\u6216\u8005 cat ~/.ssh/id_rsa.pub
\u767B\u5F55\u8FDB github/gitee \u8BBE\u7F6E SSH KEY
\u4F7F\u7528 ssh -T git@gitee.com \u6D4B\u8BD5\u662F\u5426\u6210\u529F
\u5177\u4F53\u8FC7\u7A0B\u53C2\u8003\u767E\u5EA6
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9879\u76EE\u7ED3\u6784\u521B\u5EFA</p><h3 id="_3-5-5-\u9006\u5411\u5DE5\u7A0B\u7684\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_3-5-5-\u9006\u5411\u5DE5\u7A0B\u7684\u4F7F\u7528" aria-hidden="true">#</a> 3.5.5 \u9006\u5411\u5DE5\u7A0B\u7684\u4F7F\u7528</h3><h4 id="_1-\u4E0B\u8F7D\u4EBA\u4EBA\u5F00\u6E90\u9879\u76EE" tabindex="-1"><a class="header-anchor" href="#_1-\u4E0B\u8F7D\u4EBA\u4EBA\u5F00\u6E90\u9879\u76EE" aria-hidden="true">#</a> 1.\u4E0B\u8F7D\u4EBA\u4EBA\u5F00\u6E90\u9879\u76EE</h4>`,4),fn={href:"https://gitee.com/renrenio",target:"_blank",rel:"noopener noreferrer"},qn=s("https://gitee.com/renrenio"),wn=p('<p><img src="https://cdn.nlark.com/yuque/0/2021/png/440247/1610950177379-b008f830-de8f-4367-9c43-1276a0d13fcb.png" alt="image.png" loading="lazy"></p><ol start="2"><li><h4 id="\u9009\u62E9-renren-generator-\u9879\u76EE" tabindex="-1"><a class="header-anchor" href="#\u9009\u62E9-renren-generator-\u9879\u76EE" aria-hidden="true">#</a> \u9009\u62E9 renren -generator \u9879\u76EE</h4></li></ol><p>1.\u4E0B\u8F7D\u4E4B\u540E\uFF0C\u5BFC\u5165\u9879\u76EE\uFF0C\u4FEE\u6539\u6570\u636E\u5E93\uFF0C\u4FEE\u6539\u5DE5\u7A0Bshiro\u4F9D\u8D56\u4E3ASpringSecurity</p><p>2.\u4FEE\u6539\u5BF9\u5E94\u6570\u636E\u5E93\u914D\u7F6E\uFF0C\u6A21\u5757\u540D\u4E0E\u6570\u636E\u5E93\u8868\u540D\u524D\u7F00</p><ol start="3"><li><h4 id="\u4E0B\u8F7D-renren-fast-vue\u9879\u76EE" tabindex="-1"><a class="header-anchor" href="#\u4E0B\u8F7D-renren-fast-vue\u9879\u76EE" aria-hidden="true">#</a> \u4E0B\u8F7D renren-fast-vue\u9879\u76EE</h4></li></ol><p>1.vscode \u5BFC\u5165\u524D\u7AEF\u9879\u76EE</p><p>2.\u524D\u540E\u7AEF\u8054\u8C03\u6D4B\u8BD5\u57FA\u672C\u529F\u80FD</p><h4 id="_2-\u521B\u5EFA\u4E1A\u52A1\u6A21\u5757" tabindex="-1"><a class="header-anchor" href="#_2-\u521B\u5EFA\u4E1A\u52A1\u6A21\u5757" aria-hidden="true">#</a> 2.\u521B\u5EFA\u4E1A\u52A1\u6A21\u5757</h4><h4 id="_3-\u914D\u7F6E\u516C\u5171\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#_3-\u914D\u7F6E\u516C\u5171\u73AF\u5883" aria-hidden="true">#</a> 3.\u914D\u7F6E\u516C\u5171\u73AF\u5883</h4><h4 id="_4-\u4F7F\u7528\u4EBA\u4EBA\u4EE3\u7801\u751F\u6210\u5668\u751F\u6210\u57FA\u7840\u4E1A\u52A1\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#_4-\u4F7F\u7528\u4EBA\u4EBA\u4EE3\u7801\u751F\u6210\u5668\u751F\u6210\u57FA\u7840\u4E1A\u52A1\u4EE3\u7801" aria-hidden="true">#</a> 4.\u4F7F\u7528\u4EBA\u4EBA\u4EE3\u7801\u751F\u6210\u5668\u751F\u6210\u57FA\u7840\u4E1A\u52A1\u4EE3\u7801</h4><p>\u4FEE\u6539\u76F8\u5173\u914D\u7F6E</p><h2 id="_3-6-\u524D\u540E\u7AEF\u8054\u8C03" tabindex="-1"><a class="header-anchor" href="#_3-6-\u524D\u540E\u7AEF\u8054\u8C03" aria-hidden="true">#</a> 3.6 \u524D\u540E\u7AEF\u8054\u8C03</h2><h3 id="_3-6-1-\u542F\u52A8\u524D\u7AEF\u9879\u76EE" tabindex="-1"><a class="header-anchor" href="#_3-6-1-\u542F\u52A8\u524D\u7AEF\u9879\u76EE" aria-hidden="true">#</a> 3.6.1 \u542F\u52A8\u524D\u7AEF\u9879\u76EE</h3><p>npm install \u5B89\u88C5\u4F9D\u8D56</p><p>\u901A\u8FC7 npm run dev \u542F\u52A8</p><h3 id="_3-6-2-\u542F\u52A8\u540E\u7AEF\u9879\u76EE" tabindex="-1"><a class="header-anchor" href="#_3-6-2-\u542F\u52A8\u540E\u7AEF\u9879\u76EE" aria-hidden="true">#</a> 3.6.2 \u542F\u52A8\u540E\u7AEF\u9879\u76EE</h3><p>\u8FD9\u65F6\uFF0C\u4F60\u4F7F\u7528\u6D4F\u89C8\u5668\u76F4\u63A5\u8BE5\u63A5\u53E3\uFF0C\u53D1\u73B0\u8BBF\u95EE\u6CA1\u4E8B\uFF0C\u4F46\u662F\u7528\u524D\u7AEF\u9879\u76EE\u8BBF\u95EE\u5374\u62A5\u9519\uFF0C\u4EC0\u4E48\u539F\u56E0\uFF1F</p><p>\u8FD9\u5176\u5B9E\u662F\u6D4F\u89C8\u5668\u7684\u540C\u6E90\u7B56\u7565\u9020\u6210\u7684\u8DE8\u57DF\u95EE\u9898\u3002</p><h3 id="_3-6-3-\u8DE8\u57DF\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_3-6-3-\u8DE8\u57DF\u95EE\u9898" aria-hidden="true">#</a> 3.6.3 \u8DE8\u57DF\u95EE\u9898</h3><p>\u8DE8\u57DF\uFF1A\u6D4F\u89C8\u5668\u5BF9\u4E8Ejavascript\u7684\u540C\u6E90\u7B56\u7565\u7684\u9650\u5236 \u3002</p><p>\u4EE5\u4E0B\u60C5\u51B5\u90FD\u5C5E\u4E8E\u8DE8\u57DF\uFF1A</p>',21),_n=n("thead",null,[n("tr",null,[n("th",null,"\u8DE8\u57DF\u539F\u56E0\u8BF4\u660E"),n("th",null,"\u793A\u4F8B")])],-1),Sn=n("td",null,"\u57DF\u540D\u4E0D\u540C",-1),xn={href:"http://www.jd.com",target:"_blank",rel:"noopener noreferrer"},En=s("www.jd.com"),In=s(" \u4E0E "),Cn={href:"http://www.taobao.com",target:"_blank",rel:"noopener noreferrer"},An=s("www.taobao.com"),jn=n("td",null,"\u57DF\u540D\u76F8\u540C\uFF0C\u7AEF\u53E3\u4E0D\u540C",-1),Rn={href:"http://www.jd.com:8080",target:"_blank",rel:"noopener noreferrer"},On=s("www.jd.com:8080"),Pn=s(" \u4E0E "),Tn={href:"http://www.jd.com:8081",target:"_blank",rel:"noopener noreferrer"},Ln=s("www.jd.com:8081"),Vn=n("td",null,"\u4E8C\u7EA7\u57DF\u540D\u4E0D\u540C",-1),Dn={href:"http://item.jd.com",target:"_blank",rel:"noopener noreferrer"},Bn=s("item.jd.com"),Mn=s(" \u4E0E "),Un={href:"http://miaosha.jd.com",target:"_blank",rel:"noopener noreferrer"},Nn=s("miaosha.jd.com"),zn=n("p",null,"\u5982\u679C\u57DF\u540D\u548C\u7AEF\u53E3\u90FD\u76F8\u540C\uFF0C\u4F46\u662F\u8BF7\u6C42\u8DEF\u5F84\u4E0D\u540C\uFF0C\u4E0D\u5C5E\u4E8E\u8DE8\u57DF\uFF0C\u5982\uFF1A",-1),Fn={href:"http://www.jd.com/item",target:"_blank",rel:"noopener noreferrer"},Gn=s("www.jd.com/item"),Qn={href:"http://www.jd.com/goods",target:"_blank",rel:"noopener noreferrer"},Hn=s("www.jd.com/goods"),Wn=n("p",null,"http\u548Chttps\u4E5F\u5C5E\u4E8E\u8DE8\u57DF",-1),Jn={href:"http://xn--manager-754kviu40app1cwua071bji2g.gmall.xn--comapi-r05ju418anfta.gmall.com",target:"_blank",rel:"noopener noreferrer"},Kn=s("\u800C\u6211\u4EEC\u521A\u624D\u662F\u4ECEmanager.gmall.com\u53BB\u8BBF\u95EEapi.gmall.com"),$n=s("\uFF0C\u8FD9\u5C5E\u4E8E\u7AEF\u53E3\u4E0D\u540C\uFF0C\u8DE8\u57DF\u4E86\u3002"),Xn=p('<h4 id="_3-6-3-1-\u4E3A\u4EC0\u4E48\u4F1A\u6709\u8DE8\u57DF\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_3-6-3-1-\u4E3A\u4EC0\u4E48\u4F1A\u6709\u8DE8\u57DF\u95EE\u9898" aria-hidden="true">#</a> 3.6.3.1 \u4E3A\u4EC0\u4E48\u4F1A\u6709\u8DE8\u57DF\u95EE\u9898</h4><p>\u8DE8\u57DF\u4E0D\u4E00\u5B9A\u90FD\u4F1A\u6709\u8DE8\u57DF\u95EE\u9898\u3002</p><p>\u56E0\u4E3A\u8DE8\u57DF\u95EE\u9898\u662F\u6D4F\u89C8\u5668\u5BF9\u4E8Eajax\u8BF7\u6C42\u7684\u4E00\u79CD\u5B89\u5168\u9650\u5236\uFF1A\u4E00\u4E2A\u9875\u9762\u53D1\u8D77\u7684ajax\u8BF7\u6C42\uFF0C\u53EA\u80FD\u662F\u4E0E\u5F53\u524D\u9875\u57DF\u540D\u76F8\u540C\u7684\u8DEF\u5F84\uFF0C\u8FD9\u80FD\u6709\u6548\u7684\u963B\u6B62\u8DE8\u7AD9\u653B\u51FB\u3002</p><p>\u56E0\u6B64\uFF1A\u8DE8\u57DF\u95EE\u9898 \u662F\u9488\u5BF9ajax\u7684\u4E00\u79CD\u9650\u5236\u3002</p><p>\u4F46\u662F\u8FD9\u5374\u7ED9\u6211\u4EEC\u7684\u5F00\u53D1\u5E26\u6765\u4E86\u4E0D\u4FBF\uFF0C\u800C\u4E14\u5728\u5B9E\u9645\u751F\u4EA7\u73AF\u5883\u4E2D\uFF0C\u80AF\u5B9A\u4F1A\u6709\u5F88\u591A\u53F0\u670D\u52A1\u5668\u4E4B\u95F4\u4EA4\u4E92\uFF0C\u5730\u5740\u548C\u7AEF\u53E3\u90FD\u53EF\u80FD\u4E0D\u540C\uFF0C\u600E\u4E48\u529E\uFF1F</p><h4 id="_3-6-3-2-\u4E3A\u4EC0\u4E48\u4F1A\u6709\u8DE8\u57DF\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_3-6-3-2-\u4E3A\u4EC0\u4E48\u4F1A\u6709\u8DE8\u57DF\u95EE\u9898" aria-hidden="true">#</a> 3.6.3.2 \u4E3A\u4EC0\u4E48\u4F1A\u6709\u8DE8\u57DF\u95EE\u9898</h4><p>\u76EE\u524D\u6BD4\u8F83\u5E38\u7528\u7684\u8DE8\u57DF\u89E3\u51B3\u65B9\u6848\u67093\u79CD\uFF1A</p><p>\u25CFJsonp\u6700\u65E9\u7684\u89E3\u51B3\u65B9\u6848\uFF0C\u5229\u7528script\u6807\u7B7E\u53EF\u4EE5\u8DE8\u57DF\u7684\u539F\u7406\u5B9E\u73B0\u3002\u9650\u5236\uFF1A</p><p>\u25CB\u9700\u8981\u670D\u52A1\u7684\u652F\u6301</p><p>\u25CB\u53EA\u80FD\u53D1\u8D77GET\u8BF7\u6C42</p><p>\u25CFnginx\u53CD\u5411\u4EE3\u7406 \u601D\u8DEF\u662F\uFF1A\u5229\u7528nginx\u628A\u8DE8\u57DF\u53CD\u5411\u4EE3\u7406\u4E3A\u4E0D\u8DE8\u57DF\uFF0C\u652F\u6301\u5404\u79CD\u8BF7\u6C42\u65B9\u5F0F \u7F3A\u70B9\uFF1A\u9700\u8981\u5728nginx\u8FDB\u884C\u989D\u5916\u914D\u7F6E\uFF0C\u8BED\u4E49\u4E0D\u6E05\u6670</p><p>\u25CFCORS\u89C4\u8303\u5316\u7684\u8DE8\u57DF\u8BF7\u6C42\u89E3\u51B3\u65B9\u6848\uFF0C\u5B89\u5168\u53EF\u9760\u3002\u4F18\u52BF\uFF1A</p><p>\u25CB\u5728\u670D\u52A1\u7AEF\u8FDB\u884C\u63A7\u5236\u662F\u5426\u5141\u8BB8\u8DE8\u57DF\uFF0C\u53EF\u81EA\u5B9A\u4E49\u89C4\u5219</p><p>\u25CB\u652F\u6301\u5404\u79CD\u8BF7\u6C42\u65B9\u5F0F</p><p>\u25CF\u7F3A\u70B9\uFF1A</p><p>\u25CB\u4F1A\u4EA7\u751F\u989D\u5916\u7684\u8BF7\u6C42</p><p>\u6211\u4EEC\u8FD9\u91CC\u4F1A\u91C7\u7528cors\u7684\u8DE8\u57DF\u65B9\u6848\u3002</p><h3 id="_3-6-4-\u8DE8\u57DF\u89E3\u51B3" tabindex="-1"><a class="header-anchor" href="#_3-6-4-\u8DE8\u57DF\u89E3\u51B3" aria-hidden="true">#</a> 3.6.4 \u8DE8\u57DF\u89E3\u51B3</h3><p><strong>\u4EC0\u4E48\u662Fcors</strong></p><p>CORS\u662F\u4E00\u4E2AW3C\u6807\u51C6\uFF0C\u5168\u79F0\u662F&quot;\u8DE8\u57DF\u8D44\u6E90\u5171\u4EAB&quot;\uFF08Cross-origin resource sharing\uFF09\u3002</p>',20),Yn=s("\u5B83\u5141\u8BB8\u6D4F\u89C8\u5668\u5411\u8DE8\u6E90\u670D\u52A1\u5668\uFF0C\u53D1\u51FA"),Zn={href:"http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html",target:"_blank",rel:"noopener noreferrer"},ns=s("XMLHttpRequest"),ss=s("\u8BF7\u6C42\uFF0C\u4ECE\u800C\u514B\u670D\u4E86AJAX\u53EA\u80FD"),as={href:"http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html",target:"_blank",rel:"noopener noreferrer"},ts=s("\u540C\u6E90"),ps=s("\u4F7F\u7528\u7684\u9650\u5236\u3002"),es=n("p",null,"CORS\u9700\u8981\u6D4F\u89C8\u5668\u548C\u670D\u52A1\u5668\u540C\u65F6\u652F\u6301\u3002\u76EE\u524D\uFF0C\u6240\u6709\u6D4F\u89C8\u5668\u90FD\u652F\u6301\u8BE5\u529F\u80FD\uFF0CIE\u6D4F\u89C8\u5668\u4E0D\u80FD\u4F4E\u4E8EIE10\u3002",-1),os=n("p",null,"\u25CF\u6D4F\u89C8\u5668\u7AEF\uFF1A \u76EE\u524D\uFF0C\u6240\u6709\u6D4F\u89C8\u5668\u90FD\u652F\u6301\u8BE5\u529F\u80FD\uFF08IE10\u4EE5\u4E0B\u4E0D\u884C\uFF09\u3002\u6574\u4E2ACORS\u901A\u4FE1\u8FC7\u7A0B\uFF0C\u90FD\u662F\u6D4F\u89C8\u5668\u81EA\u52A8\u5B8C\u6210\uFF0C\u4E0D\u9700\u8981\u7528\u6237\u53C2\u4E0E\u3002",-1),cs=n("p",null,"\u25CF\u670D\u52A1\u7AEF\uFF1A CORS\u901A\u4FE1\u4E0EAJAX\u6CA1\u6709\u4EFB\u4F55\u5DEE\u522B\uFF0C\u56E0\u6B64\u4F60\u4E0D\u9700\u8981\u6539\u53D8\u4EE5\u524D\u7684\u4E1A\u52A1\u903B\u8F91\u3002\u53EA\u4E0D\u8FC7\uFF0C\u6D4F\u89C8\u5668\u4F1A\u5728\u8BF7\u6C42\u4E2D\u643A\u5E26\u4E00\u4E9B\u5934\u4FE1\u606F\uFF0C\u6211\u4EEC\u9700\u8981\u4EE5\u6B64\u5224\u65AD\u662F\u5426\u5141\u8BB8\u5176\u8DE8\u57DF\uFF0C\u7136\u540E\u5728\u54CD\u5E94\u5934\u4E2D\u52A0\u5165\u4E00\u4E9B\u4FE1\u606F\u5373\u53EF\u3002\u8FD9\u4E00\u822C\u901A\u8FC7\u8FC7\u6EE4\u5668\u5B8C\u6210\u5373\u53EF\u3002",-1),is=n("p",null,[n("strong",null,"\u539F\u7406")],-1),ls=n("p",null,"\u9884\u68C0\u8BF7\u6C42",-1),us=n("p",null,'\u8DE8\u57DF\u8BF7\u6C42\u4F1A\u5728\u6B63\u5F0F\u901A\u4FE1\u4E4B\u524D\uFF0C\u589E\u52A0\u4E00\u6B21HTTP\u67E5\u8BE2\u8BF7\u6C42\uFF0C\u79F0\u4E3A"\u9884\u68C0"\u8BF7\u6C42\uFF08preflight\uFF09\u3002',-1),rs=n("p",null,"\u6D4F\u89C8\u5668\u5148\u8BE2\u95EE\u670D\u52A1\u5668\uFF0C\u5F53\u524D\u7F51\u9875\u6240\u5728\u7684\u57DF\u540D\u662F\u5426\u5728\u670D\u52A1\u5668\u7684\u8BB8\u53EF\u540D\u5355\u4E4B\u4E2D\uFF0C\u4EE5\u53CA\u53EF\u4EE5\u4F7F\u7528\u54EA\u4E9BHTTP\u52A8\u8BCD\u548C\u5934\u4FE1\u606F\u5B57\u6BB5\u3002\u53EA\u6709\u5F97\u5230\u80AF\u5B9A\u7B54\u590D\uFF0C\u6D4F\u89C8\u5668\u624D\u4F1A\u53D1\u51FA\u6B63\u5F0F\u7684XMLHttpRequest\u8BF7\u6C42\uFF0C\u5426\u5219\u5C31\u62A5\u9519\u3002",-1),ks=n("p",null,"\u4E00\u4E2A\u201C\u9884\u68C0\u201D\u8BF7\u6C42\u7684\u6837\u677F\uFF1A",-1),ds=n("p",null,"OPTIONS /cors HTTP/1.1",-1),ms=s("Origin: "),vs={href:"http://localhost:1000",target:"_blank",rel:"noopener noreferrer"},gs=s("http://localhost:1000"),bs=p("<p>Access-Control-Request-Method: GET</p><p>Access-Control-Request-Headers: X-Custom-Header</p><p>User-Agent: Mozilla/5.0...</p><p>\u25CFOrigin\uFF1A\u4F1A\u6307\u51FA\u5F53\u524D\u8BF7\u6C42\u5C5E\u4E8E\u54EA\u4E2A\u57DF\uFF08\u534F\u8BAE+\u57DF\u540D+\u7AEF\u53E3\uFF09\u3002\u670D\u52A1\u4F1A\u6839\u636E\u8FD9\u4E2A\u503C\u51B3\u5B9A\u662F\u5426\u5141\u8BB8\u5176\u8DE8\u57DF\u3002</p><p>\u25CFAccess-Control-Request-Method\uFF1A\u63A5\u4E0B\u6765\u4F1A\u7528\u5230\u7684\u8BF7\u6C42\u65B9\u5F0F\uFF0C\u6BD4\u5982PUT</p><p>\u25CFAccess-Control-Request-Headers\uFF1A\u4F1A\u989D\u5916\u7528\u5230\u7684\u5934\u4FE1\u606F</p><p>\u9884\u68C0\u8BF7\u6C42\u7684\u54CD\u5E94</p><p>\u670D\u52A1\u7684\u6536\u5230\u9884\u68C0\u8BF7\u6C42\uFF0C\u5982\u679C\u8BB8\u53EF\u8DE8\u57DF\uFF0C\u4F1A\u53D1\u51FA\u54CD\u5E94\uFF1A</p><p>HTTP/1.1 200 OK</p><p>Date: Mon, 01 Dec 2008 01:15:39 GMT</p><p>Server: Apache/2.0.61 (Unix)</p>",11),hs=s("Access-Control-Allow-Origin: "),ys={href:"http://miaosha.jd.com/",target:"_blank",rel:"noopener noreferrer"},fs=s("http://miaosha.jd.com"),qs=p(`<p>Access-Control-Allow-Credentials: true</p><p>Access-Control-Allow-Methods: GET, POST, PUT</p><p>Access-Control-Allow-Headers: X-Custom-Header</p><p>Access-Control-Max-Age: 1728000</p><p>Content-Type: text/html; charset=utf-8</p><p>Content-Encoding: gzip</p><p>Content-Length: 0</p><p>Keep-Alive: timeout=2, max=100</p><p>Connection: Keep-Alive</p><p>Content-Type: text/plain</p><p>\u5982\u679C\u670D\u52A1\u5668\u5141\u8BB8\u8DE8\u57DF\uFF0C\u9700\u8981\u5728\u8FD4\u56DE\u7684\u54CD\u5E94\u5934\u4E2D\u643A\u5E26\u4E0B\u9762\u4FE1\u606F\uFF1A</p><p>\u25CFAccess-Control-Allow-Origin\uFF1A\u53EF\u63A5\u53D7\u7684\u57DF\uFF0C\u662F\u4E00\u4E2A\u5177\u4F53\u57DF\u540D\u6216\u8005*\uFF08\u4EE3\u8868\u4EFB\u610F\u57DF\u540D\uFF09</p><p>\u25CFAccess-Control-Allow-Credentials\uFF1A\u662F\u5426\u5141\u8BB8\u643A\u5E26cookie\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Ccors\u4E0D\u4F1A\u643A\u5E26cookie\uFF0C\u9664\u975E\u8FD9\u4E2A\u503C\u662Ftrue</p><p>\u25CFAccess-Control-Allow-Methods\uFF1A\u5141\u8BB8\u8BBF\u95EE\u7684\u65B9\u5F0F</p><p>\u25CFAccess-Control-Allow-Headers\uFF1A\u5141\u8BB8\u643A\u5E26\u7684\u5934</p><p>\u25CFAccess-Control-Max-Age\uFF1A\u672C\u6B21\u8BB8\u53EF\u7684\u6709\u6548\u65F6\u957F\uFF0C\u5355\u4F4D\u662F\u79D2\uFF0C\u8FC7\u671F\u4E4B\u524D\u7684ajax\u8BF7\u6C42\u5C31\u65E0\u9700\u518D\u6B21\u8FDB\u884C\u9884\u68C0\u4E86</p><p>\u6709\u5173cookie\uFF1A</p><p>\u8981\u60F3\u64CD\u4F5Ccookie\uFF0C\u9700\u8981\u6EE1\u8DB33\u4E2A\u6761\u4EF6\uFF1A</p><p>\u25CF\u670D\u52A1\u7684\u54CD\u5E94\u5934\u4E2D\u9700\u8981\u643A\u5E26Access-Control-Allow-Credentials\u5E76\u4E14\u4E3Atrue\u3002</p><p>\u25CF\u6D4F\u89C8\u5668\u53D1\u8D77ajax\u9700\u8981\u6307\u5B9AwithCredentials \u4E3Atrue</p><p>\u25CF\u54CD\u5E94\u5934\u4E2D\u7684Access-Control-Allow-Origin\u4E00\u5B9A\u4E0D\u80FD\u4E3A*\uFF0C\u5FC5\u987B\u662F\u6307\u5B9A\u7684\u57DF\u540D</p><p><strong>\u5B9E\u73B0\u65B9\u5F0F</strong></p><p>\u867D\u7136\u539F\u7406\u6BD4\u8F83\u590D\u6742\uFF0C\u4F46\u662F\u524D\u9762\u8BF4\u8FC7\uFF1A</p><p>\u25CF\u6D4F\u89C8\u5668\u7AEF\u90FD\u6709\u6D4F\u89C8\u5668\u81EA\u52A8\u5B8C\u6210\uFF0C\u6211\u4EEC\u65E0\u9700\u64CD\u5FC3</p><p>\u25CF\u670D\u52A1\u7AEF\u53EF\u4EE5\u901A\u8FC7\u62E6\u622A\u5668\u7EDF\u4E00\u5B9E\u73B0\uFF0C\u4E0D\u5FC5\u6BCF\u6B21\u90FD\u53BB\u8FDB\u884C\u8DE8\u57DF\u5224\u5B9A\u7684\u7F16\u5199\u3002</p><p>\u4E8B\u5B9E\u4E0A\uFF0CSpring\u5DF2\u7ECF\u5E2E\u6211\u4EEC\u5199\u597D\u4E86CORS\u7684\u8DE8\u57DF\u8FC7\u6EE4\u5668\uFF0C\u5185\u90E8\u5DF2\u7ECF\u5B9E\u73B0\u4E86\u521A\u624D\u6240\u8BB2\u7684\u5224\u5B9A\u903B\u8F91\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>spring-webmvc\uFF1ACorsFilter
spring-webflux\uFF1ACorsWebFilter
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>springcloud-gateway\u96C6\u6210\u7684\u662Fwebflux\uFF0C\u6240\u4EE5\u8FD9\u91CC\u4F7F\u7528\u7684\u662FCorsWebFilter \u5728gmall-gateway\u4E2D\u7F16\u5199\u4E00\u4E2A\u914D\u7F6E\u7C7B\uFF0C\u5E76\u4E14\u6CE8\u518CCorsWebFilter\uFF1A Plain Text</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Configuration
public class CorsConfig {
    @Bean
    public CorsWebFilter corsWebFilter() {
        // \u521D\u59CB\u5316CORS\u914D\u7F6E\u5BF9\u8C61
        CorsConfiguration config = new CorsConfiguration();
        // \u5141\u8BB8\u7684\u57DF,\u4E0D\u8981\u5199*\uFF0C\u5426\u5219cookie\u5C31\u65E0\u6CD5\u4F7F\u7528\u4E86
        config.addAllowedOrigin(&quot;http://manager.gmall.com&quot;);
        config.addAllowedOrigin(&quot;http://www.gmall.com&quot;);
        // \u5141\u8BB8\u7684\u5934\u4FE1\u606F
        config.addAllowedHeader(&quot;*&quot;);
        // \u5141\u8BB8\u7684\u8BF7\u6C42\u65B9\u5F0F
        config.addAllowedMethod(&quot;*&quot;);
        // \u662F\u5426\u5141\u8BB8\u643A\u5E26Cookie\u4FE1\u606F
        config.setAllowCredentials(true);
        // \u6DFB\u52A0\u6620\u5C04\u8DEF\u5F84\uFF0C\u6211\u4EEC\u62E6\u622A\u4E00\u5207\u8BF7\u6C42
        UrlBasedCorsConfigurationSource corsConfigurationSource = new UrlBasedCorsConfigurationSource();
        corsConfigurationSource.registerCorsConfiguration(&quot;/**&quot;, config);
        return new CorsWebFilter(corsConfigurationSource);
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="\u56DB\u3001\u5206\u5E03\u5F0F\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u56DB\u3001\u5206\u5E03\u5F0F\u7EC4\u4EF6" aria-hidden="true">#</a> \u56DB\u3001\u5206\u5E03\u5F0F\u7EC4\u4EF6</h1>`,30),ws={id:"springcloud-alibaba",tabindex:"-1"},_s=n("a",{class:"header-anchor",href:"#springcloud-alibaba","aria-hidden":"true"},"#",-1),Ss=s(),xs={href:"https://github.com/alibaba/spring-cloud-alibaba/blob/2.2.x/README-zh.md",target:"_blank",rel:"noopener noreferrer"},Es=s("SpringCloud Alibaba"),Is=s("\u8BF7\u67E5\u770Bcloud\u7B14\u8BB0\u6216\u5B98\u65B9\u6587\u6863\u6216"),Cs={href:"https://www.springcloud.cc/",target:"_blank",rel:"noopener noreferrer"},As=s("\u4E2D\u6587\u6587\u6863"),js=p('<p><strong>SpringClouid\u7684\u51E0\u5927\u75DB\u70B9\uFF1A</strong></p><p>SpringCloud\u90E8\u5206\u7EC4\u4EF6\u505C\u6B62\u7EF4\u62A4\u548C\u66F4\u65B0\uFF0C\u7ED9\u5F00\u53D1\u5E26\u6765\u4E0D\u4FBF;</p><p>SpringCloud\u90E8\u5206\u73AF\u5883\u642D\u5EFA\u590D\u6742\uFF0C\u6CA1\u6709\u5B8C\u5584\u7684\u53EF\u89C6\u5316\u754C\u9762\uFF0C\u6211\u4EEC\u9700\u8981\u5927\u91CF\u7684\u4E8C\u6B21\u5F00\u53D1\u548C\u5B9A\u5236</p><p>SpringCloud\u914D\u7F6E\u590D\u6742\uFF0C\u96BE\u4EE5\u4E0A\u624B\uFF0C\u90E8\u5206\u914D\u7F6E\u5DEE\u522B\u96BE\u4EE5\u533A\u5206\u548C\u5408\u7406\u5E94\u7528</p><p><strong>SpringCloud Alibaba\u7684\u4F18\u52BF\uFF1A</strong></p><p>\u963F\u91CC\u4F7F\u7528\u8FC7\u7684\u7EC4\u4EF6\u7ECF\u5386\u4E86\u8003\u9A8C\uFF0C\u6027\u80FD\u5F3A\u608D\uFF0C\u8BBE\u8BA1\u5408\u7406\uFF0C\u73B0\u5728\u5F00\u6E90\u51FA\u6765\u5927\u5BB6\u7528</p><p>\u6210\u5957\u7684\u4EA7\u54C1\u642D\u914D\u5B8C\u5584\u7684\u53EF\u89C6\u5316\u754C\u9762\u7ED9\u5F00\u53D1\u8FD0\u7EF4\u5E26\u6765\u6781\u5927\u7684\u4FBF\u5229</p><p>\u642D\u5EFA\u7B80\u5355\uFF0C\u5B66\u4E60\u66F2\u7EBF\u4F4E\u3002</p><h2 id="\u6280\u672F\u642D\u914D\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u6280\u672F\u642D\u914D\u65B9\u6848" aria-hidden="true">#</a> <strong>\u6280\u672F\u642D\u914D\u65B9\u6848</strong></h2><h3 id="springcloud-alibaba-1" tabindex="-1"><a class="header-anchor" href="#springcloud-alibaba-1" aria-hidden="true">#</a> <strong>SpringCloud Alibaba</strong></h3><p>Nacos : \u6CE8\u518C\u4E2D\u5FC3 (\u670D\u52A1\u53D1\u73B0/\u6CE8\u518C)</p><p>Nacos: \u914D\u7F6E\u4E2D\u5FC3 (\u52A8\u6001\u914D\u7F6E\u7BA1\u7406)</p><p>Sentinel: \u670D\u52A1\u5BB9\u9519(\u9650\u6D41\u3001\u964D\u7EA7\u3001\u7194\u65AD)</p><p>Seata: \u539FFescar, \u5373\u5206\u5E03\u5F0F\u4E8B\u52A1\u89E3\u51B3\u65B9\u6848</p><h3 id="springcloud" tabindex="-1"><a class="header-anchor" href="#springcloud" aria-hidden="true">#</a> <strong>SpringCloud</strong></h3><p>Ribbon: \u8D1F\u8F7D\u5747\u8861</p><p>Feign: \u58F0\u660E\u5F0FHTTP\u5BA2\u6237\u7AEF(\u8C03\u7528\u8FDC\u7A0B\u670D\u52A1)</p><p>Gateway: API \u7F51\u5173 (webflux \u7F16\u7A0B\u6A21\u5F0F)</p><p>Sleuth:\u8C03\u7528\u94FE\u76D1\u63A7</p><h2 id="\u9879\u76EE\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#\u9879\u76EE\u67B6\u6784" aria-hidden="true">#</a> \u9879\u76EE\u67B6\u6784</h2><p><img src="http://qnimg.gisfsde.com/work/image-20220510131550076.png" alt="image-20220510131550076" loading="lazy"></p><h3 id="\u7EC4\u4EF6\u6280\u672F\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u7EC4\u4EF6\u6280\u672F\u65B9\u6848" aria-hidden="true">#</a> \u7EC4\u4EF6\u6280\u672F\u65B9\u6848</h3><p><img src="http://qnimg.gisfsde.com/work/image-20220510132138533.png" alt="image-20220510132138533" loading="lazy"></p>',23),Rs={id:"nacos\u3010\u6CE8\u518C\u4E2D\u5FC3\u3011",tabindex:"-1"},Os=n("a",{class:"header-anchor",href:"#nacos\u3010\u6CE8\u518C\u4E2D\u5FC3\u3011","aria-hidden":"true"},"#",-1),Ps=s(),Ts={href:"https://github.com/alibaba/spring-cloud-alibaba/blob/2.2.x/spring-cloud-alibaba-examples/nacos-example/nacos-discovery-example/readme-zh.md",target:"_blank",rel:"noopener noreferrer"},Ls=s("Nacos\u3010\u6CE8\u518C\u4E2D\u5FC3\u3011"),Vs=p(`<p>\u6CE8\u518C\u4E2D\u5FC3\u3010\u670D\u52A1\u53D1\u73B0/\u6CE8\u518C\u3011</p><h3 id="_1-\u516C\u5171\u4F9D\u8D56\u5F15\u8FDB" tabindex="-1"><a class="header-anchor" href="#_1-\u516C\u5171\u4F9D\u8D56\u5F15\u8FDB" aria-hidden="true">#</a> 1.\u516C\u5171\u4F9D\u8D56\u5F15\u8FDB</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u4E0B\u8F7Dnacos-server" tabindex="-1"><a class="header-anchor" href="#_2-\u4E0B\u8F7Dnacos-server" aria-hidden="true">#</a> 2.\u4E0B\u8F7DNacos Server</h3>`,4),Ds={id:"releases-\xB7-alibaba-nacos-github-com-\u5E76\u70B9\u51FB\u6587\u4EF6\u5939\u4E0B\u7684startup-bat\u542F\u52A8\u670D\u52A1-\u542F\u52A8\u4E0D\u4E86\u53EF\u80FD\u672A\u914Djava-home\u73AF\u5883\u53D8\u91CF",tabindex:"-1"},Bs=n("a",{class:"header-anchor",href:"#releases-\xB7-alibaba-nacos-github-com-\u5E76\u70B9\u51FB\u6587\u4EF6\u5939\u4E0B\u7684startup-bat\u542F\u52A8\u670D\u52A1-\u542F\u52A8\u4E0D\u4E86\u53EF\u80FD\u672A\u914Djava-home\u73AF\u5883\u53D8\u91CF","aria-hidden":"true"},"#",-1),Ms=s(),Us={href:"https://github.com/alibaba/nacos/releases",target:"_blank",rel:"noopener noreferrer"},Ns=s("Releases \xB7 alibaba/nacos (github.com)"),zs=s("\u5E76\u70B9\u51FB\u6587\u4EF6\u5939\u4E0B\u7684startup.bat\u542F\u52A8\u670D\u52A1,\u542F\u52A8\u4E0D\u4E86\u53EF\u80FD\u672A\u914DJAVA_HOME\u73AF\u5883\u53D8\u91CF"),Fs=p(`<h3 id="_3-\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3-\u914D\u7F6E" aria-hidden="true">#</a> 3.\u914D\u7F6E</h3><h4 id="_1\u3001\u9996\u5148-\u4FEE\u6539-pom-xml-\u6587\u4EF6-\u5F15\u5165-nacos-discovery-starter" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u9996\u5148-\u4FEE\u6539-pom-xml-\u6587\u4EF6-\u5F15\u5165-nacos-discovery-starter" aria-hidden="true">#</a> 1\u3001\u9996\u5148\uFF0C\u4FEE\u6539 pom.xml \u6587\u4EF6\uFF0C\u5F15\u5165 Nacos Discovery Starter</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u5728\u5E94\u7528\u7684-resource-application-properties-\u4E2D\u914D\u7F6E-nacos-server\u5730\u5740" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5728\u5E94\u7528\u7684-resource-application-properties-\u4E2D\u914D\u7F6E-nacos-server\u5730\u5740" aria-hidden="true">#</a> 2\u3001\u5728\u5E94\u7528\u7684 /resource /application.properties \u4E2D\u914D\u7F6E Nacos Server\u5730\u5740</h4><div class="language-PROPER ext-PROPER line-numbers-mode"><pre class="language-PROPER"><code>spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-\u542F\u52A8\u7C7B\u6DFB\u52A0\u6CE8\u89E3\u5F00\u542F\u670D\u52A1\u4E0E\u6CE8\u89E3\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#_4-\u542F\u52A8\u7C7B\u6DFB\u52A0\u6CE8\u89E3\u5F00\u542F\u670D\u52A1\u4E0E\u6CE8\u89E3\u529F\u80FD" aria-hidden="true">#</a> 4.\u542F\u52A8\u7C7B\u6DFB\u52A0\u6CE8\u89E3\u5F00\u542F\u670D\u52A1\u4E0E\u6CE8\u89E3\u529F\u80FD</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@EnableDiscoveryClient
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_5-\u914D\u7F6E\u6A21\u5757\u540D" tabindex="-1"><a class="header-anchor" href="#_5-\u914D\u7F6E\u6A21\u5757\u540D" aria-hidden="true">#</a> 5.\u914D\u7F6E\u6A21\u5757\u540D</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>spring.application.name=service-provider
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_6-\u542F\u52A8\u6A21\u5757\u8BBF\u95EE" tabindex="-1"><a class="header-anchor" href="#_6-\u542F\u52A8\u6A21\u5757\u8BBF\u95EE" aria-hidden="true">#</a> 6.\u542F\u52A8\u6A21\u5757\u8BBF\u95EE</h3>`,10),Gs={href:"http://localhost:8848/nacos/#/login",target:"_blank",rel:"noopener noreferrer"},Qs=s("Nacos"),Hs=p(`<h2 id="nacos\u3010\u914D\u7F6E\u4E2D\u5FC3\u3011" tabindex="-1"><a class="header-anchor" href="#nacos\u3010\u914D\u7F6E\u4E2D\u5FC3\u3011" aria-hidden="true">#</a> Nacos\u3010\u914D\u7F6E\u4E2D\u5FC3\u3011</h2><h4 id="_1\u3001pom-xml-\u5F15\u5165-nacos-config-starter" tabindex="-1"><a class="header-anchor" href="#_1\u3001pom-xml-\u5F15\u5165-nacos-config-starter" aria-hidden="true">#</a> 1\u3001pom.xml \u5F15\u5165 Nacos Config Starter</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>  <span class="token comment">&lt;!--\u914D\u7F6E\u4E2D\u5FC3\u6765\u505A\u914D\u7F6E\u7BA1\u7406--&gt;</span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2\u3001\u5728\u5E94\u7528\u7684-resource-\u4E0B-bootstrap-properties" tabindex="-1"><a class="header-anchor" href="#_5-3-2\u3001\u5728\u5E94\u7528\u7684-resource-\u4E0B-bootstrap-properties" aria-hidden="true">#</a> 5.3.2\u3001\u5728\u5E94\u7528\u7684 resource \u4E0B bootstrap.properties</h4><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">gulimall-coupon</span>
<span class="token key attr-name">spring.cloud.nacos.config.server-addr</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:8848</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-3\u3001\u5728-nacos-\u4E2D\u6DFB\u52A0\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_5-3-3\u3001\u5728-nacos-\u4E2D\u6DFB\u52A0\u914D\u7F6E" aria-hidden="true">#</a> 5.3.3\u3001\u5728 nacos \u4E2D\u6DFB\u52A0\u914D\u7F6E</h4><p>\u9009\u62E9\u53F3\u4E0A\u89D2\u6DFB\u52A0\u914D\u7F6E</p><p><img src="http://qnimg.gisfsde.com/work/image-20220512152022866.png" alt="image-20220512152022866" loading="lazy"></p><p>Data ID \u6539\u6210 gulimall-coupon.properties \u9ED8\u8BA4\u89C4\u5219 \u7528\u6237\u540D.\u5E94\u7528\u540D.properties</p><p><img src="http://qnimg.gisfsde.com/work/image-20220512152043662.png" alt="image-20220512152043662" loading="lazy"></p><h4 id="_5-3-4\u3001\u5728\u5E94\u7528\u4E2D\u4F7F\u7528-value-\u548C-refreshscope" tabindex="-1"><a class="header-anchor" href="#_5-3-4\u3001\u5728\u5E94\u7528\u4E2D\u4F7F\u7528-value-\u548C-refreshscope" aria-hidden="true">#</a> 5.3.4\u3001\u5728\u5E94\u7528\u4E2D\u4F7F\u7528@Value \u548C @RefreshScope</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RefreshScope</span> <span class="token comment">// \u5237\u65B0\u5BF9\u5E94controller</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;coupon/coupon&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CouponController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CouponService</span> couponService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${coupon.user.name}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${coupon.user.age}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-5\u3001\u8FDB\u9636" tabindex="-1"><a class="header-anchor" href="#_5-3-5\u3001\u8FDB\u9636" aria-hidden="true">#</a> 5.3.5\u3001\u8FDB\u9636</h4><blockquote><p>1\u3001\u6838\u5FC3\u6982\u5FF5</p></blockquote><p><strong>\u547D\u540D\u7A7A\u95F4:</strong> \u7528\u4E8E\u8FDB\u884C\u79DF\u6237\u7C92\u5EA6\u7684\u914D\u7F6E\u9694\u79BB\u3002\u4E0D\u540C\u7684\u547D\u540D\u7A7A\u95F4\u4E0B\uFF0C\u53EF\u4EE5\u5B58\u5728\u76F8\u540C\u7684 <strong>Group</strong> \u6216 <strong>DatalD</strong> \u7684\u914D\u7F6E\u3002<strong>Namespace</strong> \u7684\u5E38\u7528\u573A\u666F\u4E4B\u4E00\u662F\u4E0D\u540C\u73AF\u5883\u7684\u914D\u7F6E\u7684\u533A\u5206\u9694\u79BB\uFF0C\u4F8B\u5982\u5F00\u53D1\u6D4B\u8BD5\u73AF\u5883\u548C\u751F\u4EA7\u73AF\u5883\u7684\u8D44\u6E90(\u5982\u914D\u7F6E\u3001\u670D\u52A1)\u9694\u79BB\u7B49\u3002</p><p><strong>\u914D\u7F6E\u96C6</strong></p><p><strong>\u4E00\u7EC4\u76F8\u5173\u6216\u8005\u4E0D\u76F8\u5173\u7684\u914D\u7F6E\u9879\u7684\u96C6\u5408\u79F0\u4E3A\u914D\u7F6E\u96C6</strong>\u3002\u5728\u7CFB\u7EDF\u4E2D\uFF0C\u4E00\u4E2A\u914D\u7F6E\u6587\u4EF6\u901A\u5E38\u5C31\u662F\u4E00\u4E2A\u914D\u7F6E\u96C6\uFF0C\u5305\u542B\u4E86\u7CFB\u7EDF\u5404\u4E2A\u65B9\u9762\u7684\u914D\u7F6E\u3002\u4F8B\u5982\uFF0C\u4E00\u4E2A\u914D\u7F6E\u96C6\u53EF\u80FD\u5305\u542B\u4E86\u6570\u636E\u6E90\u3001\u7EBF\u7A0B\u6C60\u3001\u65E5\u5FD7\u7EA7\u522B\u7B49\u914D\u7F6E\u9879\u3002</p><p><strong>\u914D\u7F6E\u96C6ID:</strong></p><p>Nacos \u4E2D\u7684\u67D0\u4E2A\u914D\u7F6E\u96C6\u7684 ID\uFF0C\u914D\u7F6E\u96C6 ID \u662F\u7EC4\u7EC7\u5212\u5206\u914D\u7F6E\u7684\u7EF4\u5EA6\u4E4B\u4E00\uFF0C<strong>Data ID</strong> \u901A\u5E38\u7528\u4E8E\u7EC4\u7EC7\u5212\u5206\u7CFB\u7EDF\u7684\u914D\u7F6E\u96C6\uFF0C\u4E00\u4E2A\u7CFB\u7EDF\u6216\u8005\u5E94\u7528\u53EF\u4EE5\u5305\u542B\u591A\u4E2A\u914D\u7F6E\u96C6\uFF0C\u4E00\u4E2A\u7CFB\u7EDF\u5E94\u7528\u53EF\u4EE5\u5305\u542B\u591A\u4E2A\u914D\u7F6E\u96C6\uFF0C\u6BCF\u4E2A\u914D\u7F6E\u96C6\u90FD\u53EF\u4EE5\u88AB\u4E00\u4E2A\u6709\u610F\u4E49\u7684\u540D\u79F0\u6807\u8BC6\uFF0CData ID \u901A\u5E38\u91C7\u7528\u7C7B Java \u5305 \u5982 ( com.taobao.tc.refund.log.level ) \u7684\u547D\u540D\u89C4\u5219\u4FDD\u8BC1\u5168\u5C40\u552F\u4E00\u6027\uFF0C\u6B64\u547D\u540D\u89C4\u5219\u975E\u5F3A\u5236</p><p><strong>\u914D\u7F6E\u5206\u7EC4\uFF1A</strong></p><p>Nacos \u4E2D\u7684\u4E00\u7EC4\u914D\u7F6E\u96C6\uFF0C\u662F\u7EC4\u7EC7\u914D\u7F6E\u7684\u7EF4\u5EA6\u4E4B\u4E00\uFF0C\u901A\u8FC7\u4E00\u4E2A\u6709\u610F\u4E49\u7684\u5B57\u7B26\u4E32\uFF0C(\u5982 Buy \u6216 Trade ) \u5BF9\u914D\u7F6E\u96C6\u8FDB\u884C\u5206\u7EC4\uFF0C\u4ECE\u800C\u533A\u5206 Data ID \u76F8\u540C\u7684\u914D\u7F6E\u96C6\uFF0C\u5F53\u60A8\u5728 Nacos \u4E0A\u521B\u5EFA\u4E00\u4E2A\u914D\u7F6E\u65F6\uFF0C\u5982\u679C\u672A\u586B\u5199\u914D\u7F6E\u5206\u7EC4\u7684\u540D\u79F0\uFF0C\u5219\u914D\u7F6E\u5206\u7EC4\u7684\u540D\u79F0\u9ED8\u8BA4\u91C7\u7528\uFF0CDEFAULT_GROUP \u914D\u7F6E\u5206\u7EC4\u7684\u5E38\u89C1\u573A\u666F\uFF0C\u4E0D\u540C\u7684\u5E94\u7528\u6216\u7EC4\u4EF6\u91C7\u7528\u4E86\u76F8\u540C\u7684\u914D\u7F6E\u7C7B\u578B\uFF0C\u5982 database_url \u914D\u7F6E\u548C MQ_topic \u914D\u7F6E</p><p><strong>bootstrap.properties \u914D\u7F6E</strong></p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">gulimall-coupon # \u670D\u52A1\u7684\u540D\u79F0</span>
<span class="token key attr-name">spring.cloud.nacos.config.server-addr</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:8848  # \u670D\u52A1\u6CE8\u518C\u5730\u5740</span>
<span class="token key attr-name">spring.cloud.nacos.config.namespace</span><span class="token punctuation">=</span><span class="token value attr-value">ae34901c-9215-4409-ae61-c6b8d6c8f9b0  # \u547D\u540D\u7A7A\u95F4\u5730\u5740</span>
<span class="token comment">#spring.cloud.nacos.config.group=111 # \u5BF9\u5E94\u5206\u7EC4</span>

<span class="token key attr-name">spring.cloud.nacos.config.ext-config[0].data-id</span><span class="token punctuation">=</span><span class="token value attr-value">datasource.yml  # \u914D\u7F6E\u96C6\u6307\u5B9Adata_id</span>
<span class="token key attr-name">spring.cloud.nacos.config.ext-config[0].group</span><span class="token punctuation">=</span><span class="token value attr-value">dev               # \u914D\u7F6E\u96C6\u6307\u5B9A group \u5206\u7EC4</span>
<span class="token key attr-name">spring.cloud.nacos.config.ext-config[0].refresh</span><span class="token punctuation">=</span><span class="token value attr-value">true            # \u662F\u5426\u52A8\u6001\u5237\u65B0 \u5728\u914D\u7F6E\u4E2D\u5FC3\u4FEE\u6539\u540E \u5FAE\u670D\u52A1\u81EA\u52A8\u5237\u65B0</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u76F8\u5173\u89E3\u91CA</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 1\u3001\u5982\u4F55\u4F7F\u7528 Nacos\u4F5C\u4E3A\u914D\u7F6E\u4E2D\u5FC3\u7EDF\u4E00\u7BA1\u7406\u914D\u7F6E
 *  1.1 \u5F15\u5165\u4F9D\u8D56
 *     \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 *             \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 *             \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 *      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
 *  1.2 \u521B\u5EFA\u4E00\u4E2Abootstrap.properties
 *      spring.application.name=gulimall-coupon
 *      spring.cloud.nacos.config.server-addr=127.0.0.1:8848
 *  1.3 \u9700\u8981\u7ED9\u914D\u7F6E\u4E2D\u5FC3\u9ED8\u8BA4\u6DFB\u52A0\u4E00\u4E2A\u53EB \u6570\u636E\u96C6 (Data Id) gulimall-coupon.properties \u9ED8\u8BA4\u89C4\u5219 \u7528\u6237\u540D.\u5E94\u7528\u540D.properties
 *  1.4 \u7ED9 \u5E94\u7528\u540D.properties \u6DFB\u52A0\u4EFB\u4F55\u914D\u7F6E
 *  1.5 \u52A8\u6001\u83B7\u53D6\u914D\u7F6E
 *      @RefreshScope: \u52A8\u6001\u83B7\u53D6\u5E76\u5237\u65B0\u914D\u7F6E
 *      @Value$(&quot;$<span class="token punctuation">{</span>\u914D\u7F6E\u9879\u7684\u540D\u5B57<span class="token punctuation">}</span>&quot;)
 * \u5982\u679C\u914D\u7F6E\u4E2D\u5FC3\u548C\u5F53\u524D\u5E94\u7528\u7684\u914D\u7F6E\u6587\u4EF6\u4E2D\u90FD\u914D\u7F6E\u4E86\u76F8\u540C\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u4F18\u5148\u4F7F\u7528\u914D\u7F6E\u4E2D\u5FC3\u7684\u6587\u4EF6
 *
 * 2\u3001\u7EC6\u8282
 *      1\u3001\u547D\u540D\u7A7A\u95F4\uFF1A\u914D\u7F6E\u9694\u79BB\uFF1A
 *          \u9ED8\u8BA4\uFF1Apublic(\u4FDD\u7559\u7A7A\u95F4)\uFF1B\u9ED8\u8BA4\u65B0\u589E\u7684\u6240\u6709\u914D\u7F6E\u90FD\u5728 public \u7A7A\u95F4
 *          1\u3001\u5F00\u53D1 \u6D4B\u8BD5 \u751F\u4EA7 \u5229\u7528\u547D\u540D\u7A7A\u95F4\u6765\u505A\u73AF\u5883\u9694\u79BB
 *          \u6CE8\u610F: \u5728bootstrap.properties\u914D\u7F6E\u4E0A \u9700\u8981\u4F7F\u7528\u54EA\u4E2A\u547D\u540D\u7A7A\u95F4\u4E0B\u7684\u914D\u7F6E
 *              spring.cloud.nacos.config.namespace=b1e89ce0-784f-4a80-9de0-e9b080eeaca5
 *          2\u3001\u6BCF\u4E00\u4E2A\u5FAE\u670D\u52A1\u4E4B\u95F4\u4E92\u76F8\u9694\u79BB\u914D\u7F6E\uFF0C\u6BCF\u4E00\u4E2A\u5FAE\u670D\u52A1\u90FD\u521B\u5EFA\u81EA\u5DF1\u7684\u547D\u540D\u7A7A\u95F4\uFF0C\u53EA\u52A0\u8F7D\u81EA\u5DF1\u547D\u540D\u7A7A\u95F4\u4E0B\u7684\u6240\u6709\u914D\u7F6E
 *
 *
 *      2\u3001\u914D\u7F6E\u96C6\uFF1A\u6240\u6709\u914D\u7F6E\u7684\u96C6\u5408
 *
 *      3\u3001\u914D\u7F6E\u96C6ID\uFF1A\u7C7B\u4F3C\u6587\u4EF6\u540D
 *          Data ID\uFF1A\u7C7B\u578B\u6587\u4EF6\u540D
 *
 *      4\u3001\u914D\u7F6E\u5206\u7EC4\uFF1A
 *      \u9ED8\u8BA4\u6240\u6709\u7684\u914D\u7F6E\u90FD\u5C5E\u4E8E DEFAULT_GROUP
 *
 * \u6BCF\u4E2A\u5FAE\u670D\u52A1\u521B\u5EFA\u81EA\u5DF1\u7684\u547D\u540D\u7A7A\u95F4\uFF0C\u4F7F\u7528\u914D\u7F6E\u5206\u7EC4\u533A\u5206\u73AF\u5883\uFF0Cdev\u3001test\u3001prod
 *
 * 3\u3001\u540C\u65F6\u52A0\u8F7D\u591A\u4E2A\u914D\u7F6E\u96C6
 *      1\u3001\u5FAE\u670D\u52A1\u4EFB\u4F55\u914D\u7F6E\u4FE1\u606F\uFF0C\u4EFB\u4F55\u914D\u7F6E\u6587\u4EF6\u591A\u53EF\u4EE5\u653E\u5728\u914D\u7F6E\u4E2D\u5FC3\u4E2D
 *      2\u3001\u53EA\u8981\u5728 bootstrap.properties \u8BF4\u660E\u52A0\u8F7D\u914D\u7F6E\u4E2D\u5FC3\u4E2D\u54EA\u4E9B\u914D\u7F6E\u6587\u4EF6\u5373\u53EF
 *      3\u3001@Value\uFF0C@ConfigurationProperties...
 *      \u4EE5\u524DSpringBoot\u7684\u4EFB\u4F55\u65B9\u5F0F\u4ECE\u914D\u7F6E\u6587\u4EF6\u4E2D\u83B7\u53D6\u503C\uFF0C\u90FD\u80FD\u4F7F\u7528
 *      \u914D\u7F6E\u4E2D\u5FC3\u6709\u7684\u4F18\u5148\u4F7F\u7528\u914D\u7F6E\u4E2D\u5FC3\u7684
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-10-16
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sentinel" tabindex="-1"><a class="header-anchor" href="#sentinel" aria-hidden="true">#</a> Sentinel</h2><h3 id="_1\u3001\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7B80\u4ECB" aria-hidden="true">#</a> 1\u3001\u7B80\u4ECB</h3><h4 id="_1\u3001\u670D\u52A1\u964D\u7EA7\u9650\u6D41" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u670D\u52A1\u964D\u7EA7\u9650\u6D41" aria-hidden="true">#</a> 1\u3001\u670D\u52A1\u964D\u7EA7\u9650\u6D41</h4><p><strong>\u4EC0\u4E48\u662F\u7194\u65AD\uFF1A</strong></p><p>\u200B A \u670D\u52A1\u8C03\u7528 B \u670D\u52A1\u7684\u67D0\u4E2A\u529F\u80FD\uFF0C\u7531\u4E8E\u7F51\u7EDC\u4E0D\u7A33\u5B9A\u95EE\u9898\uFF0C\u6216\u8005 B \u670D\u52A1\u5361\u673A\uFF0C\u5BFC\u81F4\u529F\u80FD\u65F6\u95F4\u8D85\u957F\uFF0C\u5982\u679C\u8FD9\u6837\u5B50\u7684\u6B21\u6570\u592A\u591A\uFF0C\u6211\u4EEC\u53EF\u4EE5\u76F4\u63A5\u5C06 B \u65AD\u8DEF\u4E86\uFF0C\uFF08A \u4E0D\u5728\u8BF7\u6C42 B \u63A5\u53E3\uFF09\u51E1\u662F\u8C03\u7528 B \u670D\u52A1\u7684\u76F4\u63A5\u8FD4\u56DE\u964D\u7EA7\u6570\u636E\uFF0C\u4E0D\u5FC5\u7B49\u5F85 B \u7684 \u8D85\u65F6\u6267\u884C\uFF0C\u8FD9\u6837 B \u7684\u6545\u969C\u95EE\u9898\uFF0C\u5C31\u4E0D\u4F1A\u7EA7\u8054\u5F71\u54CD\u5230 A\u3002</p><p><strong>\u4EC0\u4E48\u662F\u964D\u7EA7\uFF1A</strong></p><p>\u200B \u6574\u4E2A\u7F51\u7AD9\u5904\u4E8E\u6D41\u91CF\u9AD8\u5CF0\u671F\u670D\u52A1\u5668\u538B\u529B\u5267\u589E\uFF0C\u6839\u636E\u5F53\u524D\u81EA\u8EAB\u4E1A\u52A1\u60C5\u51B5\u4EE5\u53CA\u6D41\u91CF\uFF0C\u5BF9\u4E00\u4E9B\u670D\u52A1\u548C\u9875\u9762\u8FDB\u884C\u6709\u7B56\u7565\u7684\u964D\u7EA7/\u505C\u6B62\u670D\u52A1\uFF0C\u6240\u6709\u7684\u8C03\u7528\u76F4\u63A5\u8FD4\u56DE\u964D\u7EA7\u6570\u636E\u4EE5\u6B64\u7F13\u89E3\u670D\u52A1\u5668\u8D44\u6E90\u7684\u538B\u529B\uFF0C\u4EE5\u4FDD\u8BC1\u6838\u5FC3\u4E1A\u52A1\u7684\u6B63\u5E38\u8FD0\u884C\uFF0C\u540C\u65F6\u4E5F\u4FDD\u6301\u4E86\u5BA2\u6237\u548C\u5927\u90E8\u5206\u5BA2\u6237\u7B49\u5230\u6B63\u786E\u7684\u54CD\u5E94</p><p>\u5F02\u540C\uFF1A</p><p>\u200B \u76F8\u540C\u70B9</p><p>\u200B 1\u3001\u4E3A\u4E86\u4FDD\u8BC1\u96C6\u7FA4\u5927\u90E8\u5206\u670D\u52A1\u7684\u53EF\u7528\u6027\u548C\u53EF\u9760\u6027\uFF0C\u9632\u6B62\u5D29\u6E83\uFF0C\u727A\u7272\u5C0F\u6211</p><p>\u200B 2\u3001\u7528\u6237\u6700\u7EC8\u90FD\u662F\u4F53\u9A8C\u5230\u67D0\u4E2A\u529F\u80FD\u4E0D\u53EF\u7528</p><p>\u200B \u4E0D\u540C\u70B9\uFF1A</p><p>\u200B 1\u3001\u7194\u65AD\u662F\u88AB\u8C03\u7528\u65B9\u7684\u6545\u969C\uFF0C\u89E6\u53D1\u7CFB\u7EDF\u7684\u4E3B\u52A8\u89C4\u5219</p><p>\u200B 2\u3001\u964D\u7EA7\u662F\u57FA\u4E8E\u5168\u5C40\u7684\u8003\u8651\u505C\u6B62\u4E00\u4E9B\u6B63\u5E38\u670D\u52A1\uFF0C\u91CA\u653E\u8D44\u6E90</p><p>\u4EC0\u4E48\u662F\u9650\u6D41</p><p>\u200B \u5BF9\u6253\u5165\u7684\u670D\u52A1\u7684\u8BF7\u6C42\u6D41\u91CF\u8FDB\u884C\u63A7\u5236\uFF0C\u4F7F\u670D\u52A1\u80FD\u591F\u627F\u62C5\u4E0D\u8D85\u8FC7\u81EA\u5DF1\u80FD\u529B\u7684\u6D41\u91CF\u538B\u529B</p><h4 id="_2\u3001sentinel-\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_2\u3001sentinel-\u7B80\u4ECB" aria-hidden="true">#</a> 2\u3001Sentinel \u7B80\u4ECB</h4>`,42),Ws=s("\u5B98\u65B9\u6587\u6863\uFF1A"),Js={href:"https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D",target:"_blank",rel:"noopener noreferrer"},Ks=s("https://github.com/alibaba/Sentinel/wiki/\u4ECB\u7ECD"),$s=s("\u9879\u76EE\u6587\u6863\uFF1A"),Xs={href:"https://github.com/alibaba/Sentinel",target:"_blank",rel:"noopener noreferrer"},Ys=s("https://github.com/alibaba/Sentinel"),Zs=p('<p>\u968F\u7740\u5FAE\u670D\u52A1\u7684\u6D41\u884C\uFF0C\u670D\u52A1\u548C\u670D\u52A1\u4E4B\u95F4\u7684\u7A33\u5B9A\u6027\u53D8\u5F97\u8D8A\u6765\u8D8A\u91CD\u8981\u3002Sentinel \u4EE5\u6D41\u91CF\u4E3A\u5207\u5165\u70B9\uFF0C\u4ECE\u6D41\u91CF\u63A7\u5236\u3001\u7194\u65AD\u964D\u7EA7\u3001\u7CFB\u7EDF\u8D1F\u8F7D\u4FDD\u62A4\u7B49\u591A\u4E2A\u7EF4\u5EA6\u4FDD\u62A4\u670D\u52A1\u7684\u7A33\u5B9A\u6027\u3002</p><p><strong>Sentinel \u5177\u6709\u4EE5\u4E0B\u7279\u5F81:</strong></p><ul><li><strong>\u4E30\u5BCC\u7684\u5E94\u7528\u573A\u666F</strong>\uFF1ASentinel \u627F\u63A5\u4E86\u963F\u91CC\u5DF4\u5DF4\u8FD1 10 \u5E74\u7684\u53CC\u5341\u4E00\u5927\u4FC3\u6D41\u91CF\u7684\u6838\u5FC3\u573A\u666F\uFF0C\u4F8B\u5982\u79D2\u6740\uFF08\u5373\u7A81\u53D1\u6D41\u91CF\u63A7\u5236\u5728\u7CFB\u7EDF\u5BB9\u91CF\u53EF\u4EE5\u627F\u53D7\u7684\u8303\u56F4\uFF09\u3001\u6D88\u606F\u524A\u5CF0\u586B\u8C37\u3001\u96C6\u7FA4\u6D41\u91CF\u63A7\u5236\u3001\u5B9E\u65F6\u7194\u65AD\u4E0B\u6E38\u4E0D\u53EF\u7528\u5E94\u7528\u7B49\u3002</li><li><strong>\u5B8C\u5907\u7684\u5B9E\u65F6\u76D1\u63A7</strong>\uFF1ASentinel \u540C\u65F6\u63D0\u4F9B\u5B9E\u65F6\u7684\u76D1\u63A7\u529F\u80FD\u3002\u60A8\u53EF\u4EE5\u5728\u63A7\u5236\u53F0\u4E2D\u770B\u5230\u63A5\u5165\u5E94\u7528\u7684\u5355\u53F0\u673A\u5668\u79D2\u7EA7\u6570\u636E\uFF0C\u751A\u81F3 500 \u53F0\u4EE5\u4E0B\u89C4\u6A21\u7684\u96C6\u7FA4\u7684\u6C47\u603B\u8FD0\u884C\u60C5\u51B5\u3002</li><li><strong>\u5E7F\u6CDB\u7684\u5F00\u6E90\u751F\u6001</strong>\uFF1ASentinel \u63D0\u4F9B\u5F00\u7BB1\u5373\u7528\u7684\u4E0E\u5176\u5B83\u5F00\u6E90\u6846\u67B6/\u5E93\u7684\u6574\u5408\u6A21\u5757\uFF0C\u4F8B\u5982\u4E0E Spring Cloud\u3001Dubbo\u3001gRPC \u7684\u6574\u5408\u3002\u60A8\u53EA\u9700\u8981\u5F15\u5165\u76F8\u5E94\u7684\u4F9D\u8D56\u5E76\u8FDB\u884C\u7B80\u5355\u7684\u914D\u7F6E\u5373\u53EF\u5FEB\u901F\u5730\u63A5\u5165 Sentinel\u3002</li><li><strong>\u5B8C\u5584\u7684 SPI \u6269\u5C55\u70B9</strong>\uFF1ASentinel \u63D0\u4F9B\u7B80\u5355\u6613\u7528\u3001\u5B8C\u5584\u7684 SPI \u6269\u5C55\u63A5\u53E3\u3002\u60A8\u53EF\u4EE5\u901A\u8FC7\u5B9E\u73B0\u6269\u5C55\u63A5\u53E3\u6765\u5FEB\u901F\u5730\u5B9A\u5236\u903B\u8F91\u3002\u4F8B\u5982\u5B9A\u5236\u89C4\u5219\u7BA1\u7406\u3001\u9002\u914D\u52A8\u6001\u6570\u636E\u6E90\u7B49\u3002</li></ul><p>Sentinel \u7684\u4E3B\u8981\u7279\u6027\uFF1A</p><p><img src="http://qnimg.gisfsde.com/work/image-20201125115407751.png" alt="image-20201125115407751" loading="lazy"></p><p><strong>Sentinel \u5206\u4E3A\u4E24\u4E2A\u90E8\u5206:</strong></p><ul><li>\u6838\u5FC3\u5E93\uFF08Java \u5BA2\u6237\u7AEF\uFF09\u4E0D\u4F9D\u8D56\u4EFB\u4F55\u6846\u67B6/\u5E93\uFF0C\u80FD\u591F\u8FD0\u884C\u4E8E\u6240\u6709 Java \u8FD0\u884C\u65F6\u73AF\u5883\uFF0C\u540C\u65F6\u5BF9 Dubbo / Spring Cloud \u7B49\u6846\u67B6\u4E5F\u6709\u8F83\u597D\u7684\u652F\u6301\u3002</li><li>\u63A7\u5236\u53F0\uFF08Dashboard\uFF09\u57FA\u4E8E Spring Boot \u5F00\u53D1\uFF0C\u6253\u5305\u540E\u53EF\u4EE5\u76F4\u63A5\u8FD0\u884C\uFF0C\u4E0D\u9700\u8981\u989D\u5916\u7684 Tomcat \u7B49\u5E94\u7528\u5BB9\u5668\u3002</li></ul><p><strong>Sentinel \u57FA\u672C\u6982\u5FF5:</strong></p><ul><li>\u8D44\u6E90 <ul><li>\u8D44\u6E90\u662F Sentinel \u7684\u5173\u952E\u6982\u5FF5\u3002\u5B83\u53EF\u4EE5\u662F Java \u5E94\u7528\u7A0B\u5E8F\u4E2D\u7684\u4EFB\u4F55\u5185\u5BB9\uFF0C\u4F8B\u5982\uFF0C\u7531\u5E94\u7528\u7A0B\u5E8F\u63D0\u4F9B\u7684\u670D\u52A1\uFF0C\u6216\u7531\u5E94\u7528\u7A0B\u5E8F\u8C03\u7528\u7684\u5176\u5B83\u5E94\u7528\u63D0\u4F9B\u7684\u670D\u52A1\uFF0C\u751A\u81F3\u53EF\u4EE5\u662F\u4E00\u6BB5\u4EE3\u7801\u3002\u5728\u63A5\u4E0B\u6765\u7684\u6587\u6863\u4E2D\uFF0C\u6211\u4EEC\u90FD\u4F1A\u7528\u8D44\u6E90\u6765\u63CF\u8FF0\u4EE3\u7801\u5757\u3002</li><li><strong>\u53EA\u8981\u901A\u8FC7 Sentinel API \u5B9A\u4E49\u7684\u4EE3\u7801\uFF0C\u5C31\u662F\u8D44\u6E90\uFF0C\u80FD\u591F\u88AB Sentinel \u4FDD\u62A4\u8D77\u6765</strong>\u3002\u5927\u90E8\u5206\u60C5\u51B5\u4E0B\uFF0C\u53EF\u4EE5\u4F7F\u7528\u65B9\u6CD5\u7B7E\u540D\uFF0CURL\uFF0C\u751A\u81F3\u670D\u52A1\u540D\u79F0\u4F5C\u4E3A\u8D44\u6E90\u540D\u6765\u6807\u793A\u8D44\u6E90\u3002</li></ul></li><li>\u89C4\u5219 <ul><li>\u56F4\u7ED5\u8D44\u6E90\u7684\u5B9E\u65F6\u72B6\u6001\u8BBE\u5B9A\u7684\u89C4\u5219\uFF0C\u53EF\u4EE5\u5305\u62EC<strong>\u6D41\u91CF\u63A7\u5236\u89C4\u5219\u3001\u7194\u65AD\u964D\u7EA7\u89C4\u5219\u4EE5\u53CA\u7CFB\u7EDF\u4FDD\u62A4\u89C4\u5219\u3002\u6240\u6709\u89C4\u5219\u53EF\u4EE5\u52A8\u6001\u5B9E\u65F6\u8C03\u6574\u3002</strong></li></ul></li></ul><h3 id="_2\u3001hystrix-\u4E0E-sentinel-\u6BD4\u8F83" tabindex="-1"><a class="header-anchor" href="#_2\u3001hystrix-\u4E0E-sentinel-\u6BD4\u8F83" aria-hidden="true">#</a> 2\u3001Hystrix \u4E0E Sentinel \u6BD4\u8F83</h3><p><img src="http://qnimg.gisfsde.com/work/image-20201125120634969.png" alt="image-20201125120634969" loading="lazy"></p><h3 id="_3\u3001\u6574\u5408-feign-\u548C-sentinel-\u6D4B\u8BD5\u7194\u65AD\u964D\u7EA7" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u6574\u5408-feign-\u548C-sentinel-\u6D4B\u8BD5\u7194\u65AD\u964D\u7EA7" aria-hidden="true">#</a> 3\u3001\u6574\u5408 Feign \u548C Sentinel \u6D4B\u8BD5\u7194\u65AD\u964D\u7EA7</h3>',12),na=s("\u7194\u65AD\u964D\u7EA7\u5B98\u7F51\u89E3\u91CA\uFF1A"),sa={href:"https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7",target:"_blank",rel:"noopener noreferrer"},aa=s("https://github.com/alibaba/Sentinel/wiki/\u7194\u65AD\u964D\u7EA7"),ta=s("Spring- Cloud\u6574\u5408Sentinel\u548CFeign\uFF1A"),pa={href:"https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel",target:"_blank",rel:"noopener noreferrer"},ea=s("https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel"),oa=p(`<p>pom.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- \u5BFC\u5165sentinel\u4F9D\u8D56 --&gt;</span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--\u5BFC\u5165openFeign --&gt;</span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.properties</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">## sentinel\u4E0E\u9879\u76EE\u95F4\u7684\u901A\u4FE1\u7AEF\u53E3</span>
<span class="token key attr-name">spring.cloud.sentinel.transport.port</span><span class="token punctuation">=</span><span class="token value attr-value">8719</span>
<span class="token comment">## sentinel\u7AEF\u53E3\u8BBE\u7F6E</span>
<span class="token key attr-name">spring.cloud.sentinel.transport.dashboard</span><span class="token punctuation">=</span><span class="token value attr-value">localhost:8333</span>
<span class="token comment">## \u66B4\u9732\u4FE1\u606F</span>
<span class="token key attr-name">management.endpoints.web.exposure.exclude</span><span class="token punctuation">=</span><span class="token value attr-value">*</span>
<span class="token comment">## \u914D\u7F6E\u6587\u4EF6\u6253\u5F00 Sentinel \u5BF9 Feign \u7684\u652F\u6301</span>
<span class="token key attr-name">feign.sentinel.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F00\u542F\u540E\uFF0C\u5728\u5FAE\u670D\u52A1\u4E2D\u8C03\u7528\u8FDC\u7A0B\u670D\u52A1\uFF0CSentinel \u5C31\u4F1A\u8BB0\u5F55\u5FAE\u670D\u52A1\u4E4B\u95F4\u7684\u8C03\u7528\uFF0C\u4ECE\u800C\u5BF9\u8FDC\u7A0B\u8C03\u7528\u8FDB\u884C\u8BBE\u7F6E\u7194\u65AD\u964D\u7EA7\u7B49\u3002</p><p>\u8BF7\u6C42\u8BBE\u7F6E</p><p><img src="http://qnimg.gisfsde.com/work/image-20201126154714221.png" alt="image-20201126154714221" loading="lazy"></p><p>\u8BBE\u7F6E\u6D41\u63A7\u89C4\u5219</p><p><img src="http://qnimg.gisfsde.com/work/image-20201126165501709.png" alt="image-20201126165501709" loading="lazy"></p><p>Feign\u8BBE\u7F6E</p><p><img src="http://qnimg.gisfsde.com/work/image-20201126165336761.png" alt="image-20201126165336761" loading="lazy"></p><p>\u7ED3\u679C</p><p><img src="http://qnimg.gisfsde.com/work/image-20201126164858768.png" alt="image-20201126164858768" loading="lazy"></p><h3 id="_4\u3001\u6574\u5408-sentinel-\u6D4B\u8BD5\u9650\u6D41" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u6574\u5408-sentinel-\u6D4B\u8BD5\u9650\u6D41" aria-hidden="true">#</a> 4\u3001\u6574\u5408 Sentinel \u6D4B\u8BD5\u9650\u6D41</h3>`,14),ca=s("\u5B98\u7F51Spring-Cloud \u6574\u5408\uFF1A"),ia={href:"https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel",target:"_blank",rel:"noopener noreferrer"},la=s("https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel"),ua=p(`<p>Pom.xml</p><blockquote><p>\u53C2\u8003 3\u3001\u6574\u5408 Feign \u548C Sentinel \u6D4B\u8BD5\u7194\u65AD\u964D\u7EA7</p></blockquote><p>\u63A7\u5236\u53F0\uFF1A</p><p><img src="http://qnimg.gisfsde.com/work/image-20201126161848389.png" alt="" loading="lazy"></p><p>\u8D85\u8FC7\u5355\u7EE7\u9608\u503C\uFF0C\u8FD4\u56DE\u81EA\u5B9A\u4E49\u8BF7\u6C42\u7ED3\u679C</p><p>\u5B9E\u73B0\u65B9\u5F0F\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
  		1\u3001\u4EE3\u7801
 *      	try (Entry entry = SphU.entry(&quot;resourceName&quot;)) <span class="token punctuation">{</span>
 *      	<span class="token punctuation">}</span>(BlockedException e)<span class="token punctuation">{</span><span class="token punctuation">}</span>
 *      2\u3001\u57FA\u4E8E\u6CE8\u89E3
 *       	@SentinelResource(value = &quot;getCurrentSeckillSkusSource&quot;,blockHandler = &quot;BlockHandler&quot;)
 *       	\u65E0\u8BBA1/2\u65B9\u5F0F\u4E00\u5B9A\u8981\u914D\u7F6E\u9650\u6D41\u4EE5\u540E\u7684\u9ED8\u8BA4\u8FD4\u56DE
 *       	url\u53EF\u4EE5\u8BBE\u7F6E\u7EDF\u4E00\u8FD4\u56DE

**/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),ra=s("\u5177\u4F53\u5B9E\u73B0\u65B9\u5F0F\u53C2\u8003\u5B98\u7F51\u7ED9\u51FA\u6587\u6863\uFF1A"),ka={href:"https://github.com/alibaba/Sentinel/wiki/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"},da=s("https://github.com/alibaba/Sentinel/wiki/\u5982\u4F55\u4F7F\u7528"),ma=n("h3",{id:"_5\u3001sentinel\u7F51\u5173\u9650\u6D41",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_5\u3001sentinel\u7F51\u5173\u9650\u6D41","aria-hidden":"true"},"#"),s(" 5\u3001Sentinel\u7F51\u5173\u9650\u6D41")],-1),va=s("\u5B98\u7F51\u6587\u6863\uFF1A"),ga={href:"https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81",target:"_blank",rel:"noopener noreferrer"},ba=s("https://github.com/alibaba/Sentinel/wiki/\u7F51\u5173\u9650\u6D41"),ha=p(`<p>pom.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
          \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
          \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-sentinel-gateway\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
          \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0.RELEASE\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u52A8Sentinle1.7.1 \u540E\u6BD4\u539F\u5148\u76841.6.1\u591A\u4E2A\u4E00\u4E2A\u529F\u80FD</p><p><img src="http://qnimg.gisfsde.com/work/image-20201127102052864.png" alt="image-20201127102052864" loading="lazy"></p><p>\u60A8\u53EF\u4EE5\u5728 <code>GatewayCallbackManager</code> \u6CE8\u518C\u56DE\u8C03\u8FDB\u884C\u5B9A\u5236\uFF1A</p><ul><li><code>setBlockHandler</code>\uFF1A\u6CE8\u518C\u51FD\u6570\u7528\u4E8E\u5B9E\u73B0\u81EA\u5B9A\u4E49\u7684\u903B\u8F91\u5904\u7406\u88AB\u9650\u6D41\u7684\u8BF7\u6C42\uFF0C\u5BF9\u5E94\u63A5\u53E3\u4E3A <code>BlockRequestHandler</code>\u3002\u9ED8\u8BA4\u5B9E\u73B0\u4E3A <code>DefaultBlockRequestHandler</code>\uFF0C\u5F53\u88AB\u9650\u6D41\u65F6\u4F1A\u8FD4\u56DE\u7C7B\u4F3C\u4E8E\u4E0B\u9762\u7684\u9519\u8BEF\u4FE1\u606F\uFF1A<code>Blocked by Sentinel: FlowException</code>\u3002</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SentinelGatewayConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">SentinelGatewayConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GatewayCallbackManager</span><span class="token punctuation">.</span><span class="token function">setBlockHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlockRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u7F51\u5173\u9650\u6D41\u4E86 \u5C31\u4F1A\u56DE\u8C03</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Mono</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> serverWebExchange<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">R</span> error <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>TO_MANY_REQUEST<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>TO_MANY_REQUEST<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> errorJson <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Mono</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> body <span class="token operator">=</span> <span class="token class-name">ServerResponse</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>errorJson<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> body<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="seata" tabindex="-1"><a class="header-anchor" href="#seata" aria-hidden="true">#</a> Seata</h2><h4 id="_1\u3001\u7B80\u4ECB-1" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7B80\u4ECB-1" aria-hidden="true">#</a> 1\u3001\u7B80\u4ECB</h4><p>Seata \u662F\u4E00\u6B3E\u5F00\u6E90\u7684\u5206\u5E03\u5F0F\u4E8B\u52A1\u89E3\u51B3\u65B9\u6848\uFF0C\u81F4\u529B\u4E8E\u63D0\u4F9B\u9AD8\u6027\u80FD\u548C\u7B80\u5355\u6613\u7528\u7684\u5206\u5E03\u5F0F\u4E8B\u52A1\u670D\u52A1\u3002Seata \u5C06\u4E3A\u7528\u6237\u63D0\u4F9B\u4E86 AT\u3001TCC\u3001SAGA \u548C XA \u4E8B\u52A1\u6A21\u5F0F\uFF0C\u4E3A\u7528\u6237\u6253\u9020\u4E00\u7AD9\u5F0F\u7684\u5206\u5E03\u5F0F\u89E3\u51B3\u65B9\u6848\u3002</p>`,10),ya={href:"https://seata.io/zh-cn/index.html",target:"_blank",rel:"noopener noreferrer"},fa=s("https://seata.io/zh-cn/index.html"),qa=p('<h3 id="_2\u3001\u6838\u5FC3\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6838\u5FC3\u6982\u5FF5" aria-hidden="true">#</a> 2\u3001\u6838\u5FC3\u6982\u5FF5</h3><p><strong>TC (Transaction Coordinator) - \u4E8B\u52A1\u534F\u8C03\u8005</strong></p><p>\u7EF4\u62A4\u5168\u5C40\u548C\u5206\u652F\u4E8B\u52A1\u7684\u72B6\u6001\uFF0C\u9A71\u52A8\u5168\u5C40\u4E8B\u52A1\u63D0\u4EA4\u6216\u56DE\u6EDA\u3002</p><p><strong>TM (Transaction Manager) - \u4E8B\u52A1\u7BA1\u7406\u5668</strong></p><p>\u5B9A\u4E49\u5168\u5C40\u4E8B\u52A1\u7684\u8303\u56F4\uFF1A\u5F00\u59CB\u5168\u5C40\u4E8B\u52A1\u3001\u63D0\u4EA4\u6216\u56DE\u6EDA\u5168\u5C40\u4E8B\u52A1\u3002</p><p><strong>RM (Resource Manager) - \u8D44\u6E90\u7BA1\u7406\u5668</strong></p><p>\u7BA1\u7406\u5206\u652F\u4E8B\u52A1\u5904\u7406\u7684\u8D44\u6E90\uFF0C\u4E0ETC\u4EA4\u8C08\u4EE5\u6CE8\u518C\u5206\u652F\u4E8B\u52A1\u548C\u62A5\u544A\u5206\u652F\u4E8B\u52A1\u7684\u72B6\u6001\uFF0C\u5E76\u9A71\u52A8\u5206\u652F\u4E8B\u52A1\u63D0\u4EA4\u6216\u56DE\u6EDA\u3002</p><h2 id="oss" tabindex="-1"><a class="header-anchor" href="#oss" aria-hidden="true">#</a> OSS</h2><h3 id="_5-6-1\u3001\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_5-6-1\u3001\u7B80\u4ECB" aria-hidden="true">#</a> 5.6.1\u3001\u7B80\u4ECB</h3><p>\u5BF9\u8C61\u5B58\u50A8\u670D\u52A1 \u963F\u91CC\u4E91\u5BF9\u8C61\u5B58\u50A8\u670D\u52A1\uFF08Object Storage Service\uFF0C\u7B80\u79F0 OSS\uFF09\uFF0C\u662F\u963F\u91CC\u4E91\u63D0\u4F9B\u7684\u6D77\u91CF\u3001\u5B89\u5168\u3001\u4F4E\u6210\u672C\u3001\u9AD8\u53EF\u9760\u7684\u4E91\u5B58\u50A8\u670D\u52A1\u3002\u60A8\u53EF\u4EE5\u5728\u4EFB\u4F55\u5E94\u7528\u3001\u4EFB\u4F55\u65F6\u95F4\u3001\u4EFB\u4F55\u5730\u70B9\u5B58\u50A8\u548C\u8BBF\u95EE\u4EFB\u610F\u7C7B\u578B\u7684\u6570\u636E\u3002</p><p><img src="http://qnimg.gisfsde.com/work/image-20220512152840054.png" alt="image-20220512152840054" loading="lazy"></p><h3 id="_5-6-2\u3001\u4F7F\u7528\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#_5-6-2\u3001\u4F7F\u7528\u6B65\u9AA4" aria-hidden="true">#</a> 5.6.2\u3001\u4F7F\u7528\u6B65\u9AA4</h3><p>\u4F7F\u7528 Java \u4E0A\u4F20\u6587\u4EF6</p>',13),wa={href:"https://help.aliyun.com/document_detail/32011.html?spm=a2c4g.11186623.6.915.56196d39rr96Ll",target:"_blank",rel:"noopener noreferrer"},_a=s("https://help.aliyun.com/document_detail/32011.html?spm=a2c4g.11186623.6.915.56196d39rr96Ll"),Sa=p(`<p>\u6765\u81EA\u5B98\u7F51\u5B9E\u4F8B - \u4E0A\u4F20\u6587\u4EF6\u6D41</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// Endpoint\u4EE5\u676D\u5DDE\u4E3A\u4F8B\uFF0C\u5176\u5B83Region\u8BF7\u6309\u5B9E\u9645\u60C5\u51B5\u586B\u5199\u3002</span>
        <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">// \u4E91\u8D26\u53F7AccessKey\u6709\u6240\u6709API\u8BBF\u95EE\u6743\u9650\uFF0C\u5EFA\u8BAE\u9075\u5FAA\u963F\u91CC\u4E91\u5B89\u5168\u6700\u4F73\u5B9E\u8DF5\uFF0C\u521B\u5EFA\u5E76\u4F7F\u7528RAM\u5B50\u8D26\u53F7\u8FDB\u884CAPI\u8BBF\u95EE\u6216\u65E5\u5E38\u8FD0\u7EF4\uFF0C\u8BF7\u767B\u5F55 //https://ram.console.aliyun.com \u521B\u5EFA\u3002</span>
        <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">&quot;\\&lt;yourAccessKeyId&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">&quot;\\&lt;yourAccessKeySecret&gt;&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// \u521B\u5EFAOSSClient\u5B9E\u4F8B\u3002</span>
        <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u4E0A\u4F20\u6587\u4EF6\u6D41\u3002</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;\\&lt;yourlocalFile&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token string">&quot;\\&lt;yourBucketName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\\&lt;yourObjectName&gt;&quot;</span><span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u5173\u95EDOSSClient\u3002</span>
        ossClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4E0A\u4F20\u6210\u529F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9700\u8981\u586B\u5199 AccesskeyId \u4EE5\u53CA Secret \u540C\u65F6\u4E5F\u8981\u6307\u5B9A\u6587\u4EF6\u4F4D\u7F6E \u4EE5\u53CA\u6587\u4EF6\u540D\u5B57</p><p>\u6700\u7EC8\u4E0A\u4F20\u7ED3\u679C</p><p><img src="http://qnimg.gisfsde.com/work/image-20220512152930694.png" alt="image-20220512152930694" loading="lazy"></p><h3 id="_5-6-3\u3001-\u62BD\u53D6\u6210\u4E00\u4E2A\u5355\u72EC\u7684\u7B2C\u4E09\u65B9\u670D\u52A1-oss" tabindex="-1"><a class="header-anchor" href="#_5-6-3\u3001-\u62BD\u53D6\u6210\u4E00\u4E2A\u5355\u72EC\u7684\u7B2C\u4E09\u65B9\u670D\u52A1-oss" aria-hidden="true">#</a> 5.6.3\u3001 \u62BD\u53D6\u6210\u4E00\u4E2A\u5355\u72EC\u7684\u7B2C\u4E09\u65B9\u670D\u52A1\uFF1FOSS</h3><p>\u5B98\u7F51\u6587\u6863</p>`,7),xa={href:"https://github.com/alibaba/aliyun-spring-boot/blob/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample/README-zh.md",target:"_blank",rel:"noopener noreferrer"},Ea=s("https://github.com/alibaba/aliyun-spring-boot/blob/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample/README-zh.md"),Ia=p(`<p>\u65B0\u5EFA\u9879\u76EE gulimall-third-party</p><p>pom \u914D\u7F6E</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alicloud-oss\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

 \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${spring-cloud.version}\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
           <span class="token comment">&lt;!-- springCloudAlibaba --&gt;</span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0.RELEASE\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml \u914D\u7F6E <strong>accessKey\u3001secretKey\u3001endpoint</strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
    <span class="token key atrule">alicloud</span><span class="token punctuation">:</span>
      <span class="token key atrule">access-key</span><span class="token punctuation">:</span> LTAI4GE22ckocpNBfd36zkxJ 
      <span class="token key atrule">secret-key</span><span class="token punctuation">:</span> qDFrQ6cxZqc4DwxoWx5K2aosXXj0Go
      <span class="token key atrule">oss</span><span class="token punctuation">:</span>
        <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> oss<span class="token punctuation">-</span>cn<span class="token punctuation">-</span>shenzhen.aliyuncs.com  <span class="token comment">## \u5730\u57DF\u8282\u70B9</span>
        <span class="token key atrule">bucket</span><span class="token punctuation">:</span> gulimall<span class="token punctuation">-</span>oss01 <span class="token comment"># \u6876\u5217\u8868</span>

  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gulimall<span class="token punctuation">-</span>third<span class="token punctuation">-</span>party

<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">30000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-6-4\u3001web\u7AEF\u4E0A\u4F20\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_5-6-4\u3001web\u7AEF\u4E0A\u4F20\u4ECB\u7ECD" aria-hidden="true">#</a> 5.6.4\u3001Web\u7AEF\u4E0A\u4F20\u4ECB\u7ECD</h3><blockquote><p>\u963F\u91CC\u4E91\u5BF9\u8C61\u5B58\u50A8-\u666E\u901A\u4E0A\u4F20\u65B9\u5F0F\uFF1A</p></blockquote><p><img src="http://qnimg.gisfsde.com/work/image-20220512152947516.png" alt="image-20220512152947516" loading="lazy"></p><p>\u7528\u6237\u63D0\u4EA4\u6587\u4EF6\u5230\u670D\u52A1\u5668\uFF0C\u670D\u52A1\u5668\u5C06\u6587\u4EF6\u63D0\u4EA4\u5230 OSS \u5BF9\u8C61\u5B58\u50A8</p><p>\u548C\u6570\u636E\u76F4\u4F20\u5230OSS\u76F8\u6BD4\uFF0C\u4EE5\u4E0A\u65B9\u6CD5\u6709\u4E09\u4E2A\u7F3A\u70B9\uFF1A</p><ul><li>\u4E0A\u4F20\u6162\uFF1A\u7528\u6237\u6570\u636E\u9700\u5148\u4E0A\u4F20\u5230\u5E94\u7528\u670D\u52A1\u5668\uFF0C\u4E4B\u540E\u518D\u4E0A\u4F20\u5230OSS\u3002\u7F51\u7EDC\u4F20\u8F93\u65F6\u95F4\u6BD4\u76F4\u4F20\u5230OSS\u591A\u4E00\u500D\u3002\u5982\u679C\u7528\u6237\u6570\u636E\u4E0D\u901A\u8FC7\u5E94\u7528\u670D\u52A1\u5668\u4E2D\u8F6C\uFF0C\u800C\u662F\u76F4\u4F20\u5230OSS\uFF0C\u901F\u5EA6\u5C06\u5927\u5927\u63D0\u5347\u3002\u800C\u4E14OSS\u91C7\u7528BGP\u5E26\u5BBD\uFF0C\u80FD\u4FDD\u8BC1\u5404\u5730\u5404\u8FD0\u8425\u5546\u4E4B\u95F4\u7684\u4F20\u8F93\u901F\u5EA6\u3002</li><li>\u6269\u5C55\u6027\u5DEE\uFF1A\u5982\u679C\u540E\u7EED\u7528\u6237\u591A\u4E86\uFF0C\u5E94\u7528\u670D\u52A1\u5668\u4F1A\u6210\u4E3A\u74F6\u9888\u3002</li><li>\u8D39\u7528\u9AD8\uFF1A\u9700\u8981\u51C6\u5907\u591A\u53F0\u5E94\u7528\u670D\u52A1\u5668\u3002\u7531\u4E8EOSS\u4E0A\u4F20\u6D41\u91CF\u662F\u514D\u8D39\u7684\uFF0C\u5982\u679C\u6570\u636E\u76F4\u4F20\u5230OSS\uFF0C\u4E0D\u901A\u8FC7\u5E94\u7528\u670D\u52A1\u5668\uFF0C\u90A3\u4E48\u5C06\u80FD\u7701\u4E0B\u51E0\u53F0\u5E94\u7528\u670D\u52A1\u5668\u3002</li></ul><blockquote><p>\u963F\u91CC\u4E91\u5BF9\u8C61\u5B58\u50A8-\u670D\u52A1\u7AEF\u7B7E\u540D\u540E\u76F4\u4F20\uFF1A</p></blockquote><p><img src="http://qnimg.gisfsde.com/work/image-20201019203744740.png" alt="image-20201019203744740" loading="lazy"></p>`,13),Ca={href:"https://help.aliyun.com/document_detail/31926.html",target:"_blank",rel:"noopener noreferrer"},Aa=s("\u6D41\u7A0B\u4ECB\u7ECD"),ja=n("p",null,[n("img",{src:"http://qnimg.gisfsde.com/work/p139016.png",alt:"\u65F6\u5E8F\u56FE",loading:"lazy"})],-1),Ra=n("p",null,[n("strong",null,"\u80CC\u666F")],-1),Oa=s("\u91C7\u7528JavaScript\u5BA2\u6237\u7AEF\u76F4\u63A5\u7B7E\u540D\uFF08\u53C2\u89C1"),Pa={href:"https://help.aliyun.com/document_detail/31925.html?spm=a2c4g.11186623.2.11.26386e28XWAM19#concept-frd-4gy-5db",target:"_blank",rel:"noopener noreferrer"},Ta=s("JavaScript\u5BA2\u6237\u7AEF\u7B7E\u540D\u76F4\u4F20"),La=s("\uFF09\u65F6\uFF0CAccessKey ID\u548CAcessKey Secret\u4F1A\u66B4\u9732\u5728\u524D\u7AEF\u9875\u9762\uFF0C\u56E0\u6B64\u5B58\u5728\u4E25\u91CD\u7684\u5B89\u5168\u9690\u60A3\u3002\u56E0\u6B64\uFF0COSS\u63D0\u4F9B\u4E86\u670D\u52A1\u7AEF\u7B7E\u540D\u540E\u76F4\u4F20\u7684\u65B9\u6848\u3002"),Va=n("p",null,"Web\u7AEF\u5411\u670D\u52A1\u7AEF\u8BF7\u6C42\u7B7E\u540D\uFF0C\u7136\u540E\u76F4\u63A5\u4E0A\u4F20\uFF0C\u4E0D\u4F1A\u5BF9\u670D\u52A1\u7AEF\u4EA7\u751F\u538B\u529B\uFF0C\u800C\u4E14\u5B89\u5168\u53EF\u9760\u3002\u670D\u52A1\u7AEF\u7B7E\u540E\u76F4\u4F20",-1),Da=n("h2",{id:"openfeign",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#openfeign","aria-hidden":"true"},"#"),s(" OpenFeign")],-1),Ba={id:"\u7B80\u4ECB",tabindex:"-1"},Ma=n("a",{class:"header-anchor",href:"#\u7B80\u4ECB","aria-hidden":"true"},"#",-1),Ua=s(),Na={href:"https://www.springcloud.cc/spring-cloud-greenwich.html#_spring_cloud_openfeign",target:"_blank",rel:"noopener noreferrer"},za=s("\u7B80\u4ECB"),Fa=p(`<p>Feign \u662F\u4E00\u4E2A\u58F0\u660E\u5F0F\u7684 HTTP \u5BA2\u6237\u7AEF\uFF0C\u4ED6\u7684\u76EE\u7684\u5C31\u662F\u8BA9\u8FDC\u7A0B\u8C03\u7528\u66F4\u52A0\u7B80\u5355\uFF0CFeign\u63D0\u4F9B\u4E86 HTTP\u8BF7\u6C42\u7684\u6A21\u677F\uFF0C<strong>\u901A\u8FC7\u7F16\u5199\u7B80\u5355\u7684\u63A5\u53E3\u548C\u63D2\u5165\u6CE8\u89E3</strong>\uFF0C\u5C31\u53EF\u4EE5\u5B9A\u4E49\u597D\u7684 HTTP \u8BF7\u6C42\u53C2\u6570\u3001\u683C\u5F0F\u3001\u5730\u5740\u7B49\u4FE1\u606F</p><p>Feign \u6574\u5408\u4E86 <strong>Ribbon\uFF08\u8D1F\u8F7D\u5747\u8861</strong>\uFF09\u548C <strong>Hystrix\uFF08\u670D\u52A1\u7194\u65AD</strong>\uFF09\uFF0C\u53EF\u4EE5\u8BA9\u6211\u4EEC\u4E0D\u518D\u9700\u8981\u663E\u793A\u5730\u4F7F\u7528\u8FD9\u4E24\u4E2A\u7EC4\u4EF6</p><p>SpringCloud - Feign\uFF0C\u5728 NetflixFeign \u7684\u57FA\u7840\u4E0A\u6269\u5C55\u4E86\u5BF9 SpringMVC \u6CE8\u89E3\u7684\u652F\u6301\uFF0C\u5728\u5176\u5B9E\u73B0\u4E0B\uFF0C\u6211\u4EEC\u53EA\u9700\u521B\u5EFA\u4E00\u4E2A\u63A5\u53E3\u5E76\u7528\u6CE8\u89E3\u7684\u65B9\u5F0F\u6765\u914D\u7F6E\u5B83\uFF0C\u5373\u53EF\u5B8C\u6210\u5BF9\u670D\u52A1\u63D0\u4F9B\u65B9\u7684\u63A5\u53E3\u7ED1\u5B9A\u3002\u7B80\u5316\u4E86 SpringCloud - Ribbon \u81EA\u884C\u5C01\u88C5\u670D\u52A1\u8C03\u7528\u5BA2\u6237\u7AEF\u7684\u5F00\u53D1\u91CF\u3002</p><h3 id="_1-\u5F15\u5165\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_1-\u5F15\u5165\u4F9D\u8D56" aria-hidden="true">#</a> 1.\u5F15\u5165\u4F9D\u8D56</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u521B\u5EFA\u670D\u52A1\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#_2-\u521B\u5EFA\u670D\u52A1\u63A5\u53E3" aria-hidden="true">#</a> 2.\u521B\u5EFA\u670D\u52A1\u63A5\u53E3</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">&quot;gulimall-coupon&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CouponFeignService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/coupon/coupon/member/list&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">membercoupons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-\u5F00\u542F\u8FDC\u7A0B\u8C03\u7528\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#_3-\u5F00\u542F\u8FDC\u7A0B\u8C03\u7528\u529F\u80FD" aria-hidden="true">#</a> 3.\u5F00\u542F\u8FDC\u7A0B\u8C03\u7528\u529F\u80FD</h3><p>\u5BA2\u6237\u7AEF\u4E3B\u542F\u52A8\u7C7B\u6CE8\u89E3\u5F00\u542F\u8FDC\u7A0B\u8C03\u7528\u529F\u80FD\uFF0C\u8C03\u7528\u63A5\u53E3\u4F7F\u7528\u670D\u52A1</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@EnableFeignClients(basePackages = &quot;com.atguigu.gulimall.member.feign&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="gateway" tabindex="-1"><a class="header-anchor" href="#gateway" aria-hidden="true">#</a> Gateway</h2><h3 id="\u7B80\u4ECB-1" tabindex="-1"><a class="header-anchor" href="#\u7B80\u4ECB-1" aria-hidden="true">#</a> \u7B80\u4ECB</h3><p>\u7F51\u5173\u4F5C\u4E3A\u6D41\u6D6A\u5165\u53E3\uFF0C\u5E38\u7528\u529F\u80FD\u5305\u62EC\u8DEF\u7531\u8F6C\u53D1\uFF0C\u6743\u9650\u6548\u9A8C\uFF0C\u9650\u6D41\u63A7\u5236\u7B49\uFF0C\u800C SpringCloud GateWay\u4F5C\u4E3A SpringCloud \u5B98\u65B9\u63A8\u51FA\u7684\u7B2C\u4E8C\u4EE3\u7F51\u5173\u6846\u67B6\uFF0C\u53D6\u4EE3\u4E86 Zull \u7F51\u5173</p><p>\u7F51\u4E0A\u6D4B\u8BD5 \u4E09\u79CD\u7F51\u5173\u5BF9\u5E94\u8BF7\u6C42\u6570</p><p><img src="http://qnimg.gisfsde.com/work/image-20220512153202454.png" alt="image-20220512153202454" loading="lazy"></p><p>\u7F51\u5173\u63D0\u4F9B API \u5168\u6258\u7BA1\u670D\u52A1\uFF0C\u4E30\u5BCC\u7684 API \u7BA1\u7406\u529F\u80FD\uFF0C\u8F85\u52A9\u4F01\u4E1A\u7BA1\u7406\u5927\u89C4\u6A21\u7684 API\uFF0C\u4EE5\u964D\u4F4E\u7BA1\u7406\u6210\u672C\u548C\u5B89\u5168\u98CE\u9669\u3001\u5305\u62EC\u534F\u8BAE\u9002\u914D\u3001\u534F\u8BAE\u8F6C\u53D1\u3001\u5B89\u5168\u7B56\u7565\u3001\u9632\u5237\u3001\u6D41\u91CF\u3001\u76D1\u63A7\u65E5\u5FD7\u7B49\u529F\u80FD</p><p>Spring Cloud GateWay \u65E8\u5728\u63D0\u4F9B\u4E00\u79CD\u7B80\u5355\u6709\u6548\u7684\u65B9\u5F0F\u6765\u5BF9 API \u8FDB\u884C\u8DEF\u7531\uFF0C\u5E76\u4E3A\u4ED6\u4EEC\u63D0\u4F9B\u5207\u9762\uFF0C\u5217\u5982\u3001\u5B89\u5168\u6027\u3001\u76D1\u63A7/\u6307\u6807 \u548C\u5F39\u6027\u7B49</p><h2 id="sleuth-zipkin-\u670D\u52A1\u94FE\u8DEF\u8FFD\u8E2A" tabindex="-1"><a class="header-anchor" href="#sleuth-zipkin-\u670D\u52A1\u94FE\u8DEF\u8FFD\u8E2A" aria-hidden="true">#</a> Sleuth+Zipkin \u670D\u52A1\u94FE\u8DEF\u8FFD\u8E2A</h2><h3 id="\u4E3A\u4EC0\u4E48\u7528" tabindex="-1"><a class="header-anchor" href="#\u4E3A\u4EC0\u4E48\u7528" aria-hidden="true">#</a> \u4E3A\u4EC0\u4E48\u7528</h3><p>\u5FAE\u670D\u52A1\u67B6\u6784\u662F\u4E00\u4E2A\u5206\u5E03\u5F0F\u67B6\u6784\uFF0C\u5B83\u6309\u4E1A\u52A1\u5212\u5206\u670D\u52A1\u5355\u5143\uFF0C\u4E00\u4E2A\u5206\u5E03\u5F0F\u7CFB\u7EDF\u5F80\u5F80\u6709\u5F88\u591A\u4E2A\u670D\u52A1\u5355\u5143\u3002\u7531\u4E8E\u670D\u52A1\u5355\u5143\u6570\u91CF\u4F17\u591A\uFF0C\u4E1A\u52A1\u7684\u590D\u6742\u6027\uFF0C\u5982\u679C\u51FA\u73B0\u4E86\u9519\u8BEF\u548C\u5F02\u5E38\uFF0C\u5F88\u96BE\u53BB\u5B9A\u4F4D\u3002\u4E3B\u8981\u4F53\u73B0\u5728\uFF0C\u4E00\u4E2A\u8BF7\u6C42\u53EF\u80FD\u9700\u8981\u8C03\u7528\u5F88\u591A\u4E2A\u670D\u52A1\uFF0C\u800C\u5185\u90E8\u670D\u52A1\u7684\u8C03\u7528\u590D\u6742\u6027\uFF0C\u51B3\u5B9A\u4E86\u95EE\u9898\u96BE\u4EE5\u5B9A\u4F4D\u3002\u6240\u4EE5\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\uFF0C\u5FC5\u987B\u5B9E\u73B0\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\uFF0C\u53BB\u8DDF\u8FDB\u4E00\u4E2A\u8BF7 \u6C42\u5230\u5E95\u6709\u54EA\u4E9B\u670D\u52A1\u53C2\u4E0E\uFF0C\u53C2\u4E0E\u7684\u987A\u5E8F\u53C8\u662F\u600E\u6837\u7684\uFF0C\u4ECE\u800C\u8FBE\u5230\u6BCF\u4E2A\u8BF7\u6C42\u7684\u6B65\u9AA4\u6E05\u6670\u53EF\u89C1\uFF0C\u51FA\u4E86\u95EE\u9898\uFF0C\u5F88\u5FEB\u5B9A\u4F4D\u3002</p><p>\u94FE\u8DEF\u8FFD\u8E2A\u7EC4\u4EF6\u6709Google \u7684Dapper, Twitter \u7684Zipkin,\u4EE5\u53CA\u963F\u91CC\u7684Eagleeye(\u9E70\u773C)\u7B49\uFF0C\u5B83\u4EEC\u90FD\u662F\u975E\u5E38\u4F18\u79C0\u7684\u94FE\u8DEF\u8FFD\u8E2A\u5F00\u6E90\u7EC4\u4EF6\u3002</p><h1 id="\u4E94\u3001\u524D\u7AEF\u5F00\u53D1\u57FA\u7840\u77E5\u8BC6" tabindex="-1"><a class="header-anchor" href="#\u4E94\u3001\u524D\u7AEF\u5F00\u53D1\u57FA\u7840\u77E5\u8BC6" aria-hidden="true">#</a> \u4E94\u3001\u524D\u7AEF\u5F00\u53D1\u57FA\u7840\u77E5\u8BC6</h1><p>\u8FD9\u4E2A\u7B49\u4EE5\u540E\u6DF1\u5165\u5B66\u4E60\u5728\u8FDB\u884C\u8BB0\u5F55~~~~</p><h2 id="_7-1-vscode-\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_7-1-vscode-\u4F7F\u7528" aria-hidden="true">#</a> 7.1 VSCode \u4F7F\u7528</h2><p>Get</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>	&quot;http-get\u8BF7\u6C42&quot;: {
		&quot;prefix&quot;: &quot;httpget&quot;,
		&quot;body&quot;: [
		&quot;this.\\\\$http({&quot;,
		&quot;url: this.\\\\$http.adornUrl(&#39;&#39;),&quot;,
		&quot;method: &#39;get&#39;,&quot;,
		&quot;params: this.\\\\$http.adornParams({})&quot;,
		&quot;}).then(({ data }) =&gt; {&quot;,
		&quot;})&quot;],
		&quot;description&quot;: &quot;httpGET\u8BF7\u6C42&quot;
	},
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>POST</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>	&quot;http-post\u8BF7\u6C42&quot;: {
		&quot;prefix&quot;: &quot;httppost&quot;,
		&quot;body&quot;: [
		&quot;this.\\\\$http({&quot;,
		&quot;url: this.\\\\$http.adornUrl(&#39;&#39;),&quot;,
		&quot;method: &#39;post&#39;,&quot;,
		&quot;data: this.\\\\$http.adornData(data, false)&quot;,
		&quot;}).then(({ data }) =&gt; { });&quot; ],
		&quot;description&quot;: &quot;httpPOST\u8BF7\u6C42&quot;
	}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,28),Ga={id:"_7-2-es6",tabindex:"-1"},Qa=n("a",{class:"header-anchor",href:"#_7-2-es6","aria-hidden":"true"},"#",-1),Ha=s(" 7.2 "),Wa={href:"https://es6.ruanyifeng.com/",target:"_blank",rel:"noopener noreferrer"},Ja=s("ES6"),Ka=p(`<h2 id="_7-3-node-js" tabindex="-1"><a class="header-anchor" href="#_7-3-node-js" aria-hidden="true">#</a> 7.3 Node.js</h2><h2 id="_7-4-vue" tabindex="-1"><a class="header-anchor" href="#_7-4-vue" aria-hidden="true">#</a> 7.4 Vue</h2><h3 id="_7-4-5-\u6574\u5408-element-ui" tabindex="-1"><a class="header-anchor" href="#_7-4-5-\u6574\u5408-element-ui" aria-hidden="true">#</a> 7.4.5 \u6574\u5408 Element UI</h3><blockquote><p>1\u3001\u5B89\u88C5</p></blockquote><div class="language-vu ext-vu line-numbers-mode"><pre class="language-vu"><code>npm i element-ui -S
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>2\u3001\u5F15\u5165 Element</p></blockquote><p>main.js \u4E2D\u5F15\u5165\u4EE5\u4E0B\u5185\u5BB9</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>import Vue from &#39;vue&#39;;
import ElementUI from &#39;element-ui&#39;;
import &#39;element-ui/lib/theme-chalk/index.css&#39;; // \u5F15\u5165\u9759\u6001\u8D44\u6E90\u6587\u4EF6
import App from &#39;./App.vue&#39;;

Vue.use(ElementUI);

new Vue({
  el: &#39;#app&#39;,
  render: h =&gt; h(App)
});
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-5-babel" tabindex="-1"><a class="header-anchor" href="#_7-5-babel" aria-hidden="true">#</a> 7.5 Babel</h3><h3 id="_7-6-webpack" tabindex="-1"><a class="header-anchor" href="#_7-6-webpack" aria-hidden="true">#</a> 7.6 Webpack</h3><h1 id="\u516D\u3001\u5546\u54C1\u670D\u52A1-\u4E09\u7EA7\u5206\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u516D\u3001\u5546\u54C1\u670D\u52A1-\u4E09\u7EA7\u5206\u7C7B" aria-hidden="true">#</a> \u516D\u3001\u5546\u54C1\u670D\u52A1&amp;\u4E09\u7EA7\u5206\u7C7B</h1><h2 id="_8-1-\u57FA\u7840\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_8-1-\u57FA\u7840\u6982\u5FF5" aria-hidden="true">#</a> 8.1 \u57FA\u7840\u6982\u5FF5</h2><h3 id="_8-1-1\u3001\u4E09\u7EA7\u5206\u7C7B" tabindex="-1"><a class="header-anchor" href="#_8-1-1\u3001\u4E09\u7EA7\u5206\u7C7B" aria-hidden="true">#</a> 8.1.1\u3001\u4E09\u7EA7\u5206\u7C7B</h3><p><img src="http://qnimg.gisfsde.com/work/image-20220512154227328.png" alt="image-20220512154227328" loading="lazy"></p><p>\u4E00\u7EA7\u5206\u7C7B\u67E5\u51FA\u4E8C\u7EA7\u5206\u7C7B\u6570\u636E\uFF0C\u4E8C\u7EA7\u5206\u7C7B\u4E2D\u67E5\u8BE2\u51FA\u4E09\u7EA7\u5206\u7C7B\u6570\u636E</p><p><strong>\u6570\u636E\u5E93\u8BBE\u8BA1</strong></p><p><img src="http://qnimg.gisfsde.com/work/image-20220512154240463.png" alt="image-20220512154240463" loading="lazy"></p><h3 id="_8-1-2\u3001spu-\u548C-sku" tabindex="-1"><a class="header-anchor" href="#_8-1-2\u3001spu-\u548C-sku" aria-hidden="true">#</a> 8.1.2\u3001SPU \u548C SKU</h3><p><strong>SPU\uFF1AStandard Product Unit \uFF08\u6807\u51C6\u5316\u4EA7\u54C1\u5355\u5143\uFF09</strong></p><p>\u662F\u5546\u54C1\u4FE1\u606F\u805A\u5408\u7684\u6700\u5C0F\u5355\u4F4D\uFF0C\u662F\u4E00\u7EC4\u53EF\u590D\u7528\uFF0C\u6613\u68C0\u7D22\u7684\u6807\u51C6\u5316\u4FE1\u606F\u7684\u7EC4\u5408\uFF0C\u8BE5\u96C6\u5408\u63CF\u8FF0\u4E86\u4E00\u4E2A\u4EA7\u54C1\u7684\u7279\u6027</p><p><img src="http://qnimg.gisfsde.com/work/image-20201020083615056.png" alt="image-20201020083615056" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201020083857519.png" alt="image-20201020083857519" loading="lazy"></p><p>IPhoneX \u662F SPU,MI8 \u662F SPU</p><p>IPhoneX 64G \u9ED1\u66DC\u77F3 \u662F SKU</p><p>MIX8 + 64G \u662F SKU</p><p><strong>SKU: Stock KeepingUnit (\u5E93\u5B58\u91CF\u5355\u4F4D)</strong></p><h3 id="_8-1-3\u3001\u57FA\u672C\u5C5E\u6027-\u3010\u89C4\u683C\u53C2\u6570\u3011\u4E0E-\u9500\u552E\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#_8-1-3\u3001\u57FA\u672C\u5C5E\u6027-\u3010\u89C4\u683C\u53C2\u6570\u3011\u4E0E-\u9500\u552E\u5C5E\u6027" aria-hidden="true">#</a> 8.1.3\u3001\u57FA\u672C\u5C5E\u6027 \u3010\u89C4\u683C\u53C2\u6570\u3011\u4E0E \u9500\u552E\u5C5E\u6027</h3><p>\u6BCF\u4E2A\u5206\u5171\u4E0B\u7684\u5546\u5171\u4EAB\u89C4\u683C\u53C2\u6570\u3001\u4E0E\u9500\u552E\u5C5E\u6027\uFF0C\u53EA\u662F\u6709\u4E9B\u5546\u54C1\u4E0D\u4E00\u5B9A\u66F4\u7528\u8FD9\u4E2A\u5206\u7C7B\u4E0B\u5168\u90E8\u7684\u5C5E\u6027\uFF1A</p><p>\u5C5E\u6027\u662F\u4EE5\u4E09\u7EA7\u5206\u7C7B\u7EC4\u7EC7\u8D77\u6765\u7684</p><p>\u89C4\u683C\u53C2\u6570\u4E2D\u6709\u4E9B\u662F\u53EF\u4EE5\u63D0\u4F9B\u68C0\u7D22\u7684</p><p>\u89C4\u683C\u53C2\u6570\u4E5F\u662F\u57FA\u672C\u5C5E\u6027\uFF0C\u4ED6\u4EEC\u5177\u6709\u81EA\u5DF1\u7684\u5206\u7EC4</p><p>\u5C5E\u6027\u7684\u5206\u7EC4\u4E5F\u662F\u4EE5\u4E09\u7EA7\u5206\u7C7B\u7EC4\u7EC7\u8D77\u6765\u7684</p><p>\u5C5E\u6027\u540D\u786E\u5B9A\u7684\uFF0C\u4F46\u662F\u503C\u662F\u6BCF\u4E00\u4E2A\u5546\u54C1\u4E0D\u540C\u6765\u51B3\u5B9A\u7684</p><blockquote><p>\u3010\u5C5E\u6027\u5206\u7EC4-\u89C4\u683C\u53C2\u6570-\u9500\u552E\u5C5E\u6027-\u4E09\u7EA7\u5206\u7C7B\u3011\u5173\u8054\u5173\u7CFB</p></blockquote><p><img src="http://qnimg.gisfsde.com/work/image-20201020150957557.png" alt="image-20201020150957557" loading="lazy"></p><p>SPU-SKU-\u5C5E\u6027\u8868</p><p><img src="http://qnimg.gisfsde.com/work/image-20201020151022330.png" alt="image-20201020151022330" loading="lazy"></p><h3 id="_8-1-4\u3001\u63A5\u53E3\u6587\u6863\u4F4D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_8-1-4\u3001\u63A5\u53E3\u6587\u6863\u4F4D\u7F6E" aria-hidden="true">#</a> 8.1.4\u3001\u63A5\u53E3\u6587\u6863\u4F4D\u7F6E</h3>`,38),$a={href:"https://easydoc.xyz/s/78237135/ZUqEdvA4/hKJTcbfd",target:"_blank",rel:"noopener noreferrer"},Xa=s("https://easydoc.xyz/s/78237135/ZUqEdvA4/hKJTcbfd"),Ya=p(`<h3 id="_8-1-5\u3001-object-\u5212\u5206" tabindex="-1"><a class="header-anchor" href="#_8-1-5\u3001-object-\u5212\u5206" aria-hidden="true">#</a> 8.1.5\u3001 Object \u5212\u5206</h3><h4 id="vo-view-object-\u89C6\u56FE\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#vo-view-object-\u89C6\u56FE\u5BF9\u8C61" aria-hidden="true">#</a> <strong>VO \uFF08View Object\uFF09\u89C6\u56FE\u5BF9\u8C61</strong></h4><p>\u7528\u4E8E\u5C55\u793A\u5C42\uFF0C\u5B83\u7684\u4F5C\u7528\u662F\u628A\u67D0\u4E2A\u6307\u5B9A\u9875\u9762\uFF08\u6216\u7EC4\u4EF6\uFF09\u7684\u6240\u6709\u6570\u636E\u5C01\u88C5\u8D77\u6765\u3002\u901A\u5E38\u7528\u4E8E\u4E1A\u52A1\u5C42\u4E4B\u95F4\u7684\u6570\u636E\u4F20\u9012\uFF0C\u548C PO \u4E00\u6837\u4E5F\u662F\u4EC5\u4EC5\u5305\u542B\u6570\u636E\u800C\u5DF2\uFF0C\u4F46\u5E94\u662F\u62BD\u8C61\u51FA\u7684\u4E1A\u52A1\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u548C\u8868\u5BF9\u5E94\uFF0C\u4E5F\u53EF\u4EE5\u4E0D\uFF0C\u8FD9\u6839\u636E\u4E1A\u52A1\u7684\u9700\u8981\uFF0C\u7528 new \u5173\u952E\u5B57\u521B\u5EFA\uFF0C\u7531 GC \u56DE\u6536</p><p>view Object \u8BD5\u56FE\u5BF9\u8C61</p><p>\u63A5\u53D7\u9875\u9762\u4F20\u9012\u6765\u7684\u6570\u636E\uFF0C\u5C01\u88C5\u5BF9\u8C61\uFF0C\u5C01\u88C5\u9875\u9762\u9700\u8981\u7528\u7684\u6570\u636E</p><h4 id="dto-data-transfer-object-\u6570\u636E\u4F20\u8F93\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#dto-data-transfer-object-\u6570\u636E\u4F20\u8F93\u5BF9\u8C61" aria-hidden="true">#</a> <strong>DTO\uFF08Data Transfer Object\uFF09\u6570\u636E\u4F20\u8F93\u5BF9\u8C61</strong></h4><p>\u4E3B\u8981\u7528\u4E8E\u5C55\u793A\u5C42\u4E0E\u670D\u52A1\u5C42\u4E4B\u95F4\u7684\u6570\u636E\u4F20\u8F93\u5BF9\u8C61\u3002\u8FD9\u4E2A\u6982\u5FF5\u6765\u6E90\u4E8E J2EE \u7684\u8BBE\u8BA1\u6A21\u5F0F\uFF0C\u539F\u6765\u7684\u76EE\u7684\u662F\u4E3A\u4E86 EJB\u7684\u5206\u5E03\u5F0F\u5E94\u7528\u63D0\u4F9B\u7C97\u7C92\u5EA6\u7684\u6570\u636E\u5B9E\u4F53\uFF0C\u4EE5\u51CF\u5C11\u5206\u5E03\u5F0F\u8C03\u7528\u7684\u6B21\u6570\uFF0C\u4ECE\u800C\u63D0\u9AD8\u5206\u6570\u8C03\u7528\u7684\u6027\u80FD\u548C\u964D\u4F4E\u7F51\u7EDC\u8D1F\u8F7D\uFF0C\u4F46\u5728\u8FD9\u91CC\uFF0C\u6CDB\u6307\u7528\u4E8E\u5C55\u793A\u5C42\u4E0E\u670D\u52A1\u5C42\u4E4B\u95F4\u7684\u6570\u636E\u4F20\u8F93\u5BF9\u8C61</p><h4 id="do-domain-object-\u9886\u57DF\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#do-domain-object-\u9886\u57DF\u5BF9\u8C61" aria-hidden="true">#</a> <strong>DO\uFF08Domain Object\uFF09\u9886\u57DF\u5BF9\u8C61</strong></h4><p>\u5C31\u662F\u4ECE\u73B0\u5B9E\u4E16\u754C\u4E2D\u62BD\u8C61\u51FA\u6765\u7684\u6709\u5F62\u6216\u65E0\u5F62\u7684\u4E1A\u52A1\u5B9E\u4F53\u3002</p><h4 id="po-persistent-object-\u6301\u4E45\u5316\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#po-persistent-object-\u6301\u4E45\u5316\u5BF9\u8C61" aria-hidden="true">#</a> <strong>PO\uFF08Persistent Object\uFF09\uFF1A\u6301\u4E45\u5316\u5BF9\u8C61</strong></h4><p>\u5B83\u8DDF\u6301\u4E45\u5C42\uFF08\u901A\u5E38\u662F\u5173\u7CFB\u578B\u6570\u636E\u5E93\uFF09\u7684\u6570\u636E\u7ED3\u6784\u5F62\u6210\u4E00\u4E00\u5BF9\u5E94\u7684\u6620\u5C04\u5173\u7CFB\uFF0C\u5982\u679C\u6301\u4E45\u5C42\u662F\u5173\u7CFB\u578B\u6570\u636E\u5E93\uFF0C\u90A3\u4E48\uFF0C\u6570\u636E\u8868\u4E2D\u7684\u6BCF\u4E2A\u5B57\u6BB5\u5C31\u5BF9\u5E94PO\u7684\u4E00\u4E2A\u5C5E\u6027\u3002po \u5C31\u662F\u5BF9\u5E94\u6570\u636E\u5E93\u4E2D\u67D0\u4E00\u4E2A\u8868\u7684\u4E00\u6761\u8BB0\u5F55\uFF0C\u591A\u4E2A\u8BB0\u5F55\u53EF\u4EE5\u7528 PO \u7684\u96C6\u5408\uFF0CPO \u4E2D\u5E94\u8BE5\u4E0D\u5305\u542B\u4EFB\u4F55\u5BF9\u6570\u636E\u5E93\u5230\u64CD\u4F5C</p><h4 id="to-transfer-object-\u6570\u636E\u4F20\u8F93\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#to-transfer-object-\u6570\u636E\u4F20\u8F93\u5BF9\u8C61" aria-hidden="true">#</a> <strong>TO (Transfer Object) \u6570\u636E\u4F20\u8F93\u5BF9\u8C61</strong></h4><p>\u4E0D\u540C\u7684\u5E94\u7528\u7A0B\u5E8F\u4E4B\u95F4\u4F20\u8F93\u7684\u5BF9\u8C61</p><h4 id="bo-business-object-\u4E1A\u52A1\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#bo-business-object-\u4E1A\u52A1\u5BF9\u8C61" aria-hidden="true">#</a> <strong>BO(business object) \u4E1A\u52A1\u5BF9\u8C61</strong></h4><p>\u4ECE\u4E1A\u52A1\u6A21\u578B\u7684\u89D2\u5EA6\u770B\uFF0C\u89C1 UML \u539F\u4EF6\u9886\u57DF\u6A21\u578B\u4E2D\u7684\u9886\u57DF\u5BF9\u8C61\uFF0C\u5C01\u88C5\u4E1A\u52A1\u903B\u8F91\u7684\uFF0C java \u5BF9\u8C61\uFF0C\u901A\u8FC7\u8C03\u7528 DAO \u65B9\u6CD5\uFF0C\u7ED3\u5408 PO VO,\u8FDB\u884C\u4E1A\u52A1\u64CD\u4F5C\uFF0Cbusiness object \u4E1A\u52A1\u5BF9\u8C61\uFF0C\u4E3B\u8981\u4F5C\u7528\u662F\u628A\u4E1A\u52A1\u903B\u8F91\u5C01\u88C5\u6210\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u5305\u62EC\u4E00\u4E2A\u6216\u591A\u4E2A\u5BF9\u8C61\uFF0C\u6BD4\u5982\u4E00\u4E2A\u7B80\u5386\uFF0C\u6709\u6559\u80B2\u7ECF\u5386\uFF0C\u5DE5\u4F5C\u7ECF\u5386\uFF0C\u793E\u4F1A\u5173\u7CFB\u7B49\u7B49\uFF0C\u6211\u4EEC\u53EF\u4EE5\u628A\u6559\u80B2\u7ECF\u5386\u5BF9\u5E94\u4E00\u4E2A PO \u3001\u5DE5\u4F5C\u7ECF\u9A8C\u5BF9\u5E94\u4E00\u4E2A PO\u3001 \u793E\u4F1A\u5173\u7CFB\u5BF9\u5E94\u4E00\u4E2A PO, \u5EFA\u7ACB\u4E00\u4E2A\u5BF9\u5E94\u7B80\u5386\u7684\u7684 BO \u5BF9\u8C61\u5904\u7406\u7B80\u5386\uFF0C\u6BCF \u4E2A BO \u5305\u542B\u8FD9\u4E9B PO ,\u8FD9\u6837\u5904\u7406\u4E1A\u52A1\u903B\u8F91\u65F6\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u9488\u5BF9 BO \u53BB\u5904\u7406</p><h4 id="pojo-plain-ordinary-java-object-\u7B80\u5355\u65E0\u89C4\u5219-java-\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#pojo-plain-ordinary-java-object-\u7B80\u5355\u65E0\u89C4\u5219-java-\u5BF9\u8C61" aria-hidden="true">#</a> <strong>POJO ( plain ordinary java object) \u7B80\u5355\u65E0\u89C4\u5219 java \u5BF9\u8C61</strong></h4><p>\u4F20\u7EDF\u610F\u4E49\u7684 java \u5BF9\u8C61\uFF0C\u5C31\u662F\u8BF4\u4E00\u4E9B Object/Relation Mapping \u5DE5\u5177\u4E2D\uFF0C\u80FD\u591F\u505A\u5230\u7EF4\u62A4\u6570\u636E\u5E93\u8868\u8BB0\u5F55\u7684 persisent object \u5B8C\u5168\u662F\u4E00\u4E2A\u7B26\u5408 Java Bean \u89C4\u8303\u7684 \u7EAF java \u5BF9\u8C61\uFF0C\u6CA1\u6709\u589E\u52A0\u522B\u7684\u5C5E\u6027\u548C\u65B9\u6CD5\uFF0C\u6211\u4EEC\u7684\u7406\u89E3\u5C31\u662F\u6700\u57FA\u672C\u7684 Java bean \u53EA\u6709\u5C5E\u6027\u5B57\u6BB5 setter \u548C getter \u65B9\u6CD5</p><p>POJO \u65F6\u662F DO/DTO/BO/VO \u7684\u7EDF\u79F0</p><h4 id="dao-data-access-object-\u6570\u636E\u8BBF\u95EE\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#dao-data-access-object-\u6570\u636E\u8BBF\u95EE\u5BF9\u8C61" aria-hidden="true">#</a> <strong>DAO\uFF08data access object\uFF09 \u6570\u636E\u8BBF\u95EE\u5BF9\u8C61</strong></h4><p>\u662F\u4E00\u4E2A sun \u7684\u4E00\u4E2A\u6807\u51C6 j2ee \u8BBE\u8BA1\u6A21\u5F0F\uFF0C\u8FD9\u4E2A\u6A21\u5F0F\u6709\u4E2A\u63A5\u53E3\u5C31\u662F DAO \uFF0C\u4ED6\u8D1F\u6301\u4E45\u5C42\u7684\u64CD\u4F5C\uFF0C\u4E3A\u4E1A\u52A1\u5C42\u63D0\u4F9B\u63A5\u53E3\uFF0C\u6B64\u5BF9\u8C61\u7528\u4E8E\u8BBF\u95EE\u6570\u636E\u5E93\uFF0C\u901A\u5E38\u548C PO \u7ED3\u5408\u4F7F\u7528\uFF0CDAO \u4E2D\u5305\u542B\u4E86\u5404\u79CD\u6570\u636E\u5E93\u7684\u64CD\u4F5C\u65B9\u6CD5\uFF0C\u901A\u8FC7\u5B83\u7684\u65B9\u6CD5\uFF0C\u7ED3\u5408 PO \u5BF9\u6570\u636E\u5E93\u8FDB\u884C\u76F8\u5173\u64CD\u4F5C\uFF0C\u5939\u5728\u4E1A\u52A1\u903B\u8F91\u4E0E\u6570\u636E\u5E93\u8D44\u6E90\u4E2D\u95F4\uFF0C\u914D\u5408VO \u63D0\u4F9B\u6570\u636E\u5E93\u7684 CRUD \u529F\u80FD</p><h4 id="vo-\u4E0E-dto-\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#vo-\u4E0E-dto-\u7684\u533A\u522B" aria-hidden="true">#</a> <strong>VO \u4E0E DTO \u7684\u533A\u522B</strong></h4><p>DTO \u548C VO \u7684\u5C5E\u6027\u503C\u57FA\u672C\u662F\u4E00\u81F4\u7684\uFF0C\u800C\u4E14\u4ED6\u4EEC\u901A\u5E38\u90FD\u662F POJO\u3010\u7B80\u5355\u7684 Java \u5BF9\u8C61\uFF08Plain Old Java Object\uFF09\u3011,\u4F46\u4E24\u8005\u5B58\u5728\u672C\u8D28\u4E0A\u7684\u533A\u522B\uFF1BDTO \u4EE3\u8868\u670D\u52A1\u5C42\u9700\u8981\u63A5\u6536\u7684\u6570\u636E\u548C\u8FD4\u56DE\u7684\u6570\u636E\uFF0C\u800CVO \u4EE3\u8868\u5C55\u793A\u5C42\u9700\u8981\u663E\u793A\u7684\u6570\u636E\u3002</p><h4 id="dto-\u4E0E-do-\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#dto-\u4E0E-do-\u7684\u533A\u522B" aria-hidden="true">#</a> <strong>DTO \u4E0E DO \u7684\u533A\u522B</strong></h4><p>\u9996\u5148\u662F\u6982\u5FF5\u4E0A\u7684\u533A\u522B\uFF0CDTO \u662F\u5C55\u793A\u5C42\u548C\u670D\u52A1\u5C42\u4E4B\u95F4\u7684\u6570\u636E\u4F20\u8F93\u5BF9\u8C61\uFF08\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E24\u8005\u4E4B\u95F4\u7684\u534F\u8BAE\uFF09\uFF0C\u800C DO\u662F\u5BF9\u73B0\u5B9E\u4E16\u754C\u5404\u79CD\u4E1A\u52A1\u89D2\u8272\u7684\u62BD\u8C61\uFF0C\u8FD9\u5C31\u5F15\u51FA\u4E86\u4E24\u8005\u5728\u6570\u636E\u4E0A\u7684\u533A\u522B\u3002</p><h4 id="do-\u4E0E-po-\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#do-\u4E0E-po-\u7684\u533A\u522B" aria-hidden="true">#</a> <strong>DO \u4E0E PO \u7684\u533A\u522B</strong></h4><p>DO \u548C PO \u5728\u7EDD\u5927\u90E8\u5206\u60C5\u51B5\u4E0B\u662F\u4E00\u4E00\u5BF9\u5E94\u7684\uFF0CPO\u662F\u53EA\u542B\u6709 get/set \u65B9\u6CD5\u7684POJO\uFF0C\u4F46\u67D0\u4E9B\u573A\u666F\u8FD8\u662F\u80FD\u53CD\u6620\u51FA\u4E24\u8005\u5728\u6982\u5FF5\u4E0A\u5B58\u5728\u672C\u8D28\u533A\u522B\uFF1A DO\u5728\u67D0\u4E9B\u573A\u666F\u4E0B\u4E0D\u9700\u8981\u8FDB\u884C\u663E\u5F0F\u7684\u6301\u4E45\u5316\uFF0C\u4F8B\u5982\u5229\u7528\u7B56\u7565\u6A21\u5F0F\u8BBE\u8BA1\u7684\u5546\u54C1\u6298\u6263\u7B56\u7565\uFF0C\u4F1A\u884D\u751F\u51FA\u6298\u6263\u7B56\u7565\u7684\u63A5\u53E3\u548C\u4E0D\u540C\u6298\u6263\u7B56\u7565\u5B9E\u73B0\u7C7B\uFF0C\u8FD9\u4E9B\u6298\u6263\u7B56\u7565\u5B9E\u73B0\u7C7B\u53EF\u4EE5\u7B97\u662FDO\uFF0C\u4F46\u5B83\u4EEC\u53EA\u4F1A\u9A7B\u7559\u5728\u9759\u6001\u5185\u5B58\u6C60\uFF0C\u4E0D\u9700\u8981\u6301\u4E45\u5316\u5230\u6301\u4E45\u5C42\uFF0C\u56E0\u6B64\uFF0C\u8FD9\u7C7B DO \u662F\u4E0D\u5B58\u5728\u5BF9\u5E94\u7684 PO\u7684\u3002 \u540C\u6837\u7684\u9053\u7406\uFF0C\u67D0\u4E9B\u573A\u666F\u4E0B\uFF0CPO\u4E5F\u6CA1\u6709\u5BF9\u5E94\u7684DO\uFF0C\u4F8B\u5982\u8001\u5E08Teacher\u548C\u5B66\u751FStudent\u5B58\u5728\u591A\u5BF9\u591A\u7684\u5173\u7CFB\uFF0C\u5728\u5173\u7CFB\u6570\u636E\u5E93\u4E2D\uFF0C\u8FD9\u79CD\u5173\u7CFB\u9700\u8981\u8868\u73B0\u4E3A\u4E00\u4E2A\u4E2D\u95F4\u8868\uFF0C\u4E5F\u5C31\u5BF9\u5E94\u6709\u4E00\u4E2ATeacherAndStudentPO\u7684PO\uFF0C\u4F46\u8FD9\u4E2APO\u5728\u4E1A\u52A1\u9886\u57DF\u6CA1\u6709\u4EFB\u4F55\u73B0\u5B9E\u7684\u610F\u4E49\uFF0C\u5B83\u5B8C\u5168\u4E0D\u80FD\u4E0E\u4EFB\u4F55DO\u5BF9\u5E94\u4E0A\u3002</p><h2 id="_8-2-\u4E09\u7EA7\u5206\u7C7B\u63A5\u53E3\u7F16\u5199" tabindex="-1"><a class="header-anchor" href="#_8-2-\u4E09\u7EA7\u5206\u7C7B\u63A5\u53E3\u7F16\u5199" aria-hidden="true">#</a> 8.2 \u4E09\u7EA7\u5206\u7C7B\u63A5\u53E3\u7F16\u5199</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u8FD4\u56DE\u67E5\u8BE2\u6240\u6709\u5206\u7C7B\u4EE5\u53CA\u5B50\u5B50\u5206\u7C7B\uFF0C\u4EE5\u6811\u5F62\u7ED3\u6784\u7EC4\u88C5\u8D77\u6765    </span>
<span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">listWithTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B9E\u73B0\u7C7B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">listWithTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u67E5\u51FA\u6240\u6709\u5206\u7C7B \u8BBE\u7F6E\u4E3Anull\u67E5\u8BE2\u5168\u90E8</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> entities <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2\u3001\u7EC4\u88C5\u6210\u7236\u5B50\u7684\u6811\u5F62\u7ED3\u6784</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> levelList <span class="token operator">=</span> entities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>categoryEntity <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// parentCid ==0 \u4E3A\u7236\u76EE\u5F55\u9ED8\u8BA40</span>
            <span class="token keyword">return</span> categoryEntity<span class="token punctuation">.</span><span class="token function">getParentCid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>menu <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u8BBE\u7F6E\u4E8C\u4E09\u7EA7\u5206\u7C7B \u9012\u5F52</span>
            menu<span class="token punctuation">.</span><span class="token function">setChildren</span><span class="token punctuation">(</span><span class="token function">getChildrens</span><span class="token punctuation">(</span>menu<span class="token punctuation">,</span>entities<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> menu<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>menu1<span class="token punctuation">,</span> menu2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//  \u6392\u5E8F Sort\u5B57\u6BB5\u6392\u5E8F</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>menu1<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> menu1<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>menu2<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> menu2<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> levelList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/**
     *  \u9012\u5F52\u67E5\u8BE2\u5B50\u5206\u7C7B
     * <span class="token keyword">@param</span> <span class="token parameter">root</span> \u5F53\u524Dcategory\u5BF9\u8C61
     * <span class="token keyword">@param</span> <span class="token parameter">all</span>  \u5168\u90E8\u5206\u7C7B\u6570\u636E
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">getChildrens</span><span class="token punctuation">(</span><span class="token class-name">CategoryEntity</span> root<span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> all<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> all<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>categoryEntity <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u904D\u5386\u6240\u6709\u7684category\u5BF9\u8C61\u7684\u7236\u7C7Bid = \u7B49\u4E8Eroot\u7684\u5206\u7C7Bid \u8BF4\u660E\u662F\u4ED6\u7684\u5B50\u7C7B</span>
            <span class="token keyword">return</span> categoryEntity<span class="token punctuation">.</span><span class="token function">getParentCid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> root<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>menu <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1\u3001\u9012\u5F52\u904D\u5386\u83DC\u5355</span>
            menu<span class="token punctuation">.</span><span class="token function">setChildren</span><span class="token punctuation">(</span><span class="token function">getChildrens</span><span class="token punctuation">(</span>menu<span class="token punctuation">,</span> all<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> menu<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>menu1<span class="token punctuation">,</span> menu2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 2\u3001\u83DC\u5355\u6392\u5E8F</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>menu1<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> menu1<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>menu2<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> menu2<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> collect<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u8DE8\u57DF</p></blockquote><p>\u8DE8\u57DF\uFF1A\u6307\u7684\u662F\u6D4F\u89C8\u5668\u4E0D\u80FD\u6267\u884C\u5176\u4ED6\u7F51\u7AD9\u7684\u811A\u672C\u3002\u5B83\u662F\u7531\u6D4F\u89C8\u5668\u7684\u540C\u6E90\u7B56\u7565\u9020\u6210\u7684\uFF0C\u662F\u6D4F\u89C8\u5668\u5BF9javascript\u65BD\u52A0\u7684\u5B89\u5168\u9650\u5236\u3002</p><p>\u540C\u6E90\u7B56\u7565\uFF1A\u662F\u6307\u534F\u8BAE\uFF0C\u57DF\u540D\uFF0C\u7AEF\u53E3\u90FD\u8981\u76F8\u540C\uFF0C\u5176\u4E2D\u6709\u4E00\u4E2A\u4E0D\u540C\u90FD\u4F1A\u4EA7\u751F\u8DE8\u57DF\uFF1B</p><p>\u4E0B\u56FE\u8BE6\u7EC6\u8BF4\u660E\u4E86 URL \u7684\u6539\u53D8\u5BFC\u81F4\u662F\u5426\u5141\u8BB8\u901A\u4FE1</p><p><img src="http://qnimg.gisfsde.com/work/image-20220512154306048.png" alt="image-20220512154306048" loading="lazy"></p><blockquote><p>\u8DE8\u57DF\u6D41\u7A0B</p></blockquote><p><img src="http://qnimg.gisfsde.com/work/image-20220512154318670.png" alt="image-20220512154318670" loading="lazy"></p><p>\u6D4F\u89C8\u5668\u53D1\u8BF7\u6C42\u90FD\u8981\u5B9E\u73B0\u53D1\u9001\u4E00\u4E2A\u8BF7\u6C42\u8BE2\u95EE\u662F\u5426\u53EF\u4EE5\u8FDB\u884C\u901A\u4FE1 \uFF0C\u6211\u76F4\u63A5\u7ED9\u4F60\u8FD4\u56DE\u53EF\u4EE5\u901A\u4FE1\u4E0D\u5C31\u53EF\u4EE5\u4E86\u5417\uFF1F<img src="http://qnimg.gisfsde.com/work/image-20201017090546193.png" alt="image-20201017090546193" loading="lazy"></p>`,38),Za=s("\u76F8\u5173\u8D44\u6599\u53C2\u8003\uFF1A"),nt={href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS",target:"_blank",rel:"noopener noreferrer"},st=s("https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS"),at=p(`<blockquote><p>\u89E3\u51B3\u8DE8\u8D8A\uFF08 \u4E00 \uFF09 \u4F7F\u7528nginx\u90E8\u7F72\u4E3A\u540C\u4E00\u57DF</p></blockquote><p>\u5F00\u53D1\u8FC7\u4E8E\u9EBB\u70E6\uFF0C\u4E0A\u7EBF\u5728\u4F7F\u7528</p><p><img src="http://qnimg.gisfsde.com/work/image-20220512154332704.png" alt="image-20220512154332704" loading="lazy"></p><blockquote><p>\u89E3\u51B3\u8DE8\u57DF \uFF08 \u4E8C \uFF09\u914D\u7F6E\u5F53\u6B21\u8BF7\u6C42\u5141\u8BB8\u8DE8\u57DF</p></blockquote><p>1\u3001\u6DFB\u52A0\u54CD\u5E94\u5934</p><ul><li><p>Access-Control-Allow-Origin: \u652F\u6301\u54EA\u4E9B\u6765\u6E90\u7684\u8BF7\u6C42\u8DE8\u57DF</p></li><li><p>Access-Control-Allow-Methods: \u652F\u6301\u54EA\u4E9B\u65B9\u6CD5\u8DE8\u57DF</p></li><li><p>Access-Control-Allow-Credentials: \u8DE8\u57DF\u8BF7\u6C42\u9ED8\u8BA4\u4E0D\u5305\u542Bcookie,\u8BBE\u7F6E\u4E3Atrue\u53EF\u4EE5\u5305\u542Bcookie</p></li><li><p>Access-Control-Expose-Headers: \u8DE8\u57DF\u8BF7\u6C42\u66B4\u9732\u7684\u5B57\u6BB5</p><p>\u200B CORS\u8BF7\u6C42\u65F6, XML .HttpRequest\u5BF9\u8C61\u7684getResponseHeader()\u65B9\u6CD5\u53EA\u80FD\u62FF\u52306\u4E2A\u57FA\u672C\u5B57\u6BB5: CacheControl\u3001Content-L anguage\u3001Content Type\u3001Expires\u3001</p><p>Last-Modified\u3001 Pragma\u3002 \u5982\u679C\u60F3\u62FF\u5230\u5176\u4ED6\u5B57\u6BB5\uFF0C\u5C31\u5FC5\u987B\u5728Access-Control-Expose-Headers\u91CC\u9762\u6307\u5B9A\u3002</p></li><li><p>Access-Control-Max- Age: \u8868\u660E\u8BE5\u54CD\u5E94\u7684\u6709\u6548\u65F6\u95F4\u4E3A\u591A\u5C11\u79D2\u3002\u5728\u6709\u6548\u65F6\u95F4\u5185\uFF0C\u6D4F\u89C8\u5668\u65E0\u987B\u4E3A\u540C\u4E00-\u8BF7\u6C42\u518D\u6B21\u53D1\u8D77\u9884\u68C0\u8BF7\u6C42\u3002\u8BF7\u6CE8\u610F\uFF0C\u6D4F\u89C8\u5668\u81EA\u8EAB\u7EF4\u62A4\u4E86\u4E00\u4E2A\u6700\u5927\u6709\u6548\u65F6\u95F4\uFF0C\u5982\u679C\u8BE5\u9996\u90E8\u5B57\u6BB5\u7684\u503C\u8D85\u8FC7\u4E86\u6700\u5927\u6709\u6548\u65F6\u95F4\uFF0C\u5C06\u4E0D\u4F1A\u751F\u6548\u3002</p></li></ul><p>\u7F51\u5173\u914D\u7F6E\u6587\u4EF6</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> product_route
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//gulimall<span class="token punctuation">-</span>product
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/api/product/<span class="token important">**</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> RewritePath=/api/(<span class="token punctuation">?</span>\\&lt;segment<span class="token punctuation">&gt;</span>/<span class="token punctuation">?</span>.<span class="token important">*)</span><span class="token punctuation">,</span>/$\\<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>

        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> admin_route
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//renren<span class="token punctuation">-</span>fast  <span class="token comment"># lb\u8D1F\u8F7D\u5747\u8861</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/api/<span class="token important">**</span>  <span class="token comment"># path\u6307\u5B9A\u5BF9\u5E94\u8DEF\u5F84</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span> <span class="token comment"># \u91CD\u5199\u8DEF\u5F84</span>
            <span class="token punctuation">-</span> RewritePath=/api/(<span class="token punctuation">?</span>\\&lt;segment<span class="token punctuation">&gt;</span>/<span class="token punctuation">?</span>.<span class="token important">*)</span><span class="token punctuation">,</span> /renren<span class="token punctuation">-</span>fast/$\\<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8DE8\u8D8A\u8BBE\u7F6E</p><p>\u8BF7\u6C42\u5148\u53D1\u9001\u5230\u7F51\u5173\uFF0C\u7F51\u5173\u5728\u8F6C\u53D1\u7ED9\u5176\u4ED6\u670D\u52A1 \u4E8B\u5148\u90FD\u8981\u6CE8\u518C\u5230<strong>\u6CE8\u518C\u4E2D\u5FC3</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallCorsConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CorsWebFilter</span> <span class="token function">corsWebFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UrlBasedCorsConfigurationSource</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlBasedCorsConfigurationSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CorsConfiguration</span> corsConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorsConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u914D\u7F6E\u8DE8\u8D8A</span>
        corsConfiguration<span class="token punctuation">.</span><span class="token function">addAllowedHeader</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5141\u8BB8\u90A3\u4E9B\u5934</span>
        corsConfiguration<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5141\u8BB8\u90A3\u4E9B\u8BF7\u6C42\u65B9\u5F0F</span>
        corsConfiguration<span class="token punctuation">.</span><span class="token function">addAllowedOrigin</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  \u5141\u8BB8\u8BF7\u6C42\u6765\u6E90</span>
        corsConfiguration<span class="token punctuation">.</span><span class="token function">setAllowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u662F\u5426\u5141\u8BB8\u643A\u5E26cookie\u8DE8\u8D8A</span>
        <span class="token comment">// \u6CE8\u518C\u8DE8\u8D8A\u914D\u7F6E</span>
        source<span class="token punctuation">.</span><span class="token function">registerCorsConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">,</span>corsConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CorsWebFilter</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53BB\u6389renren-fast\u9ED8\u8BA4\u8DE8\u57DF\u8BBE\u7F6E</p><h3 id="_8-2-1-\u6811\u5F62\u5C55\u793A\u4E09\u7EA7\u5206\u7C7B\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_8-2-1-\u6811\u5F62\u5C55\u793A\u4E09\u7EA7\u5206\u7C7B\u6570\u636E" aria-hidden="true">#</a> 8.2.1 \u6811\u5F62\u5C55\u793A\u4E09\u7EA7\u5206\u7C7B\u6570\u636E</h3><blockquote><p>1\u3001\u7528\u5230\u7684\u524D\u7AEF\u7EC4\u4EF6 Tree \u6811\u5F62\u63A7\u4EF6</p></blockquote><p><img src="http://qnimg.gisfsde.com/work/image-20220512154347353.png" alt="image-20220512154347353" loading="lazy"></p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tree</span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:props</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultProps<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@node-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleNodeClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tree</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--
data	
\u5C55\u793A\u6570\u636E
props \u914D\u7F6E\u9009\u9879
children \u6307\u5B9A\u5B50\u6811\u4E3A\u8282\u70B9\u5BF9\u8C61\u7684\u67D0\u4E2A\u5C5E\u6027\u503C
label \u6307\u5B9A\u8282\u70B9\u6807\u7B7E\u4E3A\u8282\u70B9\u5BF9\u8C61\u7684\u67D0\u4E2A\u5C5E\u6027\u503C
disabled \u8282\u70B9\u9009\u62E9\u6846\u662F\u5426\u7981\u7528\u4E3A\u8282\u70B9\u5BF9\u8C61\u7684\u67D0\u4E2A\u5C5E\u6027\u503C
@node-click \u8282\u70B9\u88AB\u70B9\u51FB\u65F6\u7684\u56DE\u8C03
--&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u914D\u7F6E\u9759\u6001\u6570\u636E\u5C31\u80FD\u663E\u793A\u51FA\u5BF9\u5E94\u7684\u6548\u679C</p><blockquote><p>2\u3001\u7F16\u5199\u65B9\u6CD5\u83B7\u53D6\u5168\u90E8\u83DC\u5355\u6570\u636E</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">getMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token comment">// \u8BF7\u6C42\u63A5\u53E3\u89C1\u4E0A\u9762</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/product/category/list/tree&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;get&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FD4\u56DE\u7684\u83DC\u5355\u6570\u636E&quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>menus <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>3\u3001\u6700\u7EC8\u5C55\u793A\u7ED3\u679C ( append ,edit \u4F1A\u5728\u540E\u9762\u4ECB\u7ECD)</p></blockquote><p><img src="http://qnimg.gisfsde.com/work/image-20220512154358877.png" alt="image-20220512154358877" loading="lazy"></p><h3 id="_8-2-2-\u903B\u8F91\u5220\u9664-\u5220\u9664\u6548\u679C\u7EC6\u5316" tabindex="-1"><a class="header-anchor" href="#_8-2-2-\u903B\u8F91\u5220\u9664-\u5220\u9664\u6548\u679C\u7EC6\u5316" aria-hidden="true">#</a> 8.2.2 \u903B\u8F91\u5220\u9664&amp;\u5220\u9664\u6548\u679C\u7EC6\u5316</h3><p>\u6548\u679C\u56FE</p><p><img src="http://qnimg.gisfsde.com/work/image-20220512154414329.png" alt="image-20220512154414329" loading="lazy"></p><blockquote><p>1\u3001\u8282\u70B9\u7684\u5185\u5BB9\u652F\u6301\u81EA\u5B9A\u4E49\uFF0C\u53EF\u4EE5\u5728\u8282\u70B9\u533A\u6DFB\u52A0\u6309\u94AE\u6216\u56FE\u6807\u7B49\u5185\u5BB9</p></blockquote><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code> \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
            <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>node.childNodes.length == 0<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>() =&gt; remove(node, data)<span class="token punctuation">&quot;</span></span>
          <span class="token punctuation">&gt;</span></span> Delete\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
 <span class="token comment">&lt;!-- 
	v-if=&quot;node.childNodes.length == 0&quot;  \u6CA1\u6709\u5B50\u8282\u70B9\u53EF\u4EE5\u5220\u9664
	type \u5BF9\u5E94\u7C7B\u578B
	size \u5927\u5C0F
	@click \u70B9\u51FB\u540E\u51FA\u53D1\u7684\u65B9\u6CD5 \u6B64\u5904\u4F7F\u7528\u4E86 \u7BAD\u5934\u51FD\u6570
--&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>2\u3001\u524D\u7AEFremove\u65B9\u6CD5\u8FDB\u884C\u5220\u9664</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$confirm</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\u662F\u5426\u5220\u9664\u3010</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>data<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\u3011\u83DC\u5355 ? </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token string">&quot;\u63D0\u793A&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">confirmButtonText</span><span class="token operator">:</span> <span class="token string">&quot;\u786E\u5B9A&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cancelButtonText</span><span class="token operator">:</span> <span class="token string">&quot;\u53D6\u6D88&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u62FF\u5230\u5F53\u524D\u8282\u70B9\u7684catId</span>
          <span class="token keyword">var</span> ids <span class="token operator">=</span> <span class="token punctuation">[</span>data<span class="token punctuation">.</span>catId<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/product/category/delete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornData</span><span class="token punctuation">(</span>ids<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;\u83DC\u5355\u5220\u9664\u6210\u529F&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u5237\u65B0\u83DC\u5355</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8BBE\u7F6E\u9ED8\u8BA4\u9700\u8981\u5C55\u5F00\u7684\u83DC\u5355</span>
            <span class="token doc-comment comment">/**
            default-expanded-keys  \u9ED8\u8BA4\u5C55\u5F00\u8282\u70B9\u7684 key \u6570\u7EC4 
            */</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>expandedKey <span class="token operator">=</span> <span class="token punctuation">[</span>node<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>catId<span class="token punctuation">]</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>catId<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;remove&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>3\u3001\u540E\u7AEF\u63A5\u53E3 -- \u903B\u8F91\u5220\u9664\u914D\u7F6E</p></blockquote>`,29),tt=s("3.1 \u7B2C\u4E00\u79CD\u65B9\u5F0F mybatisplus \u903B\u8F91\u5220\u9664\u53C2\u8003\u5B98\u7F51\uFF1A"),pt={href:"https://baomidou.com/guide/logic-delete.html",target:"_blank",rel:"noopener noreferrer"},et=s("https://baomidou.com/guide/logic-delete.html"),ot=p(`<p>\u5728appliction.yml \u4E2D\u914D\u7F6E myabtisplus \u903B\u8F91\u5220\u9664</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token important">*:/mapper/**/*.xml</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto <span class="token comment"># \u6570\u636E\u5E93\u4E3B\u952E\u81EA\u589E</span>
      <span class="token key atrule">logic-delete-value</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># \u903B\u8F91\u5DF2\u5220\u9664\u503C(\u9ED8\u8BA4\u4E3A 1)</span>
      <span class="token key atrule">logic-not-delete-value</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment"># \u903B\u8F91\u672A\u5220\u9664\u503C(\u9ED8\u8BA4\u4E3A 0)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.2 \u7B2C\u4E8C\u79CD\u65B9\u5F0F \u5728 Entity\u4E2D \u4F7F\u7528\u6CE8\u89E3</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
	\u662F\u5426\u4E3A\u6570\u636E\u5E93\u8868\u5B57\u6BB5
	\u9ED8\u8BA4 true \u5B58\u5728\uFF0Cfalse \u4E0D\u5B58\u5728
	\u6807\u8BB0\u4E3Afalse \u8BF4\u660E \u8BE5\u5B57\u6BB5\u4E0D\u5728\u6570\u636E\u5E93 
**/</span>
<span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> children<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>4\u3001Controller \u5B9E\u73B0 \u4F7F\u7528\u4E86\u4EE3\u7801\u751F\u6210\u5668</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * \u5220\u9664
     * @RequestBody:\u83B7\u53D6\u8BF7\u6C42\u4F53\uFF0C\u5FC5\u987B\u53D1\u9001post\u8BF7\u6C42\u624D\u6709 get\u8BF7\u6C42\u6CA1\u6709
     * SpringMvc \u81EA\u52A8\u5C06\u8BF7\u6C42\u4F53\u7684\u6570\u636E ( json ) \u8F6C\u4E3A\u5BF9\u5E94\u7684\u5BF9\u8C61
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/delete&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> catIds<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u68C0\u67E5\u5F53\u524D\u5220\u9664\u7684\u83DC\u5355\uFF0C\u662F\u5426\u88AB\u522B\u7684\u5730\u65B9\u5E94\u7528</span>
        categoryService<span class="token punctuation">.</span><span class="token function">removeMenuByIds</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//Service \u5B9E\u73B0</span>
   <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeMenuByIds</span><span class="token punctuation">(</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> asList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u903B\u8F91\u5220\u9664</span>
        baseMapper<span class="token punctuation">.</span><span class="token function">deleteBatchIds</span><span class="token punctuation">(</span>asList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-3-\u65B0\u589E\u6548\u679C-\u57FA\u672C\u4FEE\u6539" tabindex="-1"><a class="header-anchor" href="#_8-2-3-\u65B0\u589E\u6548\u679C-\u57FA\u672C\u4FEE\u6539" aria-hidden="true">#</a> 8.2.3 \u65B0\u589E\u6548\u679C&amp;\u57FA\u672C\u4FEE\u6539</h3><p><img src="http://qnimg.gisfsde.com/work/image-20220512154444827.png" alt="image-20220512154444827" loading="lazy"></p><blockquote><p>1\u3001\u524D\u7AEF\u7EC4\u4EF6 button \u7EC4\u4EF6 Dialog \u5BF9\u8BDD\u6846</p></blockquote><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>  <span class="token comment">&lt;!-- \u5C42\u7EA7\u5C0F\u4E8E2 \u624D\u80FD\u65B0\u589E --&gt;</span>
          \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
            <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>node.level \\&lt;= 2<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>() =&gt; append(data)<span class="token punctuation">&quot;</span></span>
            <span class="token punctuation">&gt;</span></span>Append
          \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
 \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>() =&gt; edit(data)<span class="token punctuation">&quot;</span></span>
            <span class="token punctuation">&gt;</span></span>edit
          \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- \u4E0A\u9762\u7EC4\u4EF6\u5728tree\u4E2D--&gt;</span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span>
      <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialogVisible<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>30%<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:before-close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleClose<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:close-on-click-modal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>category<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\u5206\u7C7B\u540D\u79F0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>category.name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>off<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\u56FE\u6807<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>category.icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>off<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\u8BA1\u91CF\u5355\u4F4D<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span>
            <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>category.productUnit<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>off<span class="token punctuation">&quot;</span></span>
          <span class="token punctuation">&gt;</span></span>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">&gt;</span></span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>footer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialog-footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialogVisible = false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u53D6 \u6D88\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submitData<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u786E \u5B9A\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>2\u3001\u65B0\u589E&amp;\u4FEE\u6539</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token function">append</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;append&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dialogType <span class="token operator">=</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;\u6DFB\u52A0\u5206\u7C7B&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>parentCid <span class="token operator">=</span> data<span class="token punctuation">.</span>catId<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>catLevel <span class="token operator">=</span> data<span class="token punctuation">.</span>catLevel <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>catId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>icon <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>productUnit <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// \u8981\u4FEE\u6539\u7684\u6570\u636E</span>
    <span class="token function">edit</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u8981\u4FEE\u6539\u7684\u6570\u636E&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dialogType <span class="token operator">=</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;\u4FEE\u6539\u5206\u7C7B&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

      <span class="token comment">// \u53D1\u9001\u8BF7\u6C42\u83B7\u53D6\u6700\u65B0\u7684\u6570\u636E</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornUrl</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/product/category/info/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>data<span class="token punctuation">.</span>catId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;get&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8BF7\u6C42\u6210\u529F</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u8981\u56DE\u663E\u7684\u6570\u636E&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>name <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>catId <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>catId<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>icon <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>icon<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>productUnit <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>productUnit<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>parentCid <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>parentCid<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>



<span class="token function">submitData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dialogType <span class="token operator">==</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8FDB\u884C\u65B0\u589E</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dialogType <span class="token operator">==</span> <span class="token string">&quot;edit&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8FDB\u884C\u4FEE\u6539</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">editCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// \u6DFB\u52A0\u4E09\u7EA7\u5206\u7C7B</span>
    <span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6DFB\u52A0\u4E09\u7EA7\u5206\u7C7B\u7684\u6570\u636E&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/product/category/save&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;\u83DC\u5355\u4FDD\u5B58\u6210\u529F&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5173\u95ED\u5BF9\u8BDD\u6846</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">// \u91CD\u65B0\u5237\u65B0\u6570\u636E</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u9ED8\u8BA4\u5C55\u5F00\u7684\u83DC\u5355</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>expandedKey <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>parentCid<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// \u4FEE\u6539\u4E09\u7EA7\u5206\u7C7B\u6570\u636E</span>
    <span class="token function">editCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u89E3\u6784\u51FA\u5355\u72EC\u7684\u51E0\u4E2A\u5BF9\u8C61 \u7528\u6765\u63D0\u4EA4</span>
      <span class="token keyword">var</span> <span class="token punctuation">{</span> catId<span class="token punctuation">,</span> name<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> productUnit <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/product/category/update&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> catId<span class="token punctuation">,</span> name<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> productUnit <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;\u83DC\u5355\u4FEE\u6539\u6210\u529F&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5173\u95ED\u5BF9\u8BDD\u6846</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">// \u91CD\u65B0\u5237\u65B0\u6570\u636E</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u9ED8\u8BA4\u5C55\u5F00\u7684\u83DC\u5355</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>expandedKey <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">.</span>parentCid<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>3\u3001\u8981\u8003\u8651\u5230\u7684\u70B9 \u4EE5\u53CA\u7EC6\u8282</p></blockquote>`,13),ct=s("\u6DFB\u52A0\u5B8C\u6210\u540E\u8981\u628A\u8868\u5355\u7684\u6570\u636E\u8FDB\u884C\u6E05\u9664\uFF0C\u5426\u5219\u7B2C\u4E8C\u6B21\u6253\u5F00\u4EFB\u7136\u4F1A\u6709\u4E0A\u6B21\u8868\u5355\u63D0\u4EA4\u5269\u4E0B\u7684\u6570\u636E "),it={href:"http://this.category.name",target:"_blank",rel:"noopener noreferrer"},lt=s("this.category.name"),ut=s(' = "";'),rt=n("li",null,'\u4FEE\u6539\u548C\u65B0\u589E\u7528\u7684\u662F\u540C\u4E00\u4E2A\u8868\u5355\uFF0C\u56E0\u6B64\u5728\u65B9\u6CD5\u5BF9\u8BDD\u6846\u4E2D \u52A8\u6001\u7684\u7ED1\u5B9A\u4E86 :title="title" \u6807\u9898 \u7528\u4E8E\u663E\u793A\u662F\u65B0\u589E\u8FD8\u662F\u4FEE\u6539',-1),kt=n("li",null,'\u4E00\u4E2A\u8868\u5355\u90FD\u662F\u4E00\u4E2A\u63D0\u4EA4\u65B9\u6CD5 \u56E0\u6B64\u5728\u63D0\u4EA4\u65B9\u6CD5\u7684\u65F6\u5019\u8FDB\u884C\u4E86\u5224\u65AD\uFF0C\u6839\u636E\u53D8\u91CF\u8D4B\u503C\u51B3\u5B9A\u8C03\u7528\u90A3\u4E2A\u65B9\u6CD5 this.dialogType = "add"; this.dialogType = "edit";',-1),dt=p(`<h3 id="_8-2-4-\u62D6\u62FD\u529F\u80FD-\u6570\u636E\u6536\u96C6-\u6279\u91CF\u5220\u9664" tabindex="-1"><a class="header-anchor" href="#_8-2-4-\u62D6\u62FD\u529F\u80FD-\u6570\u636E\u6536\u96C6-\u6279\u91CF\u5220\u9664" aria-hidden="true">#</a> 8.2.4 \u62D6\u62FD\u529F\u80FD&amp;\u6570\u636E\u6536\u96C6&amp;\u6279\u91CF\u5220\u9664</h3><p>\u6548\u679C\u6F14\u793A</p><p><img src="http://qnimg.gisfsde.com/work/image-20220512154501803.png" alt="image-20220512154501803" loading="lazy"></p><blockquote><p>1\u3001\u524D\u7AEF\u7528\u7684\u7EC4\u4EF6 Tree \u6811\u5F62\u63A7\u4EF6 \u53EF\u62D6\u62FD\u8282\u70B9</p></blockquote><p>\u901A\u8FC7 draggable \u5C5E\u6027\u53EF\u8BA9\u8282\u70B9\u53D8\u4E3A\u53EF\u62D6\u62FD\u3002</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code> \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tree</span>
      <span class="token attr-name">:expand-on-click-node</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> 
      <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>menus<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:props</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultProps<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">show-checkbox</span>
      <span class="token attr-name">node-key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>catId<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:default-expanded-keys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>expandedKey<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:draggable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>draggable<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:allow-drop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>allowDrop<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@node-drop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleDrop<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>menuTree<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 
:expand-on-click-node \u662F\u5426\u5728\u70B9\u51FB\u8282\u70B9\u7684\u65F6\u5019\u5C55\u5F00\u6216\u8005\u6536\u7F29\u8282\u70B9 \u9ED8\u8BA4 true \u5219\u53EA\u6709\u70B9\u7BAD\u5934\u56FE\u6807\u7684\u65F6\u5019\u624D\u4F1A\u5C55\u5F00\u6216\u8005\u6536\u7F29\u8282\u70B9\u3002
show-checkbox	\u8282\u70B9\u662F\u5426\u53EF\u88AB\u9009\u62E9
node-key \u6BCF\u4E2A\u6811\u8282\u70B9\u7528\u6765\u505A\u552F\u4E00\u6807\u8BC6\u7684\u5C5E\u6027 
default-expanded-keys  \u9ED8\u8BA4\u5C55\u5F00\u8282\u70B9\u7684\u8282\u70B9
draggable \u8868\u793A\u662F\u5426\u53EF\u4EE5\u88AB\u62D6\u62FD true&amp;false
allow-drop \u62D6\u62FD\u65F6\u5224\u5B9A\u76EE\u6807\u8282\u70B9\u80FD\u5426\u88AB\u653E\u7F6E
node-drop \u62D6\u62FD\u6210\u529F\u5B8C\u6210\u51FA\u53D1\u7684\u4E8B\u4EF6
ref \u8BE5\u7EC4\u4EF6tree\u7684\u5F15\u7528
\u8BE6\u7EC6\u89E3\u91CA\u53C2\u8003\u5B98\u7F51 https://element.eleme.cn/#/zh-CN/component/tree
--&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>2\u3001\u4E3B\u8981\u4E1A\u52A1\u903B\u8F91 TODO\uFF1A\u6682\u65F6\u4E0D\u61C2 \u56DE\u5934\u518D\u6765\u770B</p></blockquote><p><strong>allowDrop</strong>\uFF1A</p><p>\u62D6\u62FD\u65F6\u5224\u5B9A\u76EE\u6807\u8282\u70B9\u80FD\u5426\u88AB\u653E\u7F6E\u3002<code>type</code> \u53C2\u6570\u6709\u4E09\u79CD\u60C5\u51B5\uFF1A&#39;prev&#39;\u3001&#39;inner&#39; \u548C &#39;next&#39;\uFF0C\u5206\u522B\u8868\u793A\u653E\u7F6E\u5728\u76EE\u6807\u8282\u70B9\u524D\u3001\u63D2\u5165\u81F3\u76EE\u6807\u8282\u70B9\u548C\u653E\u7F6E\u5728\u76EE\u6807\u8282\u70B9\u540E</p><p><strong>@node-drop</strong></p><p>\u62FD\u6210\u529F\u5B8C\u6210\u65F6\u89E6\u53D1\u7684\u4E8B\u4EF6</p><p>\u5171\u56DB\u4E2A\u53C2\u6570\uFF0C\u4F9D\u6B21\u4E3A\uFF1A\u88AB\u62D6\u62FD\u8282\u70B9\u5BF9\u5E94\u7684 Node\u3001\u7ED3\u675F\u62D6\u62FD\u65F6\u6700\u540E\u8FDB\u5165\u7684\u8282\u70B9\u3001\u88AB\u62D6\u62FD\u8282\u70B9\u7684\u653E\u7F6E\u4F4D\u7F6E\uFF08before\u3001after\u3001inner\uFF09\u3001event</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token function">allowDrop</span><span class="token punctuation">(</span><span class="token parameter">draggingNode<span class="token punctuation">,</span> dropNode<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 1\u3001\u88AB\u62D6\u52A8\u7684\u5F53\u524D\u8282\u70B9\u4EE5\u53CA\u6240\u5728\u7684\u7236\u8282\u70B9\u603B\u5C42\u6B21\u4E0D\u80FD\u5927\u4E8E3</span>

      <span class="token comment">// 1) \u88AB\u62D6\u52A8\u8282\u70B9\u7684\u603B\u5C42\u6570</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;allowDrop&quot;</span><span class="token punctuation">,</span> draggingNode<span class="token punctuation">,</span> dropNode<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">countNodeLevel</span><span class="token punctuation">(</span>draggingNode<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u5F53\u524D\u6B63\u5728\u62D6\u52A8\u7684\u8282\u70B9 + \u7236\u8282\u70B9\u6240\u5728\u7684\u6DF1\u5EA6\u4E0D\u5927\u4E8E3\u5373\u53EF</span>
      <span class="token keyword">let</span> deep <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maxLevel <span class="token operator">-</span> draggingNode<span class="token punctuation">.</span>level<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6DF1\u5EA6&quot;</span><span class="token punctuation">,</span> deep<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">&quot;inner&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> deep <span class="token operator">+</span> dropNode<span class="token punctuation">.</span>level \\<span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> deep <span class="token operator">+</span> dropNode<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>level \\<span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">countNodeLevel</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u627E\u5230\u6240\u6709\u5B50\u8282\u70B9\uFF0C\u6C42\u51FA\u6700\u5927\u6DF1\u5EA6</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>children <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i \\<span class="token operator">&lt;</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>catLevel <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>maxLevel <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>catLevel<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// \u9012\u5F52\u67E5\u627E</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">countNodeLevel</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">handleDrop</span><span class="token punctuation">(</span><span class="token parameter">draggingNode<span class="token punctuation">,</span> dropNode<span class="token punctuation">,</span> dropType<span class="token punctuation">,</span> ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;handleDrop: &quot;</span><span class="token punctuation">,</span> draggingNode<span class="token punctuation">,</span> dropNode<span class="token punctuation">,</span> dropType<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 1\u3001\u5F53\u524D\u8282\u70B9\u6700\u65B0\u7684\u7236\u8282\u70B9</span>
      <span class="token keyword">let</span> pCid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> siblings <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dropType <span class="token operator">==</span> <span class="token string">&quot;before&quot;</span> <span class="token operator">||</span> dropType <span class="token operator">==</span> <span class="token string">&quot;after&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pCid <span class="token operator">=</span>
          dropNode<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>catId <span class="token operator">==</span> <span class="token keyword">undefined</span>
            <span class="token operator">?</span> <span class="token number">0</span>
            <span class="token operator">:</span> dropNode<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>catId<span class="token punctuation">;</span>
        siblings <span class="token operator">=</span> dropNode<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>childNodes<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        pCid <span class="token operator">=</span> dropNode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>catId<span class="token punctuation">;</span>
        siblings <span class="token operator">=</span> dropNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// this.PCid = pCid</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pCid<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pCid<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 2\u3001\u5F53\u524D\u62D6\u62FD\u8282\u70B9\u7684\u6700\u65B0\u987A\u5E8F</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i \\<span class="token operator">&lt;</span> siblings<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>siblings<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>catId <span class="token operator">==</span> draggingNode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>catId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u5982\u679C\u904D\u5386\u7684\u662F\u5F53\u524D\u6B63\u5728\u62D6\u62FD\u7684\u8282\u70B9</span>
          <span class="token keyword">let</span> catLevel <span class="token operator">=</span> draggingNode<span class="token punctuation">.</span>level<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>siblings<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>level <span class="token operator">!=</span> draggingNode<span class="token punctuation">.</span>level<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5F53\u524D\u7ED3\u70B9\u7684\u5C42\u7EA7\u53D1\u751F\u53D8\u5316</span>
            catLevel <span class="token operator">=</span> siblings<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>level<span class="token punctuation">;</span>
            <span class="token comment">// \u4FEE\u6539\u5B83\u5B50\u8282\u70B9\u7684\u5C42\u7EA7</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateChildNodeLevel</span><span class="token punctuation">(</span>siblings<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// \u5982\u679C\u904D\u5386\u5F53\u524D\u6B63\u5728\u62D6\u62FD\u7684\u8282\u70B9</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>updateNodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">catId</span><span class="token operator">:</span> siblings<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>catId<span class="token punctuation">,</span>
            <span class="token literal-property property">sort</span><span class="token operator">:</span> i<span class="token punctuation">,</span>
            <span class="token literal-property property">parentCid</span><span class="token operator">:</span> pCid
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>updateNodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">catId</span><span class="token operator">:</span> siblings<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>catId<span class="token punctuation">,</span> <span class="token literal-property property">sort</span><span class="token operator">:</span> i <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 3\u3001\u5F53\u524D\u62D6\u62FD\u8282\u70B9\u7684\u6700\u65B0\u5C42\u7EA7</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;updateNodes&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updateNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">updateChildNodeLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i \\<span class="token operator">&lt;</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> cNode <span class="token operator">=</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>updateNodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">catId</span><span class="token operator">:</span> cNode<span class="token punctuation">.</span>catId<span class="token punctuation">,</span>
            <span class="token literal-property property">catLevel</span><span class="token operator">:</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>level
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateChildNodeLevel</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>3\u3001\u6279\u91CF\u5220\u9664</p></blockquote><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code> \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>danger<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>batchDelete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u6279\u91CF\u5220\u9664\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>batchDelete\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token function">batchDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> catIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// \u8FD4\u56DE\u76EE\u524D\u88AB\u9009\u4E2D\u7684\u8282\u70B9\u6240\u7EC4\u6210\u7684\u6570\u7EC4</span>
      <span class="token keyword">let</span> checkedNodes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>menuTree<span class="token punctuation">.</span><span class="token function">getCheckedNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u88AB\u9009\u4E2D\u7684\u5143\u7D20&quot;</span><span class="token punctuation">,</span> checkedNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i \\<span class="token operator">&lt;</span> checkedNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u904D\u5386\u8282\u70B9\u6570\u7EC4 \u62FF\u5230\u9700\u8981\u7684\u503C</span>
        catIds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>checkedNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>catId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        names<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>checkedNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$confirm</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\u662F\u5426\u6279\u91CF\u5220\u9664\u3010</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>names<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\u3011\u83DC\u5355 ? </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token string">&quot;\u63D0\u793A&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">confirmButtonText</span><span class="token operator">:</span> <span class="token string">&quot;\u786E\u5B9A&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cancelButtonText</span><span class="token operator">:</span> <span class="token string">&quot;\u53D6\u6D88&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/product/category/delete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornData</span><span class="token punctuation">(</span>catIds<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;\u5220\u9664\u6210\u529F&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5237\u65B0\u83DC\u5355</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u540E\u7AEF\u63A5\u53E3\u4E5F\u662F\u903B\u8F91\u6279\u91CF\u5220\u9664</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">removeMenuByIds</span><span class="token punctuation">(</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> asList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u63A5\u6536\u7684\u662F\u4E00\u4E2Aid\u6570\u7EC4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u603B\u7ED3\uFF1A</strong></p><p>\u524D\u7AEF\u7528\u5230\u7684\u7EC4\u4EF6</p><p>Dialog \u5BF9\u8BDD\u6846\u3001\u53EF\u62D6\u62FD\u8282\u70B9\u3001Switch \u5F00\u5173\u3001Button \u6309\u94AE\u3001Tree\u7EC4\u4EF6\uFF08\u5C5E\u6027\u8F83\u591A\uFF09</p><p>\u7EC6\u8282\u70B9\uFF1A</p><p>\u6CA1\u5F00\u542F\u62D6\u62FD</p><p>\u5F00\u542F\u62D6\u62FD\uFF1A</p><p>\u901A\u8FC7 draggable \u5C5E\u6027\u53EF\u8BA9\u8282\u70B9\u53D8\u4E3A\u53EF\u62D6\u62FD\u3002</p><p><img src="http://qnimg.gisfsde.com/work/image-20220512154539368.png" alt="image-20220512154539368" loading="lazy"></p><h1 id="\u4E03\u3001\u5546\u54C1\u670D\u52A1-\u54C1\u724C\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#\u4E03\u3001\u5546\u54C1\u670D\u52A1-\u54C1\u724C\u7BA1\u7406" aria-hidden="true">#</a> \u4E03\u3001\u5546\u54C1\u670D\u52A1&amp;\u54C1\u724C\u7BA1\u7406</h1><h2 id="_9-1\u3001\u6548\u679C\u663E\u793A\u4F18\u5316\u4E0E\u5FEB\u901F\u663E\u793A\u5F00\u5173" tabindex="-1"><a class="header-anchor" href="#_9-1\u3001\u6548\u679C\u663E\u793A\u4F18\u5316\u4E0E\u5FEB\u901F\u663E\u793A\u5F00\u5173" aria-hidden="true">#</a> 9.1\u3001\u6548\u679C\u663E\u793A\u4F18\u5316\u4E0E\u5FEB\u901F\u663E\u793A\u5F00\u5173</h2><p>vue\u4EE3\u7801</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code> \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-switch</span>
            <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scope.row.showStatus<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">active-color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#13ce66<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">inactive-color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#ff4949<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">:active-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">:inactive-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>updateBrandStatus(scope.row)<span class="token punctuation">&quot;</span></span>
          <span class="token punctuation">&gt;</span></span>
     <span class="token comment">&lt;!-- 
scope.row \u62FF\u5230\u6574\u884C\u7684\u6570\u636E
active-color	switch \u6253\u5F00\u65F6\u7684\u80CC\u666F\u8272
inactive-color	switch \u5173\u95ED\u65F6\u7684\u80CC\u666F\u8272
active-value	switch \u6253\u5F00\u65F6\u7684\u503C
inactive-value	switch \u5173\u95ED\u65F6\u7684\u503C
--&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,31),mt=s("\u7EC4\u4EF6\u5730\u5740\uFF1A"),vt={href:"https://element.eleme.cn/#/zh-CN/component/switch",target:"_blank",rel:"noopener noreferrer"},gt=s("https://element.eleme.cn/#/zh-CN/component/switch"),bt=p(`<p>\u7528\u6237\u70B9\u51FB switch \u5F00\u5173\u5C31\u4F1A\u8C03\u7528\u540E\u53F0\u7684\u63A5\u53E3\u66F4\u6539\u5BF9\u5E94\u6570\u636E\u5E93\u7684\u5B57\u6BB5 ( \u51B3\u5B9A\u662F\u5426\u663E\u793A)\uFF0C\u5B9A\u4E49\u4E86 @change \u4E8B\u4EF6 \u53EA\u8981\u4FEE\u540E\u5C31\u4F1A\u89E6\u53D1\u5BF9\u5E94\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token function">updateBrandStatus</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6574\u884C\u6570\u636E&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// \u5355\u72EC\u5C31\u5C01\u88C5\u4E24\u4E2A\u5B57\u6BB5</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span>brandId<span class="token punctuation">,</span>showStatus<span class="token punctuation">}</span> <span class="token operator">=</span> data
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornUrl</span><span class="token punctuation">(</span><span class="token string">&#39;/product/brand/update&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>brandId<span class="token punctuation">,</span>showStatus<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">&quot;\u72B6\u6001\u66F4\u65B0\u6210\u529F&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-2\u3001\u8868\u5355\u6548\u9A8C-\u81EA\u5B9A\u4E49\u6548\u9A8C\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_9-2\u3001\u8868\u5355\u6548\u9A8C-\u81EA\u5B9A\u4E49\u6548\u9A8C\u89C4\u5219" aria-hidden="true">#</a> 9.2\u3001\u8868\u5355\u6548\u9A8C&amp;\u81EA\u5B9A\u4E49\u6548\u9A8C\u89C4\u5219</h2><p>Form \u7EC4\u4EF6\u63D0\u4F9B\u4E86\u8868\u5355\u9A8C\u8BC1\u7684\u529F\u80FD\uFF0C\u53EA\u9700\u8981\u901A\u8FC7 <code>rules</code> \u5C5E\u6027\u4F20\u5165\u7EA6\u5B9A\u7684\u9A8C\u8BC1\u89C4\u5219\uFF0C\u5E76\u5C06 Form-Item \u7684 <code>prop</code> \u5C5E\u6027\u8BBE\u7F6E\u4E3A\u9700\u6821\u9A8C\u7684\u5B57\u6BB5\u540D\u5373\u53EF</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span>
      <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataForm<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:rules</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataRule<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataForm<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@keyup.enter.native</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataFormSubmit()<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>140px<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>data\u4E2D</p><p>\u81EA\u5B9A\u4E49\u7684\u89C4\u5219 \uFF0C\u7528\u6765\u5BF9\u6570\u636E\u8FDB\u884C\u5224\u65AD</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">dataRule</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;\u54C1\u724C\u540D\u4E0D\u80FD\u4E3A\u7A7A&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">&quot;blur&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// \u81EA\u5B9A\u4E49\u7684\u89C4\u5219  </span>
        <span class="token literal-property property">firstLetter</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;\u9996\u5B57\u6BCD\u5FC5\u987B\u586B\u5199&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z]$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;\u9996\u5B57\u6BCD\u5FC5\u987Ba-z\u6216\u8005A-Z\u4E4B\u95F4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token literal-property property">trigger</span><span class="token operator">:</span><span class="token string">&#39;blur&#39;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sort</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;\u6392\u5E8F\u5B57\u6BB5\u5FC5\u987B\u586B\u5199&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> value \\<span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;\u6392\u5E8F\u5FC5\u987B\u662F\u4E00\u4E2A\u5927\u4E8E\u7B49\u4E8E0\u7684\u6574\u6570&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">&quot;blur&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-3\u3001jsr303-\u6570\u636E\u6548\u9A8C-\u7EDF\u4E00\u5F02\u5E38\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_9-3\u3001jsr303-\u6570\u636E\u6548\u9A8C-\u7EDF\u4E00\u5F02\u5E38\u5904\u7406" aria-hidden="true">#</a> 9.3\u3001JSR303 \u6570\u636E\u6548\u9A8C &amp; \u7EDF\u4E00\u5F02\u5E38\u5904\u7406</h2><p>\u524D\u7AEF\u6570\u636E\u6548\u9A8C\u6210\u529F\u4E86\uFF0C\u5C31\u4F1A\u628Ajson\u6570\u636E\u4F20\u9012\u5230\u540E\u7AEF\uFF0C\u4F46\u662F\u6709\u4EBA\u5229\u7528\u63A5\u53E3 \u6BD4\u5982 postman \u4E71\u53D1\u9001\u8BF7\u6C42 \u90A3\u4F1A\u600E\u4E48\u529E\uFF0C\u4E8E\u662F\u540E\u7AEF\u4E5F\u4F1A\u5229\u7528 JSR303\u8FDB\u884C\u6570\u636E\u6548\u9A8C</p><h3 id="_9-3-1\u3001\u7ED9bean\u6DFB\u52A0\u6548\u9A8C\u6CE8\u89E3-javax-validation-constraints\u5305\u4E0B-\u5E76\u5B9A\u4E49\u81EA\u5DF1\u7684\u7684message\u63D0\u793A" tabindex="-1"><a class="header-anchor" href="#_9-3-1\u3001\u7ED9bean\u6DFB\u52A0\u6548\u9A8C\u6CE8\u89E3-javax-validation-constraints\u5305\u4E0B-\u5E76\u5B9A\u4E49\u81EA\u5DF1\u7684\u7684message\u63D0\u793A" aria-hidden="true">#</a> 9.3.1\u3001\u7ED9Bean\u6DFB\u52A0\u6548\u9A8C\u6CE8\u89E3 javax.validation.constraints\u5305\u4E0B \u5E76\u5B9A\u4E49\u81EA\u5DF1\u7684\u7684message\u63D0\u793A</h3><p><img src="http://qnimg.gisfsde.com/work/image-20201019205020068.png" alt="" loading="lazy"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>messsage <span class="token operator">=</span> <span class="token string">&quot;logo\u4E0D\u80FD\u4E3A\u7A7A&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@URL</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;logo\u5FC5\u987B\u662F\u4E00\u4E2A\u5408\u6CD5\u7684url\u5730\u5740&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> logo<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-2\u3001\u5F00\u542F\u6548\u9A8C\u529F\u80FD-valid" tabindex="-1"><a class="header-anchor" href="#_9-3-2\u3001\u5F00\u542F\u6548\u9A8C\u529F\u80FD-valid" aria-hidden="true">#</a> 9.3.2\u3001\u5F00\u542F\u6548\u9A8C\u529F\u80FD @Valid</h3><ul><li><p>\u6548\u679C\uFF1A\u6548\u9A8C\u9519\u8BEF\u4EE5\u540E\u6709\u9ED8\u8BA4\u7684\u54CD\u5E94</p><p>Controller\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/save&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">BrandEntity</span> brand<span class="token punctuation">)</span><span class="token punctuation">{</span>
    brandService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://qnimg.gisfsde.com/work/image-20201020083020271.png" alt="image-20201020083020271" loading="lazy"></p></li></ul><h3 id="_9-3-3\u3001\u7ED9\u6548\u9A8C\u7684bean\u540E\u7D27\u8DDF\u4E00\u4E2Abindingresult-\u5C31\u53EF\u4EE5\u83B7\u53D6\u5230\u6548\u9A8C\u7684\u7ED3\u679C" tabindex="-1"><a class="header-anchor" href="#_9-3-3\u3001\u7ED9\u6548\u9A8C\u7684bean\u540E\u7D27\u8DDF\u4E00\u4E2Abindingresult-\u5C31\u53EF\u4EE5\u83B7\u53D6\u5230\u6548\u9A8C\u7684\u7ED3\u679C" aria-hidden="true">#</a> 9.3.3\u3001\u7ED9\u6548\u9A8C\u7684bean\u540E\u7D27\u8DDF\u4E00\u4E2ABindingResult \u5C31\u53EF\u4EE5\u83B7\u53D6\u5230\u6548\u9A8C\u7684\u7ED3\u679C</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">BrandEntity</span> brand<span class="token punctuation">,</span><span class="token class-name">BindingResult</span> result<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//1\u3001\u83B7\u53D6\u6821\u9A8C\u7684\u9519\u8BEF\u7ED3\u679C</span>
            result<span class="token punctuation">.</span><span class="token function">getFieldErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">//FieldError \u83B7\u53D6\u5230\u9519\u8BEF\u63D0\u793A</span>
                <span class="token class-name">String</span> message <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u83B7\u53D6\u9519\u8BEF\u7684\u5C5E\u6027\u7684\u540D\u5B57</span>
                <span class="token class-name">String</span> field <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token string">&quot;\u63D0\u4EA4\u7684\u6570\u636E\u4E0D\u5408\u6CD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-4\u3001\u5206\u7EC4\u6548\u9A8C-\u591A\u573A\u666F\u590D\u6742\u6548\u9A8C" tabindex="-1"><a class="header-anchor" href="#_9-3-4\u3001\u5206\u7EC4\u6548\u9A8C-\u591A\u573A\u666F\u590D\u6742\u6548\u9A8C" aria-hidden="true">#</a> 9.3.4\u3001\u5206\u7EC4\u6548\u9A8C (\u591A\u573A\u666F\u590D\u6742\u6548\u9A8C)</h3><p>\u6DFB\u52A0\u4E00\u4E2A\u7EC4 &amp; \u4FEE\u6539\u4E00\u4E2A\u7EC4</p><p>1\u3001@NotBlank(message = &quot;\u54C1\u724C\u540D\u5FC5\u987B\u63D0\u4EA4&quot;,groups = {AddGroup.class,UpdateGroup.class})</p><ul><li><strong>\u7ED9\u6548\u9A8C\u6CE8\u89E3\u6807\u6CE8\u4EC0\u4E48\u60C5\u51B5\u9700\u8981\u8FDB\u884C\u6548\u9A8C</strong></li><li>@Validated({AddGroup.class}) \u5728\u5BF9\u5E94\u65B9\u6CD5\u4E0A\u8FDB\u884C\u6807\u6CE8</li><li><strong>\u9ED8\u8BA4\u6CA1\u6709\u6307\u5B9A\u5206\u7EC4\u7684\u6548\u9A8C\u6CE8\u89E3 @NotBlank \u5728\u5206\u7EC4\u6548\u9A8C\u60C5\u51B5@Validated({AddGroup.class})\u4E0D\u751F\u6548</strong>\uFF0C\u53EA\u4F1A\u5728@Validated\u751F\u6548</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u6807\u8BB0\u4F7F\u7528\u4FEE\u6539\u5206\u7EC4</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Validated</span><span class="token punctuation">(</span><span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">BrandEntity</span> brand<span class="token punctuation">)</span><span class="token punctuation">{</span>
	brandService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Entity</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u54C1\u724Cid
 */</span>
<span class="token annotation punctuation">@Null</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;\u65B0\u589E\u4E0D\u80FD\u6307\u5B9AId&quot;</span><span class="token punctuation">,</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;\u4FEE\u6539\u5FC5\u987B\u6307\u5B9A\u54C1\u724Cid&quot;</span><span class="token punctuation">,</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@TableId</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> brandId<span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * \u54C1\u724C\u540D
 */</span>
<span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;\u54C1\u724C\u540D\u4E0D\u80FD\u4E3A\u7A7A&quot;</span><span class="token punctuation">,</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * \u54C1\u724Clogo\u5730\u5740
 */</span>
<span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@URL</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;logo\u5FC5\u987B\u662F\u4E00\u4E2A\u5408\u6CD5\u7684url\u5730\u5740&quot;</span><span class="token punctuation">,</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> logo<span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * \u4ECB\u7ECD
 */</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> descript<span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * \u663E\u793A\u72B6\u6001[0-\u4E0D\u663E\u793A\uFF1B1-\u663E\u793A]
 */</span>
<span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">UpdateStatusGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ListValue</span><span class="token punctuation">(</span>vals<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">UpdateStatusGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> showStatus<span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * \u68C0\u7D22\u9996\u5B57\u6BCD
 */</span>
<span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">&quot;^[a-zA-Z]$&quot;</span><span class="token punctuation">,</span>message <span class="token operator">=</span> <span class="token string">&quot;\u68C0\u7D22\u9996\u5B57\u6BCD\u5FC5\u987B\u662F\u4E00\u4E2A\u5B57\u6BCD&quot;</span><span class="token punctuation">,</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> firstLetter<span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * \u6392\u5E8F
 */</span>
<span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Min</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>message <span class="token operator">=</span> <span class="token string">&quot;\u6392\u5E8F\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E0&quot;</span><span class="token punctuation">,</span>groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> sort<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-5\u3001\u81EA\u5B9A\u4E49\u6548\u9A8C" tabindex="-1"><a class="header-anchor" href="#_9-3-5\u3001\u81EA\u5B9A\u4E49\u6548\u9A8C" aria-hidden="true">#</a> 9.3.5\u3001\u81EA\u5B9A\u4E49\u6548\u9A8C</h3><ul><li><pre><code> \u7F16\u5199\u4E00\u4E2A\u81EA\u5B9A\u4E49\u7684\u6548\u9A8C\u6CE8\u89E3
</code></pre></li><li><pre><code> \u7F16\u5199\u4E00\u4E2A\u81EA\u5B9A\u4E49\u7684\u6548\u9A8C\u5668\u4F55\u81EA\u5B9A\u4E49\u7684\u6548\u9A8C\u6CE8\u89E3
</code></pre></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>validatedBy <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">ListValueConstraintValidator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//\u3010\u53EF\u4EE5\u6307\u5B9A\u591A\u4E2A\u4E0D\u540C\u7684\u6548\u9A8C\u5668\uFF0C\u9002\u914D\u4E0D\u540C\u7C7B\u578B\u7684\u6548\u9A8C\u3011</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span> METHOD<span class="token punctuation">,</span> FIELD<span class="token punctuation">,</span> ANNOTATION_TYPE<span class="token punctuation">,</span> CONSTRUCTOR<span class="token punctuation">,</span> PARAMETER<span class="token punctuation">,</span> TYPE_USE <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ListValue</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u4E09\u8981\u7D20\u4E0D\u80FD\u4E22</span>
    <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;{com.atguigu.gulimall.product.valid.ListValue.message}&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Payload</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">vals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B9E\u73B0\u7EA6\u675F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListValueConstraintValidator</span> <span class="token keyword">implements</span> <span class="token class-name">ConstraintValidator</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ListValue</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Set</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u521D\u59CB\u5316\u65B9\u6CD5</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">ListValue</span> constraintAnnotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> vals <span class="token operator">=</span> constraintAnnotation<span class="token punctuation">.</span><span class="token function">vals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> val <span class="token operator">:</span> vals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5C06\u7ED3\u679C\u6DFB\u52A0\u5230set\u96C6\u5408</span>
            set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     *	\u5224\u65AD\u6548\u9A8C\u662F\u5426\u6210\u529F
     * <span class="token keyword">@param</span> <span class="token parameter">value</span> \u9700\u8981\u6548\u9A8C\u7684\u503C
     * <span class="token keyword">@param</span> <span class="token parameter">context</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> value<span class="token punctuation">,</span> <span class="token class-name">ConstraintValidatorContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5224\u65AD\u662F\u5305\u542B\u8BE5\u503C</span>
        <span class="token keyword">return</span> set<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-6\u3001\u5F02\u5E38\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_9-3-6\u3001\u5F02\u5E38\u5904\u7406" aria-hidden="true">#</a> 9.3.6\u3001\u5F02\u5E38\u5904\u7406</h3><p>\u8FD9\u91CC\u4F7F\u7528\u5230\u4E86 SpringMVC \u7684\u6CE8\u89E3 @ControllerAdvice</p><p>1\u3001\u7F16\u5199\u5F02\u5E38\u5904\u7406\u7C7B\u4F7F\u7528SpringMvc\u7684@ControllerAdvice</p><p>2\u3001\u4F7F\u7528@ExceptionHandler\u6807\u8BB0\u65B9\u6CD5\u53EF\u4EE5\u5904\u7406\u5F02\u5E38</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestControllerAdvice</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span>  <span class="token string">&quot;com.atguigu.gulimall.product.controller&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallExceptionControllerAdvice</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u6355\u83B7\u5B9A\u4E49\u7684\u5F02\u5E38
     * <span class="token keyword">@param</span> <span class="token parameter">e</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">handleVaildException</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\u6570\u636E\u6548\u9A8C\u51FA\u73B0\u95EE\u9898{},\u5F02\u5E38\u7C7B\u578B:{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errorMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BindingResult</span> bindingResult <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindingResult<span class="token punctuation">.</span><span class="token function">getFieldErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>fieldError <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            errorMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>fieldError<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fieldError<span class="token punctuation">.</span><span class="token function">getDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>VAILD_EXCEPTION<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>VAILD_EXCEPTION<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span>errorMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u515C\u5E95\u5F02\u5E38
     * <span class="token keyword">@param</span> <span class="token parameter">throwable</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Throwable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5F02\u5E38\u9519\u8BEF\u7801\u5B9A\u4E49 \uFF08\u91CD\u70B9\uFF09</strong></p><p>\u540E\u7AEF\u5C06\u5B9A\u4E49\u7684\u9519\u8BEF\u7801\u5199\u5165\u5230\u5F00\u53D1\u624B\u518C\uFF0C\u524D\u7AEF\u51FA\u73B0\u5BF9\u4E8E\u7684\u9519\u8BEF\uFF0C\u5C31\u53EF\u4EE5\u901A\u8FC7\u624B\u518C\u67E5\u8BE2\u5230\u5BF9\u5E94\u7684\u5F02\u5E38</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/***
 * \u9519\u8BEF\u7801\u548C\u9519\u8BEF\u4FE1\u606F\u5B9A\u4E49\u7C7B
 * 1. \u9519\u8BEF\u7801\u5B9A\u4E49\u89C4\u5219\u4E3A5\u4E3A\u6570\u5B57
 * 2. \u524D\u4E24\u4F4D\u8868\u793A\u4E1A\u52A1\u573A\u666F\uFF0C\u6700\u540E\u4E09\u4F4D\u8868\u793A\u9519\u8BEF\u7801\u3002\u4F8B\u5982\uFF1A100001\u300210:\u901A\u7528 001:\u7CFB\u7EDF\u672A\u77E5\u5F02\u5E38
 * 3. \u7EF4\u62A4\u9519\u8BEF\u7801\u540E\u9700\u8981\u7EF4\u62A4\u9519\u8BEF\u63CF\u8FF0\uFF0C\u5C06\u4ED6\u4EEC\u5B9A\u4E49\u4E3A\u679A\u4E3E\u5F62\u5F0F
 * \u9519\u8BEF\u7801\u5217\u8868\uFF1A
 *  10: \u901A\u7528
 *      001\uFF1A\u53C2\u6570\u683C\u5F0F\u6821\u9A8C
 *  11: \u5546\u54C1
 *  12: \u8BA2\u5355
 *  13: \u8D2D\u7269\u8F66
 *  14: \u7269\u6D41
 *
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">BizCodeEnume</span> <span class="token punctuation">{</span>
    <span class="token function">UNKNOW_EXCEPTION</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token string">&quot;\u7CFB\u7EDF\u672A\u77E5\u5F02\u5E38&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">VAILD_EXCEPTION</span><span class="token punctuation">(</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token string">&quot;\u53C2\u6570\u683C\u5F0F\u6821\u9A8C\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
    <span class="token class-name">BizCodeEnume</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="\u516B\u3001\u5546\u54C1\u670D\u52A1-\u5C5E\u6027\u5206\u7EC4" tabindex="-1"><a class="header-anchor" href="#\u516B\u3001\u5546\u54C1\u670D\u52A1-\u5C5E\u6027\u5206\u7EC4" aria-hidden="true">#</a> \u516B\u3001\u5546\u54C1\u670D\u52A1&amp;\u5C5E\u6027\u5206\u7EC4</h1><h2 id="_10-1-\u3001\u524D\u7AEF\u7EC4\u4EF6\u62BD\u53D6-\u7236\u5B50\u7EC4\u4EF6\u4EA4\u4E92" tabindex="-1"><a class="header-anchor" href="#_10-1-\u3001\u524D\u7AEF\u7EC4\u4EF6\u62BD\u53D6-\u7236\u5B50\u7EC4\u4EF6\u4EA4\u4E92" aria-hidden="true">#</a> 10.1 \u3001\u524D\u7AEF\u7EC4\u4EF6\u62BD\u53D6 &amp; \u7236\u5B50\u7EC4\u4EF6\u4EA4\u4E92</h2><h3 id="_10-1-1-\u5C5E\u6027\u5206\u7EC4-\u6548\u679C" tabindex="-1"><a class="header-anchor" href="#_10-1-1-\u5C5E\u6027\u5206\u7EC4-\u6548\u679C" aria-hidden="true">#</a> 10.1.1 \u5C5E\u6027\u5206\u7EC4 - \u6548\u679C</h3><p><img src="http://qnimg.gisfsde.com/work/image-20201020151047887.png" alt="image-20201020151047887" loading="lazy"></p><p>\u5DE6\u8FB9\u8FD9\u4E2A\u6811\u5F62\u7A7A\u95F4\u6211\u4EEC\u5DF2\u7ECF\u5199\u8FC7\u4E86\uFF0C\u5728\u4E09\u7EA7\u5206\u7C7B\u7684\u65F6\u5019\u7F16\u5199\u8FC7\uFF0C\u76F8\u5BF9\u5E94\u7684\u529F\u80FD\uFF0C\u62D6\u62FD\uFF0C\u6DFB\u52A0\uFF0C\u5220\u9664\u7B49\u7B49\u90FD\u5DF2\u7ECF\u5B9E\u73B0\uFF0C\u90A3\u6211\u4EEC\u4E3A\u4EC0\u4E48\u4E0D\u628A\u4ED6\u62BD\u53D6\u51FA\u4E00\u4E2A\u516C\u5171\u7684\u7EC4\u4EF6\u4FBF\u4E8E\u5176\u4ED6\u7EC4\u4EF6\u5229\u7528\uFF1F</p><p>\u8BF4\u5E72\u5C31\u5E72\uFF01</p><p>\u5728 modules \u4E2D\u65B0\u5EFA common \u6587\u4EF6\u5939\uFF0C\u5728common\u4E2D \u65B0\u5EFA category.vue</p><p>category.vue \u6838\u5FC3\u4EE3\u7801</p><p>\u62BD\u53D6\u9700\u8981\u7684\u7ED3\u679C\uFF0C\u591A\u4F59\u7684\u7ED3\u679C\u8FDB\u884C\u5220\u9664</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tree</span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>menus<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:props</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultProps<span class="token punctuation">&quot;</span></span> <span class="token attr-name">node-key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>catId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>menuTree<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@node-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nodeClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tree</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-1-2-layout-\u5E03\u5C40" tabindex="-1"><a class="header-anchor" href="#_10-1-2-layout-\u5E03\u5C40" aria-hidden="true">#</a> 10.1.2 Layout \u5E03\u5C40</h3><p>\u901A\u8FC7\u57FA\u7840\u7684 24 \u5206\u680F\uFF0C\u8FC5\u901F\u7B80\u4FBF\u5730\u521B\u5EFA\u5E03\u5C40\u3001\u7C7B\u4F3C\u4E4B\u524D\u5B66\u8FC7\u7684bootstrap</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-row</span> <span class="token attr-name">:gutter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>6<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u8868\u683C\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">&gt;</span></span>
  \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>18<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u83DC\u5355\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-row</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5DE6\u8FB9\u653E\u8868\u683C\uFF0C\u53F3\u8FB9\u653E\u83DC\u5355</p><p>\u5F15\u5165 category \u7EC4\u4EF6</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> category <span class="token keyword">from</span> <span class="token string">&quot;../common/category&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5E76\u4E14\u58F0\u660E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//import\u5F15\u5165\u7684\u7EC4\u4EF6\u9700\u8981\u6CE8\u5165\u5230\u5BF9\u8C61\u4E2D\u624D\u80FD\u4F7F\u7528</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    category
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6700\u540E\u5728\u7EC4\u4EF6\u4E2D\u4F7F\u7528</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>   \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>6<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
       <span class="token comment">&lt;!-- \u76F4\u63A5\u4F7F\u7528--&gt;</span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name">@tree-node-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>treenodeclick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>category</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-col</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53F3\u8FB9\u83DC\u5355\u4F7F\u7528\u4EE3\u7801\u751F\u6210\u5668\u7684\u4EE3\u7801\u76F4\u63A5\u5F15\u5165\u5373\u53EF</p><h3 id="_10-1-3-\u7236\u5B50\u7EC4\u4EF6\u5982\u4F55\u8FDB\u884C\u4EA4\u4E92" tabindex="-1"><a class="header-anchor" href="#_10-1-3-\u7236\u5B50\u7EC4\u4EF6\u5982\u4F55\u8FDB\u884C\u4EA4\u4E92" aria-hidden="true">#</a> 10.1.3 \u7236\u5B50\u7EC4\u4EF6\u5982\u4F55\u8FDB\u884C\u4EA4\u4E92</h3><p>\u5B50\u7EC4\u4EF6\u4E2D\u7684 Tree \u7EC4\u4EF6\u7684\u4E00\u4E2A\u4E8B\u4EF6 node-click \u8282\u70B9\u88AB\u70B9\u51FB\u65F6\u7684\u56DE\u8C03</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token comment">// \u5411\u7236\u7EC4\u4EF6\u53D1\u9001\u4E8B\u4EF6\uFF0C\u540E\u9762\u662F\u9700\u8981\u4F20\u9012\u7684\u5BF9\u8C61\uFF0C\u53C2\u6570\u7B49</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;tree-node-click&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span>node<span class="token punctuation">,</span>component<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7236\u7EC4\u4EF6\u9700\u8981\u5B9A\u4E49\u76F8\u540C\u65B9\u6CD5\u63A5\u6536</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>  \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name">@tree-node-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>treenodeclick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>category</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token comment">// \u611F\u77E5\u5230\u8282\u70B9\u88AB\u70B9\u51FB</span>
    <span class="token function">treenodeclick</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> data<span class="token punctuation">,</span> component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;attrgroup\u611F\u77E5\u5230category\u8282\u70B9\u88AB\u70B9\u51FB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u521A\u624D\u88AB\u70B9\u51FB\u7684\u83DC\u5355id:&quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>catId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>level <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>catId <span class="token operator">=</span> data<span class="token punctuation">.</span>catId<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-2-\u3001\u83B7\u53D6\u5C5E\u6027\u5206\u7C7B\u5206\u7EC4" tabindex="-1"><a class="header-anchor" href="#_10-2-\u3001\u83B7\u53D6\u5C5E\u6027\u5206\u7C7B\u5206\u7EC4" aria-hidden="true">#</a> 10.2 \u3001\u83B7\u53D6\u5C5E\u6027\u5206\u7C7B\u5206\u7EC4</h2><p>\u67E5\u770B\u63D0\u4F9B\u7684\u63A5\u53E3\u6587\u6863</p><p><img src="http://qnimg.gisfsde.com/work/image-20201020153526835.png" alt="image-20201020153526835" loading="lazy"></p><p>\u8BF7\u6C42\u53C2\u6570\u9700\u8981\u6211\u4EEC\u5E26\u5BF9\u5E94\u7684\u5206\u9875\u53C2\u6570\uFF0C\u6240\u4EE5\u6211\u4EEC\u5728\u8BF7\u6C42\u7684\u65F6\u5019\u5F97\u628A\u53C2\u6570\u5E26\u4E0A</p><p>\u90A3\u5C31\u5B9A\u4E49\u63A5\u53E3 go</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * 
     * <span class="token keyword">@param</span> <span class="token parameter">params</span> \u5206\u9875\u8BF7\u6C42\u76F8\u5173\u53C2\u6570
     * <span class="token keyword">@param</span> <span class="token parameter">catelogId</span> \u4E09\u7EA7\u5206\u7C7Bid
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B9E\u73B0\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5206\u7C7Bid \u7B49\u4E8E01 \u67E5\u8BE2\u5168\u90E8</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>catelogId <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u62FF\u5230\u53C2\u6570\u4E2D\u7684 key</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5148\u6839\u636E\u5206\u7C7Bid\u8FDB\u884C\u67E5\u8BE2</span>
        <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// selecet * from attrgroup where catelog_id = ? and (attr_group_id = key or like attr_group_name = key)</span>
        <span class="token comment">// \u6709\u65F6\u5019\u67E5\u8BE2\u4E5F\u4E0D\u4F1A\u5E26\u4E0Akey \u6240\u4EE5\u5F97\u5224\u65AD</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// where\u6761\u4EF6\u540E\u52A0\u4E0A and </span>
            wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                obj<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_group_id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;attr_group_name&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u7EC4\u88C5\u6761\u4EF6\u8FDB\u884C\u67E5\u8BE2 </span>
        <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
                wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span>  <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-3-\u3001\u5206\u7C7B\u65B0\u589E-\u7EA7\u8054\u9009\u62E9\u5668" tabindex="-1"><a class="header-anchor" href="#_10-3-\u3001\u5206\u7C7B\u65B0\u589E-\u7EA7\u8054\u9009\u62E9\u5668" aria-hidden="true">#</a> 10.3 \u3001\u5206\u7C7B\u65B0\u589E &amp; \u7EA7\u8054\u9009\u62E9\u5668</h2><p>\u7EA7\u8054\u9009\u62E9\u5668\u662F\u5565\uFF1F\uFF1F \u6CA1\u63A5\u89E6\u8FC7</p><p>\u5B98\u65B9\u89E3\u91CA</p><p><strong>Cascader \u7EA7\u8054\u9009\u62E9\u5668</strong></p><p>\u5F53\u4E00\u4E2A\u6570\u636E\u96C6\u5408\u6709\u6E05\u6670\u7684\u5C42\u7EA7\u7ED3\u6784\u65F6\uFF0C\u53EF\u901A\u8FC7\u7EA7\u8054\u9009\u62E9\u5668\u9010\u7EA7\u67E5\u770B\u5E76\u9009\u62E9\u3002</p><p>\u5BF9\u5E94\u6548\u679C</p><p><img src="http://qnimg.gisfsde.com/work/image-20201020154619941.png" alt="image-20201020154619941" loading="lazy"></p><p>attrgroup-add-or-update.vue \u4E2D \u52A0\u5165\u8BE5\u7EC4\u4EF6</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>  \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-cascader</span>
          <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataForm.catelogPath<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\u8BD5\u8BD5\u641C\u7D22\uFF1A\u624B\u673A<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:options</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>categorys<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:props</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>props<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">filterable</span>
        <span class="token punctuation">&gt;</span></span>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-cascader</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--
placeholder=&quot;\u8BD5\u8BD5\u641C\u7D22\uFF1A\u624B\u673A&quot;\u9ED8\u8BA4\u7684\u641C\u7D22\u63D0\u793A
:options=&quot;categorys&quot; \u53EF\u9009\u9879\u6570\u636E\u6E90\uFF0C\u952E\u540D\u53EF\u901A\u8FC7 Props \u5C5E\u6027\u914D\u7F6E
:props=&quot;props&quot; \u914D\u7F6E\u9009\u9879	
 filterable \u662F\u5426\u53EF\u641C\u7D22\u9009\u9879
--&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u90A3\u4E48\u95EE\u9898\u6765\u4E86\uFF1F \u6211\u600E\u6837\u628A\u6570\u636E\u52A0\u8F7D\u5230\u8FD9\u4E2A\u7EC4\u4EF6\u91CC\u9762\uFF1F</p><p>\u5728\u4F60\u7EC4\u4EF6\u52A0\u8F7D\u5B8C\u6210\u540E\uFF0C\u6211\u5728\u8C03\u7528\u65B9\u6CD5 ( getCategorys() ) \u83B7\u53D6\u83DC\u5355\u6570\u636E\uFF0C\u5728\u8BBE\u7F6E\u5230options\u4E0D\u5C31\u884C\u4E86\u5417\uFF1F</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token function">getCategorys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/product/category/list/tree&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;get&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>categorys <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-4-\u3001\u5206\u7C7B\u4FEE\u6539-\u56DE\u663E\u7EA7\u8054\u9009\u62E9\u5668" tabindex="-1"><a class="header-anchor" href="#_10-4-\u3001\u5206\u7C7B\u4FEE\u6539-\u56DE\u663E\u7EA7\u8054\u9009\u62E9\u5668" aria-hidden="true">#</a> 10.4 \u3001\u5206\u7C7B\u4FEE\u6539 &amp; \u56DE\u663E\u7EA7\u8054\u9009\u62E9\u5668</h2><p>\u4FEE\u6539\u548C\u65B0\u589E\u7528\u7684\u662F\u4E00\u4E2A\u6DFB\u52A0\u7EC4\u4EF6 \u90A3\u4E48\u6211\u4EEC\u518D\u70B9\u51FB\u4FEE\u6539\u540E\uFF0C\u4F60\u5982\u4F55\u628A \u7EA7\u8054\u663E\u793A\u7684\u6570\u636E\u518D\u6B21\u663E\u793A\u51FA\u6765\uFF1F</p><p>\u5728 AttrGroup\u70B9\u51FB\u4FEE\u6539\u540E\uFF0C\u4F1A\u89E6\u53D1addOrUpdateHandle\u65B9\u6CD5\uFF0C\u4ED6\u4F1A\u901A\u8FC7\u5F15\u7528 vue \u6587\u4EF6\u91CC\u7684 addOrUpdate \u5E76\u8C03\u7528\u4ED6\u7684 init\u521D\u59CB\u5316\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token comment">// \u65B0\u589E / \u4FEE\u6539</span>
    <span class="token function">addOrUpdateHandle</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u5BF9\u8BDD\u6846\u663E\u793A</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>addOrUpdateVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token comment">// \u8981\u6E32\u67D3\u7684\u7EC4\u4EF6\u5B8C\u6210\u9009\u7136\u540E \u8C03\u7528\u8BE5\u65B9\u6CD5</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// this \u5F53\u524D refs \u5F53\u524D\u6240\u6709\u7EC4\u4EF6</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>addOrUpdate<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>init\u6267\u884C\u5B8C\u6210\u4F1A\u56DE\u8C03</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>code <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>dataForm<span class="token punctuation">.</span>attrGroupName <span class="token operator">=</span> data<span class="token punctuation">.</span>attrGroup<span class="token punctuation">.</span>attrGroupName<span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>dataForm<span class="token punctuation">.</span>sort <span class="token operator">=</span> data<span class="token punctuation">.</span>attrGroup<span class="token punctuation">.</span>sort<span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>dataForm<span class="token punctuation">.</span>descript <span class="token operator">=</span> data<span class="token punctuation">.</span>attrGroup<span class="token punctuation">.</span>descript<span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>dataForm<span class="token punctuation">.</span>icon <span class="token operator">=</span> data<span class="token punctuation">.</span>attrGroup<span class="token punctuation">.</span>icon<span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>dataForm<span class="token punctuation">.</span>catelogId <span class="token operator">=</span> data<span class="token punctuation">.</span>attrGroup<span class="token punctuation">.</span>catelogId<span class="token punctuation">;</span>
                <span class="token comment">// \u8BBE\u7F6E \u7EA7\u8054\u7684\u8DEF\u5F84 \u4ECE\u6570\u636E\u4E2D\u53D6</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>dataForm<span class="token punctuation">.</span>catelogPath <span class="token operator">=</span> data<span class="token punctuation">.</span>attrGroup<span class="token punctuation">.</span>catelogPath<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u540E\u7AEF\u5982\u4F55\u6839\u636E\u5206\u7EC4id \u67E5\u8BE2\u51FA \u5BF9\u5E94\u7684\u5206\u7C7B\uFF1F\u5B9A\u4E49\u63A5\u53E3</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u627E\u5230catelogId\u7684\u5B8C\u6574\u8DEF\u5F84
 * \u3010\u7236/\u5B50/\u5B59\u3011
 * <span class="token keyword">@param</span> <span class="token parameter">catelogId</span>
 */</span>
<span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findCatelogPath</span><span class="token punctuation">(</span><span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">findCatelogPath</span><span class="token punctuation">(</span><span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> paths <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> parentPath <span class="token operator">=</span> <span class="token function">findParentPath</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">,</span> paths<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u53CD\u8F6C</span>
    <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span>parentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8F6C\u6210Long[] \u6570\u7EC4\u8FD4\u56DE</span>
    <span class="token keyword">return</span> parentPath<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Long</span><span class="token punctuation">[</span>parentPath<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * \u9012\u5F52\u67E5\u627E
 * <span class="token keyword">@param</span> <span class="token parameter">catelogId</span> \u4E09\u7EA7\u5206\u7C7B\u7684id
 * <span class="token keyword">@param</span> <span class="token parameter">paths</span> \u8DEF\u5F84
 * <span class="token keyword">@return</span>
 */</span>
<span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">findParentPath</span><span class="token punctuation">(</span><span class="token class-name">Long</span> catelogId<span class="token punctuation">,</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> paths<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1\u3001\u6536\u96C6\u5F53\u524D\u8282\u70B9id</span>
    paths<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2\u3001\u901A\u8FC7\u5206\u7C7Bid\u62FF\u5230 Category \u5BF9\u8C61</span>
    <span class="token class-name">CategoryEntity</span> byId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3\u3001\u5982\u679C\u4E0D\u662F\u6839\u8282\u70B9 \u5C31\u4E00\u76F4\u9012\u5F52\u4E0B\u53BB\u67E5\u627E</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>byId<span class="token punctuation">.</span><span class="token function">getParentCid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">findParentPath</span><span class="token punctuation">(</span>byId<span class="token punctuation">.</span><span class="token function">getParentCid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>paths<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> paths<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 AttrGroupEntity \u4E2D \u6DFB\u52A0\u4E86\u4E00\u4E2A\u65B0\u5C5E\u6027</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u7528\u4E8E\u5B58\u653E \u7EA7\u8054\u663E\u793A\u7684 \u7236\u5B50\u5B59\u7684\u5730\u5740
 */</span>
<span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// \u6807\u6CE8\u4E3Afalse \u8868\u662F\u4E0D\u662F\u6570\u636E\u5E93\u5B57\u6BB5</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> catelogPath<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Controller \u5177\u4F53\u8BBE\u7F6E\u8FD4\u56DE\u6570\u636E</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
   * \u4FE1\u606F
   */</span>
  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/info/{attrGroupId}&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;attrGroupId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> attrGroupId<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// \u6839\u636Eid\u67E5\u8BE2\u51FA \u5206\u7EC4group\u5BF9\u8C61</span>
	<span class="token class-name">AttrGroupEntity</span> attrGroup <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>attrGroupId<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u62FF\u5230\u5206\u7C7Bid</span>
      <span class="token class-name">Long</span> catelogId <span class="token operator">=</span> attrGroup<span class="token punctuation">.</span><span class="token function">getCatelogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// \u6839\u636E\u5206\u7C7Bid\u67E5\u8BE2\u51FA \u4ED6\u7684 \u7236 \u5B50 \u5B59 \u5BF9\u5E94\u7684\u6570\u636E,\u5E76\u4E14\u8BBE\u7F6E\u5230 attrGroup\u5BF9\u8C61</span>
      <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> catelogPath <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">findCatelogPath</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      attrGroup<span class="token punctuation">.</span><span class="token function">setCatelogPath</span><span class="token punctuation">(</span>catelogPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;attrGroup&quot;</span><span class="token punctuation">,</span> attrGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-5\u3001\u54C1\u724C\u5206\u7C7B\u5173\u8054\u4E0E\u7EA7\u8054\u66F4\u65B0" tabindex="-1"><a class="header-anchor" href="#_10-5\u3001\u54C1\u724C\u5206\u7C7B\u5173\u8054\u4E0E\u7EA7\u8054\u66F4\u65B0" aria-hidden="true">#</a> 10.5\u3001\u54C1\u724C\u5206\u7C7B\u5173\u8054\u4E0E\u7EA7\u8054\u66F4\u65B0</h2><h3 id="_10-5-1\u3001\u5B9E\u73B0\u54C1\u724C\u7BA1\u7406\u641C\u7D22" tabindex="-1"><a class="header-anchor" href="#_10-5-1\u3001\u5B9E\u73B0\u54C1\u724C\u7BA1\u7406\u641C\u7D22" aria-hidden="true">#</a> 10.5.1\u3001\u5B9E\u73B0\u54C1\u724C\u7BA1\u7406\u641C\u7D22</h3><p><img src="http://qnimg.gisfsde.com/work/image-20201020120929362.png" alt="image-20201020120929362" loading="lazy"></p><p>\u5728\u539F\u672C\u67E5\u8BE2\u4E2D\u52A0\u5165\u65B0\u529F\u80FD</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u83B7\u53D6key</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// key\u4E0D\u4E3A\u7A7A brand_id \u548C name \u8FDB\u884C\u503C\u5339\u914D </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;brand_id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
                wrapper
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u662F\u76F4\u63A5\u628A\u6570\u636E\u8868\u5B58\u8FDB\u4E86\u4E2D\u95F4\u8868,\u5982\u679C\u5728\u771F\u6B63\u7684\u54C1\u724C\u540D\u548C\u5206\u7C7B\u540D\u8FDB\u884C\u4E86\u4FEE\u6539\uFF0C\u90A3\u4E48\u6B64\u65F6\u4E2D\u95F4\u8868\u7684\u6570\u636E\u5C31\u662F\u4E0D\u5BF9\u7684\uFF0C\u8FD9\u65F6\u5019\u6570\u636E\u5C31\u4E0D\u662F\u4E00\u81F4\u6027</p><p>\u89E3\u51B3</p><p>\u5728\u8FDB\u884C\u4FEE\u6539\u7684\u65F6\u5019\uFF0C\u4E5F\u8981\u628A\u4E2D\u95F4\u8868\u7684\u6570\u636E\u8FDB\u884C\u66F4\u6539</p><p>Brand</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// BrandController</span>
 <span class="token doc-comment comment">/**
      /**
     * \u4FEE\u6539
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/update&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Validated</span><span class="token punctuation">(</span><span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">BrandEntity</span> brand<span class="token punctuation">)</span><span class="token punctuation">{</span>

		brandService<span class="token punctuation">.</span><span class="token function">updateDetail</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">// Service</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateDetail</span><span class="token punctuation">(</span><span class="token class-name">BrandEntity</span> brand<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4FDD\u8BC1\u5B57\u6BB5\u4E00\u81F4</span>
    <span class="token comment">// \u6839\u636Eid\u66F4\u6539</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>brand<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u540C\u6B65\u66F4\u65B0\u5176\u4ED6\u5173\u8054\u8868\u4E2D\u7684\u6570\u636E</span>
        categoryBrandRelationService<span class="token punctuation">.</span><span class="token function">updateBrand</span><span class="token punctuation">(</span>brand<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>brand<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// TODO \u66F4\u65B0\u5176\u4ED6\u5173\u8054</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Service\u5B9E\u73B0\u7C7B</span>
  <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateBrand</span><span class="token punctuation">(</span><span class="token class-name">Long</span> brandId<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CategoryBrandRelationEntity</span> relationEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CategoryBrandRelationEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        relationEntity<span class="token punctuation">.</span><span class="token function">setBrandName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        relationEntity<span class="token punctuation">.</span><span class="token function">setBrandId</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>relationEntity<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryBrandRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;brand_id&quot;</span><span class="token punctuation">,</span>brandId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Category</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateCascate</span><span class="token punctuation">(</span><span class="token class-name">CategoryEntity</span> category<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span>
    categoryBrandRelationService<span class="token punctuation">.</span><span class="token function">updateCategory</span><span class="token punctuation">(</span>category<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>category<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Service </span>
  <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateCascate</span><span class="token punctuation">(</span><span class="token class-name">CategoryEntity</span> category<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u66F4\u65B0\u81EA\u5DF1\u8868\u5BF9\u8C61</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u66F4\u65B0\u5173\u8054\u8868\u5BF9\u8C61</span>
        categoryBrandRelationService<span class="token punctuation">.</span><span class="token function">updateCategory</span><span class="token punctuation">(</span>category<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>category<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="\u4E5D\u3001\u5546\u54C1\u670D\u52A1-\u5E73\u53F0\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#\u4E5D\u3001\u5546\u54C1\u670D\u52A1-\u5E73\u53F0\u5C5E\u6027" aria-hidden="true">#</a> \u4E5D\u3001\u5546\u54C1\u670D\u52A1&amp;\u5E73\u53F0\u5C5E\u6027</h1><h2 id="object\u5212\u5206" tabindex="-1"><a class="header-anchor" href="#object\u5212\u5206" aria-hidden="true">#</a> Object\u5212\u5206</h2><h5 id="_1\u3001po-persistant-object-\u6301\u4E45\u5316\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_1\u3001po-persistant-object-\u6301\u4E45\u5316\u5BF9\u8C61" aria-hidden="true">#</a> 1\u3001PO (persistant object) \u6301\u4E45\u5316\u5BF9\u8C61</h5><p>po \u5C31\u662F\u5BF9\u5E94\u6570\u636E\u5E93\u4E2D\u67D0\u4E00\u4E2A\u8868\u7684\u4E00\u6761\u8BB0\u5F55\uFF0C\u591A\u4E2A\u8BB0\u5F55\u53EF\u4EE5\u7528 PO \u7684\u96C6\u5408\uFF0CPO \u4E2D\u5E94\u8BE5\u4E0D\u5305\u542B\u4EFB\u4F55\u5BF9\u6570\u636E\u5E93\u5230\u64CD\u4F5C</p><h5 id="_2\u3001do-domain-object-\u9886\u57DF\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_2\u3001do-domain-object-\u9886\u57DF\u5BF9\u8C61" aria-hidden="true">#</a> 2\u3001DO ( Domain Object) \u9886\u57DF\u5BF9\u8C61</h5><p>\u5C31\u662F\u4ECE\u73B0\u5B9E\u4E16\u754C\u62BD\u8C61\u51FA\u6765\u7684\u6709\u5F62\u6216\u65E0\u5F62\u7684\u4E1A\u52A1\u5B9E\u4F53</p><h5 id="_3\u3001to-transfer-object-\u6570\u636E\u4F20\u8F93\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_3\u3001to-transfer-object-\u6570\u636E\u4F20\u8F93\u5BF9\u8C61" aria-hidden="true">#</a> 3\u3001TO (Transfer Object) \u6570\u636E\u4F20\u8F93\u5BF9\u8C61</h5><p>\u4E0D\u540C\u7684\u5E94\u7528\u7A0B\u5E8F\u4E4B\u95F4\u4F20\u8F93\u7684\u5BF9\u8C61</p><h5 id="_4\u3001dto-data-transfer-object-\u6570\u636E\u4F20\u8F93\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_4\u3001dto-data-transfer-object-\u6570\u636E\u4F20\u8F93\u5BF9\u8C61" aria-hidden="true">#</a> 4\u3001DTO (Data Transfer Object) \u6570\u636E\u4F20\u8F93\u5BF9\u8C61</h5><p>\u8FD9\u4E2A\u6982\u5FF5\u6765\u6E90\u4E8E J2EE \u7684\u8BBE\u8BA1\u6A21\u5F0F\uFF0C\u539F\u6765\u7684\u76EE\u7684\u662F\u4E3A\u4E86 EJB\u7684\u5206\u5E03\u5F0F\u5E94\u7528\u63D0\u4F9B\u7C97\u7C92\u5EA6\u7684\u6570\u636E\u5B9E\u4F53\uFF0C\u4EE5\u51CF\u5C11\u5206\u5E03\u5F0F\u8C03\u7528\u7684\u6B21\u6570\uFF0C\u4ECE\u800C\u63D0\u9AD8\u5206\u6570\u8C03\u7528\u7684\u6027\u80FD\u548C\u964D\u4F4E\u7F51\u7EDC\u8D1F\u8F7D\uFF0C\u4F46\u5728\u8FD9\u91CC\uFF0C\u6CDB\u6307\u7528\u4E8E\u5C55\u793A\u5C42\u4E0E\u670D\u52A1\u5C42\u4E4B\u95F4\u7684\u6570\u636E\u4F20\u8F93\u5BF9\u8C61</p><h5 id="_5\u3001vo-value-object-\u503C\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_5\u3001vo-value-object-\u503C\u5BF9\u8C61" aria-hidden="true">#</a> 5\u3001VO(value object) \u503C\u5BF9\u8C61</h5><p>\u901A\u5E38\u7528\u4E8E\u4E1A\u52A1\u5C42\u4E4B\u95F4\u7684\u6570\u636E\u4F20\u9012\uFF0C\u548C PO \u4E00\u6837\u4E5F\u662F\u4EC5\u4EC5\u5305\u542B\u6570\u636E\u800C\u5DF2\uFF0C\u4F46\u5E94\u662F\u62BD\u8C61\u51FA\u7684\u4E1A\u52A1\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u548C\u8868\u5BF9\u5E94\uFF0C\u4E5F\u53EF\u4EE5\u4E0D\uFF0C\u8FD9\u6839\u636E\u4E1A\u52A1\u7684\u9700\u8981\uFF0C\u7528 new \u5173\u952E\u5B57\u521B\u5EFA\uFF0C\u7531 GC \u56DE\u6536</p><p>view Object \u8BD5\u56FE\u5BF9\u8C61</p><p>\u63A5\u53D7\u9875\u9762\u4F20\u9012\u6765\u7684\u6570\u636E\uFF0C\u5C01\u88C5\u5BF9\u8C61\uFF0C\u5C01\u88C5\u9875\u9762\u9700\u8981\u7528\u7684\u6570\u636E</p><h5 id="_6\u3001bo-business-object-\u4E1A\u52A1\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_6\u3001bo-business-object-\u4E1A\u52A1\u5BF9\u8C61" aria-hidden="true">#</a> 6\u3001BO(business object) \u4E1A\u52A1\u5BF9\u8C61</h5><p>\u4ECE\u4E1A\u52A1\u6A21\u578B\u7684\u89D2\u5EA6\u770B\uFF0C\u89C1 UML \u539F\u4EF6\u9886\u57DF\u6A21\u578B\u4E2D\u7684\u9886\u57DF\u5BF9\u8C61\uFF0C\u5C01\u88C5\u4E1A\u52A1\u903B\u8F91\u7684\uFF0C java \u5BF9\u8C61\uFF0C\u901A\u8FC7\u8C03\u7528 DAO \u65B9\u6CD5\uFF0C\u7ED3\u5408 PO VO,\u8FDB\u884C\u4E1A\u52A1\u64CD\u4F5C\uFF0Cbusiness object \u4E1A\u52A1\u5BF9\u8C61\uFF0C\u4E3B\u8981\u4F5C\u7528\u662F\u628A\u4E1A\u52A1\u903B\u8F91\u5C01\u88C5\u6210\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u5305\u62EC\u4E00\u4E2A\u6216\u591A\u4E2A\u5BF9\u8C61\uFF0C\u6BD4\u5982\u4E00\u4E2A\u7B80\u5386\uFF0C\u6709\u6559\u80B2\u7ECF\u5386\uFF0C\u5DE5\u4F5C\u7ECF\u5386\uFF0C\u793E\u4F1A\u5173\u7CFB\u7B49\u7B49\uFF0C\u6211\u4EEC\u53EF\u4EE5\u628A\u6559\u80B2\u7ECF\u5386\u5BF9\u5E94\u4E00\u4E2A PO \u3001\u5DE5\u4F5C\u7ECF\u9A8C\u5BF9\u5E94\u4E00\u4E2A PO\u3001 \u793E\u4F1A\u5173\u7CFB\u5BF9\u5E94\u4E00\u4E2A PO, \u5EFA\u7ACB\u4E00\u4E2A\u5BF9\u5E94\u7B80\u5386\u7684\u7684 BO \u5BF9\u8C61\u5904\u7406\u7B80\u5386\uFF0C\u6BCF \u4E2A BO \u5305\u542B\u8FD9\u4E9B PO ,\u8FD9\u6837\u5904\u7406\u4E1A\u52A1\u903B\u8F91\u65F6\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u9488\u5BF9 BO \u53BB\u5904\u7406</p><h5 id="_7\u3001pojo-plain-ordinary-java-object-\u7B80\u5355\u65E0\u89C4\u5219-java-\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_7\u3001pojo-plain-ordinary-java-object-\u7B80\u5355\u65E0\u89C4\u5219-java-\u5BF9\u8C61" aria-hidden="true">#</a> 7\u3001POJO ( plain ordinary java object) \u7B80\u5355\u65E0\u89C4\u5219 java \u5BF9\u8C61</h5><p>\u4F20\u7EDF\u610F\u4E49\u7684 java \u5BF9\u8C61\uFF0C\u5C31\u662F\u8BF4\u4E00\u4E9B Object/Relation Mapping \u5DE5\u5177\u4E2D\uFF0C\u80FD\u591F\u505A\u5230\u7EF4\u62A4\u6570\u636E\u5E93\u8868\u8BB0\u5F55\u7684 persisent object \u5B8C\u5168\u662F\u4E00\u4E2A\u7B26\u5408 Java Bean \u89C4\u8303\u7684 \u7EAF java \u5BF9\u8C61\uFF0C\u6CA1\u6709\u589E\u52A0\u522B\u7684\u5C5E\u6027\u548C\u65B9\u6CD5\uFF0C\u6211\u4EEC\u7684\u7406\u89E3\u5C31\u662F\u6700\u57FA\u672C\u7684 Java bean \u53EA\u6709\u5C5E\u6027\u5B57\u6BB5 setter \u548C getter \u65B9\u6CD5</p><p>POJO \u65F6\u662F DO/DTO/BO/VO \u7684\u7EDF\u79F0</p><h5 id="_8\u3001dao-data-access-object-\u6570\u636E\u8BBF\u95EE\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_8\u3001dao-data-access-object-\u6570\u636E\u8BBF\u95EE\u5BF9\u8C61" aria-hidden="true">#</a> 8\u3001DAO\uFF08data access object\uFF09 \u6570\u636E\u8BBF\u95EE\u5BF9\u8C61</h5><p>\u662F\u4E00\u4E2A sun \u7684\u4E00\u4E2A\u6807\u51C6 j2ee \u8BBE\u8BA1\u6A21\u5F0F\uFF0C\u8FD9\u4E2A\u6A21\u5F0F\u6709\u4E2A\u63A5\u53E3\u5C31\u662F DAO \uFF0C\u4ED6\u8D1F\u6301\u4E45\u5C42\u7684\u64CD\u4F5C\uFF0C\u4E3A\u4E1A\u52A1\u5C42\u63D0\u4F9B\u63A5\u53E3\uFF0C\u6B64\u5BF9\u8C61\u7528\u4E8E\u8BBF\u95EE\u6570\u636E\u5E93\uFF0C\u901A\u5E38\u548C PO \u7ED3\u5408\u4F7F\u7528\uFF0CDAO \u4E2D\u5305\u542B\u4E86\u5404\u79CD\u6570\u636E\u5E93\u7684\u64CD\u4F5C\u65B9\u6CD5\uFF0C\u901A\u8FC7\u5B83\u7684\u65B9\u6CD5\uFF0C\u7ED3\u5408 PO \u5BF9\u6570\u636E\u5E93\u8FDB\u884C\u76F8\u5173\u64CD\u4F5C\uFF0C\u5939\u5728\u4E1A\u52A1\u903B\u8F91\u4E0E\u6570\u636E\u5E93\u8D44\u6E90\u4E2D\u95F4\uFF0C\u914D\u5408VO \u63D0\u4F9B\u6570\u636E\u5E93\u7684 CRUD \u529F\u80FD</p><h2 id="_11-1-\u89C4\u683C\u53C2\u6570\u65B0\u589E\u4E0Evo" tabindex="-1"><a class="header-anchor" href="#_11-1-\u89C4\u683C\u53C2\u6570\u65B0\u589E\u4E0Evo" aria-hidden="true">#</a> 11.1 \u89C4\u683C\u53C2\u6570\u65B0\u589E\u4E0EVO</h2><h3 id="_11-1-1-\u83B7\u53D6\u5206\u7C7B\u89C4\u683C\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_11-1-1-\u83B7\u53D6\u5206\u7C7B\u89C4\u683C\u53C2\u6570" aria-hidden="true">#</a> 11.1.1 \u83B7\u53D6\u5206\u7C7B\u89C4\u683C\u53C2\u6570</h3><p><strong>\u5177\u4F53\u9700\u6C42\uFF1A</strong></p><p>\u67E5\u8BE2\u7684\u6570\u636E\u6CA1\u6709\u5206\u7C7B\u548C\u5206\u7EC4</p><p><img src="http://qnimg.gisfsde.com/work/image-20201021051239049.png" alt="image-20201021051239049" loading="lazy"></p><p>\u5C5E\u6027\u5206\u7C7B \u548C \u6240\u5C5E\u5206\u7EC4\u5C45\u7136\u6CA1\u6709\u6570\u636E\uFF1F</p><p>\u5148\u67E5\u770B\u8FD4\u56DE\u7684\u6570\u636E</p><p><img src="http://qnimg.gisfsde.com/work/image-20201021051433485.png" alt="image-20201021051433485" loading="lazy"></p><p>\u53D1\u73B0\u6CA1\u6709 catelogName \u548C AttrGroupName \u7684\u6570\u636E\uFF01\uFF01 \u539F\u56E0\u662F AttrEntity\u6CA1\u6709\u8FD9\u4E24\u4E2A\u5C5E\u6027</p><p><img src="http://qnimg.gisfsde.com/work/image-20201021051653178.png" alt="image-20201021051653178" loading="lazy"></p><p>\u4F46\u662F\u4ED6\u5173\u8054\u4E86 pms_attr_attrgroup_relation \u8868 \u8FD9\u4E2A\u8868\u91CC\u9762\u6709 attr_Group_id \u90A3\u4E48\u601D\u8DEF\u6765\u4E86\uFF1F</p><p>1\u3001\u6211\u5148\u7528 attr_id \u53BB pms_attr_attrgroup_relation\u4E2D\u67E5\u8BE2\u51FA attr_Group_id \u7136\u540E\u901A\u8FC7 attr_Group_id\u53BBpms_attr_group \u8868\u4E2D\u67E5\u8BE2\u51FA \u5206\u7EC4\u7684\u540D\u79F0</p><p>2\u3001\u81EA\u8EAB attr\u8868\u4E2D\u6709 catelog_id \u90A3\u6211\u6839\u636E\u8FD9\u4E2Aid\u53BB category\u8868\u4E2D\u67E5\u8BE2\u5230 \u5206\u7C7B\u7684\u59D3\u540D \u4E0D\u5C31\u884C\u4E86\u5417\uFF1F</p><p>\u4E0A\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryBaseAttrPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>catelogId <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>wrapper1<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            wrapper1<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            wrapper
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PageUtils</span> pageUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u62FF\u5230\u5206\u9875\u8BB0\u5F55</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrRespVo</span><span class="token punctuation">&gt;</span></span> respVo <span class="token operator">=</span> records<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

        <span class="token class-name">AttrRespVo</span> attrRespVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrRespVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">,</span> attrRespVo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 1\u3001\u8BBE\u7F6E\u5206\u7C7B\u548C\u5206\u7EC4\u7684\u540D\u5B57</span>
        <span class="token class-name">AttrAttrgroupRelationEntity</span> attr_idEntity <span class="token operator">=</span> relationDao<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attrEntity<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>attr_idEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">AttrGroupEntity</span> attrGroupEntity <span class="token operator">=</span> attrGroupDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>attr_idEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            attrRespVo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>attrGroupEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">CategoryEntity</span> categoryEntity <span class="token operator">=</span> categoryDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">.</span><span class="token function">getCatelogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>categoryEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            attrRespVo<span class="token punctuation">.</span><span class="token function">setCatelogName</span><span class="token punctuation">(</span>categoryEntity<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> attrRespVo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    pageUtils<span class="token punctuation">.</span><span class="token function">setList</span><span class="token punctuation">(</span>respVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pageUtils<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F46\u662F\u539F\u5148\u7684 AttrEntity \u5BF9\u8C61\u91CC\u9762\u4EFB\u7136\u6CA1\u6709\u8FD9\u4E24\u4E2A\u5C5E\u6027 ! \u600E\u4E48\u89E3\u51B3</p><p>1\u3001\u6211\u76F4\u63A5\u5728 AttrEntity\u4E2D\u65B0\u5EFA\u5BF9\u5E94\u7684\u5B57\u6BB5\u4E0D\u5C31\u884C\u4E86\u5417\uFF1F \u7136\u540E\u8BBE\u7F6E\u6210\u4E0D\u662F\u6570\u636E\u5E93\u7684\u5B57\u6BB5</p><p>\u7F3A\u70B9\uFF1A<strong>\u8FD9\u6837\u5B50\u662F\u4E0D\u662F\u592A\u4E71\u4E86\uFF1F</strong></p><p>2\u3001\u65B0\u5EFA\u4E00\u4E2A VO \u62BD\u53D6\u51FA\u8FD9\u4E24\u4E2A\u5C5E\u6027 \u4E0D\u5C31\u884C\u4E86\u5417\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AttrRespVo</span> <span class="token keyword">extends</span> <span class="token class-name">AttrVo</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * catelogName \u624B\u673A\u6570\u7801\uFF0C\u6240\u5C5E\u5206\u7C7B\u540D\u5B57
     * groupName \u4E3B\u4F53 \u6240\u5C5E\u5206\u7EC4\u540D\u5B57
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> catelogName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> groupName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-2-\u89C4\u683C\u53C2\u6570\u5217\u8868-\u89C4\u683C\u4FEE\u6539" tabindex="-1"><a class="header-anchor" href="#_11-2-\u89C4\u683C\u53C2\u6570\u5217\u8868-\u89C4\u683C\u4FEE\u6539" aria-hidden="true">#</a> 11.2 \u89C4\u683C\u53C2\u6570\u5217\u8868&amp;\u89C4\u683C\u4FEE\u6539</h2><h4 id="_11-2-1\u3001\u83B7\u53D6\u5206\u7C7B\u89C4\u683C\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_11-2-1\u3001\u83B7\u53D6\u5206\u7C7B\u89C4\u683C\u53C2\u6570" aria-hidden="true">#</a> 11.2.1\u3001\u83B7\u53D6\u5206\u7C7B\u89C4\u683C\u53C2\u6570</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u83B7\u53D6\u5206\u7C7B\u89C4\u683C\u53C2\u6570
 	attrType \u548C catelogId \u901A\u7528
 * <span class="token keyword">@param</span> <span class="token parameter">params</span> 
 * <span class="token keyword">@param</span> <span class="token parameter">catelogId</span>
 * <span class="token keyword">@param</span> <span class="token parameter">type</span>  sale \u9500\u552E\u5C5E\u6027 base \u89C4\u683C\u53C2\u6570
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{attrType}/list/{catelogId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">baseAttrList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params
        <span class="token punctuation">,</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;catelogId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">,</span>
                      <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;attrType&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span>  type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">queryBaseAttrPage</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span>catelogId<span class="token punctuation">,</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B9E\u73B0\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryBaseAttrPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5148\u6839\u636E attr_type\u5B57\u6BB5\u8FDB\u884C\u67E5\u8BE2 \u8BE5\u5B57\u6BB5\u8868\u793A 1\u662F\u57FA\u672C\u5C5E\u6027 0\u662F\u9500\u552E\u5C5E\u6027\uFF0C\u57FA\u672C\u5C5E\u6027\u548C\u9500\u552E\u5C5E\u6027\u6211\u4EEC\u653E\u5728\u4E00\u5F20\u8868\u5185</span>
        <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;base&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token operator">?</span>
                        <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span>ATTR_TYPE_BASE<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
                        <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span>ATTR_TYPE_SALE<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5206\u7C7Bid\u4E0D\u7B49\u4E8E0 \u6309\u7167\u5206\u7C7Bid\u8FDB\u884C\u67E5\u8BE2</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>catelogId <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u53D6\u51FA\u53C2\u6570 key,\u8FDB\u884C\u6761\u4EF6\u67E5\u8BE2</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>wrapper1<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                wrapper1<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u5C01\u88C5\u5206\u9875\u6570\u636E</span>
        <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
                wrapper
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PageUtils</span> pageUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u62FF\u5230\u5168\u90E8\u7684\u5206\u9875\u8BB0\u5F55</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u67E5\u8BE2\u6240\u5C5E\u5206\u7C7B\u4EE5\u53CA\u6240\u5C5E\u5206\u7EC4</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrRespVo</span><span class="token punctuation">&gt;</span></span> respVo <span class="token operator">=</span> records<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5B9E\u4F8B\u5316\u6570\u636E\u4F20\u8F93\u5BF9\u8C61 \u5C06 attrEntity\u7684\u5206\u7C7B\u540D\u5B57\u4EE5\u53CA\u5206\u7EC4\u540D\u5B57 \u590D\u5236\u5230\u8BE5\u5BF9\u8C61</span>
            <span class="token class-name">AttrRespVo</span> attrRespVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrRespVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">,</span> attrRespVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Controller\u5730\u5740\u5982\u679C\u662F \u57FA\u7840 \u624D\u8FDB\u884C\u67E5\u8BE2\u5206\u88C2</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;base&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 1\u3001\u6839\u636Eattr_id \u67E5\u8BE2\u5230 attr\u548C attrGroup\u7684\u5173\u7CFB\u8868</span>
                <span class="token class-name">AttrAttrgroupRelationEntity</span> attr_idEntity <span class="token operator">=</span> relationDao<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attrEntity<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u67E5\u8BE2\u5230\u7684\u5173\u7CFB\u5BF9\u8C61\u4EE5\u53CA\u5206\u7EC4id\u4E0D\u4E3A\u7A7A</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>attr_idEntity <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> attr_idEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u6839\u636E\u5206\u7EC4id\u67E5\u8BE2\u5230\u5206\u7EC4\u4FE1\u606F</span>
                    <span class="token class-name">AttrGroupEntity</span> attrGroupEntity <span class="token operator">=</span> attrGroupDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>attr_idEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    attrRespVo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>attrGroupEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// \u6839\u636EattrEntity\u7684\u5206\u7C7Bid \u67E5\u8BE2\u5230\u5206\u7C7B\u5BF9\u8C61\u5E76\u8BBE\u7F6E\u5206\u7C7B\u59D3\u540D</span>
            <span class="token class-name">CategoryEntity</span> categoryEntity <span class="token operator">=</span> categoryDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">.</span><span class="token function">getCatelogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>categoryEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                attrRespVo<span class="token punctuation">.</span><span class="token function">setCatelogName</span><span class="token punctuation">(</span>categoryEntity<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> attrRespVo<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5C01\u88C5\u5230\u5206\u9875\u5DE5\u5177\u7C7B</span>
        pageUtils<span class="token punctuation">.</span><span class="token function">setList</span><span class="token punctuation">(</span>respVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> pageUtils<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5148\u662F\u6839\u636E <code>catelog_id</code>\u67E5\u8BE2\u5230<code>AttrEntity</code> \u5BF9\u8C61 \u8BE5\u5BF9\u8C61\u91CC\u62E5\u6709 <code>attr_id</code> \u7136\u540E\u6839\u636Eattr_id \u53BB <code>pms_attr_attrgroup_relation</code>\u8868\u8FDB\u884C\u67E5\u8BE2</p><h4 id="_11-2-2\u3001\u67E5\u8BE2\u5C5E\u6027\u8BE6\u60C5" tabindex="-1"><a class="header-anchor" href="#_11-2-2\u3001\u67E5\u8BE2\u5C5E\u6027\u8BE6\u60C5" aria-hidden="true">#</a> 11.2.2\u3001\u67E5\u8BE2\u5C5E\u6027\u8BE6\u60C5</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201022154745658.png" alt="image-20201022154745658" loading="lazy"></p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
   * \u4FE1\u606F
   */</span>
  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/info/{attrId}&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;attrId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> attrId<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token class-name">AttrRespVo</span> attr <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getAttrInfo</span><span class="token punctuation">(</span>attrId<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;attr&quot;</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service \u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">AttrRespVo</span> <span class="token function">getAttrInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> attrId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5B9E\u4F8B\u5316\u5C01\u88C5VO\u6570\u636E\u5BF9\u8C61</span>
    <span class="token class-name">AttrRespVo</span> attrRespVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrRespVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u6839\u636Eattrid\u67E5\u8BE2\u51FA\u5546\u54C1\u5C5E\u6027</span>
    <span class="token class-name">AttrEntity</span> attrEntity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>attrId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5C06\u5546\u54C1\u5C5E\u6027\u5BF9\u8C61\u7684\u5C5E\u6027\u590D\u5236\u5230 VO\u6570\u636E\u5BF9\u8C61</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">,</span> attrRespVo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//  attrType == 1\u4E3A\u57FA\u672C\u7C7B\u578B\u624D\u8FDB\u884C\u67E5\u8BE2\u5206\u7EC4\u4FE1\u606F</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>attrEntity<span class="token punctuation">.</span><span class="token function">getAttrType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span>ATTR_TYPE_BASE<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6839\u636E attr_id \u67E5\u8BE2\u5230 \u5546\u54C1\u5C5E\u6027\u4EE5\u53CA\u5546\u54C1\u5206\u7EC4\u5173\u7CFB\u8868</span>
        <span class="token class-name">AttrAttrgroupRelationEntity</span> relationEntity <span class="token operator">=</span> relationDao<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attrId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>relationEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u8BBE\u7F6E\u5206\u7EC4id</span>
            attrRespVo<span class="token punctuation">.</span><span class="token function">setAttrGroupId</span><span class="token punctuation">(</span>relationEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u5206\u7EC4&amp;\u5546\u54C1\u4FE1\u606F\u5173\u7CFB\u8868\u62FF\u5230\u5206\u7EC4id \u67E5\u8BE2\u5230\u5206\u7EC4\u5BF9\u8C61</span>
            <span class="token class-name">AttrGroupEntity</span> attrGroupEntity <span class="token operator">=</span> attrGroupDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>relationEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>attrGroupEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u4E0D\u4E3A\u7A7A\u8BBE\u7F6E\u5206\u7EC4\u59D3\u540D</span>
                attrRespVo<span class="token punctuation">.</span><span class="token function">setGroupName</span><span class="token punctuation">(</span>attrGroupEntity<span class="token punctuation">.</span><span class="token function">getAttrGroupName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u4ECE\u5F53\u524D\u5546\u54C1\u5C5E\u6027\u5BF9\u8C61\u4E2D\u62FF\u5230\u5206\u7C7Bid\u8FDB\u884C\u8BBE\u7F6E\u5206\u7C7B\u4FE1\u606F</span>
    <span class="token class-name">Long</span> catelogId <span class="token operator">=</span> attrEntity<span class="token punctuation">.</span><span class="token function">getCatelogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u6839\u636E catelogId \u67E5\u8BE2\u5230\u5206\u7C7B \u7236 \u5B50 \u5B59 \u8DEF\u5F84</span>
    <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> catelogPath <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">findCatelogPath</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    attrRespVo<span class="token punctuation">.</span><span class="token function">setCatelogPath</span><span class="token punctuation">(</span>catelogPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u6700\u540E\u6839\u636E\u5206\u7C7Bid \u67E5\u8BE2\u5230\u5206\u7C7B\u5BF9\u8C61 \u5E76\u8FDB\u884C\u8BBE\u7F6E\u5206\u7C7B\u59D3\u540D</span>
    <span class="token class-name">CategoryEntity</span> categoryEntity <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>categoryEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        attrRespVo<span class="token punctuation">.</span><span class="token function">setCatelogName</span><span class="token punctuation">(</span>categoryEntity<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> attrRespVo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3B\u8981\u7406\u89E3\uFF1A \u5148\u662F\u6839\u636E <code>attrId</code> \u67E5\u8BE2\u5230<strong>\u5546\u54C1\u5C5E\u6027</strong> \u7136\u540E\u6839\u636E attrId \u67E5\u8BE2\u5230<strong>\u5206\u7C7B\u5173\u7CFB\u8868</strong> \u8BE5\u8868\u4E2D\u6709\u5206\u7EC4id attrGroup_id \u901A\u8FC7\u8FD9\u4E2A\u67E5\u8BE2\u5230 <strong>\u5206\u7EC4\u5BF9\u8C61\u4FE1\u606F</strong>\uFF0C</p><p>\uFF0C\u540C\u65F6\u5728 \u5546\u54C1\u5C5E\u6027\u8868\u4E2D\u62FF\u5230 \u5206\u7C7Bid \u901A\u8FC7<strong>\u5206\u7C7Bid \u67E5\u8BE2\u5230 \u67E5\u8BE2\u5230\u5206\u7C7B\u5BF9\u8C61</strong> \u540C\u65F6\u6839\u636E \u5206\u7C7Bid\u67E5\u8BE2\u5BF9\u5E94\u5C42\u7EA7\u5173\u7CFB\uFF0C\u5E76\u8BBE\u7F6E<strong>\u5206\u7C7B\u59D3\u540D</strong></p><h4 id="_11-3-3\u3001\u9500\u552E\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#_11-3-3\u3001\u9500\u552E\u5C5E\u6027" aria-hidden="true">#</a> 11.3.3\u3001\u9500\u552E\u5C5E\u6027</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201022155557579.png" alt="image-20201022155557579" loading="lazy"></p><p>\u9500\u552E\u5C5E\u6027 \u548C \u57FA\u672C\u5C5E\u6027 \u901A\u8FC7\u4E00\u4E2A\u5B57\u6BB5\u6765\u533A\u5206\uFF0C\u5BF9\u5E94\u7684\u4FEE\u6539\uFF0C\u67E5\u8BE2 \u90FD\u7528\u7684\u540C\u4E00\u4E2A\u65B9\u6CD5\uFF0C\u6240\u4EE5\u5728\u65B9\u6CD5\u7684\u4E2D \u4E5F\u8FDB\u884C\u4E86\u5BF9\u5E94\u7684\u5224\u65AD</p><p>\u4FDD\u5B58</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAttr</span><span class="token punctuation">(</span><span class="token class-name">AttrVo</span> attr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AttrEntity</span> attrEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>attr<span class="token punctuation">,</span> attrEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u4FDD\u5B58\u57FA\u672C\u6570\u636E</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2\u3001\u4FDD\u5B58\u5173\u8054\u5173\u7CFB</span>
    <span class="token comment">// \u7B49\u4E8E1 \u8BF4\u660E\u57FA\u672C\u5C5E\u6027 \u624D\u8FDB\u884C\u4FDD\u5B58\u5206\u7EC4\u5173\u7CFB</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span>ATTR_TYPE_BASE<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> attr<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AttrAttrgroupRelationEntity</span> relationEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        relationEntity<span class="token punctuation">.</span><span class="token function">setAttrGroupId</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        relationEntity<span class="token punctuation">.</span><span class="token function">setAttrId</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        relationDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>relationEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4FEE\u6539</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Transactional</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateAttr</span><span class="token punctuation">(</span><span class="token class-name">AttrVo</span> attr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Vo\u6570\u636E\u4F20\u8F93\u5BF9\u8C61\u5C5E\u6027\u62F7\u8D1D\u5230 attrEntity\u5BF9\u8C61</span>
        <span class="token class-name">AttrEntity</span> attrEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>attr<span class="token punctuation">,</span> attrEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// attrType \u7B49\u4E8E 1 \u4E5F\u5C31\u662F\u57FA\u672C\u5C5E\u6027</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>attrEntity<span class="token punctuation">.</span><span class="token function">getAttrType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span>ATTR_TYPE_BASE<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//1\u3001\u4FEE\u6539\u5206\u7EC4\u5173\u8054</span>
            <span class="token class-name">AttrAttrgroupRelationEntity</span> relationEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8BBE\u7F6Eattrid \u4EE5\u53CA \u5206\u7EC4id</span>
            relationEntity<span class="token punctuation">.</span><span class="token function">setAttrId</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            relationEntity<span class="token punctuation">.</span><span class="token function">setAttrGroupId</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u5173\u7CFB\u8868\u4E2D\u6839\u636Eattr_id \u8FDB\u884C\u66F4\u65B0</span>
            relationDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>relationEntity<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                    <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u6839\u636E attr_id \u662F\u5426\u53EF\u4EE5\u67E5\u8BE2\u5230\u7ED3\u679C</span>
            <span class="token class-name">Integer</span> count <span class="token operator">=</span> relationDao<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                    <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// \u67E5\u5F97\u5230</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u8FDB\u884C\u66F4\u65B0</span>
                relationDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>relationEntity<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u67E5\u4E0D\u5230\u610F\u5473\u7740 \u6CA1\u6709\u8BE5\u8BB0\u5F55 \u5219\u8FDB\u884C\u63D2\u5165</span>
                relationDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>relationEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-3-\u67E5\u8BE2\u5206\u7C7B\u5173\u8054\u5C5E\u6027-\u5220\u9664\u5173\u8054-\u67E5\u8BE2\u5206\u7EC4\u672A\u5173\u8054\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#_11-3-\u67E5\u8BE2\u5206\u7C7B\u5173\u8054\u5C5E\u6027-\u5220\u9664\u5173\u8054-\u67E5\u8BE2\u5206\u7EC4\u672A\u5173\u8054\u5C5E\u6027" aria-hidden="true">#</a> 11.3 \u67E5\u8BE2\u5206\u7C7B\u5173\u8054\u5C5E\u6027&amp;\u5220\u9664\u5173\u8054&amp;\u67E5\u8BE2\u5206\u7EC4\u672A\u5173\u8054\u5C5E\u6027</h2><h4 id="_11-3-1\u3001\u83B7\u53D6\u5C5E\u6027\u5206\u7EC4\u7684\u5173\u8054\u7684\u6240\u6709\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#_11-3-1\u3001\u83B7\u53D6\u5C5E\u6027\u5206\u7EC4\u7684\u5173\u8054\u7684\u6240\u6709\u5C5E\u6027" aria-hidden="true">#</a> 11.3.1\u3001\u83B7\u53D6\u5C5E\u6027\u5206\u7EC4\u7684\u5173\u8054\u7684\u6240\u6709\u5C5E\u6027</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u83B7\u53D6\u5C5E\u6027\u5206\u7EC4\u7684\u5173\u8054\u7684\u6240\u6709\u5C5E\u6027
 * <span class="token keyword">@param</span> <span class="token parameter">attrgroupId</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{attrgroupId}/attr/relation&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">attrRelation</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;attrgroupId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> attrgroupId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> entityList <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getRelationAttr</span><span class="token punctuation">(</span>attrgroupId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> entityList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service \u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6839\u636E\u5206\u7EC4id\u67E5\u627E\u5173\u8054\u7684\u6240\u6709\u57FA\u672C\u5C5E\u6027
 * <span class="token keyword">@param</span> <span class="token parameter">attrgroupId</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRelationAttr</span><span class="token punctuation">(</span><span class="token class-name">Long</span> attrgroupId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6839\u636Eattr_group_id \u67E5\u8BE2\u5230 \u5173\u7CFB\u8868</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span> entities <span class="token operator">=</span> relationDao<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_group_id&quot;</span><span class="token punctuation">,</span> attrgroupId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u4ECE\u5173\u7CFB\u8868\u4E2D \u53D6\u5230 \u5C5E\u6027id</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> attrIds <span class="token operator">=</span> entities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>attrIds <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> attrIds<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u6309\u7167\u5C5E\u6027id\u8FDB\u884C\u67E5\u8BE2</span>
    <span class="token class-name">Collection</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> attrEntities <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listByIds</span><span class="token punctuation">(</span>attrIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> attrEntities<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://qnimg.gisfsde.com/work/image-20201022161654834.png" alt="image-20201022161654834" loading="lazy"></p><p>\u5DF2\u77E5\u6709\u53C2\u6570 attr_group_id \u8FDB\u884C\u67E5\u8BE2 \u80FD\u67E5\u5230 attr_id,\u5728\u5229\u7528 attr_id \u67E5\u8BE2\u5230 attr\u76F8\u5173\u4FE1\u606F</p><h4 id="_11-3-2\u3001\u5220\u9664\u5C5E\u6027\u4E0E\u5206\u7EC4\u7684\u5173\u8054\u5173\u7CFB" tabindex="-1"><a class="header-anchor" href="#_11-3-2\u3001\u5220\u9664\u5C5E\u6027\u4E0E\u5206\u7EC4\u7684\u5173\u8054\u5173\u7CFB" aria-hidden="true">#</a> 11.3.2\u3001\u5220\u9664\u5C5E\u6027\u4E0E\u5206\u7EC4\u7684\u5173\u8054\u5173\u7CFB</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201022162103501.png" alt="image-20201022162103501" loading="lazy"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5220\u9664\u5C5E\u6027\u4E0E\u5206\u7EC4\u7684\u5173\u8054\u5173\u7CFB
 * <span class="token keyword">@param</span> <span class="token parameter">relationVo</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/attr/relation/delete&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">deleteRelation</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">AttrGroupRelationVo</span><span class="token punctuation">[</span><span class="token punctuation">]</span> relationVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    attrService<span class="token punctuation">.</span><span class="token function">deleteRelation</span><span class="token punctuation">(</span>relationVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service \u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteRelation</span><span class="token punctuation">(</span><span class="token class-name">AttrGroupRelationVo</span><span class="token punctuation">[</span><span class="token punctuation">]</span> relationVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// \u8F6C\u6210 list \u8FDB\u884Cstream\u6D41\u5904\u7406</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span> entities <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>relationVo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5C06 item\u5BF9\u5E94\u5C5E\u6027\u62F7\u8D1D\u5230 relationEntity\u5BF9\u8C61\u4E2D</span>
            <span class="token class-name">AttrAttrgroupRelationEntity</span> relationEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> relationEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> relationEntity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// id\u6279\u91CF\u5220\u9664</span>
        relationDao<span class="token punctuation">.</span><span class="token function">deleteBatchRelation</span><span class="token punctuation">(</span>entities<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>deleteBatchRelation \u65B9\u6CD5</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>deleteBatchRelation<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    DELETE FROM \`pms_attr_attrgroup_relation\` WHERE 
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!-</span> <span class="token attr-name">\u5FAA\u73AF\u904D\u5386\u8FDB\u884C\u5220\u9664</span> <span class="token attr-name">\u4F7F\u7528\u7684\u662F</span> <span class="token attr-name">or--</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>entities<span class="token punctuation">&quot;</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span> OR <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        ( attr_id=#{item.attrId} AND attr_group_id=#{item.attrGroupId} )
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_11-3-3\u3001\u67E5\u8BE2\u5206\u7EC4\u672A\u5173\u8054\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#_11-3-3\u3001\u67E5\u8BE2\u5206\u7EC4\u672A\u5173\u8054\u5C5E\u6027" aria-hidden="true">#</a> 11.3.3\u3001\u67E5\u8BE2\u5206\u7EC4\u672A\u5173\u8054\u5C5E\u6027</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{attrgroupId}/noattr/relation&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">attrNoRelation</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;attrgroupId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> attrgroupId<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getNoRelationAttr</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span>attrgroupId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">getNoRelationAttr</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">,</span> <span class="token class-name">Long</span> attrgroupId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1\u3001\u5F53\u524D\u5206\u7EC4\u53EA\u80FD\u5173\u8054\u81EA\u5DF1\u6240\u5C5E\u5206\u7C7B\u91CC\u9762\u7684\u6240\u6709\u5C5E\u6027</span>
    <span class="token class-name">AttrGroupEntity</span> attrGroupEntity <span class="token operator">=</span> attrGroupDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>attrgroupId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> catelogId <span class="token operator">=</span> attrGroupEntity<span class="token punctuation">.</span><span class="token function">getCatelogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//2\u3001\u5F53\u524D\u5206\u7EC4\u53EA\u80FD\u5173\u8054\u522B\u7684\u5206\u7EC4\u6CA1\u6709\u5F15\u7528\u7684\u5C5E\u6027</span>
    <span class="token comment">//2.1 \u5F53\u524D\u5206\u7C7B\u4E0B\u7684 **\u5176\u4ED6\u5206\u7EC4** \u6839\u636E\u5206\u7C7Bid\u8FDB\u884C\u67E5\u8BE2</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span> group <span class="token operator">=</span> attrGroupDao<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u62FF\u5230\u5206\u7EC4id</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//2.2 \u8FD9\u4E9B\u5206\u7EC4\u5173\u8054\u7684\u5C5E\u6027  \u6839\u636E\u5206\u7EC4id\u67E5\u8BE2\u51FA\u5173\u8054\u8868</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span> groupId <span class="token operator">=</span> relationDao<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token string">&quot;attr_group_id&quot;</span><span class="token punctuation">,</span> collect<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u62FF\u5230\u6240\u6709\u7684\u5C5E\u6027id</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> attrIds <span class="token operator">=</span> groupId<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//2.3 \u4ECE\u5F53\u524D\u5206\u7C7B\u7684\u6240\u6709\u5C5E\u6027\u4E2D\u79FB\u9664\u8FD9\u4E9B\u5C5E\u6027</span>
    <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_type&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>AttrEnum</span><span class="token punctuation">.</span>ATTR_TYPE_BASE<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// attrIds \u5C5E\u6027id\u6570\u7EC4\u4E0D\u4E3A\u7A7A</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>attrIds <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> attrIds<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5728attrids \u6570\u7EC4\u4E2D\u5F97id\u4E0D\u7528\u8FDB\u884C\u67E5\u8BE2</span>
        wrapper<span class="token punctuation">.</span><span class="token function">notIn</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> attrIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u53D6\u51FA\u53C2\u6570\u8FDB\u884C \u5BF9\u5E94\u6761\u4EF6\u67E5\u8BE2</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u6839\u636E\u5206\u9875\u6570\u636E \u4EE5\u53CA wrapper\u8FDB\u884C\u67E5\u8BE2</span>
    <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span> wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PageUtils</span> pageUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pageUtils<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_11-4-4\u3001\u65B0\u589E\u5206\u7EC4\u4E0E\u5C5E\u6027\u5173\u8054" tabindex="-1"><a class="header-anchor" href="#_11-4-4\u3001\u65B0\u589E\u5206\u7EC4\u4E0E\u5C5E\u6027\u5173\u8054" aria-hidden="true">#</a> 11.4.4\u3001\u65B0\u589E\u5206\u7EC4\u4E0E\u5C5E\u6027\u5173\u8054</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/attr/relation&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span>  <span class="token class-name">R</span> <span class="token function">addRelation</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupRelationVo</span><span class="token punctuation">&gt;</span></span> attrGroupRelationVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    attrAttrgroupRelationService<span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>attrGroupRelationVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveBatch</span><span class="token punctuation">(</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupRelationVo</span><span class="token punctuation">&gt;</span></span> attrGroupRelationVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> attrGroupRelationVo<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u590D\u5236\u5C5E\u6027 \u8FD4\u56DE</span>
        <span class="token class-name">AttrAttrgroupRelationEntity</span> relationEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrAttrgroupRelationEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> relationEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> relationEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E1A\u52A1\u4E4B\u95F4\u9700\u8981\u591A\u79CD\u6D4B\u8BD5 \u5404\u79CD\u5224\u65AD</p><h1 id="\u5341\u3001\u5546\u54C1\u670D\u52A1-\u65B0\u589E\u5546\u54C1" tabindex="-1"><a class="header-anchor" href="#\u5341\u3001\u5546\u54C1\u670D\u52A1-\u65B0\u589E\u5546\u54C1" aria-hidden="true">#</a> \u5341\u3001\u5546\u54C1\u670D\u52A1&amp;\u65B0\u589E\u5546\u54C1</h1><h2 id="_12-1-\u83B7\u53D6\u5206\u7C7B\u5173\u8054\u7684\u54C1\u724C" tabindex="-1"><a class="header-anchor" href="#_12-1-\u83B7\u53D6\u5206\u7C7B\u5173\u8054\u7684\u54C1\u724C" aria-hidden="true">#</a> 12.1 \u83B7\u53D6\u5206\u7C7B\u5173\u8054\u7684\u54C1\u724C</h2><p>\u524D\u7AEF\u53D1\u9001\u8BF7\u6C42</p><p>\u540E\u7AEF\u7F16\u5199\uFF1A</p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *  \u83B7\u53D6\u5206\u7C7B\u5173\u8054\u7684\u54C1\u724C
 * <span class="token keyword">@param</span> <span class="token parameter">catId</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/brands/list&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">relationBrandList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;catId&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> catId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandEntity</span><span class="token punctuation">&gt;</span></span> vos <span class="token operator">=</span> categoryBrandRelationService<span class="token punctuation">.</span><span class="token function">getBrandCatId</span><span class="token punctuation">(</span>catId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u62FF\u5230 \u54C1\u724C\u5BF9\u8C61\u6570\u636E\u540E \u4ECE\u4E2D\u62BD\u53D6\u9664 \u54C1\u724C\u59D3\u540D\u548Cid</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandVo</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> vos<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">BrandVo</span> brandVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrandVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        brandVo<span class="token punctuation">.</span><span class="token function">setBrandId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        brandVo<span class="token punctuation">.</span><span class="token function">setBrandName</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> brandVo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service\u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">getBrandCatId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> catId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6839\u636E\u5206\u7C7Bid\u67E5\u8BE2\u51FA \u5206\u7C7B\u548C\u54C1\u724C\u7684\u5173\u7CFB\u8868</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryBrandRelationEntity</span><span class="token punctuation">&gt;</span></span> catelogId <span class="token operator">=</span> categoryBrandRelationDao<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryBrandRelationEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> catelogId<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u6839\u636E\u54C1\u724Cid\u67E5\u8BE2\u51FA\u54C1\u724C\u5BF9\u8C61</span>
        <span class="token class-name">BrandEntity</span> brandEntity <span class="token operator">=</span> brandDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> brandEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> collect<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u603B\u7ED3\uFF1A</p></blockquote><p>\u4E1A\u52A1\u64CD\u4F5C\u8BBE\u8BA1\u4E24\u4E2A\u8868</p><ul><li>pms_brand</li><li>pms_category_brand_relation</li></ul><p>\u8BF7\u6C42\u53C2\u6570\u662F CatId Long\u7C7B\u578B</p><ul><li>\u5148\u6839\u636E CatId \u5728 pms_category_brand_relation\u8868\u4E2D\u67E5\u8BE2\u5230\u54C1\u724C Id</li><li>\u62FF\u5230 brand_id \u67E5\u8BE2\u51FA brand \u7684\u76F8\u5173\u4FE1\u606F</li><li>\u7EC4\u88C5\u6210 BrandVo \u540E \u8FD4\u56DE</li></ul><p><img src="http://qnimg.gisfsde.com/work/image-20201023052748618.png" alt="image-20201023052748618" loading="lazy"></p><h2 id="_12-2-\u83B7\u53D6\u5206\u7C7B\u4E0B\u6240\u6709\u5206\u7EC4\u4EE5\u53CA\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#_12-2-\u83B7\u53D6\u5206\u7C7B\u4E0B\u6240\u6709\u5206\u7EC4\u4EE5\u53CA\u5C5E\u6027" aria-hidden="true">#</a> 12.2 \u83B7\u53D6\u5206\u7C7B\u4E0B\u6240\u6709\u5206\u7EC4\u4EE5\u53CA\u5C5E\u6027</h2><p><img src="http://qnimg.gisfsde.com/work/image-20201023072959266.png" alt="image-20201023072959266" loading="lazy"></p><p>\u57FA\u672C\u4FE1\u606F\u8F93\u5165\u6210\u529F\u540E\uFF0C\u5C31\u4F1A\u8DF3\u8F6C\u5230\u89C4\u683C\u53C2\u6570\uFF0C</p><p>\u5E76\u6839\u636E\u5206\u7C7Bid\u67E5\u8BE2\u51FA\u5BF9\u5E94\u6570\u636E</p><p><img src="http://qnimg.gisfsde.com/work/image-20201023073041272.png" alt="image-20201023073041272" loading="lazy"></p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *  \u83B7\u53D6\u5206\u7C7B\u4E0B\u6240\u6709\u5206\u7EC4&amp;\u5173\u8054\u5C5E\u6027
 * <span class="token keyword">@param</span> <span class="token parameter">catelogId</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{catelogId}/withattr&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getAttrGroupWithAttrs</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;catelogId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span>   <span class="token punctuation">{</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupWithAttrsVo</span><span class="token punctuation">&gt;</span></span> vos <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getAttrGroupWithAttrsByCatelogId</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span>vos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service \u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupWithAttrsVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAttrGroupWithAttrsByCatelogId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> catelogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1\u3001\u6839\u636E\u5206\u7C7Bid\u67E5\u8BE2\u51FA \u67E5\u8BE2\u5206\u7EC4\u5173\u7CFB</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span> attrgroupEntites <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catelog_id&quot;</span><span class="token punctuation">,</span> catelogId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrGroupWithAttrsVo</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> attrgroupEntites<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>group <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">AttrGroupWithAttrsVo</span> attrsVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrGroupWithAttrsVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2\u3001\u5C06\u5206\u7EC4\u5C5E\u6027\u62F7\u8D1D\u5230 VO\u4E2D</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> attrsVo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3\u3001\u901A\u8FC7\u5206\u7EC4id\u67E5\u8BE2\u51FA \u5546\u54C1\u5C5E\u6027\u4FE1\u606F</span>
        <span class="token comment">// \u8C03\u7528 getRelationAttr\u65B9\u6CD5\u5148\u6839\u636E \u5206\u7EC4id\u53BB \u4E2D\u95F4\u5173\u7CFB\u8868\u67E5\u8BE2\u5230\u5546\u54C1\u5C5E\u6027id \u7136\u540E\u6839\u636E\u5546\u54C1\u5C5E\u6027id\u67E5\u8BE2\u5230\u5546\u54C1\u4FE1\u606F</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrEntity</span><span class="token punctuation">&gt;</span></span> relationAttr <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getRelationAttr</span><span class="token punctuation">(</span>attrsVo<span class="token punctuation">.</span><span class="token function">getAttrGroupId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        attrsVo<span class="token punctuation">.</span><span class="token function">setAttrs</span><span class="token punctuation">(</span>relationAttr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> attrsVo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> collect<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-3-\u5546\u54C1-vo-\u62BD\u53D6-\u5546\u54C1\u65B0\u589E\u4E1A\u52A1\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_12-3-\u5546\u54C1-vo-\u62BD\u53D6-\u5546\u54C1\u65B0\u589E\u4E1A\u52A1\u6D41\u7A0B" aria-hidden="true">#</a> 12.3 \u5546\u54C1 VO \u62BD\u53D6&amp;\u5546\u54C1\u65B0\u589E\u4E1A\u52A1\u6D41\u7A0B</h2><p>\u5546\u54C1\u5C5E\u6027\u3001\u9500\u552E\u5C5E\u6027\u3001\u89C4\u683C\u53C2\u6570\u3001\u57FA\u672C\u4FE1\u606F\u90FD\u586B\u597D\u4E86\u540E\u5C31\u4F1A\u751F\u6210\u4E00\u4E32 JSON</p><p><img src="http://qnimg.gisfsde.com/work/image-20201023080411308.png" alt="image-20201023080411308" loading="lazy"></p><p>\u6211\u4EEC\u5C06 json \u653E\u5230 json\u89E3\u6790\u7F51\u7AD9\u4E0A \u5E76\u751F\u6210\u5BF9\u5E94\u5F97\u5B9E\u4F53\u7C7B</p><p><img src="http://qnimg.gisfsde.com/work/image-20201023080500520.png" alt="image-20201023080500520" loading="lazy"></p><h3 id="_12-3-4-\u5C01\u88C5-vo-\u4E2D-\u66F4\u6539\u5BF9\u5E94\u5F97\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#_12-3-4-\u5C01\u88C5-vo-\u4E2D-\u66F4\u6539\u5BF9\u5E94\u5F97\u5C5E\u6027" aria-hidden="true">#</a> 12.3.4 \u5C01\u88C5 Vo \u4E2D\uFF0C\u66F4\u6539\u5BF9\u5E94\u5F97\u5C5E\u6027</h3><p><img src="http://qnimg.gisfsde.com/work/image-20201023081250886.png" alt="image-20201023081250886" loading="lazy"></p><p>\u6709\u4E9B\u53C2\u4E0E\u8BA1\u7B97\u7684\u5C5E\u6027 \u5982 int price \u5C06\u7C7B\u578B\u66F4\u6539\u4E3A BigDecimal</p><h3 id="_12-3-5-\u5206\u6790\u4E1A\u52A1\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_12-3-5-\u5206\u6790\u4E1A\u52A1\u6D41\u7A0B" aria-hidden="true">#</a> 12.3.5 \u5206\u6790\u4E1A\u52A1\u6D41\u7A0B</h3><blockquote><p>\u4E1A\u52A1\u6D41\u7A0B:</p></blockquote><p><img src="http://qnimg.gisfsde.com/work/image-20201024112115137.png" alt="image-20201024112115137" loading="lazy"></p><h3 id="_12-3-6-\u4E3B\u8981\u7F16\u7801" tabindex="-1"><a class="header-anchor" href="#_12-3-6-\u4E3B\u8981\u7F16\u7801" aria-hidden="true">#</a> 12.3.6 \u4E3B\u8981\u7F16\u7801\uFF01</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveSpuInfo</span><span class="token punctuation">(</span><span class="token class-name">SpuSaveVo</span> vo<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1\u3001\u4FDD\u5B58Spu\u57FA\u672C\u4FE1\u606F  pms_spu_info</span>
    <span class="token class-name">SpuInfoEntity</span> spuInfoEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpuInfoEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>vo<span class="token punctuation">,</span>spuInfoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    spuInfoEntity<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    spuInfoEntity<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveBaseSpuInfo</span><span class="token punctuation">(</span>spuInfoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2\u3001\u4FDD\u5B58Spu\u7684\u63CF\u8FF0\u4FE1\u606F  pms_spu_info_desc</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> decript <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getDecript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SpuInfoDescEntity</span> spuInfoDescEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpuInfoDescEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// SpuInfoEntity\u4FDD\u5B58\u5230\u53D6\u5F97 spuId \u8BBE\u7F6E\u5230 Desc\u4E2D</span>
    spuInfoDescEntity<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spuInfoEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u4EE5\u9017\u53F7\u6765\u62C6\u5206</span>
    spuInfoDescEntity<span class="token punctuation">.</span><span class="token function">setDecript</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span>decript<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    spuInfoDescService<span class="token punctuation">.</span><span class="token function">saveSpuInfoDesc</span><span class="token punctuation">(</span>spuInfoDescEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3\u3001\u4FDD\u5B58Spu\u7684\u56FE\u7247\u96C6 pms_spu_images</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> imageList <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getImages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    spuImagesService<span class="token punctuation">.</span><span class="token function">saveImages</span><span class="token punctuation">(</span>spuInfoEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>imageList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4\u3001\u4FDD\u5B58spu\u7684\u89C4\u683C\u53C2\u6570 pms_product_attr_value</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BaseAttrs</span><span class="token punctuation">&gt;</span></span> baseAttrs <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getBaseAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> baseAttrs<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>attr <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8BBE\u7F6E spu \u5C5E\u6027\u503C</span>
        <span class="token class-name">ProductAttrValueEntity</span> valueEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        valueEntity<span class="token punctuation">.</span><span class="token function">setAttrId</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AttrEntity</span> attrEntity <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        valueEntity<span class="token punctuation">.</span><span class="token function">setAttrName</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">.</span><span class="token function">getAttrName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        valueEntity<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spuInfoEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        valueEntity<span class="token punctuation">.</span><span class="token function">setQuickShow</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getShowDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        valueEntity<span class="token punctuation">.</span><span class="token function">setAttrValue</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span><span class="token function">getAttrValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> valueEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    attrValueService<span class="token punctuation">.</span><span class="token function">saveProductAttr</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 5\u3001\u4FDD\u5B58SPU\u7684\u79EF\u5206\u4FE1\u606F gulimall_sms sms =&gt; sms_spu_bounds</span>
    <span class="token class-name">Bounds</span> bounds <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SpuBoundTo</span> spuBoundTo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpuBoundTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>bounds<span class="token punctuation">,</span>spuBoundTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    spuBoundTo<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spuInfoEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u8FDC\u7A0B\u670D\u52A1\u8C03\u7528</span>
    <span class="token class-name">R</span> r <span class="token operator">=</span> couponFeignService<span class="token punctuation">.</span><span class="token function">saveSpuBounds</span><span class="token punctuation">(</span>spuBoundTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FDC\u7A0B\u4FDD\u5B58\u4F18\u60E0\u4FE1\u606F\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// 5\u3001\u4FDD\u5B58\u5F53\u524DSpu\u5BF9\u5E94\u7684\u6240\u6709SKU\u4FE1\u606F</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Skus</span><span class="token punctuation">&gt;</span></span> skus <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getSkus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>skus <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> skus<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u904D\u5386 skus \u96C6\u5408</span>
        skus<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> defaultImage <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">// \u904D\u5386 skus \u96C6\u5408\u4E2D\u7684\u56FE\u7247 </span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Images</span> image <span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token function">getImages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u9ED8\u8BA4\u56FE\u7247\u7B49\u4E8E 1 \u8BE5\u8BB0\u5F55\u5219\u662F\u9ED8\u8BA4\u56FE\u7247</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">getDefaultImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    defaultImage <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">getImgUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// private String skuName;</span>
            <span class="token comment">//    private String price;</span>
            <span class="token comment">//    private String skuTitle;</span>
            <span class="token comment">//    private String skuSubtitle;</span>
            <span class="token comment">// \u53EA\u6709\u4E0A\u97624\u4E2A\u5C5E\u6027\u76F8\u540C</span>
            <span class="token class-name">SkuInfoEntity</span> skuInfoEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuInfoEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>skuInfoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u5176\u4ED6\u5C5E\u6027\u9700\u8981\u81EA\u5DF1\u8D4B\u503C</span>
            skuInfoEntity<span class="token punctuation">.</span><span class="token function">setBrandId</span><span class="token punctuation">(</span>spuInfoEntity<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuInfoEntity<span class="token punctuation">.</span><span class="token function">setCatalogId</span><span class="token punctuation">(</span>spuInfoEntity<span class="token punctuation">.</span><span class="token function">getCatalogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuInfoEntity<span class="token punctuation">.</span><span class="token function">setSaleCount</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuInfoEntity<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spuInfoDescEntity<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuInfoEntity<span class="token punctuation">.</span><span class="token function">setSkuDefaultImg</span><span class="token punctuation">(</span>defaultImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//5.1\u3001SKU\u7684\u57FA\u672C\u4FE1\u606F pms_sku_info</span>
            skuInfoService<span class="token punctuation">.</span><span class="token function">saveSkuInfo</span><span class="token punctuation">(</span>skuInfoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Long</span> skuId <span class="token operator">=</span> skuInfoEntity<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// \u4FDD\u5B58 sku \u56FE\u7247\u4FE1\u606F</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuImagesEntity</span><span class="token punctuation">&gt;</span></span> imagesEntities <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getImages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>img <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">SkuImagesEntity</span> skuImagesEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuImagesEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                skuImagesEntity<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                skuImagesEntity<span class="token punctuation">.</span><span class="token function">setImgUrl</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">getImgUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                skuImagesEntity<span class="token punctuation">.</span><span class="token function">setDefaultImg</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span><span class="token function">getDefaultImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> skuImagesEntity<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>entity <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">//\u8FD4\u56DE true \u9700\u8981 false \u8FC7\u6EE4</span>
                <span class="token keyword">return</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getImgUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// TODO \u6CA1\u6709\u56FE\u7247\u8DEF\u5F84\u7684\u65E0\u9700\u4FDD\u5B58</span>
            <span class="token comment">//5.2\u3001SKU\u7684\u56FE\u7247\u4FE1\u606F pms_sku_images</span>
            skuImagesService<span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>imagesEntities<span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Attr</span><span class="token punctuation">&gt;</span></span> attr <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u4FDD\u5B58 sku \u9500\u552E\u5C5E\u6027</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuSaleAttrValueEntity</span><span class="token punctuation">&gt;</span></span> skuSaleAttrValueEntities <span class="token operator">=</span> attr<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>a <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">SkuSaleAttrValueEntity</span> skuSaleAttrValueEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuSaleAttrValueEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> skuSaleAttrValueEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
                skuSaleAttrValueEntity<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> skuSaleAttrValueEntity<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//5.3\u3001SKU\u7684\u9500\u552E\u5C5E\u6027\u4FE1\u606F pms_sku_sale_attr_value</span>
            saleAttrValueService<span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>skuSaleAttrValueEntities<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//5.4\u3001SKU\u7684\u4F18\u60E0\u3001\u6EE1\u51CF\u7B49\u4FE1\u606F gulimall_sms -&gt;sms_sku_ladder \\sms_sku_full_reduction\\sms_member_price</span>

            <span class="token class-name">SkuReductionTo</span> skuReductionTo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuReductionTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>skuReductionTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuReductionTo<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">.</span><span class="token function">getFullCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> skuReductionTo<span class="token punctuation">.</span><span class="token function">getFullPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">R</span> r1 <span class="token operator">=</span> couponFeignService<span class="token punctuation">.</span><span class="token function">saveSkuReduction</span><span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>r1<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FDC\u7A0B\u4FDD\u5B58sku\u4F18\u60E0\u4FE1\u606F\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>saveImages</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveImages</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> imageList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>imageList <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> imageList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> \\<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\u56FE\u7247\u4E3A\u7A7A\uFF01\uFF01\uFF01\uFF01\uFF01\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuImagesEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> imageList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>img <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">SpuImagesEntity</span> entity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpuImagesEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8BBE\u7F6E\u4E3B\u8981\u5C5E\u6027 </span>
            entity<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            entity<span class="token punctuation">.</span><span class="token function">setImgUrl</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>collect <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FDC\u7A0B\u670D\u52A1\u8C03\u7528 \u5BF9\u5E94\u65B9\u6CD5</p><p>\u4FDD\u5B58\u4E86 <strong>\u5546\u54C1\u9636\u68AF\u4EF7\u683C</strong>\u3001<strong>\u5546\u54C1\u6EE1\u51CF\u4FE1\u606F</strong>\u3001<strong>\u5546\u54C1\u4F1A\u5458\u4EF7\u683C</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveSkuReduction</span><span class="token punctuation">(</span><span class="token class-name">SkuReductionTo</span> skuReductionTo<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//5.4\u3001SKU\u7684\u4F18\u60E0\u3001\u6EE1\u51CF\u7B49\u4FE1\u606F gulimall_sms -&gt;sms_sku_ladder \\sms_sku_full_reduction\\sms_member_price</span>

    <span class="token comment">//sms_sku_ladder</span>
    <span class="token class-name">SkuLadderEntity</span> skuLadderEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuLadderEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    skuLadderEntity<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    skuLadderEntity<span class="token punctuation">.</span><span class="token function">setFullCount</span><span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">.</span><span class="token function">getFullCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    skuLadderEntity<span class="token punctuation">.</span><span class="token function">setAddOther</span><span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">.</span><span class="token function">getCountStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    skuLadderEntity<span class="token punctuation">.</span><span class="token function">setDiscount</span><span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">.</span><span class="token function">getDiscount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>skuLadderEntity<span class="token punctuation">.</span><span class="token function">getFullCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        skuLadderService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>skuLadderEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//sms_sku_full_reduction</span>
    <span class="token class-name">SkuFullReductionEntity</span> skuFullReductionEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuFullReductionEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">,</span>skuFullReductionEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// BigDecimal \u7528 compareTo\u6765\u6BD4\u8F83</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>skuFullReductionEntity<span class="token punctuation">.</span><span class="token function">getFullPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>skuFullReductionEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//sms_member_price</span>

    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberPrice</span><span class="token punctuation">&gt;</span></span> memberPrice <span class="token operator">=</span> skuReductionTo<span class="token punctuation">.</span><span class="token function">getMemberPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberPriceEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> memberPrice<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">MemberPriceEntity</span> priceEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MemberPriceEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        priceEntity<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        priceEntity<span class="token punctuation">.</span><span class="token function">setMemberPrice</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        priceEntity<span class="token punctuation">.</span><span class="token function">setMemberLevelName</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        priceEntity<span class="token punctuation">.</span><span class="token function">setMemberLevelId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        priceEntity<span class="token punctuation">.</span><span class="token function">setAddOther</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> priceEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u4F1A\u5458\u5BF9\u5E94\u4EF7\u683C\u7B49\u4E8E0 \u8FC7\u6EE4\u6389</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">getMemberPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    memberPriceService<span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-3-7-\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_12-3-7-\u603B\u7ED3" aria-hidden="true">#</a> <strong>12.3.7 \u603B\u7ED3</strong></h3><ul><li>\u7535\u5546\u7CFB\u7EDF\u4E2D\u5927\u8868\u6570\u636E\u4E0D\u505A\u5173\u8054 \u5B81\u53EF\u4E00\u70B9\u4E00\u70B9\u67E5\u8BE2</li><li>\u5546\u54C1\u65B0\u589E\u4E1A\u52A1\uFF0C\u7728\u773C\u4E00\u770B\u5F88\u591A\u4EE3\u7801\uFF0C\u4F46\u662F\u5982\u679C\u628A\u4ED6\u4EEC\u5212\u5206\u6210\u51E0\u4E2A\u529F\u80FD\u70B9\u4E00\u4E00\u5B8C\u6210\uFF0C\u4E1A\u52A1\u4E5F\u5C31\u4E0D\u4F1A\u53D8\u5F97\u5F88\u5E9E\u5927</li></ul><p>\u76F8\u5173\u64CD\u4F5C\u7684\u8868</p><p><img src="http://qnimg.gisfsde.com/work/image-20201024113618961.png" alt="image-20201024113618961" loading="lazy"></p><h3 id="_12-3-8-\u5546\u54C1\u4FDD\u5B58\u540E-debug-\u8C03\u8BD5" tabindex="-1"><a class="header-anchor" href="#_12-3-8-\u5546\u54C1\u4FDD\u5B58\u540E-debug-\u8C03\u8BD5" aria-hidden="true">#</a> 12.3.8 \u5546\u54C1\u4FDD\u5B58\u540E Debug \u8C03\u8BD5</h3><p>\u5F88\u5C11\u6709\u4E00\u6B21\u5199\u7684\u4EE3\u7801\u80FD\u4E00\u6B21\u901A\u8FC7\uFF0C\u6240\u4EE5\u6211\u4EEC\u8981 \u4E00\u4E2A\u529F\u80FD\u70B9\u4E00\u4E2A\u65AD\u70B9\u6765\u8C03\u8BD5\u7A0B\u5E8F\u662F\u5426\u6B63\u786E</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code># \u5C06\u5F53\u524D\u4F1A\u8BDD\u7B49\u7EA7\u8BBE\u7F6E\u6210\u8BFB\u4E3A\u63D0\u4EA4\uFF0C\u5F53\u524D\u7A97\u53E3\u5C31\u80FD\u67E5\u770B\u5230\u6CA1\u6709\u63D0\u4EA4\u7684\u6570\u636E
SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5177\u4F53 Debug \u8FC7\u7A0B\u4E0D\u5728\u6B64\u53D9\u8FF0</p><h3 id="_12-3-9-\u5546\u54C1\u4FDD\u5B58\u5176\u4ED6\u95EE\u9898\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_12-3-9-\u5546\u54C1\u4FDD\u5B58\u5176\u4ED6\u95EE\u9898\u5904\u7406" aria-hidden="true">#</a> 12.3.9 \u5546\u54C1\u4FDD\u5B58\u5176\u4ED6\u95EE\u9898\u5904\u7406</h3><h4 id="_1\u3001-sku-images-\u8868\u4E2D-img-url-\u5B57\u6BB5\u4E3A\u7A7A" tabindex="-1"><a class="header-anchor" href="#_1\u3001-sku-images-\u8868\u4E2D-img-url-\u5B57\u6BB5\u4E3A\u7A7A" aria-hidden="true">#</a> 1\u3001 <code>sku_images</code> \u8868\u4E2D img_url \u5B57\u6BB5\u4E3A\u7A7A</h4><p><code>sku_images</code> \u4E2D\u6709\u5F88\u591A\u56FE\u7247\u90FD\u662F\u4E3A\u7A7A\uFF0C\u56E0\u6B64\u6211\u4EEC\u9700\u8981\u5728\u7A0B\u5E8F\u4E2D\u5904\u7406\u8FD9\u4E2A\u6570\u636E\uFF0C\u7A7A\u6570\u636E\u4E0D\u5199\u5165\u5230\u6570\u636E\u5E93\u4E2D</p><p><img src="http://qnimg.gisfsde.com/work/image-20201024114238060.png" alt="image-20201024114238060" loading="lazy"></p><p><strong>\u89E3\u51B3\u601D\u8DEF\uFF1A</strong></p><p><code>skuImages</code> \u4FDD\u5B58\u90E8\u5206\u4EE3\u7801\u3001\u5982\u679C <code>ImgUrl</code> \u4E3A\u7A7A\u5219\u8FDB\u884C\u8FC7\u6EE4</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>entity <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//\u8FD4\u56DE true \u9700\u8981 false \u8FC7\u6EE4</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getImgUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001sku-\u6EE1\u51CF\u4EE5\u53CA\u6253\u6298\u4FE1\u606F-\u6570\u636E\u51FA\u73B0\u9519\u8BEF" tabindex="-1"><a class="header-anchor" href="#_2\u3001sku-\u6EE1\u51CF\u4EE5\u53CA\u6253\u6298\u4FE1\u606F-\u6570\u636E\u51FA\u73B0\u9519\u8BEF" aria-hidden="true">#</a> 2\u3001sku \u6EE1\u51CF\u4EE5\u53CA\u6253\u6298\u4FE1\u606F \u6570\u636E\u51FA\u73B0\u9519\u8BEF</h4><p>\u6709\u90E8\u5206\u6570\u636E \u4E3A0</p><p><img src="http://qnimg.gisfsde.com/work/image-20201024114652266.png" alt="image-20201024114652266" loading="lazy"></p><p>\u89E3\u51B3\u601D\u8DEF\uFF1A</p><p>\u5728\u4EE3\u7801\u4E2D\u8FC7\u6EE4\u5BF9\u5E94\u4E3A0\u7684\u6570\u636E</p><p>\u90E8\u5206\u4FEE\u6539\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u6EE1\u51E0\u4EF6 \u5927\u4E8E0 \u53EF\u4EE5\u6DFB\u52A0  \u6EE1\u591A\u5C11\u94B1 \u81F3\u5C11\u8981\u5927\u4E8E0</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">.</span><span class="token function">getFullCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> skuReductionTo<span class="token punctuation">.</span><span class="token function">getFullPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">R</span> r1 <span class="token operator">=</span> couponFeignService<span class="token punctuation">.</span><span class="token function">saveSkuReduction</span><span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>r1<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FDC\u7A0B\u4FDD\u5B58sku\u4F18\u60E0\u4FE1\u606F\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FDC\u7A0B\u670D\u52A1\u4E2D\u4E5F\u8FDB\u884C\u5BF9\u5E94\u4FEE\u6539</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
\u4FDD\u5B58 \u5546\u54C1\u9636\u68AF\u4EF7\u683C
\u4EF6\u6570 \u5927\u4E8E0\u624D\u80FD\u8FDB\u884C\u4FEE\u6539
**/</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>skuLadderEntity<span class="token punctuation">.</span><span class="token function">getFullCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    skuLadderService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>skuLadderEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
\u4FDD\u5B58\u5546\u54C1\u6EE1\u51CF\u4FE1\u606F
**/</span>
  <span class="token comment">// BigDecimal \u7528 compareTo\u6765\u6BD4\u8F83</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>skuFullReductionEntity<span class="token punctuation">.</span><span class="token function">getFullPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>skuFullReductionEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
\u4FDD\u5B58\u5546\u54C1\u4F1A\u5458\u4EF7\u683C
\u4E5F\u8FDB\u884C\u4E86\u8FC7\u6EE4\u6570\u636E
**/</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u4F1A\u5458\u5BF9\u5E94\u4EF7\u683C\u7B49\u4E8E0 \u8FC7\u6EE4\u6389</span>
            <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">getMemberPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001\u7A0B\u5E8F\u4E2D\u5176\u4ED6\u7684\u5F02\u5E38" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u7A0B\u5E8F\u4E2D\u5176\u4ED6\u7684\u5F02\u5E38" aria-hidden="true">#</a> 3\u3001\u7A0B\u5E8F\u4E2D\u5176\u4ED6\u7684\u5F02\u5E38</h4><p>\u7A0B\u5E8F\u4E2D\u603B\u4F1A\u51FA\u73B0\u4E00\u4E9B\u5176\u4ED6\u7684\u5F02\u5E38\u7684\uFF0C\u8FD9\u4E2A\u7559\u5230\u9AD8\u7EA7\u7BC7\u8FDB\u884C\u8BB2\u89E3</p><h1 id="\u5341\u4E00\u3001-\u5546\u54C1\u670D\u52A1-\u5546\u54C1\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E00\u3001-\u5546\u54C1\u670D\u52A1-\u5546\u54C1\u7BA1\u7406" aria-hidden="true">#</a> \u5341\u4E00\u3001 \u5546\u54C1\u670D\u52A1&amp;\u5546\u54C1\u7BA1\u7406</h1><h2 id="spu-sku" tabindex="-1"><a class="header-anchor" href="#spu-sku" aria-hidden="true">#</a> SPU SKU</h2><h2 id="_11-1-\u5546\u54C1\u7BA1\u7406-spu-\u68C0\u7D22" tabindex="-1"><a class="header-anchor" href="#_11-1-\u5546\u54C1\u7BA1\u7406-spu-\u68C0\u7D22" aria-hidden="true">#</a> 11.1 \u5546\u54C1\u7BA1\u7406 SPU \u68C0\u7D22</h2><p><strong>\u529F\u80FD\u6982\u8FF0\uFF1A</strong></p><ul><li>\u67E5\u8BE2\u521A\u521A\u53D1\u5E03\u7684\u5546\u54C1\uFF0C\u5E76\u80FD\u8FDB\u884C\u5BF9\u5E94\u7684\u6761\u4EF6\u67E5\u8BE2</li></ul><p><img src="http://qnimg.gisfsde.com/work/image-20201024061157844.png" alt="image-20201024061157844" loading="lazy"></p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * \u5217\u8868
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//@RequiresPermissions(&quot;product:spuinfo:list&quot;)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> spuInfoService<span class="token punctuation">.</span><span class="token function">queryPageByCondition</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service \u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6839\u636E\u6761\u4EF6\u8FDB\u884C\u67E5\u8BE2 spu\u76F8\u5173\u4FE1\u606F
 * <span class="token keyword">@param</span> <span class="token parameter">params</span> \u5206\u9875\u53C2\u6570  status\u4E0A\u67B6\u72B6\u6001\uFF0CcatelogId \u5206\u7C7Bid brandId \u54C1\u724Cid
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPageByCondition</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuInfoEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u53D6\u51FA\u53C2\u6570 key \u8FDB\u884C\u67E5\u8BE2</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;spu_name&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u9A8C\u8BC1\u4E0D\u4E3A\u7A7A \u53D6\u51FA\u53C2\u6570\u8FDB\u884C \u67E5\u8BE2</span>
    <span class="token class-name">String</span> status <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;publish_status&quot;</span><span class="token punctuation">,</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> brandId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span>  <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;brand_id&quot;</span><span class="token punctuation">,</span>brandId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> catelogId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;catelogId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_id&quot;</span><span class="token punctuation">,</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuInfoEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuInfoEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u603B\u7ED3\u4E1A\u52A1\u6D41\u7A0B</strong></p><ul><li>\u4E3B\u8981\u67E5\u8BE2\u7684\u662F <code>pms_spu_info</code> \u8FD9\u5F20\u8868 \u524D\u7AEF\u4F20\u9012\u8FC7\u6765\u7684\u53C2\u6570 \u4E3B\u8981\u6709\u5206\u9875\uFF0C\u4EE5\u53CA \u54C1\u724Cid \u5206\u7C7Bid \u6211\u4EEC\u9700\u8981\u5224\u65AD\u8FD9\u4E9B\u503C\u662F\u5426\u6B63\u786E\uFF0C\u7136\u540E\u8FDB\u884C\u67E5\u8BE2\u6570\u636E</li></ul><h2 id="_11-2-\u5546\u54C1\u7BA1\u7406-sku-\u68C0\u7D22" tabindex="-1"><a class="header-anchor" href="#_11-2-\u5546\u54C1\u7BA1\u7406-sku-\u68C0\u7D22" aria-hidden="true">#</a> 11.2 \u5546\u54C1\u7BA1\u7406 SkU \u68C0\u7D22</h2><p><strong>\u529F\u80FD\u6982\u8FF0\uFF1A</strong></p><p>\u67E5\u8BE2\u5177\u4F53\u7684\u5546\u54C1\u7BA1\u7406 \u5E93\u5B58</p><p><img src="http://qnimg.gisfsde.com/work/image-20201024061836312.png" alt="image-20201024061836312" loading="lazy"></p><p>Controller</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/**
 * \u5217\u8868
 */
@RequestMapping(&quot;/list&quot;)
//@RequiresPermissions(&quot;product:skuinfo:list&quot;)
public R list(@RequestParam Map\\&lt;String, Object&gt; params){
    PageUtils page = skuInfoService.queryPageByCondition(params);

    return R.ok().put(&quot;page&quot;, page);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPageByCondition</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u53D6\u51FA\u53C2\u6570 \u8FDB\u884C\u67E5\u8BE2</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;sku_id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;sku_name&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u9A8C\u8BC1 id \u662F\u5426\u4E3A0 \u5426\u5219\u8FDB\u884C\u5339\u914D</span>
    <span class="token class-name">String</span> catelogId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;catelogId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_id&quot;</span><span class="token punctuation">,</span>catelogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> brandId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;brand_id&quot;</span><span class="token punctuation">,</span>brandId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> min <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;min&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">ge</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span>min<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> max <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6015\u524D\u7AEF\u4F20\u9012\u7684\u6570\u636E\u662F abc \u7B49\u7B49 \u6240\u4EE5\u8981\u629B\u51FA\u5F02\u5E38</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">BigDecimal</span> bigDecimal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> bigDecimal<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                wrapper<span class="token punctuation">.</span><span class="token function">le</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            wrapper
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u603B\u7ED3\u4E1A\u52A1\u6D41\u7A0B\uFF1A</strong></p><p>\u4E3B\u8981\u67E5\u8BE2\u662F <code>pms_sku_info</code> \u8FD9\u5F20\u8868\uFF0C\u6211\u51FA\u73B0\u7684\u95EE\u9898\u662F\u53D1\u5E03\u5546\u54C1\u65F6\u5019\uFF0C\u5B9E\u4F53\u7C7B\u7684 \u4EF7\u683C \u4E0E VO\u5C5E\u6027\u4E0D\u4E00\u81F4\uFF0C\u51FA\u73B0\u4E86\u6570\u636E\u6CA1\u6709\u62F7\u8D1D\uFF0C\u4FEE\u6539\u540E\uFF0C\u6570\u636E\u67E5\u8BE2\u6B63\u5E38</p><h1 id="\u5341\u4E8C\u3001\u4ED3\u50A8\u670D\u52A1-\u4ED3\u5E93\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E8C\u3001\u4ED3\u50A8\u670D\u52A1-\u4ED3\u5E93\u7BA1\u7406" aria-hidden="true">#</a> \u5341\u4E8C\u3001\u4ED3\u50A8\u670D\u52A1&amp;\u4ED3\u5E93\u7BA1\u7406</h1><h2 id="_14-1-\u6574\u5408ware\u670D\u52A1-\u83B7\u53D6\u4ED3\u5E93\u5217\u8868" tabindex="-1"><a class="header-anchor" href="#_14-1-\u6574\u5408ware\u670D\u52A1-\u83B7\u53D6\u4ED3\u5E93\u5217\u8868" aria-hidden="true">#</a> 14.1 \u6574\u5408ware\u670D\u52A1&amp;\u83B7\u53D6\u4ED3\u5E93\u5217\u8868</h2><h3 id="_14-1-1\u6574\u5408-ware-\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_14-1-1\u6574\u5408-ware-\u670D\u52A1" aria-hidden="true">#</a> 14.1.1\u6574\u5408 ware \u670D\u52A1</h3><p>1\u3001\u9996\u5148\u670D\u52A1\u9700\u8981\u5148\u6CE8\u518C\u5230 Nacos \u4E2D\uFF0C\u9700\u8981\u81EA\u5DF1\u914D\u7F6E\u6587\u4EF6 \u914D\u7F6E\u5BF9\u5E94\u7684 nacos\u6CE8\u518C\u5730\u5740\uFF0C</p><p>2\u3001\u542F\u52A8\u7C7B\u9700\u8981\u5F00\u542F \u670D\u52A1\u6CE8\u518C\u53D1\u73B0\uFF0C\u5F00\u542F\u8FDC\u7A0B\u670D\u52A1\u8C03\u7528</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableFeignClients</span> <span class="token comment">// \u5F00\u542Fopenfeign \u8FDC\u7A0B\u670D\u52A1\u8C03\u7528</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span> <span class="token comment">//\u5F00\u542F\u4E8B\u52A1</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.gulimall.ware.dao&quot;</span><span class="token punctuation">)</span> <span class="token comment">//mapper\u5305\u626B\u63CF</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span> <span class="token comment">//\u670D\u52A1\u6CE8\u518C\u53D1\u73B0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-1-2-\u83B7\u53D6\u4ED3\u5E93\u5217\u8868" tabindex="-1"><a class="header-anchor" href="#_14-1-2-\u83B7\u53D6\u4ED3\u5E93\u5217\u8868" aria-hidden="true">#</a> 14.1.2 \u83B7\u53D6\u4ED3\u5E93\u5217\u8868</h3><p><strong>\u5177\u4F53\u9700\u6C42\uFF1A</strong></p><p>\u6839\u636E\u53C2\u6570\u540D\u67E5\u8BE2\u51FA \u4ED3\u5E93\u76F8\u5173\u7684\u8BB0\u5F55 \uFF0C\u5177\u4F53\u5BF9\u4E8E\u64CD\u4F5C\u7684\u662F<code>wms_ware_info</code> \u8868</p><p><img src="http://qnimg.gisfsde.com/work/image-20201024121842147.png" alt="" loading="lazy"></p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5217\u8868
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//@RequiresPermissions(&quot;ware:wareinfo:list&quot;)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> wareInfoService<span class="token punctuation">.</span><span class="token function">queryPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareInfoEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u53D6\u51FA\u53C2\u6570</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u62FC\u63A5\u6761\u4EF6</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;areacode&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareInfoEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareInfoEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            wrapper
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u603B\u7ED3\u4E1A\u52A1\u6D41\u7A0B</strong></p><p>\u4ED3\u5E93\u7EF4\u62A4\u5BF9\u5E94\u7684\u662F <code>wms_ware_info</code> \u6839\u636E\u524D\u7AEF\u4F20\u9012\u8FC7\u6765\u7684\u53C2\u6570\u8FDB\u884C\u62FC\u63A5\u7136\u540E\u8FDB\u884C\u67E5\u8BE2</p><h2 id="_14-2-\u67E5\u8BE2\u5E93\u5B58-\u521B\u5EFA\u91C7\u8D2D\u9700\u6C42" tabindex="-1"><a class="header-anchor" href="#_14-2-\u67E5\u8BE2\u5E93\u5B58-\u521B\u5EFA\u91C7\u8D2D\u9700\u6C42" aria-hidden="true">#</a> 14.2 \u67E5\u8BE2\u5E93\u5B58&amp;\u521B\u5EFA\u91C7\u8D2D\u9700\u6C42</h2><h3 id="_14-2-1-\u67E5\u8BE2\u5E93\u5B58" tabindex="-1"><a class="header-anchor" href="#_14-2-1-\u67E5\u8BE2\u5E93\u5B58" aria-hidden="true">#</a> 14.2.1 \u67E5\u8BE2\u5E93\u5B58</h3><p><strong>\u5177\u4F53\u9700\u6C42\uFF1A</strong></p><p>\u6839\u636E <strong>\u4ED3\u5E93\u3001skuId</strong> \u8FDB\u884C\u67E5\u8BE2\u5BF9\u5E94\u7684\u8868\u662F wms_ware_sku</p><p><img src="http://qnimg.gisfsde.com/work/image-20201024122540156.png" alt="image-20201024122540156" loading="lazy"></p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5217\u8868
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//@RequiresPermissions(&quot;ware:waresku:list&quot;)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> wareSkuService<span class="token punctuation">.</span><span class="token function">queryPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u53D6\u51FA\u8BF7\u6C42\u7684\u53C2\u6570 \u7EC4\u88C5\u6761\u4EF6\u8FDB\u884C\u67E5\u8BE2</span>
    <span class="token class-name">String</span> skuId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;sku_id&quot;</span><span class="token punctuation">,</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> wareId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;wareId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>wareId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;ware_id&quot;</span><span class="token punctuation">,</span>wareId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            queryWrapper
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u603B\u7ED3\u4E1A\u52A1\u6D41\u7A0B\uFF1A</strong></p><p><code>wms_ware_sku</code> \u4E3B\u8981\u7684\u64CD\u4F5C\u7684\u5C31\u662F\u8BE5\u8868 \u4E00\u6837\u7684\u5C01\u88C5\u6761\u4EF6\uFF0C\u7136\u540E\u8FDB\u884C\u67E5\u8BE2</p><h3 id="_14-2-2-\u521B\u5EFA\u91C7\u8D2D\u9700\u6C42" tabindex="-1"><a class="header-anchor" href="#_14-2-2-\u521B\u5EFA\u91C7\u8D2D\u9700\u6C42" aria-hidden="true">#</a> 14.2.2 \u521B\u5EFA\u91C7\u8D2D\u9700\u6C42</h3><p><strong>\u5177\u4F53\u9700\u6C42\uFF1A</strong></p><p>\u9009\u62E9 \u4ED3\u5E93\u3001\u72B6\u6001\u3001 \u4EE5\u53CA\u5176\u4ED6\u5173\u952E\u5B57 \u67E5\u8BE2\u51FA\u5BF9\u5E94\u7684\u6570\u636E \u90A3\u4E48\u67E5\u8BE2\u7684\u662F\u54EA\u5F20\u8868\uFF1F <code>wms_purchase_detail</code></p><p><img src="http://qnimg.gisfsde.com/work/image-20201024125311832.png" alt="image-20201024125311832" loading="lazy"></p><p>Controller</p><p>\u5982\u5F80\u5E38\u4E00\u6837 \u8C03\u7528 <code>Service</code> \u8FD4\u56DE\u7ED3\u679C \u7EC4\u88C5 \u8FD4\u56DE~~~</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5217\u8868
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//@RequiresPermissions(&quot;ware:purchasedetail:list&quot;)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">PageUtils</span> page <span class="token operator">=</span> purchaseDetailService<span class="token punctuation">.</span><span class="token function">queryPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *  //   status: 0,//\u72B6\u6001
 *         //   wareId: 1,//\u4ED3\u5E93id
 * <span class="token keyword">@param</span> <span class="token parameter">params</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPage</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u53D6\u51FAkey</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// key \u4E3B\u8981\u67E5\u8BE2\u6761\u4EF6 </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;purchase_id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;sku_id&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> status <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> wareId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;wareId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>wareId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrapper<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;ware_id&quot;</span><span class="token punctuation">,</span>wareId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
            wrapper
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u603B\u7ED3\u4E1A\u52A1\u6D41\u7A0B\uFF1A</strong></p><p>\u5BF9 <code>wms_purchase_detail</code> \u8868\u8FDB\u884C\u64CD\u4F5C \u62FC\u88C5\u6761\u4EF6 \u67E5\u8BE2 \u55EF \u5C31\u8FD9\u6837~~~</p><h2 id="_14-3-\u5408\u5E76\u91C7\u8D2D\u9700\u6C42-\u9886\u53D6\u91C7\u8D2D\u5355-\u5B8C\u6210\u91C7\u8D2D-spu\u89C4\u683C\u7EF4\u62A4" tabindex="-1"><a class="header-anchor" href="#_14-3-\u5408\u5E76\u91C7\u8D2D\u9700\u6C42-\u9886\u53D6\u91C7\u8D2D\u5355-\u5B8C\u6210\u91C7\u8D2D-spu\u89C4\u683C\u7EF4\u62A4" aria-hidden="true">#</a> 14.3 \u5408\u5E76\u91C7\u8D2D\u9700\u6C42&amp;\u9886\u53D6\u91C7\u8D2D\u5355&amp;\u5B8C\u6210\u91C7\u8D2D&amp;Spu\u89C4\u683C\u7EF4\u62A4</h2><h3 id="_14-3-1-\u5408\u5E76\u91C7\u8D2D\u9700\u6C42" tabindex="-1"><a class="header-anchor" href="#_14-3-1-\u5408\u5E76\u91C7\u8D2D\u9700\u6C42" aria-hidden="true">#</a> 14.3.1 \u5408\u5E76\u91C7\u8D2D\u9700\u6C42</h3><p><strong>\u5177\u4F53\u9700\u6C42\uFF1A</strong></p><p><img src="http://qnimg.gisfsde.com/work/image-20201024131822802.png" alt="" loading="lazy"></p><p>\u9009\u4E2D \u70B9\u51FB\u6279\u91CF\u64CD\u4F5C</p><p><img src="http://qnimg.gisfsde.com/work/image-20201024132207468.png" alt="image-20201024132207468" loading="lazy"></p><p>\u8BF7\u6C42\u53C2\u6570\u5206\u4EAB</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">{</span>
  purchaseId<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//\u6574\u5355id</span>
  items<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">//\u5408\u5E76\u9879\u96C6\u5408</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u90A3\u5C31\u5EFA\u7ACB\u5BF9\u5E94\u7684 Vo \u7528\u6765\u63A5\u6536\u8BF7\u6C42\u53C2\u6570</p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5408\u5E76\u91C7\u8D2D
 * <span class="token keyword">@param</span> <span class="token parameter">mergeVo</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token comment">///ware/purchase/merge</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/merge&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">MergeVo</span> mergeVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    purchaseService<span class="token punctuation">.</span><span class="token function">mrgePurchase</span><span class="token punctuation">(</span>mergeVo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5408\u5E76\u91C7\u8D2D\u9700\u6C42
 * <span class="token keyword">@param</span> <span class="token parameter">mergeVo</span>
 */</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">mrgePurchase</span><span class="token punctuation">(</span><span class="token class-name">MergeVo</span> mergeVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u62FF\u5230\u91C7\u8D2D\u5355id</span>
    <span class="token class-name">Long</span> purchaseId <span class="token operator">=</span> mergeVo<span class="token punctuation">.</span><span class="token function">getPurchaseId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u91C7\u8D2D\u5355 id\u4E3A\u7A7A \u65B0\u5EFA</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>purchaseId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PurchaseEntity</span> purchaseEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u72B6\u6001\u8BBE\u7F6E\u4E3A\u65B0\u5EFA</span>
        purchaseEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span>CREATED<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        purchaseEntity<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        purchaseEntity<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>purchaseEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u62FF\u5230\u6700\u65B0\u7684\u91C7\u8D2D\u5355id</span>
        purchaseId <span class="token operator">=</span> purchaseEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//TODO \u786E\u8BA4\u91C7\u8D2D\u662F 0 \u6216 1 \u624D\u53EF\u4EE5\u5408\u5E76</span>

    <span class="token comment">// \u62FF\u5230\u5408\u5E76\u9879 **\u91C7\u8D2D\u9700\u6C42\u7684id**</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> mergeVo<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> finalPurchaseId <span class="token operator">=</span> purchaseId<span class="token punctuation">;</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u91C7\u8D2D\u9700\u6C42</span>
        <span class="token class-name">PurchaseDetailEntity</span> detailEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u901A\u8FC7\u91C7\u8D2D\u5355id \u67E5\u8BE2\u5230 \u91C7\u8D2D\u4FE1\u606F\u5BF9\u8C61</span>
        <span class="token class-name">PurchaseEntity</span> byId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>finalPurchaseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u72B6\u6001\u5982\u679C\u662F\u6B63\u5728\u91C7\u8D2D</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token punctuation">(</span>byId<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span>BUYING<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u8BBE\u7F6E\u4E3A\u5DF2\u5206\u914D</span>
            detailEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span>HASERROR<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        detailEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E\u91C7\u8D2D\u5355id</span>
        detailEntity<span class="token punctuation">.</span><span class="token function">setPurchaseId</span><span class="token punctuation">(</span>finalPurchaseId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> detailEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// id\u6279\u91CF\u66F4\u65B0</span>
    purchaseDetailService<span class="token punctuation">.</span><span class="token function">updateBatchById</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u518D\u6B21\u5408\u5E76\u7684\u8BDD \u66F4\u65B0\u4FEE\u6539\u65F6\u95F4</span>
    <span class="token class-name">PurchaseEntity</span> purchaseEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    purchaseEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>purchaseId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    purchaseEntity<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>purchaseEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u603B\u7ED3\u4E1A\u52A1\u6D41\u7A0B:</strong></p><ul><li>\u4ECE \u53C2\u6570 mergeVo\u4E2D\u53D6\u51FA purchaseId \u548C items \u8FDB\u884C\u76F8\u5173\u64CD\u4F5C</li><li>\u4E3B\u8981\u662F\u7528\u6765\u64CD\u4F5C\u4E24\u5F20\u8868 <code>wms_purchase</code> \u548C <code>wms_purchase_detail</code></li><li><code>wms_purchase</code> \u8868\u662F \u91C7\u8D2D\u4FE1\u606F</li><li><code>wms_purchase_detail</code> \u8868\u662F \u91C7\u8D2D\u9700\u6C42</li><li>\u6211\u7684\u7406\u89E3\u662F\u5C06 <code>wms_purchase</code> \u7684id\u63D2\u5165\u5230 <code>wms_purchase_detail</code> \u8868\u4E2D \u4E5F\u5C31\u662F purchase_id \u5B57\u6BB5\uFF0C\u4E2D\u95F4\u901A\u8FC7\u8FD9\u4E2A\u5B57\u6BB5\u5173\u8054\u8D77\u6765\uFF0C\u540C\u65F6 <code>wms_purchase</code> \u8868\u5BF9 status \u72B6\u6001\u6709\u6BD4\u8F83\u591A\u7684\u9009\u62E9\uFF0C\u89C6\u9891\u91CC\u9762\u4E5F\u662F\u5B9A\u4E49\u4E86\u4E24\u4E2A\u5E38\u91CF</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WareConstant</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span>  <span class="token class-name">PurchaseStatusEnum</span><span class="token punctuation">{</span>
        <span class="token function">CREATED</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;\u65B0\u5EFA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">ASSIGNED</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;\u5DF2\u5206\u914D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">RECEIVE</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;\u5DF2\u9886\u53D6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">FINISH</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;\u5DF2\u5B8C\u6210&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">HASERROR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&quot;\u6709\u5F02\u5E38&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
        <span class="token class-name">PurchaseStatusEnum</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> code<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCode</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span>  <span class="token class-name">PurchaseDetailStatusEnum</span><span class="token punctuation">{</span>
        <span class="token function">CREATED</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;\u65B0\u5EFA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">ASSIGNED</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;\u5DF2\u5206\u914D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">BUYING</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;\u6B63\u5728\u91C7\u8D2D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">FINISH</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;\u5DF2\u5B8C\u6210&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">HASERROR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&quot;\u91C7\u8D2D\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
        <span class="token class-name">PurchaseDetailStatusEnum</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> code<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCode</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06\u5E38\u91CF\u62BD\u53D6\u51FA\u6765\uFF0C\u4FEE\u6539\u66F4\u52A0\u65B9\u4FBF</p><h3 id="_14-3-2-\u9886\u53D6\u91C7\u8D2D\u5355" tabindex="-1"><a class="header-anchor" href="#_14-3-2-\u9886\u53D6\u91C7\u8D2D\u5355" aria-hidden="true">#</a> 14.3.2 \u9886\u53D6\u91C7\u8D2D\u5355</h3><p><strong>\u5177\u4F53\u9700\u6C42\uFF1A</strong></p><p>\u5408\u5E76\u91C7\u8D2D\u9700\u6C42\u6210\u529F\u540E\uFF0C\u5177\u4F53\u8FD9\u4E2A\u529F\u80FD\u6709\u5565\u7528\u554A\uFF1F \u4F60\u603B\u5F97\u9700\u8981\u6709\u4EBA\u53BB\u91C7\u8D2D\u5427\uFF1F \u6240\u4EE5\u5C31\u4F1A\u6709\u4E00\u4E2A<strong>\u91C7\u8D2DAPP \u5DE5\u4F5C\u4EBA\u5458\u70B9\u51FB\u91C7\u8D2D</strong>\uFF0C\u7136\u540E\u5C31\u53BB\u91C7\u8D2D\uFF0C\u8FD9\u91CC\u5C31\u6CA1\u6709\u5B9E\u73B0\u91C7\u8D2D APP \u5C31\u7528\u63A5\u53E3\u6765\u5B9E\u73B0\uFF0C\u901A\u8FC7 JSON \u7684\u53C2\u6570 \u6765\u8BF7\u6C42</p><p><img src="http://qnimg.gisfsde.com/work/image-20201024140120849.png" alt="image-20201024140120849" loading="lazy"></p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *
 * <span class="token keyword">@param</span> <span class="token parameter">ids</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/received&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">received</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    purchaseService<span class="token punctuation">.</span><span class="token function">received</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">received</span><span class="token punctuation">(</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1\u3001\u786E\u8BA4\u5F53\u524D\u91C7\u8D2D\u5355\u662F \u65B0\u5EFA\u6216\u8005 \u5DF2\u5206\u914D\u72B6\u6001 \u624D\u80FD\u8FDB\u884C\u91C7\u8D2D</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> ids<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>id <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6839\u636E\u91C7\u8D2Did\u67E5\u8BE2\u51FA\u91C7\u8D2D\u4FE1\u606F</span>
        <span class="token class-name">PurchaseEntity</span> byId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> byId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u65B0\u5EFA\u6216\u8005\u5DF2\u5206\u914D\u7559\u4E0B</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span>CREATED<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                item<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span>ASSIGNED<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8BBE\u7F6E\u4E3A\u5DF2\u9886\u53D6</span>
        item<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span>RECEIVE<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> item<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2\u3001\u6539\u53D8\u91C7\u8D2D\u5355\u72B6\u6001</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateBatchById</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 3\u3001\u6539\u53D8\u91C7\u8D2D\u9879\u7684\u72B6\u6001</span>
    collect<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6839\u636E purchase_id \u67E5\u8BE2\u51FA\u91C7\u8D2D\u9700\u6C42</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> entities <span class="token operator">=</span> purchaseDetailService<span class="token punctuation">.</span><span class="token function">listDetailByPurchaseId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> detailEntites <span class="token operator">=</span> entities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>entity <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">PurchaseDetailEntity</span> detailEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            detailEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8BBE\u7F6E\u72B6\u6001\u6B63\u5728\u91C7\u8D2D</span>
            detailEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span>BUYING<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> detailEntity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// id\u6279\u91CF\u66F4\u65B0</span>
        purchaseDetailService<span class="token punctuation">.</span><span class="token function">updateBatchById</span><span class="token punctuation">(</span>detailEntites<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u603B\u7ED3\u4E1A\u52A1\u6D41\u7A0B\uFF1A</strong></p><p>\u4E1A\u52A1\u5206\u6790</p><ul><li>\u91C7\u8D2D\u4EBA\u5458\u901A\u8FC7 APP \u70B9\u51FB\u91C7\u8D2D \u5B8C\u6210\u5BF9\u5E94\u7684\u91C7\u8D2D\u9700\u6C42\uFF0C\u8FD9\u91CC\u4F7F\u7528\u7684\u662F PostMan \u6765\u53D1\u9001\u8BF7\u6C42\uFF0C\u53D1\u9001\u8BF7\u6C42 \u5E26\u7684\u53C2\u6570\u662F\u4EC0\u4E48\uFF1F \u53C2\u6570\u5C31\u662F \u91C7\u8D2DId</li><li>\u901A\u8FC7\u91C7\u8D2D Id \u67E5\u8BE2\u51FA\u91C7\u8D2D\u76F8\u5173\u4FE1\u606F\uFF0C\u7136\u540E\u8BBE\u7F6E\u91C7\u8D2D\u8868\u7684\u72B6\u6001\uFF0C\u8BBE\u7F6E\u6210\u91C7\u8D2D\u6210\u529F\uFF0C\u540C\u65F6\u901A\u8FC7\u8FD9\u4E2A id \u5728 <code>wms_purchase_detail</code> \u8868\u4E2D <strong>\u5BF9\u5E94\u7684\u662F purchase_id</strong> \u67E5\u8BE2\u91C7\u8D2D\u9700\u6C42\u8868\u7684\u6570\u636E\uFF0C \u67E5\u8BE2\u5230\u540E\u5C06\u4ED6\u7684\u72B6\u6001\u8BBE\u7F6E\u6210 <strong>\u201C\u6B63\u5728\u91C7\u8D2D\u201C</strong></li></ul><h3 id="_14-3-3-\u5B8C\u6210\u91C7\u8D2D" tabindex="-1"><a class="header-anchor" href="#_14-3-3-\u5B8C\u6210\u91C7\u8D2D" aria-hidden="true">#</a> 14.3.3 \u5B8C\u6210\u91C7\u8D2D</h3><p><strong>\u5177\u4F53\u9700\u6C42\uFF1A</strong></p><p>\u91C7\u8D2D\u4EBA\u5458\u53C2\u4E0E\u91C7\u8D2D\u540E\uFF0C\u91C7\u8D2D\u5C31\u4F1A\u6709\u4ED6\u7684\u7ED3\u679C\uFF0C\u91C7\u8D2D\u6210\u529F\u3001\u91C7\u8D2D\u5931\u8D25\uFF0C</p><p><img src="http://qnimg.gisfsde.com/work/image-20201024142800046.png" alt="image-20201024142800046" loading="lazy"></p><p>\u6709\u4E86\u8BF7\u6C42\u53C2\u6570\uFF0C\u5982\u679C\u6BD4\u8F83\u591A\uFF0C\u90A3\u4E48\u5E95\u8003\u8651\u8BBE\u8BA1\u4E00\u4E2A VO \u54E6</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/done&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PurchaseDoneVo</span> doneVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    purchaseService<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span>doneVo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vo</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PurchaseDoneVo</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u91C7\u8D2D\u5355id
     */</span>
    <span class="token annotation punctuation">@NotNull</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseItemDoneVo</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@Data
public class PurchaseItemDoneVo {

    /**
     * \u5B8C\u6210/\u5931\u8D25\u7684\u9700\u6C42\u8BE6\u60C5
     */
    private Long itemId;
    /**
     * \u72B6\u6001
     */
    private Integer status;
    
    private String reason;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token class-name">PurchaseDoneVo</span> doneVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token comment">// \u91C7\u8D2D\u5355id</span>
    <span class="token class-name">Long</span> id <span class="token operator">=</span> doneVo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2\u3001\u6539\u53D8\u91C7\u8D2D\u9879\u76EE\u7684\u72B6\u6001</span>
    <span class="token class-name">Boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseItemDoneVo</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> doneVo<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">&gt;</span></span> updates <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PurchaseItemDoneVo</span> item <span class="token operator">:</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PurchaseDetailEntity</span> detailEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseDetailEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5982\u679C\u91C7\u8D2D\u5931\u8D25</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span>HASERROR<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            detailEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 3\u3001\u5C06\u6210\u529F\u91C7\u8D2D\u7684\u8FDB\u884C\u5165\u5E93</span>
            <span class="token class-name">PurchaseDetailEntity</span> entity <span class="token operator">=</span> purchaseDetailService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            wareSkuService<span class="token punctuation">.</span><span class="token function">addStock</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>entity<span class="token punctuation">.</span><span class="token function">getWareId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>entity<span class="token punctuation">.</span><span class="token function">getSkuNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            detailEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseDetailStatusEnum</span><span class="token punctuation">.</span>FINISH<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        detailEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        updates<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>detailEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u6279\u91CF\u66F4\u65B0</span>
    purchaseDetailService<span class="token punctuation">.</span><span class="token function">updateBatchById</span><span class="token punctuation">(</span>updates<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 1\u3001\u6539\u53D8\u91C7\u8D2D\u5355\u72B6\u6001</span>
    <span class="token class-name">PurchaseEntity</span> purchaseEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PurchaseEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    purchaseEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u8BBE\u7F6E\u72B6\u6001\u6839\u636E\u53D8\u91CF\u5224\u65AD</span>
    purchaseEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>flag<span class="token operator">?</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span>FINISH<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token class-name">WareConstant<span class="token punctuation">.</span>PurchaseStatusEnum</span><span class="token punctuation">.</span>HASERROR<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    purchaseEntity<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>purchaseEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>addStock\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addStock</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">,</span> <span class="token class-name">Long</span> wareId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> skuNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5148\u6839\u636E skuId \u548C ware_id \u67E5\u8BE2 \u662F\u5426\u62E5\u6709\u8FD9\u4E2A\u7528\u6237</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">&gt;</span></span> wareSkuEntities <span class="token operator">=</span> wareSkuDao<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;sku_id&quot;</span><span class="token punctuation">,</span> skuId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;ware_id&quot;</span><span class="token punctuation">,</span> wareId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//\u6CA1\u6709\u8FD9\u4E2A\u7528\u6237 \u90A3\u5C31\u65B0\u589E</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>wareSkuEntities <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> wareSkuEntities<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WareSkuEntity</span> wareSkuEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WareSkuEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6839\u636E\u5C5E\u6027\u503C\u8BBE\u7F6E</span>
        wareSkuEntity<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wareSkuEntity<span class="token punctuation">.</span><span class="token function">setStock</span><span class="token punctuation">(</span>skuNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wareSkuEntity<span class="token punctuation">.</span><span class="token function">setWareId</span><span class="token punctuation">(</span>wareId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wareSkuEntity<span class="token punctuation">.</span><span class="token function">setStockLocked</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// TODO \u8FDC\u7A0B\u67E5\u8BE2sku\u7684\u540D\u5B57 \u5982\u679C\u5931\u8D25\u6574\u4E2A\u4E8B\u52A1\u4E0D\u9700\u8981\u56DE\u6EDA</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u8FDC\u7A0B\u8C03\u7528 \u6839\u636E skuid\u8FDB\u884C\u67E5\u8BE2</span>
            <span class="token class-name">R</span> info <span class="token operator">=</span> productFeignService<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> info<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;skuInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                wareSkuEntity<span class="token punctuation">.</span><span class="token function">setSkuName</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;skuName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        wareSkuDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>wareSkuEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6709\u8BE5\u8BB0\u5F55\u90A3\u5C31\u8FDB\u884C\u66F4\u65B0</span>
    wareSkuDao<span class="token punctuation">.</span><span class="token function">addStock</span><span class="token punctuation">(</span>skuId<span class="token punctuation">,</span>wareId<span class="token punctuation">,</span>skuNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>addStock \u5177\u4F53\u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\\<span class="token operator">&lt;</span>insert id<span class="token operator">=</span><span class="token string">&quot;addStock&quot;</span><span class="token operator">&gt;</span>
UPDATE \`wms_ware_sku\` <span class="token class-name">SET</span> stock<span class="token operator">=</span>stock<span class="token operator">+</span>#<span class="token punctuation">{</span>skuNum<span class="token punctuation">}</span> <span class="token class-name">WHERE</span> sku_id<span class="token operator">=</span>#<span class="token punctuation">{</span>skuId<span class="token punctuation">}</span> <span class="token class-name">AND</span> ware_id<span class="token operator">=</span>#<span class="token punctuation">{</span>wareId<span class="token punctuation">}</span>
\\<span class="token operator">&lt;</span><span class="token operator">/</span>insert<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-3-4-spu\u89C4\u683C\u7EF4\u62A4" tabindex="-1"><a class="header-anchor" href="#_14-3-4-spu\u89C4\u683C\u7EF4\u62A4" aria-hidden="true">#</a> 14.3.4 Spu\u89C4\u683C\u7EF4\u62A4</h3><p><strong>\u5177\u4F53\u9700\u6C42\uFF1A</strong></p><p>\u524D\u7AEF\u9879\u76EE\u9047\u5230\u7684\u95EE\u9898\uFF1A \u9700\u8981\u81EA\u5DF1\u53BB router\u76EE\u5F55\u4E0B\u627E\u5230 index.js \u589E\u52A0\u6539\u884C\u914D\u7F6E\uFF0C\u4E3B\u8981\u662F\u914D\u7F6E\u89C4\u683C\u7EF4\u62A4\u7684\u8DEF\u5F84</p><p><img src="http://qnimg.gisfsde.com/work/image-20201025095926893.png" alt="image-20201025095926893" loading="lazy"></p><p>\u5728 Spu\u7BA1\u7406\u4E0A \u70B9\u51FB\u89C4\u683C\u540E\u67E5\u8BE2\u51FA\u76F8\u5173\u89C4\u683C\u4FE1\u606F</p><p><img src="http://qnimg.gisfsde.com/work/image-20201025100138990.png" alt="image-20201025100138990" loading="lazy"></p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/base/listforspu/{spuId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">baseAttrListforspu</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;spuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> spuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> productAttrValueEntity <span class="token operator">=</span> productAttrValueService<span class="token punctuation">.</span><span class="token function">baseAttrListforspu</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span>productAttrValueEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">baseAttrListforspu</span><span class="token punctuation">(</span><span class="token class-name">Long</span> spuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1\u3001\u6839\u636Espuid\u8FDB\u884C\u67E5\u8BE2</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> attrValueEntities <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;spu_id&quot;</span><span class="token punctuation">,</span> spuId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> attrValueEntities<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u603B\u7ED3\u4E1A\u52A1\u6D41\u7A0B\uFF1A</strong></p><p>\u5355\u8868\u64CD\u4F5C\uFF0C\u6839\u636E spu_id \u67E5\u8BE2\u51FA <code>pms_product_attr_value</code> \u8868\u7684\u4FE1\u606F</p><h3 id="_14-3-5-spu\u66F4\u65B0\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#_14-3-5-spu\u66F4\u65B0\u64CD\u4F5C" aria-hidden="true">#</a> 14.3.5 Spu\u66F4\u65B0\u64CD\u4F5C</h3><p><strong>\u5177\u4F53\u9700\u6C42\uFF1A</strong></p><p>\u6839\u636Espu_id \u67E5\u8BE2\u51FA\u89C4\u683C\u4FE1\u606F\u540E \uFF0C\u4FEE\u6539\u5BF9\u5E94\u4FE1\u606F \u63D0\u4EA4\u540E\u4F1A\u53D1\u9001\u4E00\u4E2Apost\u8BF7\u6C42\uFF0C\u5E76\u540C\u65F6\u5E26\u4E0A\u8BF7\u6C42\u53C2\u6570</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span><span class="token punctuation">{</span>
	<span class="token property">&quot;attrId&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
	<span class="token property">&quot;attrName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\u5165\u7F51\u578B\u53F7&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;attrValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LIO-AL00&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;quickShow&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token property">&quot;attrId&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
	<span class="token property">&quot;attrName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\u673A\u8EAB\u6750\u8D28\u5DE5\u827A&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;attrValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\u73BB\u7483&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;quickShow&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token property">&quot;attrId&quot;</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
	<span class="token property">&quot;attrName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CPU\u578B\u53F7&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;attrValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HUAWEI Kirin 980&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;quickShow&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521A\u597D\u8FD9\u56DB\u4E2A\u53C2\u6570\u548C\u5B9E\u4F53\u7C7B\u7684\u4E00\u81F4\uFF0C\u5C31\u4E0D\u9700\u8981\u521B\u5EFA Vo\u6765\u63A5\u6536</p><p><img src="http://qnimg.gisfsde.com/work/image-20201025100424345.png" alt="image-20201025100424345" loading="lazy"></p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/update/{spuId}&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//@RequiresPermissions(&quot;product:attr:update&quot;)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">updateSpuAttr</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;spuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> spuId<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> productAttrValueEntityList<span class="token punctuation">)</span><span class="token punctuation">{</span>

    productAttrValueService<span class="token punctuation">.</span><span class="token function">updateSpuAttr</span><span class="token punctuation">(</span>spuId<span class="token punctuation">,</span>productAttrValueEntityList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5148\u5220\u9664 \u540E\u66F4\u65B0
 * <span class="token keyword">@param</span> <span class="token parameter">spuId</span>
 * <span class="token keyword">@param</span> <span class="token parameter">productAttrValueEntityList</span>
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateSpuAttr</span><span class="token punctuation">(</span><span class="token class-name">Long</span> spuId<span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> productAttrValueEntityList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1\u3001\u6839\u636Espuid\u5220\u9664\u8BB0\u5F55</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;spu_id&quot;</span><span class="token punctuation">,</span>spuId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2\u3001\u904D\u5386\u4F20\u9012\u8FC7\u6765\u7684\u8BB0\u5F55 \u8BBE\u7F6E spuId</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> productAttrValueEntityList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> item<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3\u3001\u6279\u91CF\u4FDD\u5B58</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u603B\u7ED3\u4E1A\u52A1\u6D41\u7A0B\uFF1A</strong></p><ul><li>\u66F4\u65B0\u64CD\u4F5C\uFF0C\u6839\u636E\u524D\u7AEF\u4F20\u9012\u8FC7\u6765\u7684\u53C2\u6570\u6765\u8FDB\u884C\u66F4\u65B0\uFF0C\u524D\u7AEF\u4F20\u9012\u4E86\u4E00\u4E2A <code>spu_id</code> \u548C\u591A\u4E2A spu\u5C5E\u6027\u503C \u4E00\u4E2A <code>spu_id</code>\u5BF9\u591A\u4E2A spu \u5C5E\u6027\u503C</li><li>\u5148\u6839\u636E <code>spu_id</code> \u5220\u9664\u5B58\u5728 pms_product_attr_value \u8868\u7684\u8BB0\u5F55</li><li>\u7136\u540E\u5BF9\u591A\u4E2A ProductAttrValueEntity \u5BF9\u8C61\u8BBE\u7F6E sup_id \uFF0C\u6700\u540E\u8FDB\u884C\u6279\u91CF\u4FDD\u5B58</li></ul><h1 id="\u5206\u5E03\u5F0F\u57FA\u7840\u7BC7\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u57FA\u7840\u7BC7\u603B\u7ED3" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u57FA\u7840\u7BC7\u603B\u7ED3</h1><h2 id="_1\u3001\u5206\u5E03\u5F0F\u57FA\u7840\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5206\u5E03\u5F0F\u57FA\u7840\u6982\u5FF5" aria-hidden="true">#</a> 1\u3001\u5206\u5E03\u5F0F\u57FA\u7840\u6982\u5FF5</h2><ul><li>\u5FAE\u670D\u52A1\u3001\u6CE8\u518C\u4E2D\u5FC3\uFF08Nacos\uFF09\u3001\u914D\u7F6E\u4E2D\u5FC3\uFF08Nacos Cofig\uFF09\u3001\u8FDC\u7A0B\u8C03\u7528\u3001Feign\u3001\u7F51\u5173</li></ul><h2 id="_2\u3001\u57FA\u7840\u5F00\u53D1" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u57FA\u7840\u5F00\u53D1" aria-hidden="true">#</a> 2\u3001\u57FA\u7840\u5F00\u53D1</h2><ul><li>SpringBoot2.0\u3001SpringCloud\u3001Mybatis-Plus\u3001Vue\u7EC4\u4EF6\u5316\u3001\u963F\u91CC\u4E91\u5BF9\u8C61\u5B58\u50A8</li></ul><h2 id="_3\u3001\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u73AF\u5883" aria-hidden="true">#</a> 3\u3001\u73AF\u5883</h2><ul><li>Vagrant\u3001Linux\u3001Docker\u3001MySQL\u3001Redis\u3001\u9006\u5411\u5DE5\u7A0B&amp;\u4EBA\u4EBA\u5F00\u6E90</li></ul><h2 id="_4\u3001\u5F00\u53D1\u89C4\u8303" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5F00\u53D1\u89C4\u8303" aria-hidden="true">#</a> <strong>4\u3001\u5F00\u53D1\u89C4\u8303</strong></h2><ul><li>\u6570\u636E\u6548\u9A8CJSR303\u3001\u5168\u5C40\u5F02\u5E38\u5904\u7406\u3001\u5168\u5C40\u7EDF\u4E00\u8FD4\u56DE\u3001\u5168\u5BB6\u8DE8\u8D8A\u5904\u7406</li><li>\u679A\u4E3E\u72B6\u6001\u3001\u4E1A\u52A1\u72B6\u6001\u3001VO\u4E0ETO\u4E0EPO\u5212\u5206\u3001\u903B\u8F91\u5220\u9664</li><li>Lombok:@Data\u3001@Slf4j</li></ul><h1 id="\u5206\u5E03\u5F0F\u9AD8\u7EA7\u7BC7" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u9AD8\u7EA7\u7BC7" aria-hidden="true">#</a> =<mark><mark><strong>\u5206\u5E03\u5F0F\u9AD8\u7EA7\u7BC7</strong></mark></mark>=</h1><h1 id="_1\u3001elasticsearch-\u5168\u6587\u68C0\u7D22" tabindex="-1"><a class="header-anchor" href="#_1\u3001elasticsearch-\u5168\u6587\u68C0\u7D22" aria-hidden="true">#</a> 1\u3001Elasticsearch - \u5168\u6587\u68C0\u7D22</h1><h3 id="\u7B80\u4ECB-2" tabindex="-1"><a class="header-anchor" href="#\u7B80\u4ECB-2" aria-hidden="true">#</a> \u7B80\u4ECB</h3>`,401),ht={href:"https://www.elastic.co/cn/what-is/elasticsearch/",target:"_blank",rel:"noopener noreferrer"},yt=s("https://www.elastic.co/cn/what-is/elasticsearch/"),ft=n("p",null,"\u5168\u6587\u641C\u7D22\u5C5E\u4E8E\u6700\u5E38\u89C1\u7684\u9700\u6C42\uFF0C\u5F00\u6E90\u7684 Elasticsearch \u662F\u76EE\u524D\u5168\u6587\u641C\u7D22\u5F15\u64CE\u7684\u9996\u9009\u3002",-1),qt=n("p",null,"\u4ED6\u53EF\u4EE5\u5FEB\u901F\u5730\u5B58\u50A8\u3001\u641C\u7D22\u548C\u5206\u6790\u6D77\u91CF\u6570\u636E\u3002\u7EF4\u57FA\u767E\u79D1\u3001Stack Overflow\u3001Github \u90FD\u91C7\u7528\u4ED6",-1),wt=n("p",null,[n("img",{src:"http://qnimg.gisfsde.com/work/image-20201026084916698.png",alt:"image-20201026084916698",loading:"lazy"})],-1),_t=n("p",null,"Elatic \u7684\u5E95\u5C42\u662F\u5F00\u6E90\u5E93\u5427Lucene\u3002\u4F46\u662F\uFF0C\u4F60\u6CA1\u6CD5\u76F4\u63A5\u7528\uFF0C\u5FC5\u987B\u81EA\u5DF1\u5199\u4EE3\u7801\u8C03\u7528\u5B83\u7684\u63A5\u53E3\uFF0CElastic \u662F Lunce \u7684\u5C01\u88C5\uFF0C\u63D0\u4F9B\u4E86 REST API \u7684\u64CD\u4F5C\u63A5\u53E3\uFF0C\u5F00\u7BB1\u5373\u7528",-1),St=n("p",null,"REST API\uFF1A\u5929\u7136\u7684\u8DE8\u5E73\u53F0",-1),xt=s("\u5B98\u7F51\u6587\u6863\uFF1A"),Et={href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html",target:"_blank",rel:"noopener noreferrer"},It=s("https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html"),Ct=s("\u5B98\u7F51\u4E2D\u6587\uFF1A"),At={href:"https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html",target:"_blank",rel:"noopener noreferrer"},jt=s("https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html"),Rt=n("p",null,"\u793E\u533A\u4E2D\u6587\uFF1A",-1),Ot={href:"http://doc.codingdict.com/elasticsearch/",target:"_blank",rel:"noopener noreferrer"},Pt=s("http://doc.codingdict.com/elasticsearch/"),Tt=p(`<h3 id="_1-1\u3001\u57FA\u672C\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-1\u3001\u57FA\u672C\u6982\u5FF5" aria-hidden="true">#</a> 1.1\u3001\u57FA\u672C\u6982\u5FF5</h3><h4 id="_1-1-1-index-\u7D22\u5F15" tabindex="-1"><a class="header-anchor" href="#_1-1-1-index-\u7D22\u5F15" aria-hidden="true">#</a> 1.1.1 index(\u7D22\u5F15)</h4><p>\u52A8\u8BCD\uFF0C\u76F8\u5F53\u4E8E MySQL \u4E2D\u7684 insert\uFF1B</p><p>\u540D\u8BCD\uFF0C\u76F8\u5F53\u4E8EMySQL \u4E2D\u7684 DataBase</p><h4 id="_1-1-2-type-\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#_1-1-2-type-\u7C7B\u578B" aria-hidden="true">#</a> 1.1.2 Type(\u7C7B\u578B)</h4><p>\u5728 Index\uFF08\u7D22\u5F15\uFF09\u4E2D\uFF0C\u53EF\u4EE5\u5B9A\u4E49\u4E00\u4E2A\u6216\u591A\u4E2A\u7C7B\u578B</p><p>\u7C7B\u4F3C\u4E8E MySQL \u4E2D\u7684 Table\uFF0C\u6BCF\u4E00\u79CD\u7C7B\u578B\u7684\u6570\u636E\u653E\u5728\u4E00\u8D77</p><h4 id="_1-1-3-document-\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#_1-1-3-document-\u6587\u6863" aria-hidden="true">#</a> 1.1.3 Document(\u6587\u6863)</h4><p>\u4FDD\u5B58\u5728\u67D0\u4E2A\u7D22\u5F15\uFF08index\uFF09\u4E0B\uFF0C\u67D0\u79CD\u7C7B\u578B\uFF08Type\uFF09\u7684\u4E00\u4E2A\u6570\u636E\uFF08Document\uFF09,\u6587\u6863\u662F JSON \u683C\u5F0F\u7684\uFF0CDocument \u5C31\u50CF\u662F MySQL \u4E2D\u67D0\u4E2A Table \u91CC\u9762\u7684\u5185\u5BB9</p><h4 id="_1-1-4-\u5012\u6392\u7D22\u5F15\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_1-1-4-\u5012\u6392\u7D22\u5F15\u673A\u5236" aria-hidden="true">#</a> 1.1.4 \u5012\u6392\u7D22\u5F15\u673A\u5236</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201026092738311.png" alt="image-20201026092738311" loading="lazy"></p><h3 id="_1-2-docker-\u5B89\u88C5-es" tabindex="-1"><a class="header-anchor" href="#_1-2-docker-\u5B89\u88C5-es" aria-hidden="true">#</a> 1.2 Docker \u5B89\u88C5 ES</h3><h4 id="_1-2-1-\u4E0B\u8F7D\u955C\u50CF" tabindex="-1"><a class="header-anchor" href="#_1-2-1-\u4E0B\u8F7D\u955C\u50CF" aria-hidden="true">#</a> 1.2.1 \u4E0B\u8F7D\u955C\u50CF</h4><p>docker pull elasticsearch:7.4.2 \u5B58\u50A8\u548C\u68C0\u7D22\u6570\u636E</p><p>docker pull kibana:7.4.2 \u53EF\u89C6\u5316\u68C0\u7D22\u6570\u636E</p><h4 id="_1-2-2-\u521B\u5EFA\u5B9E\u4F8B" tabindex="-1"><a class="header-anchor" href="#_1-2-2-\u521B\u5EFA\u5B9E\u4F8B" aria-hidden="true">#</a> 1.2.2 \u521B\u5EFA\u5B9E\u4F8B</h4><h5 id="_1\u3001elasticsearch" tabindex="-1"><a class="header-anchor" href="#_1\u3001elasticsearch" aria-hidden="true">#</a> 1\u3001ElasticSearch</h5><p>\u914D\u7F6E</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /mydata/elasticsearch/config <span class="token comment"># \u7528\u6765\u5B58\u653E\u914D\u7F6E\u6587\u4EF6</span>
<span class="token function">mkdir</span> -p /mydata/elasticsearch/data  <span class="token comment"># \u6570\u636E</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;http.host: 0.0.0.0&quot;</span> <span class="token operator">&gt;</span>/mydata/elasticsearch/config/elasticsearch.yml <span class="token comment"># \u5141\u8BB8\u4EFB\u4F55\u673A\u5668\u8BBF\u95EE</span>
<span class="token function">chmod</span> -R <span class="token number">777</span> /mydata/elasticsearch/ <span class="token comment">## \u8BBE\u7F6Eelasticsearch\u6587\u4EF6\u53EF\u8BFB\u5199\u6743\u9650</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u52A8</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run --name elasticsearch -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 <span class="token punctuation">\\</span>
-e  <span class="token string">&quot;discovery.type=single-node&quot;</span> <span class="token punctuation">\\</span>
-e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xms64m -Xmx512m&quot;</span> <span class="token punctuation">\\</span>
-v /mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml <span class="token punctuation">\\</span>
-v /mydata/elasticsearch/data:/usr/share/elasticsearch/data <span class="token punctuation">\\</span>
-v  /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\\</span>
-d elasticsearch:7.4.2 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F00\u673A\u542F\u52A8 elasticsearch</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> update elasticsearch --restart<span class="token operator">=</span>always
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4EE5\u540E\u518D\u5916\u9762\u88C5\u597D\u63D2\u4EF6\u91CD\u542F\u5C31\u53EF</p><p>\u7279\u522B\u6CE8\u610F\uFF1A</p><p>-e ES_JAVA_OPTS=&quot;-Xms64m -Xmx128m&quot; \\ \u6D4B\u8BD5\u73AF\u5883\u4E0B\uFF0C\u8BBE\u7F6E ES \u7684\u521D\u59CB\u5185\u5B58\u548C\u6700\u5927\u5185\u5B58\uFF0C\u5426\u5219\u5BFC\u81F4\u8FC7\u5927\u542F\u52A8\u4E0D\u4E86ES</p><h5 id="_2\u3001kibana" tabindex="-1"><a class="header-anchor" href="#_2\u3001kibana" aria-hidden="true">#</a> 2\u3001Kibana</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run --name kibana -e <span class="token assign-left variable">ELASTICSEARCH_HOSTS</span><span class="token operator">=</span>http://192.168.56.10:9200 -p <span class="token number">5601</span>:5601 -d kibana:7.4.2

http://192.168.56.10:9200 \u6539\u6210\u81EA\u5DF1Elasticsearch\u4E0A\u7684\u5730\u5740
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3\u3001\u5B89\u88C5nginx" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5B89\u88C5nginx" aria-hidden="true">#</a> 3\u3001\u5B89\u88C5nginx</h5><p>\u968F\u4FBF\u542F\u52A8\u4E00\u4E2A nginx \u5B9E\u4F8B\uFF0C\u53EA\u662F\u4E3A\u4E86\u590D\u5236\u51FA\u914D\u7F6E</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -p80:80 --name nginx -d nginx:1.10   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5C06\u5BB9\u5668\u5185\u7684\u914D\u7F6E\u6587\u4EF6\u62F7\u8D1D\u5230\u5F53\u524D\u76EE\u5F55 \uFF08\u6CE8\u610F\u540E\u9762\u6709\u4E2A\u5C0F\u70B9</p><p>\uFF09</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> container <span class="token function">cp</span> nginx:/etc/nginx <span class="token builtin class-name">.</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u521B\u5EFAnginx\u6587\u4EF6\u5939</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /mydata/nginx/html
<span class="token function">mkdir</span> -p /mydata/nginx/logs
 <span class="token comment">#\u7531\u4E8E\u62F7\u8D1D\u5B8C\u6210\u540E\u4F1A\u5728config\u4E2D\u5B58\u5728\u4E00\u4E2Anginx\u6587\u4EF6\u5939\uFF0C\u6240\u4EE5\u9700\u8981\u5C06\u5B83\u7684\u5185\u5BB9\u79FB\u52A8\u5230conf\u4E2D</span>
 <span class="token comment">#conf \u6587\u4EF6\u5939\u4E0B\u5C31\u662F\u539F\u5148nginx\u7684\u914D\u7F6E</span>
<span class="token function">mv</span> /mydata/nginx/conf/nginx/* /mydata/nginx/conf/
<span class="token function">rm</span> -rf /mydata/nginx/conf/nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u522B\u5FD8\u4E86\u540E\u9762\u7684\u70B9</p><p>\u4FEE\u6539\u6587\u4EF6\u540D\u79F0\uFF1Amv nginx.conf \u628A\u8FD9\u4E2Aconf \u79FB\u52A8\u5230 /mydata/nginx \u4E0B</p><p>\u7EC8\u6B62\u539F\u5BB9\u5668\uFF0C docker stop nginx</p><p>\u6267\u884C\u547D\u4EE4\u5220\u9664\u5BB9\u5668\uFF1Adocker rm $Containerid</p><p>\u521B\u5EFA\u65B0\u7684 nginx \u6267\u884C\u4EE5\u4E0B\u547D\u4EE4</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code> <span class="token function">docker</span> run -p <span class="token number">80</span>:80 --name nginx <span class="token punctuation">\\</span>
 -v /mydata/nginx/html:/usr/share/nginx/html <span class="token punctuation">\\</span>
 -v /mydata/nginx/logs:/var/log/nginx <span class="token punctuation">\\</span>
 -v /mydata/nginx/conf/:/etc/nginx <span class="token punctuation">\\</span>
 -d nginx:1.10
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-\u521D\u6B65\u68C0\u7D22" tabindex="-1"><a class="header-anchor" href="#_1-3-\u521D\u6B65\u68C0\u7D22" aria-hidden="true">#</a> 1.3 \u521D\u6B65\u68C0\u7D22</h3><h4 id="_1-3-1\u3001-cat" tabindex="-1"><a class="header-anchor" href="#_1-3-1\u3001-cat" aria-hidden="true">#</a> 1.3.1\u3001_cat</h4><p>GET /_cat/nodes\uFF1A\u67E5\u770B\u6240\u6709\u8282\u70B9</p><p>GET /_cat/health\uFF1A\u67E5\u770B es \u5065\u5EB7\u72B6\u51B5</p><p>GET /_cat/master\uFF1A\u67E5\u770B\u4E3B\u8282\u70B9</p><p>GET /_cat/incices\uFF1A\u67E5\u770B\u6240\u6709\u7D22\u5F15 show databases;</p><h4 id="_1-3-2-\u7D22\u5F15\u4E00\u4E2A\u6587\u6863-\u4FDD\u5B58" tabindex="-1"><a class="header-anchor" href="#_1-3-2-\u7D22\u5F15\u4E00\u4E2A\u6587\u6863-\u4FDD\u5B58" aria-hidden="true">#</a> 1.3.2 \u7D22\u5F15\u4E00\u4E2A\u6587\u6863\uFF08\u4FDD\u5B58\uFF09</h4><p>\u4FDD\u5B58\u4E00\u4E2A\u6570\u636E\uFF0C\u4FDD\u5B58\u5728\u54EA\u4E2A\u7D22\u5F15\u7684\u54EA\u4E2A\u7C7B\u578B\u4E0B\uFF0C\u6307\u5B9A\u7528\u54EA\u4E2A\u552F\u4E00\u6807\u8BC6</p><p>PUT customer/external/1; \u5728 customer \u7D22\u5F15\u4E0B\u7684 external \u7C7B\u578B\u4E0B\u4FDD\u5B58 1\u53F7\u6570\u636E\u4E3A</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>PUT customer/external/1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_1-3-3\u3001\u67E5\u8BE2\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#_1-3-3\u3001\u67E5\u8BE2\u6587\u6863" aria-hidden="true">#</a> 1.3.3\u3001\u67E5\u8BE2\u6587\u6863</h4><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>GET custome/external/1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;customer&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5728\u90A3\u4E2A\u7D22\u5F15</span>
    <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;external&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5728\u90A3\u4E2A\u7C7B\u578B</span>
    <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u8BB0\u5F55id</span>
    <span class="token property">&quot;_version&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> \u3002<span class="token comment">// \u7248\u672C\u53F7</span>
    <span class="token property">&quot;_seq_no&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// \u5E76\u53D1\u63A7\u5236\u5B57\u6BB5\uFF0C\u6BCF\u6B21\u66F4\u65B0\u5C31\u4F1A+1\uFF0C\u7528\u6765\u505A\u4E50\u89C2\u9501</span>
    <span class="token property">&quot;_primary_term&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//\u540C\u4E0A\uFF0C\u4E3B\u5206\u7247\u91CD\u65B0\u5206\u914D\uFF0C\u5982\u91CD\u542F\uFF0C\u5C31\u4F1A\u53D8\u5316</span>
    <span class="token property">&quot;found&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;John Doe&quot;</span> <span class="token comment">// \u771F\u6B63\u7684\u5185\u5BB9</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u66F4\u65B0\u643A\u5E26\uFF1A?if_seq_no=4&amp;if_primary_term=1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_1-3-4-\u66F4\u65B0\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#_1-3-4-\u66F4\u65B0\u6587\u6863" aria-hidden="true">#</a> 1.3.4 \u66F4\u65B0\u6587\u6863</h4><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>POST customer/external/1/_update
{
	&quot;doc&quot;:{
		&quot;name&quot;:&quot;John Doew&quot;
	}
}
\u6216\u8005
POST customer/external/1
{
	&quot;name&quot;:&quot;John Doe2&quot;
}
\u6216\u8005
PUT customer/external/1
{
	&quot;name&quot;:&quot;jack&quot;
}
\u4E0D\u540C\uFF1APost\u64CD\u4F5C\u4F1A\u5BF9\u6BD4\u6E90\u6587\u6863\u6570\u636E\uFF0C\u5982\u679C\u76F8\u540C\u4E0D\u4F1A\u6709\u4EC0\u4E48\u64CD\u4F5C\uFF0C\u6587\u6863 version \u4E0D\u589E\u52A0 PUT\u64CD\u4F5C\u603B\u4F1A\u5C06\u6570\u636E\u91CD\u65B0\u4FDD\u5B58\u5E76\u589E\u52A0 version \u7248\u672C
\u5E26 _update \u5BF9\u6BD4\u5143\u6570\u636E\u5982\u679C\u4E00\u6837\u5C31\u4E0D\u8FDB\u884C\u4EFB\u4F55\u64CD\u4F5C
\u770B\u573A\u666F
\u5BF9\u4E8E\u5927\u5E76\u53D1\u66F4\u65B0\uFF0C\u4E0D\u5E26update
\u5BF9\u4E8E\u5927\u5E76\u53D1\u67E5\u8BE2\u5E76\u5076\u5C14\u66F4\u65B0\uFF0C\u5E26update \u5BF9\u6BD4\u66F4\u65B0\uFF0C\u91CD\u65B0\u8BA1\u7B97\u5206\u914D\u89C4\u5219
\u66F4\u65B0\u540C\u65F6\u589E\u52A0\u5C5E\u6027
POS customer/external/1/_update
{
	&quot;doc&quot;:{&quot;name&quot;:&quot;Jane Doe&quot;,&quot;age&quot;:20}
}
PUT \u548C POST \u4E0D\u5E26_update\u4E5F\u53EF\u4EE5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-3-5-\u5220\u9664\u6587\u6863-\u7D22\u5F15" tabindex="-1"><a class="header-anchor" href="#_1-3-5-\u5220\u9664\u6587\u6863-\u7D22\u5F15" aria-hidden="true">#</a> 1.3.5 \u5220\u9664\u6587\u6863&amp;\u7D22\u5F15</h4><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>DELETE customer/external/1
DELETE customer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-3-6-bulk-\u6279\u91CF-api" tabindex="-1"><a class="header-anchor" href="#_1-3-6-bulk-\u6279\u91CF-api" aria-hidden="true">#</a> 1.3.6 bulk \u6279\u91CF API</h4><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>POST customer/external/_bulk
{&quot;index&quot;:{&quot;_id&quot;:&quot;1&quot;}}
{&quot;name&quot;:&quot;John Doe&quot;}
{&quot;index&quot;:{&quot;_id&quot;:&quot;2&quot;}}
{&quot;name&quot;:&quot;John Doe&quot;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BED\u6CD5\u683C\u5F0F</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>action<span class="token operator">:</span><span class="token punctuation">{</span>metadata<span class="token punctuation">}</span><span class="token punctuation">}</span>\\n
<span class="token punctuation">{</span>requeestBody<span class="token punctuation">}</span>\\n
<span class="token punctuation">{</span>action<span class="token operator">:</span><span class="token punctuation">{</span>metadata<span class="token punctuation">}</span><span class="token punctuation">}</span>\\n
<span class="token punctuation">{</span>requesetbod <span class="token punctuation">}</span>\\n
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u590D\u6742\u5B9E\u4F8B\uFF1A</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>POST /_bulk
{&quot;delete&quot;:{&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;}}
{&quot;create&quot;:{&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;}}
{&quot;title&quot;:&quot;my first blog post&quot;}
{&quot;index&quot;:{&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;}}
{&quot;title&quot;:&quot;my second blog post&quot;}
{&quot;update&quot;:{&quot;_index&quot;:&quot;website&quot;,&quot;_type&quot;:&quot;blog&quot;,&quot;_id&quot;:&quot;123&quot;}}
{&quot;doc&quot;:{&quot;title&quot;:&quot;my updated blog post&quot;}}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>bulk API\u4EE5\u6B64\u6309\u987A\u5E8F\u6267\u884C\u6240\u6709\u7684action (\u52A8\u4F5C)\u3002\u5982\u679C\u4E00\u4E00\u4E2A\u5355\u4E2A\u7684\u52A8\u4F5C\u56E0\u4EFB\u4F55\u539F\u56E0\u800C\u5931\u8D25\uFF0C\u5B83\u5C06\u7EE7\u7EED\u5904\u7406\u5B83\u540E\u9762\u5269\u4F59\u7684\u52A8\u4F5C\u3002\u5F53bulkAPI \u8FD4\u56DE\u65F6\uFF0C\u5B83\u5C06\u63D0\u4F9B\u6BCF\u4E2A\u52A8\u4F5C\u7684\u72B6\u6001(\u4E0E\u53D1\u9001\u7684\u987A\u5E8F\u76F8\u540C)\uFF0C\u6240\u4EE5\u60A8\u53EF\u4EE5\u68C0\u67E5\u662F\u5426\u4E00\u4E2A\u6307\u5B9A\u7684\u52A8\u4F5C\u662F\u4E0D\u662F\u5931\u8D25\u4E86\u3002</p><h4 id="_1-3-7-\u6837\u672C\u6D4B\u8BD5\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_1-3-7-\u6837\u672C\u6D4B\u8BD5\u6570\u636E" aria-hidden="true">#</a> 1.3.7 \u6837\u672C\u6D4B\u8BD5\u6570\u636E</h4><p>\u6211\u51C6\u5907\u4E86\u4E00\u4EFD\u987E\u5BA2\u94F6\u884C\u8D26\u6237\u4FE1\u606F\u865A\u6784\u7684 JSON \u6587\u6863\u6837\u672C\uFF0C\u6BCF\u4E2A\u7528\u6237\u90FD\u6709\u4E0B\u5217\u7684 schema \uFF08\u6A21\u5F0F\uFF09\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;account_number&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token number">39225</span><span class="token punctuation">,</span>
	<span class="token property">&quot;firstname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Amber&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;lastname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Duke&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
	<span class="token property">&quot;gender&quot;</span><span class="token operator">:</span> <span class="token string">&quot;M&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;880 Holmes Lane&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;employer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Pyrami&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;amberduke@pyrami.com&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;city&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Brogan&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IL&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,71),Lt={href:"https://github.com/elastic/elasticsearch/edit/master/docs/src/test/resources/accounts.json",target:"_blank",rel:"noopener noreferrer"},Vt=s("https://github.com/elastic/elasticsearch/edit/master/docs/src/test/resources/accounts.json"),Dt=p(`<p>\u5BFC\u5165\u6D4B\u8BD5\u6570\u636E</p><p>POST bank/account/_bank</p><p>\u6D4B\u8BD5\u6570\u636E</p><p><img src="http://qnimg.gisfsde.com/work/image-20201026114903942.png" alt="image-20201026114903942" loading="lazy"></p><h3 id="_1-4-\u8FDB\u9636\u68C0\u7D22" tabindex="-1"><a class="header-anchor" href="#_1-4-\u8FDB\u9636\u68C0\u7D22" aria-hidden="true">#</a> 1.4 \u8FDB\u9636\u68C0\u7D22</h3><h4 id="_1-4-1-searchapi" tabindex="-1"><a class="header-anchor" href="#_1-4-1-searchapi" aria-hidden="true">#</a> 1.4.1 SearchAPI</h4><p>ES \u652F\u6301\u4E24\u79CD\u57FA\u672C\u65B9\u5F0F\u68C0\u7D22:</p><ul><li>\u4E00\u4E2A\u662F\u901A\u8FC7\u4F7F\u7528 REST request URL,\u53D1\u9001\u641C\u7D22\u53C2\u6570\uFF0C(uri + \u68C0\u7D22\u53C2\u6570)</li><li>\u53E6\u4E00\u4E2A\u662F\u901A\u8FC7\u4F7F\u7528 REST request bod \u6765\u53D1\u9001\u4ED6\u4EEC\uFF0C(uri + \u8BF7\u6C42\u4F53)</li></ul><p>1\u3001\u68C0\u7D22\u4FE1\u606F</p><p>\u4E00\u5207\u68C0\u7D22\u4ECE_search\u5F00\u59CB</p><p>GET /bank/_search \u68C0\u7D22 bank \u4E0B\u7684\u6240\u6709\u4FE1\u606F\uFF0C\u5305\u62EC type \u548C docs</p><p>GET /bank/_search?q=*&amp;sort=account_number:asc \u8BF7\u6C42\u53C2\u6570\u65B9\u5F0F\u68C0\u7D22</p><p>\u54CD\u5E94\u7ED3\u679C\u89E3\u91CA took - Elasticearch\u6267\u884C\u641C\u7D22\u7684\u65F6\u95F4(\u6BEB\u79D2)</p><p>time_ out - \u544A\u8BC9\u6211\u4EEC\u641C\u7D22\u662F\u5426\u8D85\u65F6</p><p>_shards - \u544A\u8BC9\u6211\u4EEC\u591A\u5C11\u4E2A\u5206\u7247\u88AB\u641C\u7D22\u4E86\uFF0C\u4EE5\u53CA\u7EDF\u8BA1\u4E86\u6210\u529F/\u5931\u8D25\u7684\u641C\u7D22\u5206\u7247 hit - \u641C\u7D22\u7ED3\u679C hits.total - \u641C\u7D22\u7ED3\u679C hits.hits - \u5B9E\u9645\u7684\u641C\u7D22\u7ED3\u679C\u6570\u7EC4(\u9ED8\u8BA4\u4E3A\u524D10\u7684\u6587\u6863) sort - \u7ED3\u679C\u7684\u6392\u5E8Fkey (\u952E) (\u6CA1\u6709\u5219\u6309 score \u6392\u5E8F) score \u548C max score - \u76F8\u5173\u6027\u5F97\u5206\u548C\u6700\u9AD8\u5F97\u5206(\u5168\u6587\u68C0\u7D22\u7528)</p><p>uri + \u8BF7\u6C42\u4F53\u8FDB\u884C\u68C0\u67E5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>GET <span class="token operator">/</span>bank<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;account_number&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>HTTP \u5BA2\u6237\u7AEF\u5DE5\u5177\uFF08POSTMAN\uFF09,get\u8BF7\u6C42\u4E0D\u80FD\u643A\u5E26\u8BF7\u6C42\u4F53\uFF0C\u6211\u4EEC\u53D8\u4E3A post\u4E5F\u662F\u4E00\u6837\u7684 \u6211\u4EEC POST \u4E00\u4E2A JSON\u98CE\u683C\u7684\u67E5\u8BE2\u8BF7\u6C42\u4F53\u5230 _search API</p><p>\u9700\u8981\u4E86\u89E3\uFF0C\u4E00\u65E6\u641C\u7D22\u7ED3\u679C\u88AB\u8FD4\u56DE\uFF0CES \u5C31\u5B8C\u6210\u4E86\u8FD9\u6B21\u8BF7\u6C42\u7684\u641C\u7D22\uFF0C\u5E76\u4E14\u4E0D\u4F1A\u7EF4\u62A4\u4EFB\u4F55\u670D\u52A1\u7AEF\u7684\u8D44\u6E90\u6216\u8005\u7ED3\u679C\u7684 cursor\uFF08\u6E38\u6807\uFF09</p><h4 id="_1-4-2\u3001querydsl" tabindex="-1"><a class="header-anchor" href="#_1-4-2\u3001querydsl" aria-hidden="true">#</a> 1.4.2\u3001QueryDSL</h4><h5 id="_1\u3001\u57FA\u672C\u8BED\u6CD5\u683C\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u57FA\u672C\u8BED\u6CD5\u683C\u5F0F" aria-hidden="true">#</a> 1\u3001\u57FA\u672C\u8BED\u6CD5\u683C\u5F0F</h5><p>ES \u63D0\u4F9B\u4E86\u4E00\u4E2A\u53EF\u4EE5\u6267\u884C\u67E5\u8BE2\u7684 Json \u98CE\u683C\u7684 DSL \uFF08domain-specifig langurage \u9886\u57DF\u7279\u5B9A\u8BED\u8A00\uFF09\uFF0C\u8FD9\u4E2A\u88AB\u6210\u4E3A Query DSL \uFF0C\u8BE5\u67E5\u8BE2\u8BED\u8A00\u975E\u5E38\u5168\u9762\uFF0C\u5E76\u4E14\u521A\u5F00\u59CB\u7684\u65F6\u5019\u4F18\u70B9\u590D\u6742\uFF0C\u771F\u6B63\u5B66\u597D\u5BF9\u4ED6\u7684\u65B9\u6CD5\u662F\u4ECE\u4E00\u4E9B\u57FA\u7840\u7684\u793A\u4F8B\u5F00\u59CB\u7684</p><p>\u4E00\u4E2A\u67E5\u8BE2\u8BED\u53E5 \u7684\u5178\u578B\u7ED3\u6784</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    QUERY_NAME<span class="token operator">:</span><span class="token punctuation">{</span>
        ARGUMENT<span class="token operator">:</span>VALUE<span class="token punctuation">,</span>
        ARGUMENT<span class="token operator">:</span>VALUE.....
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u679C\u9488\u5BF9\u67D0\u4E2A\u5B57\u6BB5\uFF0C\u90A3\u4E48\u5B83\u7684\u7ED3\u6784\u5982\u4E0B</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    QUERY_NAME<span class="token operator">:</span><span class="token punctuation">{</span>
        FIELD_NAME<span class="token operator">:</span><span class="token punctuation">{</span>
            ARGUMENT<span class="token operator">:</span>VALUE<span class="token punctuation">,</span>
            ARGUMENT<span class="token operator">:</span>VALUE.....
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>GET /bank/_search
{
  &quot;query&quot;: { &quot;match_all&quot;: {} },
  &quot;sort&quot;: [
    { &quot;account_number&quot;: &quot;asc&quot; }
  ],
  &quot;from&quot;: 10,
  &quot;size&quot;: 10
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>query \u5B9A\u4E49\u5982\u4F55\u67E5\u8BE2</p><p>match_all \u67E5\u8BE2\u7C7B\u578B\u3010\u4EE3\u8868\u67E5\u8BE2\u6240\u6709\u7684\u6240\u6709\u3011\uFF0Ces\u4E2D\u53EF\u4EE5\u5728 query\u4E2D \u7EC4\u5408\u975E\u5E38\u591A\u7684\u67E5\u8BE2\u7C7B\u578B\u5B8C\u6210\u590D\u6742\u67E5\u8BE2</p><p>\u9664\u4E86 query \u53C2\u6570\u4E4B\u5916\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u4F20\u9012\u5176\u4ED6\u7684\u53C2\u6570\u6539\u53D8\u67E5\u8BE2\u7ED3\u6784\uFF0C\u5982 sort\uFF0Csize</p><p>from + size \u9650\u5B9A\uFF0C\u5B8C\u6210\u5206\u9875\u529F\u80FD</p><p>sort\u6392\u5E8F\uFF0C\u591A\u5B57\u6BB5\u6392\u5E8F\uFF0C\u4F1A\u5728\u524D\u5E8F\u5B57\u6BB5\u76F8\u7B49\u65F6\u540E\u7EED\u5B57\u6BB5\u5185\u90E8\u6392\u5E8F\uFF0C\u5426\u5219\u4EE5\u524D\u5E8F\u4E3A\u51C6</p><h5 id="_2\u3001\u8FD4\u56DE\u90E8\u5206\u5B57\u6BB5" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u8FD4\u56DE\u90E8\u5206\u5B57\u6BB5" aria-hidden="true">#</a> 2\u3001\u8FD4\u56DE\u90E8\u5206\u5B57\u6BB5</h5><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code> GET bank/_search
 {
   &quot;query&quot;:{
     &quot;match_all&quot;: {}
   },
   &quot;sort&quot;: [
     {
       &quot;balance&quot;: {
         &quot;order&quot;: &quot;desc&quot;
       }
     }
   ],
   &quot;from&quot;: 5,
   &quot;size&quot;: 5,
   &quot;_source&quot;: [&quot;firstname&quot;,&quot;lastname&quot;]
 }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3\u3001match\u3010\u5339\u914D\u67E5\u8BE2\u3011" tabindex="-1"><a class="header-anchor" href="#_3\u3001match\u3010\u5339\u914D\u67E5\u8BE2\u3011" aria-hidden="true">#</a> 3\u3001match\u3010\u5339\u914D\u67E5\u8BE2\u3011</h5><p>\u57FA\u672C\u7C7B\u578B(\u975E\u5B57\u7B26\u4E32)\uFF0C\u7CBE\u51C6\u5339\u914D</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>GET bank/_search
{
  &quot;query&quot;:{
   &quot;match&quot;: {
     &quot;address&quot;: &quot;mill lane&quot;
   } 
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5168\u6587\u68C0\u7D22\u6309\u7167\u8BC4\u5206\u8FDB\u884C\u6392\u5E8F\uFF0C\u4F1A\u5BF9\u68C0\u7D22\u6761\u4EF6\u8FDB\u884C\u5206\u8BCD\u5339\u914D</p><h5 id="_4\u3001match-phrase\u3010\u77ED\u8BED\u5339\u914D\u3011" tabindex="-1"><a class="header-anchor" href="#_4\u3001match-phrase\u3010\u77ED\u8BED\u5339\u914D\u3011" aria-hidden="true">#</a> 4\u3001match_phrase\u3010\u77ED\u8BED\u5339\u914D\u3011</h5><p>\u5C06\u9700\u8981\u5339\u914D\u7684\u503C\u5F53\u6210\u4E00\u4E2A\u6574\u4F53\u5355\u8BCD\uFF08\u4E0D\u5206\u8BCD\uFF09\u8FDB\u884C\u68C0\u7D22</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>GET /bank/_search
{
  &quot;query&quot;: { &quot;match_phrase&quot;: { &quot;address&quot;: &quot;mill lane&quot; } }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5\u3001multi-match\u3010\u591A\u5B57\u6BB5\u5339\u914D\u3011" tabindex="-1"><a class="header-anchor" href="#_5\u3001multi-match\u3010\u591A\u5B57\u6BB5\u5339\u914D\u3011" aria-hidden="true">#</a> 5\u3001multi_match\u3010\u591A\u5B57\u6BB5\u5339\u914D\u3011</h5><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>GET bank/_search
{
  &quot;query&quot;:{
    &quot;multi_match&quot;: {
      &quot;query&quot;: &quot;mill&quot;,
      &quot;fields&quot;: [&quot;address&quot;,&quot;city&quot;]
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6\u3001bool-\u3010\u590D\u5408\u67E5\u8BE2\u3011" tabindex="-1"><a class="header-anchor" href="#_6\u3001bool-\u3010\u590D\u5408\u67E5\u8BE2\u3011" aria-hidden="true">#</a> 6\u3001bool \u3010\u590D\u5408\u67E5\u8BE2\u3011</h5><p>bool \u7528\u6765\u505A\u590D\u5408\u67E5\u8BE2</p><p>\u590D\u5408\u8BED\u53E5\u53EF\u4EE5\u5408\u5E76 \u4EFB\u4F55 \u5176\u4ED6\u5D4C\u5957\u8BED\u53E5\uFF0C\u5305\u62EC\u590D\u5408\u8BED\u53E5\uFF0C\u4E86\u89E3\u8FD9\u4E00\u70B9\u662F\u5F88\u91CD\u8981\u7684\uFF0C\u8FD9\u5C31\u610F\u5473\u7740\uFF0C\u590D\u5408\u8BED\u53E5\u4E4B\u95F4\u53EF\u4EE5\u4E92\u76F8\u5D4C\u5957\uFF0C\u53EF\u4EE5\u8868\u8FBE\u5F0F\u975E\u5E38\u590D\u6742\u7684\u903B\u8F91</p><ul><li>must\uFF1A\u5FC5\u987B\u8FBE\u5230 must \u5217\u4E3E\u7684\u6240\u6709\u6761\u4EF6</li></ul><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>GET /bank/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: [
        {
          &quot;match&quot;: {
            &quot;gender&quot;: &quot;M&quot;
          }
        },
        {
          &quot;match&quot;: {
            &quot;address&quot;: &quot;mill&quot;
          }
        }
      ],
      &quot;must_not&quot;: [
        {&quot;match&quot;:{
          &quot;age&quot;:&quot;18&quot;
        }}
      ],
      &quot;should&quot;: [
        {&quot;match&quot;: {
          &quot;lastname&quot;: &quot;Wallace&quot;
        }}
      ]
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>should:\u5E94\u8BE5\u8FBE\u5230 should \u5217\u4E3E\u7684\u6761\u4EF6\uFF0C\u5982\u679C\u8FBE\u5230\u4F1A\u589E\u52A0\u76F8\u5173\u6587\u6863\u7684\u8BC4\u5206\uFF0C\u5E76\u4E0D\u4F1A\u6539\u53D8\u67E5\u8BE2\u7684\u7ED3\u679C\uFF0C\u5982\u679C query \u4E2D\u53EA\u6709 should \u4E14\u53EA\u6709\u4E00\u79CD\u5339\u914D\u89C4\u5219\uFF0C\u90A3\u4E48 should\u7684\u6761\u4EF6\u5C31\u4F1A\u88AB\u4F5C\u4E3A\u9ED8\u8BA4\u5339\u914D\u6761\u4EF6\u800C\u533A\u6539\u53D8\u67E5\u8BE2\u7ED3\u679C</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code> <span class="token property">&quot;should&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;lastname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Wallace&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>must_not \u5FC5\u987B\u4E0D\u662F\u6307\u5B9A\u7684\u60C5\u51B5</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;must_not&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token property">&quot;age&quot;</span><span class="token operator">:</span><span class="token string">&quot;18&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://qnimg.gisfsde.com/work/image-20201026052225903.png" alt="image-20201026052225903" loading="lazy"></p><h5 id="_7\u3001filter\u3010\u7ED3\u679C\u8FC7\u6EE4\u3011" tabindex="-1"><a class="header-anchor" href="#_7\u3001filter\u3010\u7ED3\u679C\u8FC7\u6EE4\u3011" aria-hidden="true">#</a> 7\u3001filter\u3010\u7ED3\u679C\u8FC7\u6EE4\u3011</h5><p>\u5E76\u4E0D\u662F\u6240\u6709\u7684\u67E5\u8BE2\u90FD\u9700\u8981\u4EA7\u751F\u5206\u6570\uFF0C\u7279\u522B\u662F\u90A3\u4E9B\u4EC5\u4EC5\u7528\u4E8E filtering\uFF08\u8FC7\u6EE4\uFF09\u7684\u6587\u6863\uFF0C\u4E3A\u4E86\u4E0D\u8BA1\u7B97\u5206\u6570 ES \u4F1A\u81EA\u52A8\u68C0\u67E5\u573A\u666F\u5E76\u4E14\u4F18\u5316\u67E5\u8BE2\u7684\u6267\u884C</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>GET /bank/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;must&quot;: { &quot;match_all&quot;: {} },
      &quot;filter&quot;: {
        &quot;range&quot;: {
          &quot;balance&quot;: {
            &quot;gte&quot;: 20000,
            &quot;lte&quot;: 30000
          }
        }
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8\u3001term" tabindex="-1"><a class="header-anchor" href="#_8\u3001term" aria-hidden="true">#</a> 8\u3001term</h5><p>\u548C match \u4E00\u6837\uFF0C\u5339\u914D\u67D0\u4E2A\u5C5E\u6027\u7684\u503C\uFF0C\u5168\u6587\u68C0\u7D22\u5B57\u6BB5\u7528 match\uFF0C\u5176\u4ED6\u975Etext\u5B57\u6BB5\u5339\u914D\u7528 term</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>GET bank/_search
{
  &quot;query&quot;:{
    &quot;match_phrase&quot;: {
      &quot;address&quot;: &quot;789 Madison Street&quot;
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_9\u3001aggregations-\u6267\u884C\u805A\u5408" tabindex="-1"><a class="header-anchor" href="#_9\u3001aggregations-\u6267\u884C\u805A\u5408" aria-hidden="true">#</a> 9\u3001aggregations\uFF08\u6267\u884C\u805A\u5408\uFF09</h5><p>\u805A\u5408\u63D0\u4F9B\u4E86\u4ECE\u6570\u636E\u5206\u7EC4\u548C\u63D0\u53D6\u6570\u636E\u7684\u80FD\u529B\uFF0C\u6700\u7B80\u5355\u7684\u805A\u5408\u65B9\u6CD5\u5927\u81F4\u7B49\u4E8E SQL GROUP BY \u548C SQL \u805A\u5408\u51FD\u6570\uFF0C\u5728 ES \u4E2D\uFF0C\u4F60\u6709\u6267\u884C\u641C\u7D22\u8FD4\u56DE hits \uFF08\u547D\u4E2D\u7ED3\u679C\uFF09 \u5E76\u4E14\u540C\u65F6\u8FD4\u56DE\u805A\u5408\u7ED3\u679C\uFF0C\u628A\u4E00\u4E2A\u54CD\u5E94\u4E2D\u7684\u6240\u6709 hits\uFF08\u547D\u4E2D\u7ED3\u679C\uFF09\u5206\u9694\u5F00\u7684\u80FD\u529B\uFF0C\u8FD9\u662F\u975E\u5E38\u5F3A\u5927\u6709\u6548\u7684\uFF0C\u4F60\u53EF\u4EE5\u6267\u884C\u67E5\u8BE2\u548C\u591A\u4E2A\u805A\u5408\uFF0C\u5E76\u4E14\u5728\u4E00\u4E2A\u4F7F\u7528\u4E2D\u5F97\u5230\u5404\u81EA\u7684\uFF08\u4EFB\u4F55\u4E00\u4E2A\u7684\uFF09\u8FD4\u56DE\u7ED3\u679C\uFF0C\u4F7F\u7528\u4E00\u6B21\u7B80\u6D01\u7B80\u5316\u7684 API \u6765\u907F\u514D\u7F51\u7EDC\u5F80\u8FD4</p><p><strong>\u641C\u7D22address\u4E2D\u5305\u542Bmill\u7684\u6240\u6709\u4EBA\u7684\u5E74\u9F84\u5206\u5E03\u4EE5\u53CA\u5E73\u5747\u5E74\u9F84</strong></p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>GET bank/_search
{
  &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;address&quot;: &quot;mill&quot;
    }
  },
  &quot;aggs&quot;: {
    &quot;ageAgg&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;age&quot;,
        &quot;size&quot;: 10
      }
    },
    &quot;ageAvg&quot;:{
      &quot;avg&quot;: {
        &quot;field&quot;: &quot;age&quot;
      }
    },
    &quot;balanceAvg&quot;:{
      &quot;avg&quot;: {
        &quot;field&quot;: &quot;balance&quot;
      }
    }
    
  },
  &quot;size&quot;:0
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6309\u7167\u5E74\u9F84\u805A\u5408\uFF0C\u5E76\u4E14\u8BF7\u6C42\u8FD9\u4E9B\u5E74\u9F84\u6BB5\u7684\u8FD9\u4E9B\u4EBA\u7684\u5E73\u5747\u85AA\u8D44</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>GET bank<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ageAgg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;ageAvg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;avg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;balance&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u67E5\u51FA\u6240\u6709\u5E74\u9F84\u5206\u5E03\uFF0C\u5E76\u4E14\u8FD9\u4E9B\u5E74\u9F84\u6BB5\u4E2DM\u7684\u5E73\u5747\u85AA\u8D44\u548C F \u7684\u5E73\u5747\u85AA\u8D44\u4EE5\u53CA\u8FD9\u4E2A\u5E74\u9F84\u6BB5\u7684\u603B\u4F53\u5E73\u5747\u85AA\u8D44</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>GET <span class="token operator">/</span>bank<span class="token operator">/</span>_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ageAgg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">100</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;genderAgg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gender.keyword&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;balanceAvg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;avg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;balance&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_10\u3001nested" tabindex="-1"><a class="header-anchor" href="#_10\u3001nested" aria-hidden="true">#</a> 10\u3001nested</h5><p>\u5D4C\u5957\u67E5\u8BE2</p><p>\u6570\u636E\u7C7B\u578B\u6982\u89C8</p><p><img src="http://qnimg.gisfsde.com/work/image-20201225063939652.png" alt="image-20201225063939652" loading="lazy"></p>`,71),Bt=s("\u53C2\u8003\u535A\u5BA2\uFF1A"),Mt={href:"https://elastic.blog.csdn.net/article/details/82950393",target:"_blank",rel:"noopener noreferrer"},Ut=s("https://elastic.blog.csdn.net/article/details/82950393"),Nt=p('<h4 id="_1-4-3-mapping" tabindex="-1"><a class="header-anchor" href="#_1-4-3-mapping" aria-hidden="true">#</a> 1.4.3 Mapping</h4><h5 id="_1\u3001\u5B57\u6BB5\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5B57\u6BB5\u7C7B\u578B" aria-hidden="true">#</a> 1\u3001\u5B57\u6BB5\u7C7B\u578B</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201026074813810.png" alt="image-20201026074813810" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201026074841875.png" alt="image-20201026074841875" loading="lazy"></p><h5 id="_2\u3001\u6620\u5C04" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6620\u5C04" aria-hidden="true">#</a> 2\u3001\u6620\u5C04</h5><p>Mapping\uFF08\u6620\u5C04\uFF09</p><p>Mapping \u662F\u7528\u6765\u5B9A\u4E49\u4E00\u4E2A\u6587\u6863\uFF08document\uFF09,\u4EE5\u53CA\u4ED6\u6240\u5305\u542B\u7684\u5C5E\u6027\uFF08field\uFF09\u662F\u5982\u4F55\u5B58\u50A8\u7D22\u5F15\u7684\uFF0C\u6BD4\u5982\u4F7F\u7528 mapping\u6765\u5B9A\u4E49\u7684\uFF1A</p><ul><li>\u54EA\u4E9B\u5B57\u7B26\u4E32\u5C5E\u6027\u5E94\u8BE5\u88AB\u770B\u505A\u5168\u6587\u672C\u5C5E\u6027\uFF08full text fields\uFF09</li><li>\u90A3\u4E9B\u5C5E\u6027\u5305\u542B\u6570\u5B57\uFF0C\u65E5\u671F\u6216\u8005\u5730\u7406\u4F4D\u7F6E</li><li>\u6587\u6863\u4E2D\u7684\u6240\u6709\u5C5E\u6027\u662F\u80FD\u88AB\u7D22\u5F15\uFF08_all \u914D\u7F6E\uFF09</li><li>\u65E5\u671F\u7684\u683C\u5F0F</li><li>\u81EA\u5B9A\u4E49\u6620\u5C04\u89C4\u5219\u6765\u6267\u884C\u52A8\u6001\u6DFB\u52A0\u5C5E\u6027</li></ul><p>\u67E5\u770B mapping \u4FE1\u606F</p><p>GET bank/_mapping</p><p>\u4FEE\u6539 mapping \u4FE1\u606F</p>',11),zt={href:"https://www.elastic.co/guide/en/elasticsearch/reference/7.10/mapping-types.html",target:"_blank",rel:"noopener noreferrer"},Ft=s("https://www.elastic.co/guide/en/elasticsearch/reference/7.10/mapping-types.html"),Gt=p(`<p>\u81EA\u52A8\u731C\u6D4B\u7684\u6620\u5C04\u7C7B\u578B</p><p><img src="http://qnimg.gisfsde.com/work/image-20201026075424198.png" alt="image-20201026075424198" loading="lazy"></p><h5 id="_3\u3001\u65B0\u7248\u672C\u6539\u53D8" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u65B0\u7248\u672C\u6539\u53D8" aria-hidden="true">#</a> 3\u3001\u65B0\u7248\u672C\u6539\u53D8</h5><ul><li><p>\u5173\u7CFB\u578B\u6570\u636E\u5E93\u4E2D\u4E24\u4E2A\u6570\u636E\u8868\u793A\u662F\u72EC\u7ACB\u7684\uFF0C\u5373\u4F7F\u4ED6\u4EEC\u91CC\u9762\u6709\u76F8\u540C\u540D\u79F0\u7684\u5217\u4E5F\u4E0D\u5F71\u54CD\u4F7F\u7528\uFF0C\u4F46ES\u4E2D\u4E0D\u662F\u8FD9\u6837\u7684\u3002elasticsearch \u662F\u57FA\u4E8ELucene\u5F00\u53D1\u7684\u641C\u7D22\u5F15\u64CE\uFF0C\u800CES\u4E2D\u4E0D\u540Ctype\u4E0B\u540D\u79F0\u76F8\u540C\u7684filed \u6700\u7EC8\u5728Lucene,\u4E2D\u7684\u5904\u7406\u65B9\u5F0F\u662F\u4E00\u6837\u7684\u3002</p></li><li><p>\u4E24\u4E2A\u4E0D\u540C type\u4E0B\u7684\u4E24\u4E2Auser_ name, \u5728ES\u540C-\u4E2A\u7D22\u5F15\u4E0B\u5176\u5B9E\u88AB\u8BA4\u4E3A\u662F\u540C\u4E00\u4E00\u4E2Afiled,\u4F60\u5FC5\u987B\u5728\u4E24\u4E2A\u4E0D\u540C\u7684type\u4E2D\u5B9A\u4E49\u76F8\u540C\u7684filed\u6620\u5C04\u3002\u5426\u5219\uFF0C\u4E0D\u540Ctyppe\u4E2D\u7684\u76F8\u540C\u5B57\u6BB5\u79F0\u5C31\u4F1A\u5728\u5904\u7406\u4E2D\u51FA\u73B0\u795E\u7A81\u7684\u60C5\u51B5\uFF0C\u5BFC\u81F4Lucene\u5904\u7406\u6548\u7387\u4E0B\u964D\u3002</p></li><li><p>\u53BB\u6389type\u5C31\u662F\u4E3A\u4E86\u63D0\u9AD8ES\u5904\u7406\u6570\u636E\u7684\u6548\u7387\u3002</p></li></ul><p>ES 7.x</p><p>URL \u4E2D\u7684 type \u53C2\u6570 \u53EF\u9009\uFF0C\u6BD4\u5982\u7D22\u5F15\u4E00\u4E2A\u6587\u6863\u4E0D\u518D\u8981\u6C42\u63D0\u4F9B\u6587\u6863\u7C7B\u578B</p><p>ES 8.X</p><p>\u4E0D\u5728\u652F\u6301 URL \u4E2D\u7684 type \u53C2\u6570</p><p>\u89E3\u51B3\uFF1A</p><p>1\u3001\u5C06\u7D22\u5F15\u4ECE\u591A\u7C7B\u578B\u8FC1\u79FB\u5230\u5355\u7C7B\u578B\uFF0C\u6BCF\u79CD\u7C7B\u578B\u6587\u6863\u4E00\u4E2A\u72EC\u7ACB\u7684\u7D22\u5F15</p><p>2\u3001\u5C06\u5DF2\u5B58\u5728\u7684\u7D22\u5F15\u4E0B\u7684\u7C7B\u578B\u6570\u636E\uFF0C\u5168\u90E8\u8FC1\u79FB\u5230\u6307\u5B9A\u4F4D\u7F6E\u5373\u53EF\uFF0C\u8BE6\u89C1\u6570\u636E\u8FC1\u79FB</p><p><strong>1\u3001\u521B\u5EFA\u6620\u5C04</strong></p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>PUT /my_index
{
  &quot;mappings&quot;:{
    &quot;properties&quot;: {
      &quot;age&quot;:{&quot;type&quot;:&quot;integer&quot;},
      &quot;email&quot;:{&quot;type&quot;:&quot;keyword&quot;}
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2\u3001\u6DFB\u52A0\u65B0\u7684\u5B57\u6BB5\u6620\u5C04</strong></p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>PUT /my_index/_mapping
{
  &quot;properties&quot;:{
    &quot;employeeid&quot;:{
      &quot;type&quot;:&quot;keyword&quot;,
      &quot;index&quot;:false
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3\u3001\u66F4\u65B0\u6620\u5C04" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u66F4\u65B0\u6620\u5C04" aria-hidden="true">#</a> 3\u3001\u66F4\u65B0\u6620\u5C04</h5><p>\u5BF9\u4E8E\u5DF2\u7ECF\u5B58\u5728\u7684\u6620\u5C04\u5B57\u6BB5\uFF0C\u6211\u4EEC\u4E0D\u80FD\u66F4\u65B0\uFF0C\u66F4\u65B0\u5FC5\u987B\u521B\u5EFA\u65B0\u7684\u7D22\u5F15\u8FDB\u884C\u6570\u636E\u8FC1\u79FB</p><p><strong>4\u3001\u6570\u636E\u8FC1\u79FB</strong></p><p>\u5148\u521B new_twitter \u7684\u6B63\u786E\u6620\u5C04\uFF0C\u7136\u4E4E\u4F7F\u7528\u5982\u4E0B\u65B9\u5F0F\u8FDB\u884C\u6570\u636E\u8FC1\u79FB</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>POST _reindex [\u56FA\u5B9A\u5199\u6CD5]
{
  &quot;source&quot;:{
    &quot;index&quot;:&quot;twitter&quot;
  },
  &quot;dest&quot;:{
    &quot;index&quot;:&quot;new_twitter&quot;
  }
}
## \u5C06\u65E7\u7D22\u5F15\u7684 type \u4E0B\u7684\u6570\u636E\u8FDB\u884C\u8FC1\u79FB
POST _reindex
{
  &quot;source&quot;: {
    &quot;index&quot;:&quot;twitter&quot;,
    &quot;type&quot;:&quot;tweet&quot;
  },
  &quot;dest&quot;:{
    &quot;index&quot;:&quot;twweets&quot;
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,20),Qt=s("\u53C2\u8003\u5B98\u7F51\uFF1A"),Ht={href:"https://www.elastic.co/guide/en/elasticsearch/reference/7.10/mapping-types.html",target:"_blank",rel:"noopener noreferrer"},Wt=s("https://www.elastic.co/guide/en/elasticsearch/reference/7.10/mapping-types.html"),Jt=s("\u53C2\u6570\u6620\u5C04\u89C4\u5219\uFF1A"),Kt={href:"https://www.elastic.co/guide/en/elasticsearch/reference/7.10/mapping-params.html#mapping-params",target:"_blank",rel:"noopener noreferrer"},$t=s("https://www.elastic.co/guide/en/elasticsearch/reference/7.10/mapping-params.html#mapping-params"),Xt=p('<h4 id="_1-4-4-\u5206\u8BCD" tabindex="-1"><a class="header-anchor" href="#_1-4-4-\u5206\u8BCD" aria-hidden="true">#</a> 1.4.4 \u5206\u8BCD</h4><p>\u4E00\u4E2A <strong>tokenizer</strong>\uFF08\u5206\u8BCD\u5668\uFF09\u63A5\u6536\u4E00\u4E2A\u5B57\u7B26\u6D41\uFF0C\u5C06\u4E4B\u5206\u5272\u4E3A\u72EC\u7ACB\u7684 <strong>tokens</strong>\uFF08\u8BCD\u5143\uFF0C\u901A\u5E38\u662F\u72EC\u7ACB\u7684\u5355\u8BCD\uFF09\uFF0C\u7136\u540E\u8F93\u51FA <strong>token</strong> \u6D41</p><p>\u5217\u5982\uFF0Cwitespace tokenizer \u9047\u5230\u7684\u7A7A\u767D\u5B57\u7B26\u65F6\u5206\u5272\u6587\u672C\uFF0C\u5B83\u4F1A\u5C06\u6587\u672C \u201CQuick brown fox\u201D \u5206\u5272\u4E3A \u3010Quick brown fox\u3011</p><p>\u8BE5 <strong>tokenizer</strong> (\u5206\u8BCD\u5668)\u8FD8\u8D1F\u8D23\u8BB0\u5F55\u5404\u4E2A<strong>term</strong> (\u8BCD\u6761)\u7684\u987A\u5E8F\u6216 <strong>position</strong> \u4F4D\u7F6E(\u7528\u4E8E<strong>phrase</strong>\u77ED\u8BED\u548C<strong>word</strong> proximity\u8BCD\u8FD1\u90BB\u67E5\u8BE2)\uFF0C\u4EE5\u53CA</p><p><strong>term</strong> (\u8BCD\u6761)\u6240\u4EE3\u8868\u7684\u539F\u59CB <strong>word</strong> (\u5355\u8BCD)\u7684start(\u8D77\u59CB)\u548Cend (\u7ED3\u675F)\u7684 <strong>character</strong> <strong>offsets</strong> (\u5B57\u7B26\u504F\u79FB\u91CF) (\u7528\u4E8E \u9AD8\u4EAE\u663E\u793A\u641C\u7D22\u7684\u5185\u5BB9)\u3002</p><p><strong>Elasticsearch</strong> \u63D0\u4F9B\u4E86\u5F88\u591A\u5185\u7F6E\u7684\u5206\u8BCD\u5668\uFF0C\u53EF\u4EE5\u7528\u6765\u6784\u5EFAcustom analyzers(\u81EA\u5B9A\u4E49\u5206\u8BCD\u5668)</p><h5 id="_1\u3001\u5B89\u88C5-ik-\u5206\u8BCD\u5668" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5B89\u88C5-ik-\u5206\u8BCD\u5668" aria-hidden="true">#</a> 1\u3001\u5B89\u88C5 ik \u5206\u8BCD\u5668</h5><p>\u6CE8\u610F:\u4E0D\u80FD\u7528\u9ED8\u8BA4\u7684 elasticsearch-plugin.install xxx.zip \u8FDB\u884C\u81EA\u52A8\u5B89\u88C5</p>',8),Yt={href:"https://github.com/medcl/elasticsearch-analysis-ik/releases",target:"_blank",rel:"noopener noreferrer"},Zt=s("https://github.com/medcl/elasticsearch-analysis-ik/releases"),np=s(" \u4E0B\u8F7D\u4E0E es\u5BF9\u5E94\u7684\u7248\u672C"),sp=p(`<p>\u5B89\u88C5\u540E\u62F7\u8D1D\u5230 plugins \u76EE\u5F55\u4E0B</p><h5 id="_2\u3001\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6D4B\u8BD5" aria-hidden="true">#</a> 2\u3001\u6D4B\u8BD5</h5><p>\u5206\u8BCD\u5668</p><p><img src="http://qnimg.gisfsde.com/work/image-20201026092255250.png" alt="image-20201026092255250" loading="lazy"></p><p><strong>3\u3001\u81EA\u5B9A\u4E49\u8BCD\u5E93</strong></p><p>\u4FEE\u6539 /usr/share/elasticsearch/plugins/ik/config/\u4E2D\u7684 IKAnalyzer.cfg.xml</p><p>/usr/share/elasticsearch/plugins/ik/config</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\\<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
\\<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE properties SYSTEM <span class="token string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span><span class="token operator">&gt;</span>
\\<span class="token generics"><span class="token punctuation">&lt;</span>properties<span class="token punctuation">&gt;</span></span>
        \\<span class="token generics"><span class="token punctuation">&lt;</span>comment<span class="token punctuation">&gt;</span></span>IK <span class="token class-name">Analyzer</span> \u6269\u5C55\u914D\u7F6E\\<span class="token operator">&lt;</span><span class="token operator">/</span>comment<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>\u7528\u6237\u53EF\u4EE5\u5728\u8FD9\u91CC\u914D\u7F6E\u81EA\u5DF1\u7684\u6269\u5C55\u5B57\u5178 <span class="token operator">--</span><span class="token operator">&gt;</span>
        \\<span class="token operator">&lt;</span>entry key<span class="token operator">=</span><span class="token string">&quot;ext_dict&quot;</span><span class="token operator">&gt;</span>\\<span class="token operator">&lt;</span><span class="token operator">/</span>entry<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>\u7528\u6237\u53EF\u4EE5\u5728\u8FD9\u91CC\u914D\u7F6E\u81EA\u5DF1\u7684\u6269\u5C55\u505C\u6B62\u8BCD\u5B57\u5178<span class="token operator">--</span><span class="token operator">&gt;</span>
        \\<span class="token operator">&lt;</span>entry key<span class="token operator">=</span><span class="token string">&quot;ext_stopwords&quot;</span><span class="token operator">&gt;</span>\\<span class="token operator">&lt;</span><span class="token operator">/</span>entry<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>\u7528\u6237\u53EF\u4EE5\u5728\u8FD9\u91CC\u914D\u7F6E\u8FDC\u7A0B\u6269\u5C55\u5B57\u5178 <span class="token operator">--</span><span class="token operator">&gt;</span>
         \\<span class="token operator">&lt;</span>entry key<span class="token operator">=</span><span class="token string">&quot;remote_ext_dict&quot;</span><span class="token operator">&gt;</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.10</span><span class="token operator">/</span>es<span class="token operator">/</span>fenci<span class="token punctuation">.</span>txt\\<span class="token operator">&lt;</span><span class="token operator">/</span>entry<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>\u7528\u6237\u53EF\u4EE5\u5728\u8FD9\u91CC\u914D\u7F6E\u8FDC\u7A0B\u6269\u5C55\u505C\u6B62\u8BCD\u5B57\u5178<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> \\<span class="token operator">&lt;</span>entry key<span class="token operator">=</span><span class="token string">&quot;remote_ext_stopwords&quot;</span><span class="token operator">&gt;</span>words_location\\<span class="token operator">&lt;</span><span class="token operator">/</span>entry<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
\\<span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-elasticsearch-rest-client" tabindex="-1"><a class="header-anchor" href="#_1-5-elasticsearch-rest-client" aria-hidden="true">#</a> 1.5 Elasticsearch - Rest - client</h3><p>1\u30019300\uFF1ATCP</p><p>Spring-data-elasticsearch:transport-api.jar</p><p>SpringBoot\u7248\u672C\u4E0D\u540C\uFF0C<code>transport-api.jar</code> \u4E0D\u540C\uFF0C\u4E0D\u80FD\u9002\u914D es \u7248\u672C</p><p>7.x \u5DF2\u7ECF\u4E0D\u5728\u9002\u5408\u4F7F\u7528\uFF0C8 \u4EE5\u540E\u5C31\u8981\u5E9F\u5F03</p><p><strong>2\u30019200\uFF1AHTTP</strong></p><p>JestClient \u975E\u5B98\u65B9\uFF0C\u66F4\u65B0\u6162</p><p>RestTemplate:\u9ED8\u8BA4\u53D1\u9001 HTTP \u8BF7\u6C42\uFF0CES\u5F88\u591A\u64CD\u4F5C\u90FD\u9700\u8981\u81EA\u5DF1\u5C01\u88C5\u3001\u9EBB\u70E6</p><p>HttpClient\uFF1A\u540C\u4E0A</p><p>Elasticsearch - Rest - Client\uFF1A\u5B98\u65B9RestClient\uFF0C\u5C01\u88C5\u4E86 ES \u64CD\u4F5C\uFF0CAPI\u5C42\u6B21\u5206\u660E</p><p>\u6700\u7EC8\u9009\u62E9 Elasticsearch - Rest - Client \uFF08elasticsearch - rest - high - level - client\uFF09</p><h4 id="_1-5-1-springboot-\u6574\u5408" tabindex="-1"><a class="header-anchor" href="#_1-5-1-springboot-\u6574\u5408" aria-hidden="true">#</a> 1.5.1 SpringBoot \u6574\u5408</h4><p>1\u3001Pom.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- \u5BFC\u5165es\u7684 rest-high-level-client --&gt;</span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch.client\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch-rest-high-level-client\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.4.2\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3A\u4EC0\u4E48\u8981\u5BFC\u5165\u8FD9\u4E2A\uFF1F\u8FD9\u4E2A\u914D\u7F6E\u90A3\u91CC\u6765\u7684\uFF1F</p>`,23),ap=s("\u5B98\u7F51\uFF1A"),tp={href:"https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-getting-started-maven.html",target:"_blank",rel:"noopener noreferrer"},pp=s("https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-getting-started-maven.html"),ep=p(`<h4 id="_1-5-2-config\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_1-5-2-config\u914D\u7F6E" aria-hidden="true">#</a> 1.5.2 Config\u914D\u7F6E</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-10-26
 *
 * 1\u3001\u5BFC\u5165\u914D\u7F6E
 * 2\u3001\u7F16\u5199\u914D\u7F6E\uFF0C\u7ED9\u5BB9\u5668\u6CE8\u5165\u4E00\u4E2ARestHighLevelClient
 * 3\u3001\u53C2\u7167API \u5B98\u7F51\u8FDB\u884C\u5F00\u53D1
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallElasticsearchConfig</span> <span class="token punctuation">{</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">RequestOptions</span> COMMON_OPTIONS<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">RequestOptions<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">.</span><span class="token function">toBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        builder.addHeader(&quot;Authorization&quot;, &quot;Bearer &quot; + TOKEN);</span>
<span class="token comment">//        builder.setHttpAsyncResponseConsumerFactory(</span>
<span class="token comment">//                new HttpAsyncResponseConsumerFactory</span>
<span class="token comment">//                        .HeapBufferedResponseConsumerFactory(30 * 1024 * 1024 * 1024));</span>
        COMMON_OPTIONS <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestHighLevelClient</span> <span class="token function">esRestClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RestClientBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        builder <span class="token operator">=</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.56.10&quot;</span><span class="token punctuation">,</span> <span class="token number">9200</span><span class="token punctuation">,</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">RestHighLevelClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        RestHighLevelClient client = new RestHighLevelClient(</span>
<span class="token comment">//                RestClient.builder(</span>
<span class="token comment">//                        new HttpHost(&quot;localhost&quot;, 9200, &quot;http&quot;),</span>
<span class="token comment">//                        new HttpHost(&quot;localhost&quot;, 9201, &quot;http&quot;)));</span>
        <span class="token keyword">return</span> client<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),op=s("\u5B98\u7F51\uFF1A"),cp={href:"https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-getting-started-initialization.html",target:"_blank",rel:"noopener noreferrer"},ip=s("https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-getting-started-initialization.html"),lp=p(`<h4 id="_1-5-3-\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_1-5-3-\u4F7F\u7528" aria-hidden="true">#</a> 1.5.3 \u4F7F\u7528</h4><blockquote><p>\u6D4B\u8BD5\u662F\u5426\u6CE8\u5165\u6210\u529F</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u6D4B\u8BD5\u662F\u5426\u80FD \u6DFB\u52A0 \u6216\u66F4\u65B0\u6570\u636E</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6DFB\u52A0\u6216\u8005\u66F4\u65B0
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">indexData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">IndexRequest</span> indexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token string">&quot;\u7537&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> jsonString <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    indexRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">,</span><span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6267\u884C\u64CD\u4F5C</span>
    <span class="token class-name">IndexResponse</span> index <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>indexRequest<span class="token punctuation">,</span> <span class="token class-name">GulimallElasticsearchConfig</span><span class="token punctuation">.</span>COMMON_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u63D0\u53D6\u6709\u7528\u7684\u54CD\u5E94\u6570\u636E</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5\u590D\u6742\u68C0\u7D22</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">searchTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u521B\u5EFA\u68C0\u7D22\u8BF7\u6C42</span>
        <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6307\u5B9A\u7D22\u5F15</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token string">&quot;bank&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6307\u5B9A DSL\uFF0C\u68C0\u7D22\u6761\u4EF6</span>
        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        sourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mill&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//1\u30012 \u6309\u7167\u5E74\u9F84\u503C\u5206\u5E03\u8FDB\u884C\u805A\u5408</span>
        <span class="token class-name">TermsAggregationBuilder</span> aggAvg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;ageAgg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>aggAvg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//1\u30013 \u8BA1\u7B97\u5E73\u5747\u85AA\u8D44</span>
        <span class="token class-name">AvgAggregationBuilder</span> balanceAvg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token string">&quot;balanceAvg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>balanceAvg<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u68C0\u7D22\u6761\u4EF6&quot;</span> <span class="token operator">+</span> sourceBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2\u3001\u6267\u884C\u68C0\u7D22</span>
        <span class="token class-name">SearchResponse</span> searchResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">GulimallElasticsearchConfig</span><span class="token punctuation">.</span>COMMON_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3\u3001\u5206\u6790\u7ED3\u679C</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>searchResponse<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4\u3001\u62FF\u5230\u547D\u4E2D\u5F97\u7ED3\u679C</span>
        <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5\u3001\u641C\u7D22\u8BF7\u6C42\u7684\u5339\u914D</span>
        <span class="token class-name">SearchHit</span><span class="token punctuation">[</span><span class="token punctuation">]</span> searchHits <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6\u3001\u8FDB\u884C\u904D\u5386</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> searchHits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 7\u3001\u62FF\u5230\u5B8C\u6574\u7ED3\u679C\u5B57\u7B26\u4E32</span>
            <span class="token class-name">String</span> sourceAsString <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 8\u3001\u8F6C\u6362\u6210\u5B9E\u4F53\u7C7B</span>
            <span class="token class-name">Accout</span> accout <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>sourceAsString<span class="token punctuation">,</span> <span class="token class-name">Accout</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;account:&quot;</span> <span class="token operator">+</span> accout <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 9\u3001\u62FF\u5230\u805A\u5408</span>
        <span class="token class-name">Aggregations</span> aggregations <span class="token operator">=</span> searchResponse<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        for (Aggregation aggregation : aggregations) {</span>
<span class="token comment">//</span>
<span class="token comment">//        }</span>
        <span class="token comment">// 10\u3001\u901A\u8FC7\u5148\u524D\u540D\u5B57\u62FF\u5230\u5BF9\u5E94\u805A\u5408</span>
        <span class="token class-name">Terms</span> ageAgg1 <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ageAgg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> bucket <span class="token operator">:</span> ageAgg1<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 11\u3001\u62FF\u5230\u7ED3\u679C</span>
            <span class="token class-name">String</span> keyAsString <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5E74\u9F84:&quot;</span> <span class="token operator">+</span> keyAsString<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> docCount <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getDocCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4E2A\u6570\uFF1A&quot;</span> <span class="token operator">+</span> docCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Avg</span> balanceAvg1 <span class="token operator">=</span> aggregations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balanceAvg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5E73\u5747\u85AA\u8D44\uFF1A&quot;</span> <span class="token operator">+</span> balanceAvg1<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>searchResponse<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>accout<span class="token operator">:</span><span class="token class-name">GulimallSearchApplicationTests<span class="token punctuation">.</span>Accout</span><span class="token punctuation">(</span>account_number<span class="token operator">=</span><span class="token number">970</span><span class="token punctuation">,</span> balance<span class="token operator">=</span><span class="token number">19648</span><span class="token punctuation">,</span> firstname<span class="token operator">=</span><span class="token class-name">Forbes</span><span class="token punctuation">,</span> lastname<span class="token operator">=</span><span class="token class-name">Wallace</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token class-name">M</span><span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token number">990</span> <span class="token class-name">Mill</span> <span class="token class-name">Road</span><span class="token punctuation">,</span> employer<span class="token operator">=</span><span class="token class-name">Pheast</span><span class="token punctuation">,</span> email<span class="token operator">=</span>forbeswallace<span class="token annotation punctuation">@pheast.com</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token class-name">Lopezo</span><span class="token punctuation">,</span> state<span class="token operator">=</span>AK<span class="token punctuation">)</span>accout<span class="token operator">:</span><span class="token class-name">GulimallSearchApplicationTests<span class="token punctuation">.</span>Accout</span><span class="token punctuation">(</span>account_number<span class="token operator">=</span><span class="token number">136</span><span class="token punctuation">,</span> balance<span class="token operator">=</span><span class="token number">45801</span><span class="token punctuation">,</span> firstname<span class="token operator">=</span><span class="token class-name">Winnie</span><span class="token punctuation">,</span> lastname<span class="token operator">=</span><span class="token class-name">Holland</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">38</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token class-name">M</span><span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token number">198</span> <span class="token class-name">Mill</span> <span class="token class-name">Lane</span><span class="token punctuation">,</span> employer<span class="token operator">=</span><span class="token class-name">Neteria</span><span class="token punctuation">,</span> email<span class="token operator">=</span>winnieholland<span class="token annotation punctuation">@neteria.com</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token class-name">Urie</span><span class="token punctuation">,</span> state<span class="token operator">=</span>IL<span class="token punctuation">)</span>accout<span class="token operator">:</span><span class="token class-name">GulimallSearchApplicationTests<span class="token punctuation">.</span>Accout</span><span class="token punctuation">(</span>account_number<span class="token operator">=</span><span class="token number">345</span><span class="token punctuation">,</span> balance<span class="token operator">=</span><span class="token number">9812</span><span class="token punctuation">,</span> firstname<span class="token operator">=</span><span class="token class-name">Parker</span><span class="token punctuation">,</span> lastname<span class="token operator">=</span><span class="token class-name">Hines</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">38</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token class-name">M</span><span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token number">715</span> <span class="token class-name">Mill</span> <span class="token class-name">Avenue</span><span class="token punctuation">,</span> employer<span class="token operator">=</span><span class="token class-name">Baluba</span><span class="token punctuation">,</span> email<span class="token operator">=</span>parkerhines<span class="token annotation punctuation">@baluba.com</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token class-name">Blackgum</span><span class="token punctuation">,</span> state<span class="token operator">=</span>KY<span class="token punctuation">)</span>accout<span class="token operator">:</span><span class="token class-name">GulimallSearchApplicationTests<span class="token punctuation">.</span>Accout</span><span class="token punctuation">(</span>account_number<span class="token operator">=</span><span class="token number">472</span><span class="token punctuation">,</span> balance<span class="token operator">=</span><span class="token number">25571</span><span class="token punctuation">,</span> firstname<span class="token operator">=</span><span class="token class-name">Lee</span><span class="token punctuation">,</span> lastname<span class="token operator">=</span><span class="token class-name">Long</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token class-name">F</span><span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token number">288</span> <span class="token class-name">Mill</span> <span class="token class-name">Street</span><span class="token punctuation">,</span> employer<span class="token operator">=</span><span class="token class-name">Comverges</span><span class="token punctuation">,</span> email<span class="token operator">=</span>leelong<span class="token annotation punctuation">@comverges.com</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token class-name">Movico</span><span class="token punctuation">,</span> state<span class="token operator">=</span>MT<span class="token punctuation">)</span>\u5E74\u9F84<span class="token operator">:</span><span class="token number">38</span>
\u4E2A\u6570<span class="token operator">:</span><span class="token number">2</span>
\u5E74\u9F84<span class="token operator">:</span><span class="token number">28</span>
\u4E2A\u6570<span class="token operator">:</span><span class="token number">1</span>
\u5E74\u9F84<span class="token operator">:</span><span class="token number">32</span>
\u4E2A\u6570<span class="token operator">:</span><span class="token number">1</span>
\u5E73\u5747\u85AA\u6C34<span class="token operator">:</span><span class="token number">25208.0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u603B\u7ED3\uFF1A\u53C2\u8003\u5B98\u7F51\u7684API \u548C\u5BF9\u5E94\u5728 kibana \u4E2D\u53D1\u9001\u7684\u8BF7\u6C42\uFF0C\u5728\u4EE3\u7801\u4E2D\u901A\u8FC7\u8C03\u7528\u5BF9\u5E94API\u5B9E\u73B0\u6548\u679C</p>`,10),up=s("\u5B98\u7F51\uFF1A"),rp={href:"https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-search.html#java-rest-high-search-request-optional",target:"_blank",rel:"noopener noreferrer"},kp=s("https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-search.html#java-rest-high-search-request-optional"),dp=p(`<p>ELK</p><p>Elasticsearch \u7528\u4E8E\u68C0\u7D22\u6570\u636E</p><p>logstach\uFF1A\u5B58\u50A8\u6570\u636E</p><p>Kiban:\u89C6\u56FE\u5316\u67E5\u770B\u6570\u636E</p><p><img src="http://qnimg.gisfsde.com/work/image-20201027120603889.png" alt="image-20201027120603889" loading="lazy"></p><h1 id="_2\u3001\u5546\u57CE\u4E1A\u52A1-\u5546\u54C1\u4E0A\u67B6" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5546\u57CE\u4E1A\u52A1-\u5546\u54C1\u4E0A\u67B6" aria-hidden="true">#</a> 2\u3001\u5546\u57CE\u4E1A\u52A1 &amp; \u5546\u54C1\u4E0A\u67B6</h1><p>\u4E0A\u67B6\u7684\u5546\u54C1\u624D\u53EF\u4EE5\u5728\u7F51\u7AD9\u5C55\u793A</p><p>\u4E0A\u67B6\u7684\u5546\u54C1\u9700\u8981\u53EF\u4EE5\u68C0\u7D22</p><h3 id="_2-1-\u5546\u54C1mapping" tabindex="-1"><a class="header-anchor" href="#_2-1-\u5546\u54C1mapping" aria-hidden="true">#</a> 2.1 \u5546\u54C1Mapping</h3><p>\u5206\u6790\uFF1A\u5546\u54C1\u4E0A\u67B6\u5728 es \u4E2D\u662F\u5B58\u5165 sku \u8FD8\u662F spu \uFF1F</p><p>1\u3001\u68C0\u7D22\u7684\u65F6\u5019\u8F93\u5165\u540D\u5B57\uFF0C\u662F\u9700\u8981\u6309\u7167 sku \u7684 title\u8FDB\u884C\u5168\u6587\u68C0\u7D22\u7684</p><p>2\u3001\u68C0\u7D22\u4F7F\u7528\u5546\u54C1\u89C4\u683C\uFF0C\u89C4\u683C\u662F spu \u7684\u516C\u5171\u5C5E\u6027\uFF0C\u6BCF\u4E2A spu \u662F\u4E00\u6837\u7684</p><p>3\u3001\u6309\u7167\u5206\u7C7B id \u8FDB\u53BB\u7684 \u90FD\u662F\u76F4\u63A5\u5217\u51FA spu\u7684\uFF0C\u8FD8\u53EF\u4EE5\u5207\u6362</p><p>4\u3001\u6211\u4EEC\u5982\u679C\u5C06 sku \u7684 \u5168\u91CF\u4FE1\u606F \u4FDD\u5B58\u5728 es \u4E2D \uFF08\u5305\u62EC spu \u5C5E\u6027\uFF09\uFF0C\u5C31\u592A\u591A\u91CF\u5B57\u6BB5\u4E86</p><p>5\u3001\u5982\u679C\u6211\u4EEC\u5C06 spu \u4EE5\u53CA\u4ED6\u5305\u542B\u7684 sku \u4FE1\u606F\u4FDD\u5B58\u5230 es \u4E2D\uFF0C\u4E5F\u53EF\u4EE5\u65B9</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>PUT product
{
  &quot;mappings&quot;:{
    &quot;properties&quot;:{
      &quot;skuId&quot;:{
        &quot;type&quot;:&quot;long&quot;
      },
       &quot;spuId&quot;:{
        &quot;type&quot;:&quot;keyword&quot;
      },
       &quot;skuTitle&quot;:{
        &quot;type&quot;:&quot;text&quot;,
        &quot;analyzer&quot;: &quot;ik_smart&quot;
      },
       &quot;skuPrice&quot;:{
        &quot;type&quot;:&quot;keyword&quot;
      },
       &quot;skuImg&quot;:{
        &quot;type&quot;:&quot;text&quot;,
        &quot;analyzer&quot;: &quot;ik_smart&quot;
      },
       &quot;saleCount&quot;:{
        &quot;type&quot;:&quot;long&quot;
      },
       &quot;hasStock&quot;:{
        &quot;type&quot;:&quot;boolean&quot;
      },
      &quot;hotScore&quot;:{
        &quot;type&quot;:&quot;long&quot;
      },
      &quot;brandId&quot;:{
        &quot;type&quot;:&quot;long&quot;
      },
      &quot;catelogId&quot;:{
        &quot;type&quot;:&quot;long&quot;
      },
      &quot;brandName&quot;:{
        &quot;type&quot;:&quot;keyword&quot;,
        &quot;index&quot;: false,
        &quot;doc_values&quot;: false
      },
      &quot;brandImg&quot;:{
        &quot;type&quot;:&quot;keyword&quot;,
         &quot;index&quot;: false,
        &quot;doc_values&quot;: false
      },
      &quot;catalogName&quot;:{
        &quot;type&quot;:&quot;keyword&quot;,
         &quot;index&quot;: false,
         &quot;doc_values&quot;: false
      },
      &quot;attrs&quot;:{
        &quot;type&quot;:&quot;nested&quot;,
        &quot;properties&quot;: {
          &quot;attrId&quot;:{
            &quot;type&quot;:&quot;long&quot;
          },
          &quot;attrName&quot;:{
            &quot;type&quot;:&quot;keyword&quot;,
            &quot;index&quot;:false,
            &quot;doc_values&quot;:false
          },
          &quot;attrValue&quot;: {
            &quot;type&quot;:&quot;keyword&quot;
          }
        }
      }
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-\u5546\u54C1\u4E0A\u67B6\u63A5\u53E3\u7F16\u5199" tabindex="-1"><a class="header-anchor" href="#_2-2-\u5546\u54C1\u4E0A\u67B6\u63A5\u53E3\u7F16\u5199" aria-hidden="true">#</a> 2.2 \u5546\u54C1\u4E0A\u67B6\u63A5\u53E3\u7F16\u5199</h3><p><strong>\u9700\u6C42\u5206\u6790\uFF1A</strong></p><p>\u4E0A\u67B6\u5546\u54C1\u3001\u5C06\u8BE5\u5546\u54C1\u76F8\u5173\u5C5E\u6027\u4E0A\u4F20\u5230 Es\u4E2D \u4E3A\u641C\u7D22\u670D\u52A1\u505A\u94FA\u57AB</p><img src="http://qnimg.gisfsde.com/work/image-20201028152104489.png" alt="image-20201028152104489" style="zoom:200%;"><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5546\u54C1\u4E0A\u67B6
 * <span class="token keyword">@param</span> <span class="token parameter">spuId</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{spuId}/up&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;spuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> spuId<span class="token punctuation">)</span><span class="token punctuation">{</span>
    spuInfoService<span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">up</span><span class="token punctuation">(</span><span class="token class-name">Long</span> spuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1\u3001\u67E5\u51FA\u5F53\u524D spuid \u5BF9\u5E94\u7684\u6240\u6709skuid\u4FE1\u606F\uFF0C\u54C1\u724C\u7684\u540D\u5B57</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoEntity</span><span class="token punctuation">&gt;</span></span> skus <span class="token operator">=</span> skuInfoService<span class="token punctuation">.</span><span class="token function">getSkuBySpuId</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u53D6\u51FA Skuid \u7EC4\u6210\u96C6\u5408</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> skuIds <span class="token operator">=</span> skus<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">SkuInfoEntity</span><span class="token operator">::</span><span class="token function">getSkuId</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//TODO 4\u3001\u67E5\u8BE2\u5F53\u524D sku \u7684\u6240\u6709\u53EF\u4EE5\u7528\u6765\u88AB\u68C0\u7D22\u7684\u89C4\u683C\u5C5E\u6027</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductAttrValueEntity</span><span class="token punctuation">&gt;</span></span> attrValueEntities <span class="token operator">=</span> attrValueService<span class="token punctuation">.</span><span class="token function">baseAttrListforspu</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8FD4\u56DE\u6240\u6709 attrId</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> attrIds <span class="token operator">=</span> attrValueEntities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>attr <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> attr<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6839\u636E attrIds \u67E5\u8BE2\u51FA \u68C0\u7D22\u5C5E\u6027\uFF0Cpms_attr\u8868\u4E2D search_type\u4E3A\u4E00 \u5219\u662F\u68C0\u7D22\u5C5E\u6027</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> searchAttrIds <span class="token operator">=</span> attrService<span class="token punctuation">.</span><span class="token function">selectSearchAttrs</span><span class="token punctuation">(</span>attrIds<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5C06\u67E5\u8BE2\u51FA\u6765\u7684 attr_id \u653E\u5230 set \u96C6\u5408\u4E2D \u7528\u6765\u5224\u65AD attrValueEntities \u662F\u5426\u5305\u542B attrId</span>
    <span class="token class-name">Set</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> idSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>searchAttrIds<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuEsModel<span class="token punctuation">.</span>Attrs</span><span class="token punctuation">&gt;</span></span> attrList <span class="token operator">=</span> attrValueEntities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8FC7\u6EE4\u6389\u4E0D\u5305\u542B\u5728 searchAttrIds\u96C6\u5408\u4E2D\u7684\u5143\u7D20</span>
        <span class="token keyword">return</span> idSet<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getAttrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">SkuEsModel<span class="token punctuation">.</span>Attrs</span> attrs1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuEsModel<span class="token punctuation">.</span>Attrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5C5E\u6027\u5BF9\u62F7 \u5C06 ProductAttrValueEntity\u5BF9\u8C61\u4E0E SkuEsModel.Attrs\u76F8\u540C\u7684\u5C5E\u6027\u8FDB\u884C\u62F7\u8D1D</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> attrs1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> attrs1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">//TODO 1\u3001\u53D1\u9001\u8FDC\u7A0B\u8C03\u7528\uFF0C\u5E93\u5B58\u7CFB\u7EDF\u67E5\u8BE2\u662F\u5426\u6709\u5E93\u5B58</span>
    <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> stockMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">R</span> r <span class="token operator">=</span> wareFeignService<span class="token punctuation">.</span><span class="token function">getSkuHasStock</span><span class="token punctuation">(</span>skuIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// key \u662F SkuHasStockVo\u7684 skuid value\u662F item\u7684hasStock \u662F\u5426\u62E5\u6709\u5E93\u5B58</span>
        <span class="token class-name">TypeReference</span>\\<span class="token operator">&lt;</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuHasStockVo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> typeReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token operator">&lt;</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuHasStockVo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        stockMap <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span>typeReference<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">SkuHasStockVo</span><span class="token operator">::</span><span class="token function">getSkuId</span><span class="token punctuation">,</span> item <span class="token operator">-&gt;</span> item<span class="token punctuation">.</span><span class="token function">getHasStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\u5E93\u5B58\u670D\u52A1\u5F02\u5E38\uFF1A\u539F\u56E0\uFF1A{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2\u3001\u5C01\u88C5\u6BCF\u4E2A sku \u7684\u4FE1\u606F</span>
    <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> finalStockMap <span class="token operator">=</span> stockMap<span class="token punctuation">;</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuEsModel</span><span class="token punctuation">&gt;</span></span> upProducts <span class="token operator">=</span> skus<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>sku <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u7EC4\u88C5\u9700\u8981\u67E5\u8BE2\u7684\u6570\u636E</span>
        <span class="token class-name">SkuEsModel</span> skuEsModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuEsModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>sku<span class="token punctuation">,</span> skuEsModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuEsModel<span class="token punctuation">.</span><span class="token function">setSkuPrice</span><span class="token punctuation">(</span>sku<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuEsModel<span class="token punctuation">.</span><span class="token function">setSkuImg</span><span class="token punctuation">(</span>sku<span class="token punctuation">.</span><span class="token function">getSkuDefaultImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u8BBE\u7F6E\u5C5E\u6027</span>
        skuEsModel<span class="token punctuation">.</span><span class="token function">setAttrs</span><span class="token punctuation">(</span>attrList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u8BBE\u7F6E\u5E93\u5B58\u4FE1\u606F</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>finalStockMap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u8FDC\u7A0B\u670D\u52A1\u51FA\u73B0\u95EE\u9898\uFF0C\u4EFB\u7136\u8BBE\u7F6E\u4E3Anull</span>
            skuEsModel<span class="token punctuation">.</span><span class="token function">setHasStock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            skuEsModel<span class="token punctuation">.</span><span class="token function">setHasStock</span><span class="token punctuation">(</span>finalStockMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>sku<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//TODO 2\u3001\u70ED\u5EA6\u9891\u5206 0</span>
        skuEsModel<span class="token punctuation">.</span><span class="token function">setHotScore</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//TODO 3\u3001\u67E5\u8BE2\u54C1\u724C\u540D\u5B57\u548C\u5206\u7C7B\u7684\u4FE1\u606F</span>
        <span class="token class-name">BrandEntity</span> brandEntity <span class="token operator">=</span> brandService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>skuEsModel<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuEsModel<span class="token punctuation">.</span><span class="token function">setBrandName</span><span class="token punctuation">(</span>brandEntity<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuEsModel<span class="token punctuation">.</span><span class="token function">setBrandImg</span><span class="token punctuation">(</span>brandEntity<span class="token punctuation">.</span><span class="token function">getLogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CategoryEntity</span> categoryEntity <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>skuEsModel<span class="token punctuation">.</span><span class="token function">getCatalogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuEsModel<span class="token punctuation">.</span><span class="token function">setCatalogName</span><span class="token punctuation">(</span>categoryEntity<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> skuEsModel<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">//TODO 5\u3001\u5C06\u6570\u636E\u53D1\u9001\u7ED9 es\u4FDD\u5B58 \uFF0C\u76F4\u63A5\u53D1\u9001\u7ED9 search\u670D\u52A1</span>
    <span class="token class-name">R</span> r <span class="token operator">=</span> esFeignClient<span class="token punctuation">.</span><span class="token function">productStatusUp</span><span class="token punctuation">(</span>upProducts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8FDC\u7A0B\u8C03\u7528\u6210\u529F</span>
        <span class="token comment">// TODO 6\u3001\u4FEE\u6539\u5F53\u524D spu \u7684\u72B6\u6001</span>
        baseMapper<span class="token punctuation">.</span><span class="token function">updateSpuStatus</span><span class="token punctuation">(</span>spuId<span class="token punctuation">,</span> <span class="token class-name">ProductConstant<span class="token punctuation">.</span>StatusEnum</span><span class="token punctuation">.</span>SPU_UP<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8FDC\u7A0B\u8C03\u7528\u5931\u8D25</span>
        <span class="token comment">//TODO 7\u3001\u91CD\u590D\u8C03\u7528\uFF1F \u63A5\u53E3\u51A5\u7B49\u6027 \u91CD\u8BD5\u673A\u5236</span>

        <span class="token doc-comment comment">/**
         * 1\u3001\u6784\u9020\u8BF7\u6C42\u6570\u636E\uFF0C\u5C06\u5BF9\u8C61\u8F6C\u6210json
         * RequestTemplate template = buildTemplateFromArgs.create(argv);
         * 2\u3001\u53D1\u9001\u8BF7\u6C42\u8FDB\u884C\u6267\u884C(\u6267\u884C\u6210\u529F\u8FDB\u884C\u89E3\u7801)
         *  executeAndDecode(template);
         * 3\u3001\u6267\u884C\u8BF7\u6C42\u4F1A\u6709\u91CD\u8BD5\u673A\u5236
         *  while (true) <span class="token punctuation">{</span>
         *       try <span class="token punctuation">{</span>
         *         return executeAndDecode(template);
         *       <span class="token punctuation">}</span> catch (RetryableException e) <span class="token punctuation">{</span>
         *         try <span class="token punctuation">{</span>
         *           retryer.continueOrPropagate(e);
         *         <span class="token punctuation">}</span> catch (RetryableException th) <span class="token punctuation">{</span>
         *              throw cause;
         *         <span class="token punctuation">}</span>
         *         continute
         */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-1\u3001\u53D1\u9001\u8FDC\u7A0B\u8C03\u7528-\u5E93\u5B58\u7CFB\u7EDF\u67E5\u8BE2\u662F\u5426\u6709\u5E93\u5B58" tabindex="-1"><a class="header-anchor" href="#_2-2-1\u3001\u53D1\u9001\u8FDC\u7A0B\u8C03\u7528-\u5E93\u5B58\u7CFB\u7EDF\u67E5\u8BE2\u662F\u5426\u6709\u5E93\u5B58" aria-hidden="true">#</a> 2.2.1\u3001\u53D1\u9001\u8FDC\u7A0B\u8C03\u7528\uFF0C\u5E93\u5B58\u7CFB\u7EDF\u67E5\u8BE2\u662F\u5426\u6709\u5E93\u5B58</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6839\u636E skuIds \u67E5\u8BE2\u662F\u5426\u6709\u5E93\u5B58
 * <span class="token keyword">@param</span> <span class="token parameter">skuIds</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hasstock&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getSkuHasStock</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> skuIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuHasStockVo</span><span class="token punctuation">&gt;</span></span> vos <span class="token operator">=</span> wareSkuService<span class="token punctuation">.</span><span class="token function">getSkusStock</span><span class="token punctuation">(</span>skuIds<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">R</span> ok <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ok<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>vos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ok<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuHasStockVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSkusStock</span><span class="token punctuation">(</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> skuIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuHasStockVo</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> skuIds<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>skuId <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">SkuHasStockVo</span> vo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuHasStockVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u67E5\u8BE2\u5F53\u524D sku \u7684\u603B\u5E93\u5B58\u826F</span>
        <span class="token comment">// SELECT SUM(stock-stock_locked) FROM \`wms_ware_sku\` WHERE sku_id = 1</span>
        <span class="token class-name">Long</span> count <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">getSkuStock</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        vo<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        vo<span class="token punctuation">.</span><span class="token function">setHasStock</span><span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token keyword">null</span><span class="token operator">?</span><span class="token boolean">false</span><span class="token operator">:</span>count<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> vo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> collect<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-2-\u5C06\u6570\u636E\u53D1\u9001\u7ED9-es\u4FDD\u5B58-\u76F4\u63A5\u53D1\u9001\u7ED9-search\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_2-2-2-\u5C06\u6570\u636E\u53D1\u9001\u7ED9-es\u4FDD\u5B58-\u76F4\u63A5\u53D1\u9001\u7ED9-search\u670D\u52A1" aria-hidden="true">#</a> 2.2.2 \u5C06\u6570\u636E\u53D1\u9001\u7ED9 es\u4FDD\u5B58 \uFF0C\u76F4\u63A5\u53D1\u9001\u7ED9 search\u670D\u52A1</h4><p>controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * \u4E0A\u67B6\u5546\u54C1
     * <span class="token keyword">@param</span> <span class="token parameter">skuEsModelList</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/product&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">productStatusUp</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuEsModel</span><span class="token punctuation">&gt;</span></span> skuEsModelList<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> b <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            b <span class="token operator">=</span> productSaveService<span class="token punctuation">.</span><span class="token function">productStatusUp</span><span class="token punctuation">(</span>skuEsModelList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ElasticSaveController\u5546\u54C1\u4E0A\u67B6\u9519\u8BEF\uFF1A{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>PRODUCT_UP_EXCEPTION<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>PRODUCT_UP_EXCEPTION<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>PRODUCT_UP_EXCEPTION<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>PRODUCT_UP_EXCEPTION<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">productStatusUp</span><span class="token punctuation">(</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuEsModel</span><span class="token punctuation">&gt;</span></span> skuEsModelList<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// \u4FDD\u5B58\u5230es</span>
    <span class="token comment">// \u6279\u91CF\u4FDD\u5B58</span>
    <span class="token class-name">BulkRequest</span> bulkRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BulkRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SkuEsModel</span> model <span class="token operator">:</span> skuEsModelList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u6784\u9020\u8BF7\u6C42 \u6307\u5B9Aes\u7D22\u5F15</span>
        <span class="token class-name">IndexRequest</span> indexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.1 \u6307\u5B9Aid</span>
        indexRequest<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.2 \u5C06\u5BF9\u8C61esmodel\u5BF9\u8C61\u8F6C\u6362\u6210 json \u8FDB\u884C\u5B58\u50A8</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.3 \u8BBE\u7F6E\u6587\u6863\u6E90</span>
        indexRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>

        bulkRequest<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>indexRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token class-name">BulkResponse</span> bulk <span class="token operator">=</span> restHighLevelClient<span class="token punctuation">.</span><span class="token function">bulk</span><span class="token punctuation">(</span>bulkRequest<span class="token punctuation">,</span> <span class="token class-name">GulimallElasticsearchConfig</span><span class="token punctuation">.</span>COMMON_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// TODO 1\u3001 \u5982\u679C\u6279\u91CF\u9519\u8BEF</span>
    <span class="token keyword">boolean</span> b <span class="token operator">=</span> bulk<span class="token punctuation">.</span><span class="token function">hasFailures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>bulk<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\u5546\u54C1\u4E0A\u67B6\u5B8C\u6210\uFF1A{}&quot;</span><span class="token punctuation">,</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u4E1A\u52A1\u6D41\u7A0B\u603B\u7ED3\uFF1A</strong></p><p>\u524D\u7AEF\u70B9\u51FB\u4E0A\u67B6\u540E\uFF0C\u53D1\u9001\u8BF7\u6C42\u5E76\u5E26\u4E0A\u53C2\u6570 spuid</p><ul><li><p>\u6839\u636E <code>spuid</code> \u67E5\u8BE2 <code>pms_sku_info</code> \u8868\u5F97\u5230\u5546\u54C1\u76F8\u5173\u5C5E\u6027</p></li><li><p><img src="http://qnimg.gisfsde.com/work/image-20201028153205471.png" alt="image-20201028153205471" loading="lazy"></p></li><li><p>\u6839\u636E <code>spuid</code> \u67E5\u8BE2 <code>pms_product_attr_value</code> \u8868\u5F97\u5230\u53EF\u4EE5\u7528\u6765\u68C0\u7D22\u7684\u89C4\u683C\u5C5E\u6027</p></li><li><p><img src="http://qnimg.gisfsde.com/work/image-20201028153038796.png" alt="image-20201028153038796" loading="lazy"></p></li><li><p>\u4ECE <code>ProductAttrValueEntity</code> \u4E2D\u62FF\u5230\u6240\u6709\u7684 attrId\uFF0C\u6839\u636E attrId \u67E5\u8BE2 <code>pms_attr</code> \u67E5\u8BE2\u68C0\u7D22\u7684\u5C5E\u6027</p></li><li><p><img src="http://qnimg.gisfsde.com/work/image-20201028155204710.png" alt="image-20201028155204710" loading="lazy"></p></li><li><p>x\u6839\u636E <code>pms_attr</code> \u67E5\u8BE2\u5230\u68C0\u7D22\u5C5E\u6027\u540E\uFF0C\u7528\u68C0\u7D22\u5C5E\u6027\u548C \u539F\u5148\u6839\u636E <code>spuid</code> \u67E5\u8BE2 <code>pms_sku_info</code> \u8868\u5F97\u5230\u5546\u54C1\u76F8\u5173\u5C5E\u6027\u8FDB\u884C\u6BD4\u8F83\uFF0C<code>pms_sku_info</code> \u5305\u542B \u4ECE <code>pms_attr</code> \u5B57\u6BB5attr_id \u5219\u6570\u636E\u4FDD\u5B58\u5426\u5219\u8FC7\u6EE4</p></li><li><p>\u6839\u636E <code>skuIds</code> \u53BB\u67E5\u8BE2\u8FDC\u7A0B\u4ED3\u5E93\u4E2D\u662F\u5426\u6709\u5E93\u5B58 SELECT SUM(stock-stock_locked) FROM <code>wms_ware_sku</code> WHERE sku_id = 1</p></li><li><p>\u7EC4\u88C5\u6570\u636E \u8BBE\u7F6E SkuEsModel</p></li><li><p>\u53D1\u9001\u7ED9 es \u4FDD\u5B58</p></li></ul><h1 id="_3\u3001\u5546\u57CE\u4E1A\u52A1-\u9996\u9875\u6574\u5408" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5546\u57CE\u4E1A\u52A1-\u9996\u9875\u6574\u5408" aria-hidden="true">#</a> 3\u3001\u5546\u57CE\u4E1A\u52A1 &amp; \u9996\u9875\u6574\u5408</h1><h3 id="_3-1-\u6574\u5408-thymeleaf-\u6E32\u67D3\u9996\u9875" tabindex="-1"><a class="header-anchor" href="#_3-1-\u6574\u5408-thymeleaf-\u6E32\u67D3\u9996\u9875" aria-hidden="true">#</a> 3.1 \u6574\u5408 thymeleaf \u6E32\u67D3\u9996\u9875</h3><p><strong>\u9700\u6C42\u5206\u6790\uFF1A</strong></p><p>\u5F00\u53D1\u4F20\u7EDFJava WEB\u5DE5\u7A0B\u65F6\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528JSP\u9875\u9762\u6A21\u677F\u8BED\u8A00\uFF0C\u4F46\u662F\u5728SpringBoot\u4E2D\u5DF2\u7ECF\u4E0D\u63A8\u8350\u4F7F\u7528\u4E86\u3002SpringBoot\u652F\u6301\u5982\u4E0B\u9875\u9762\u6A21\u677F\u8BED\u8A00</p><ul><li>Thymeleaf</li><li>FreeMarker</li><li>Velocity</li><li>Groovy</li><li>JSP</li></ul>`,41),mp=s("thymeleaf \u5B98\u7F51\uFF1A"),vp={href:"https://www.thymeleaf.org/",target:"_blank",rel:"noopener noreferrer"},gp=s("https://www.thymeleaf.org/"),bp=s("\u5B98\u7F51\u6587\u6863\u7ED9\u51FA\u4E86\uFF0C\u8BED\u6CD5\u3001\u76F8\u5173\u6807\u7B7E\u5982\u4F55\u4F7F\u7528\u7684\u6B65\u9AA4\uFF0C\u7531\u4E8E\u5B98\u7F51\u6587\u6863\u90FD\u662F\u82F1\u6587\uFF0C\u82F1\u6587\u6587\u6863\u9605\u8BFB\u80FD\u529B\u597D\u7684\u540C\u5B66\u53EF\u4EE5\u9009\u62E9\u9605\u8BFB\uFF0C\u82F1\u6587\u4E0D\u597D\u7684\u540C\u5B66\u53EF\u4EE5\u9009\u62E9\u4E2D\u6587\u6587\u6863\u8FDB\u884C\u5B66\u4E60\uFF0C\u4E3A\u6B64\u6211\u5728\u7F51\u4E0A\u627E\u5230\u4E86\u76F8\u5173\u7684\u4E2D\u6587\u6587\u6863\uFF1A\u6587\u6863\uFF1Athymeleaf \u94FE\u63A5\uFF1A"),hp={href:"http://note.youdao.com/noteshare?id=7771a96e9031b30b91ed55c50528e918",target:"_blank",rel:"noopener noreferrer"},yp=s("http://note.youdao.com/noteshare?id=7771a96e9031b30b91ed55c50528e918"),fp=p(`<h4 id="_3-1-2-springboot-\u6574\u5408-thymeleaf" tabindex="-1"><a class="header-anchor" href="#_3-1-2-springboot-\u6574\u5408-thymeleaf" aria-hidden="true">#</a> 3.1.2 SpringBoot \u6574\u5408 thymeleaf</h4><p>Pom.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- \u7248\u672C\u540E\u7531SpringBoot\u8FDB\u884C\u7BA1\u7406--&gt;</span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">Spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">thymeleaf</span><span class="token punctuation">:</span>
    <span class="token key atrule">cache</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># \u5F00\u53D1\u8FC7\u7A0B\u5EFA\u8BAE\u5173\u95ED\u7F13\u5B58</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>resource \u76EE\u5F55\u4ECB\u7ECD\uFF1A</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029102830164.png" alt="image-20201029102830164" loading="lazy"></p><p>index.html\u4E2D\u4F7F\u7528</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>\\<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--\u4F7F\u7528thymeleaf\u4E2D\u5FC5\u987B\u58F0\u660E\u52A0\u4E0A\u8BE5\u884C\u4EE3\u7801--&gt;</span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span>  <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u76F8\u5173\u8BED\u6CD5\u4F7F\u7528</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!--\u548Cjsp\u76F8\u5173\u8868\u8FBE\u5F0F\u6709\u70B9\u76F8\u4F3C \u5177\u4F53\u4F7F\u7528\u8FC7\u7A0B\u53C2\u8003\u6587\u6863--&gt;</span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>category : \${categorys}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header_main_left_a<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ctg-data=\${category.catId}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${category.name}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u5BB6\u7528\u7535\u5668\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9ED8\u8BA4SpringBoot\u4F1A\u76F4\u63A5\u53BB\u627E templates \u4E0B\u7684 index.html</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029103230550.png" alt="image-20201029103230550" loading="lazy"></p><h3 id="_3-2-\u6574\u5408dev-tools-\u6E32\u67D3\u5206\u7C7B\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3-2-\u6574\u5408dev-tools-\u6E32\u67D3\u5206\u7C7B\u6570\u636E" aria-hidden="true">#</a> 3.2 \u6574\u5408dev-tools \u6E32\u67D3\u5206\u7C7B\u6570\u636E</h3><p><strong>\u9700\u6C42\u5206\u6790\uFF1A</strong></p><p>\u6211\u4EEC\u9700\u8981\u5728\u9875\u9762\u7684\u4FA7\u8FB9\u67E5\u8BE2\u51FA\u5206\u7C7B\u7684\u6570\u636E\uFF0C\u5E76\u4E14\u9009\u4E2D\u4E00\u7EA7\u5206\u7C7B\u6570\u636E\u540E\u663E\u793A\u4E8C\u7EA7\u548C\u4E09\u7EA7\u5206\u7C7B\u6570\u636E</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029103544553.png" alt="image-20201029103544553" loading="lazy"></p><ul><li>\u5148\u83B7\u53D6\u4E00\u7EA7\u5206\u7C7B\u6570\u636E</li><li>\u7528\u6237\u9009\u4E2D\u540E\u5728\u67E5\u8BE2\u4E8C\u7EA7\u5206\u7C7B\u6570\u636E</li></ul><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u67E5\u8BE2\u6240\u6709\u4E00\u7EA7\u5206\u7C7B
 * <span class="token keyword">@param</span> <span class="token parameter">model</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/index.html&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">indexPage</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">// select * from category where parent_id = 0</span>
    <span class="token comment">//TODO 1\u3001\u67E5\u8BE2\u6240\u6709\u7684\u4E00\u7EA7\u5206\u7C7B</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> categoryEntityList <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">getLevel1Categorys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;categorys&quot;</span><span class="token punctuation">,</span>categoryEntityList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u67E5\u8BE2\u6240\u6709\u7684\u4E00\u7EA7\u5206\u7C7B</span>
    <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">getLevel1Categorys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// parent_cid\u4E3A0\u5219\u662F\u4E00\u7EA7\u76EE\u5F55</span>
   <span class="token keyword">return</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;parent_cid&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E00\u7EA7\u5206\u7C7B\u6570\u636E\u80FD\u663E\u793A\u540E\uFF0C\u7740\u624B\u5904\u7406\u4E8C\u7EA7\u5206\u7C7B\u6570\u636E\u83B7\u53D6</p><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u67E5\u8BE2\u5B8C\u6574\u5206\u7C7B\u6570\u636E
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/index/catalog.json&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token function">getCatelogJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> catelogJson <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">getCatelogJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> catelogJson<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token function">getCatelogJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1\u3001\u67E5\u8BE2\u6240\u67091\u7EA7\u5206\u7C7B</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> level1Categorys <span class="token operator">=</span> <span class="token function">getLevel1Categorys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2\u3001\u5C01\u88C5\u6570\u636E\u5C01\u88C5\u6210 map\u7C7B\u578B  key\u4E3A catId,value List\\&lt;Catelog2Vo&gt;</span>
    <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> categoryList <span class="token operator">=</span> level1Categorys<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>k <span class="token operator">-&gt;</span> k<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u6BCF\u4E00\u4E2A\u7684\u4E00\u7EA7\u5206\u7C7B\uFF0C\u67E5\u8BE2\u5230\u8FD9\u4E2A\u4E00\u7EA7\u5206\u7C7B\u7684\u4E8C\u7EA7\u5206\u7C7B</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> categoryEntities <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;parent_cid&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2\u3001\u5C01\u88C5\u4E0A\u9762\u7684\u7ED3\u679C</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span> catelog2Vos <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>categoryEntities <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            catelog2Vos <span class="token operator">=</span> categoryEntities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>l2 <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">Catelog2Vo</span> catelog2Vo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Catelog2Vo</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> l2<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> l2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 1\u3001\u67E5\u8BE2\u5F53\u524D\u4E8C\u7EA7\u5206\u7C7B\u7684\u4E09\u7EA7\u5206\u7C7Bvo</span>
                <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> categoryEntities1 <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;parent_cid&quot;</span><span class="token punctuation">,</span> l2<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>categoryEntities1 <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">// 2\u3001\u5206\u88C5\u6210\u6307\u5B9A\u683C\u5F0F</span>
                    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">.</span>catelog3Vo<span class="token punctuation">&gt;</span></span> catelog3VoList <span class="token operator">=</span> categoryEntities1<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>l3 <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Catelog2Vo</span><span class="token punctuation">.</span>catelog3Vo catelog3Vo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Catelog2Vo</span><span class="token punctuation">.</span><span class="token function">catelog3Vo</span><span class="token punctuation">(</span>l2<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> l3<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> l3<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> catelog3Vo<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 3\u3001\u8BBE\u7F6E\u5206\u7C7B\u6570\u636E</span>
                    catelog2Vo<span class="token punctuation">.</span><span class="token function">setCatalog3List</span><span class="token punctuation">(</span>catelog3VoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
                <span class="token keyword">return</span> catelog2Vo<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> catelog2Vos<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2\u3001\u5C01\u88C5\u6570\u636E</span>
    <span class="token keyword">return</span> categoryList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u4E0A\u65B9\u4EE3\u7801\u5177\u4F53\u4E1A\u52A1\u903B\u8F91\uFF1A</strong></p><ul><li>\u67E5\u8BE2\u5230\u4E00\u7EA7\u5206\u7C7B\uFF0C\u6839\u636E\u4E00\u7EA7\u5206\u7C7B\u67E5\u8BE2\u51FA\u4E8C\u7EA7\u5206\u7C7B\u5E76\u8BBE\u7F6E\u5BF9\u5E94Vo\u5BF9\u8C61\uFF0C\u4EE5\u6B64\u7C7B\u63A8</li></ul><h1 id="_4\u3001\u5546\u57CE\u4E1A\u52A1-nginx-\u57DF\u540D\u8BBF\u95EE" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5546\u57CE\u4E1A\u52A1-nginx-\u57DF\u540D\u8BBF\u95EE" aria-hidden="true">#</a> 4\u3001\u5546\u57CE\u4E1A\u52A1 &amp; Nginx \u57DF\u540D\u8BBF\u95EE</h1><h3 id="_4-1-nginx-\u642D\u5EFA\u57DF\u540D\u73AF\u5883\u4E00-\u53CD\u5411\u4EE3\u7406\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_4-1-nginx-\u642D\u5EFA\u57DF\u540D\u73AF\u5883\u4E00-\u53CD\u5411\u4EE3\u7406\u914D\u7F6E" aria-hidden="true">#</a> 4.1 Nginx \u642D\u5EFA\u57DF\u540D\u73AF\u5883\u4E00\uFF08\u53CD\u5411\u4EE3\u7406\u914D\u7F6E\uFF09</h3><p>\u4EC0\u4E48\u662F \u53CD\u5411\u4EE3\u7406?</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029051037570.png" alt="image-20201029051037570" loading="lazy"></p><p>vi nginx.conf \u6587\u4EF6\u540E\u5728\u5E95\u90E8\u6709\u8BE5\u6761\u8BED\u53E5\uFF1A</p><ul><li>\u5F15\u5165nginx\u4E0B\u7684 conf.d \u4E0B\u9762\u7684conf\u6587\u4EF6</li><li>\u90A3\u4E48\u6211\u4EEC\u5F00\u59CB\u5728\u8BE5\u76EE\u5F55\u4E0B\u589E\u52A0\u5173\u4E8E \u8C37\u7C92\u5546\u57CE\u7684 nginx</li></ul><p><img src="http://qnimg.gisfsde.com/work/image-20201029045921936.png" alt="image-20201029045921936" loading="lazy"></p><p>\u62F7\u8D1D\u539F\u5148\u9ED8\u8BA4\u7684 conf</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029050207857.png" alt="image-20201029050207857" loading="lazy"></p><p>\u4FEE\u6539</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029050136324.png" alt="image-20201029050136324" loading="lazy"></p><h3 id="_4-2-nginx-\u642D\u5EFA\u57DF\u540D\u73AF\u5883\u4E8C-\u8D1F\u8F7D\u5747\u8861\u5230\u7F51\u5173" tabindex="-1"><a class="header-anchor" href="#_4-2-nginx-\u642D\u5EFA\u57DF\u540D\u73AF\u5883\u4E8C-\u8D1F\u8F7D\u5747\u8861\u5230\u7F51\u5173" aria-hidden="true">#</a> 4.2 Nginx \u642D\u5EFA\u57DF\u540D\u73AF\u5883\u4E8C \uFF08\u8D1F\u8F7D\u5747\u8861\u5230\u7F51\u5173\uFF09</h3><p>\u914D\u7F6E UpStream</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029050256216.png" alt="image-20201029050256216" loading="lazy"></p>`,43),qp=s("\u4F7F\u7528nginx\u5B9E\u73B0\u8D1F\u8F7D\u5E73\u8861\u7684\u6700\u7B80\u5355\u914D\u7F6E\u5982\u4E0B,\u5B98\u7F51\u5730\u5740\uFF1A"),wp={href:"https://nginx.org/en/docs/http/load_balancing.html",target:"_blank",rel:"noopener noreferrer"},_p=s("https://nginx.org/en/docs/http/load_balancing.html"),Sp=p(`<div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>http {
    upstream myapp1 {
        server srv1.example.com;
        server srv2.example.com;
        server srv3.example.com;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://myapp1;
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u540C\u65F6\u5728 \u672C\u673A\u4E0A hosts \u6587\u4EF6\u4E0A\u90A3\u4E2A\u914D\u7F6E \u57DF\u540D\u6620\u5C04</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029050625740.png" alt="image-20201029050625740" loading="lazy"></p><p>\u5C06\u8BF7\u6C42\u8F6C\u63A5\u7ED9\u7F51\u5173\u540E\uFF0C\u9700\u8981\u5728\u7F51\u5173\u914D\u7F6E</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> gulimall_host_route
  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//gulimall<span class="token punctuation">-</span>product
  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> Host=<span class="token important">**.gulimall.com</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6700\u540E\u653E\u51E0\u5F20\u56FE\u65B9\u4FBF\u7406\u89E3\u54C8</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029050828421.png" alt="image-20201029050828421" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201029050901546.png" alt="image-20201029050901546" loading="lazy"></p><h1 id="_5\u3001\u6027\u80FD\u538B\u6D4B-\u538B\u529B\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u6027\u80FD\u538B\u6D4B-\u538B\u529B\u6D4B\u8BD5" aria-hidden="true">#</a> 5\u3001\u6027\u80FD\u538B\u6D4B &amp; \u538B\u529B\u6D4B\u8BD5</h1><p><strong>\u7B80\u4ECB</strong></p><p>\u538B\u529B\u6D4B\u8BD5\u8003\u5BDF\u5F53\u524D\u8F6F\u786C\u4EF6\u73AF\u5883\u4E0B\u7CFB\u7EDF\u6240\u80FD\u627F\u53D7\u4F4F\u7684\u6700\u5927\u8D1F\u8377\u5E76\u5E2E\u52A9\u627E\u51FA\u7CFB\u7EDF\u7684\u74F6\u9888\u6240\u5728\uFF0C\u538B\u6D4B\u90FD\u662F\u4E3A\u4E86\u7CFB\u7EDF</p><p>\u5728\u7EBF\u4E0A\u7684\u5904\u7406\u80FD\u529B\u548C\u7A33\u5B9A\u6027\u7EF4\u6301\u5728\u4E00\u4E2A\u6807\u51C6\u8303\u56F4\u5185\uFF0C\u505A\u5230\u5FC3\u4E2D\u6709\u6570</p><p>\u4F7F\u7528\u538B\u529B\u6D4B\u8BD5\uFF0C\u6211\u4EEC\u6709\u5E0C\u671B\u627E\u5230\u5F88\u591A\u79CD\u7528\u5176\u4ED6\u6D4B\u8BD5\u65B9\u6CD5\u66F4\u96BE\u53D1\u73B0\u7684\u9519\u8BEF\uFF0C\u6709\u4E24\u79CD\u9519\u8BEF\u7C7B\u578B\u662F\uFF1A</p><p>\u5185\u5B58\u6CC4\u6F0F\u3001\u5E76\u53D1\u4E0E\u540C\u6B65</p><p>\u6709\u6548\u7684\u538B\u529B\u6D4B\u8BD5\u7CFB\u7EDF\u5C06\u5E94\u7528\u4EE5\u4E0B\u8FD9\u4E9B\u5173\u952E\u6761\u4EF6\uFF1A\u91CD\u590D\u3001\u5E76\u53D1\u3001\u91CF\u7EA7\u3001\u968F\u673A\u53D8\u5316</p><h3 id="_5-1-\u6027\u80FD\u6307\u6807" tabindex="-1"><a class="header-anchor" href="#_5-1-\u6027\u80FD\u6307\u6807" aria-hidden="true">#</a> 5.1 \u6027\u80FD\u6307\u6807</h3><h4 id="_5-1-1-jvm-\u5185\u5B58\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_5-1-1-jvm-\u5185\u5B58\u6A21\u578B" aria-hidden="true">#</a> 5.1.1 Jvm \u5185\u5B58\u6A21\u578B</h4><p>1\u3001Jvm\u5185\u5B58\u6A21\u578B</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029112517466.png" alt="image-20201029112517466" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201029113956043.png" alt="image-20201029113956043" loading="lazy"></p><h4 id="_5-1-2-\u5806" tabindex="-1"><a class="header-anchor" href="#_5-1-2-\u5806" aria-hidden="true">#</a> 5.1.2 \u5806</h4><p>\u6240\u6709\u7684\u5BF9\u8C61\u5B9E\u4F8B\u4EE5\u53CA\u6570\u7EC4\u90FD\u8981\u5728\u5806\u4E0A\u5206\u914D\uFF0C\u5806\u65F6\u5783\u573E\u6536\u96C6\u5668\u7BA1\u7406\u7684\u4E3B\u8981\u533A\u57DF\uFF0C\u4E5F\u88AB\u79F0\u4E3A &quot;GC\u5806&quot;\uFF0C\u4E5F\u662F\u6211\u4EEC\u4F18\u5316\u6700\u591A\u8003\u8651\u7684\u5730\u65B9</p><p>\u5806\u53EF\u4EE5\u7EC6\u5206\u4E3A\uFF1A</p><ul><li><p>\u65B0\u751F\u4EE3</p><ul><li>Eden\u7A7A\u95F4</li><li>From Survivor \u7A7A\u95F4</li><li>To Survivor \u7A7A\u95F4</li></ul></li><li><p>\u8001\u5E74\u4EE3</p></li><li><p>\u6C38\u4E45\u4EE3/\u539F\u7A7A\u95F4</p><ul><li>Java8 \u4EE5\u524D\u6C38\u4E45\u4EE3\u3001\u53D7 JVM \u7BA1\u7406\u3001Java8 \u4EE5\u540E\u539F\u7A7A\u95F4\uFF0C\u76F4\u63A5\u4F7F\u7528\u7269\u7406\u5185\u5B58\uFF0C\u56E0\u6B64\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u539F\u7A7A\u95F4\u7684\u5927\u5C0F\u4EC5\u53D7\u672C\u5730\u5185\u5B58\u9650\u5236</li></ul></li></ul><p>\u5783\u573E\u56DE\u6536</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029114153244.png" alt="image-20201029114153244" loading="lazy"></p><p>\u4ECE Java8 \u5F00\u59CB,HotSpot \u5DF2\u7ECF\u5B8C\u5168\u5C06\u6C38\u4E45\u4EE3\uFF08Permanent Generation\uFF09\u79FB\u9664\uFF0C\u53D6\u800C\u4EE3\u4E4B\u7684\u662F\u4E00\u4E2A\u65B0\u7684\u533A\u57DF - \u5143\u7A7A\u95F4\uFF08MetaSpac)</p><img src="http://qnimg.gisfsde.com/work/image-20201029114652885.png" alt="http://qnimg.gisfsde.com/work/image-20201029114652885"><p><img src="http://qnimg.gisfsde.com/work/image-20201029114218716.png" alt="image-20201029114218716" loading="lazy"></p><h4 id="_5-1-3-jconsole-\u4E0E-jvisualvm" tabindex="-1"><a class="header-anchor" href="#_5-1-3-jconsole-\u4E0E-jvisualvm" aria-hidden="true">#</a> 5.1.3 jconsole \u4E0E jvisualvm</h4><p>jdk \u7684\u4E24\u4E2A\u5C0F\u5DE5\u5177 jconsole\u3001jvisualvm\uFF08\u5347\u7EA7\u7248\u672C\u7684 jconsole\uFF09\u3002\u901A\u8FC7\u547D\u4EE4\u884C\u542F\u52A8\u3001\u53EF\u76D1\u63A7\u672C\u5730\u548C\u8FDC\u7A0B\u5E94\u7528\u3001\u8FDC\u7A0B\u5E94\u7528\u9700\u8981\u914D\u7F6E</p><p>1\u3001jvisualvm \u80FD\u5E72\u4EC0\u4E48</p><p>\u76D1\u63A7\u5185\u5B58\u6CC4\u6F0F\u3001\u8DDF\u8E2A\u5783\u573E\u56DE\u6536\u3001\u6267\u884C\u65F6\u5185\u5B58\u3001cpu\u5206\u6790\u3001\u7EBF\u7A0B\u5206\u6790.....</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029120502383.png" alt="image-20201029120502383" loading="lazy"></p><p>\u8FD0\u884C\uFF1A\u6B63\u5728\u8FD0\u884C\u7684\u7EBF\u7A0B</p><p>\u4F11\u7720\uFF1Asleep</p><p>\u7B49\u5F85\uFF1Await</p><p>\u9A7B\u7559\uFF1A\u7EBF\u7A0B\u6C60\u91CC\u9762\u7684\u7A7A\u95F2\u7EBF\u7A0B</p><p>\u76D1\u89C6\uFF1A\u7EC4\u8D5B\u7684\u7EBF\u7A0B\u3001\u6B63\u5728\u7B49\u5F85\u9501</p><p>2\u3001\u5B89\u88C5\u63D2\u4EF6\u65B9\u4FBF\u67E5\u770B gc</p><p>cmd \u542F\u52A8 jvisualvm</p><p>\u5DE5\u5177-&gt;\u63D2\u4EF6</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029121108492.png" alt="image-20201029121108492" loading="lazy"></p><p>\u5982\u679C503 \u9519\u8BEF\u89E3\u51B3</p>`,44),xp=s("\u6253\u5F00\u7F51\u5740\uFF1A "),Ep={href:"https://visualvm.github.io/pluginscenters.html",target:"_blank",rel:"noopener noreferrer"},Ip=s("https://visualvm.github.io/pluginscenters.html"),Cp=p('<p>cmd \u67E5\u770B\u81EA\u5DF1\u7684jdk\u7248\u672C\uFF0C\u627E\u5230\u5BF9\u5E94\u7684</p><p>docker stats \u67E5\u770B\u76F8\u5173\u547D\u4EE4</p><h4 id="_5-1-4-\u76D1\u63A7\u6307\u6807" tabindex="-1"><a class="header-anchor" href="#_5-1-4-\u76D1\u63A7\u6307\u6807" aria-hidden="true">#</a> 5.1.4 \u76D1\u63A7\u6307\u6807</h4><p>SQL \u8017\u65F6\u8D8A\u5C0F\u8D8A\u597D\u3001\u4E00\u822C\u60C5\u51B5\u4E0B\u5FAE\u5999\u7EA7\u522B</p><p>\u547D\u4E2D\u7387\u8D8A\u9AD8\u8D8A\u597D\u3001\u4E00\u822C\u60C5\u51B5\u4E0B\u4E0D\u80FD\u4F4E\u4E8E95%</p><p>\u9501\u7B49\u5F85\u6B21\u6570\u8D8A\u4F4E\u8D8A\u597D\u3001\u7B49\u5F85\u65F6\u95F4\u8D8A\u77ED\u8D8A\u597D</p><h5 id="_1\u3001\u4E2D\u95F4\u4EF6\u6307\u6807" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u4E2D\u95F4\u4EF6\u6307\u6807" aria-hidden="true">#</a> 1\u3001\u4E2D\u95F4\u4EF6\u6307\u6807</h5><p>\u6BEB\u79D2</p><table><thead><tr><th style="text-align:center;">\u538B\u6D4B\u5185\u5BB9</th><th>\u538B\u6D4B\u7EBF\u7A0B\u6570</th><th>\u541E\u5410\u91CF/ms</th><th>90%\u54CD\u5E94\u65F6\u95F4/ms</th><th>99%\u54CD\u5E94\u65F6\u95F4/ms</th></tr></thead><tbody><tr><td style="text-align:center;"><strong>Nginx</strong></td><td>50</td><td>1834</td><td>11</td><td>40</td></tr><tr><td style="text-align:center;"><strong>GateWay</strong></td><td>50b</td><td>16577</td><td>5</td><td>19</td></tr><tr><td style="text-align:center;"><strong>\u7B80\u5355\u670D\u52A1</strong></td><td>50</td><td>17965</td><td>5</td><td>10</td></tr><tr><td style="text-align:center;"><strong>\u9996\u9875\u4E00\u7EA7\u83DC\u5355\u6E32\u67D3</strong></td><td>50</td><td>400\uFF08db,thymeleaf\uFF09</td><td>149</td><td>230</td></tr><tr><td style="text-align:center;"><strong>\u9996\u9875\u6E32\u67D3(\u5F00\u7F13\u5B58)</strong></td><td>50</td><td>467</td><td>128</td><td>209</td></tr><tr><td style="text-align:center;"><strong>\u9996\u9875\u6E32\u67D3\uFF08\u5F00\u7F13\u5B58\u3001\u4F18\u5316\u6570\u636E\u5E93\uFF0C\u5173\u65E5\u5FD7\uFF09</strong></td><td>50</td><td>1300</td><td>60</td><td>107</td></tr><tr><td style="text-align:center;"><strong>\u4E09\u7EA7\u5206\u7C7B\u6570\u636E\u83B7\u53D6</strong></td><td>50</td><td>4.4\uFF08db\uFF09/18\uFF08\u4F18\u5316\u540E\uFF09</td><td>16622</td><td>16832</td></tr><tr><td style="text-align:center;"><strong>\u4E09\u7EA7\u5206\u7C7B\u6570\u636E\u83B7\u53D6\uFF08\u4F18\u5316\u4E1A\u52A1\uFF09</strong></td><td>50</td><td>163</td><td>410</td><td>585</td></tr><tr><td style="text-align:center;"><strong>\u4E09\u7EA7\u5206\u7C7B\u6570\u636E\u83B7\u53D6\uFF08redis\u7F13\u5B58\uFF09</strong></td><td>50</td><td>553</td><td>113</td><td>182</td></tr><tr><td style="text-align:center;"><strong>\u9996\u9875\u5168\u91CF\u6570\u636E\u83B7\u53D6</strong></td><td>50</td><td>10\uFF08\u9759\u6001\u8D44\u6E90\uFF09/12</td><td>6183</td><td>12358</td></tr><tr><td style="text-align:center;">Nginx+Gateway</td><td>50</td><td></td><td></td><td></td></tr><tr><td style="text-align:center;">Gateway+\u7B80\u5355\u670D\u52A1</td><td>50</td><td>2685</td><td>7</td><td>10</td></tr><tr><td style="text-align:center;">\u5168\u94FE\u8DEF</td><td>50</td><td>900</td><td>73</td><td>971</td></tr></tbody></table><p>\u4E2D\u95F4\u4EF6\u8D8A\u591A\uFF0C\u6027\u80FD\u635F\u5931\u8D8A\u5927\uFF0C\u5927\u591A\u90FD\u635F\u5931\u5728\u4E86\u7F51\u7EDC\u4EA4\u4E92</p><h5 id="_2\u3001\u6570\u636E\u5E93\u6307\u6807" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6570\u636E\u5E93\u6307\u6807" aria-hidden="true">#</a> 2\u3001\u6570\u636E\u5E93\u6307\u6807</h5><ul><li><p><strong>\u54CD\u5E94\u65F6\u95F4</strong>\uFF08Response Time:RT\uFF09</p></li><li><p>\u54CD\u5E94\u65F6\u95F4\u6307\u7528\u6237\u4ECE\u5BA2\u6237\u7AEF\u53D1\u8D77\u4E00\u4E2A\u8BF7\u6C42\u5F00\u59CB\uFF0C\u5230\u5BA2\u6237\u7AEF\u63A5\u6536\u5230\u670D\u52A1\u5668\u7AEF\u8FD4\u56DE\u7684\u54CD\u5E94\u7ED3\u675F\uFF0C\u6574\u4E2A\u8FC7\u7A0B\u6240\u8017\u8D39\u7684\u65F6\u95F4</p></li><li><p><strong>HPS</strong>\uFF08Hits Per Second\uFF09 \uFF1A\u6BCF\u79D2\u70B9\u51FB\u6B21\u6570\uFF0C\u5355\u4F4D\u662F\u6B21/\u79D2</p></li><li><p><strong>TPS</strong>\uFF08Transaction per Second\uFF09\uFF1A\u7CFB\u7EDF\u6BCF\u79D2\u5904\u7406\u4EA4\u6613\u6570\uFF0C\u5355\u4F4D\u662F\u7B14/\u79D2</p></li><li><p><strong>QPS</strong> (Query perSecond) :\u7CFB\u7EDF\u6BCF\u79D2\u5904\u7406\u67E5\u8BE2\u6B21\u6570\uFF0C\u5355\u4F4D\u662F\u6B21/\u79D2\u3002\u5BF9\u4E8E\u4E92\u8054\u7F51\u4E1A\u52A1\u4E2D\uFF0C\u5982\u679C\u67D0\u4E9B\u4E1A\u52A1\u6709\u4E14\u4EC5\u6709\u4E00\u4E2A\u8BF7\u6C42\u8FDE\u63A5\uFF0C\u90A3\u4E48TPS=QPS=HPS\uFF0C\u4E00\u822C\u60C5\u51B5\u4E0B\u7528TPS\u6765\u8861\u91CF\u6574\u4E2A\u4E1A\u52A1\u6D41\u7A0B\uFF0C\u7528QPS\u6765\u8861\u91CF\u63A5\u53E3\u67E5\u8BE2\u6B21\u6570\uFF0C\u7528HPS\u6765\u8868\u793A\u5BF9\u670D\u52A1\u5668\u5355\u51FB\u8BF7\u6C42\u3002</p></li><li><p>\u65E0\u8BBATPS\u3001QPS\u3001HPS,\u6B64\u6307\u6807\u662F\u8861\u91CF\u7CFB\u7EDF\u5904\u7406\u80FD\u529B\u975E\u5E38\u91CD\u8981\u7684\u6307\u6807\uFF0C\u8D8A\u5927\u8D8A\u597D\uFF0C\u6839\u636E\u7ECF\u9A8C\uFF0C\u4E00\u822C\u60C5\u51B5\u4E0B:</p><ul><li>\u91D1\u878D\u884C\u4E1A: 1000TPS~50000TPS, \u4E0D\u5305\u62EC\u4E92\u8054\u7F51\u5316\u7684\u6D3B\u52A8</li><li>\u4FDD\u9669\u884C\u4E1A: 1007P-00000PS\uFF0C \u4E0D\u5305\u62EC\u4E92\u8054\u7F51\u5316\u7684\u6D3B\u52A8</li><li>\u5236\u9020\u884C\u4E1A: 10TPS~5000TPS</li><li>\u4E92\u8054\u7F51\u7535\u5B50\u5546\u52A1: 10000TPS~-100000TPS</li><li>\u4E92\u8054\u7F51\u4E2D\u578B\u7F51\u7AD9: 1000TPS~50000TPS</li><li>\u4E92\u8054\u7F51\u5C0F\u578B\u7F51\u7AD9: 5007PS~10000TPS</li></ul></li><li><p><strong>\u6700\u5927\u54CD\u5E94\u65F6\u95F4</strong>(Max Response Time) \u6307\u7528\u6237\u53D1\u51FA\u8BF7\u6C42\u6216\u8005\u6307\u4EE4\u5230\u7CFB\u7EDF\u505A\u51FA\u53CD\u5E94(\u54CD\u5E94)\u7684\u6700\u5927\u65F6\u95F4\u3002</p></li><li><p><strong>\u6700\u5C11\u54CD\u5E94\u65F6\u95F4</strong> \uFF08Mininum ResponseTime\uFF09\u6307\u7528\u6237\u53D1\u51FA\u8BF7\u6C42\u6216\u8005\u6307\u4EE4\u5230\u7CFB\u7EDF\u505A\u51FA\u53CD\u5E94\uFF08\u54CD\u5E94\uFF09\u7684\u6700\u5C11\u65F6\u95F4</p></li><li><p><strong>90%\u54CD\u5E94\u65F6\u95F4</strong>\uFF0890% Response Time\uFF09 \u662F\u6307\u6240\u6709\u7528\u6237\u7684\u54CD\u5E94\u65F6\u95F4\u8FDB\u884C\u6392\u5E8F\u3001\u7B2C90%\u7684\u54CD\u5E94\u65F6\u95F4</p></li><li><p>\u4ECE\u5916\u90E8\u770B\u3001\u6027\u80FD\u6D4B\u8BD5\u4E3B\u8981\u5173\u6CE8\u5982\u4E0B\u4E09\u4E2A\u6307</p><ul><li>\u541E\u5410\u91CF\uFF1A\u6BCF\u79D2\u949F\u7CFB\u7EDF\u80FD\u591F\u5904\u7406\u7684\u8BF7\u6C42\u6570\u3001\u4EFB\u52A1\u6570</li><li>\u54CD\u5E94\u65F6\u95F4\uFF1A\u670D\u52A1\u5904\u7406\u4E00\u4E2A\u8BF7\u6C42\u6216\u4E00\u4E2A\u4EFB\u52A1\u7684\u8017\u65F6</li><li>\u9519\u8BEF\u7387\uFF1A\u4E00\u6279\u8BF7\u6C42\u4E2D\u7ED3\u679C\u51FA\u9519\u7684\u8BF7\u6C42\u6240\u5360\u6BD4\u4F8B</li></ul></li></ul><p>\u541E\u5410\u91CF\u5927:\u7CFB\u7EDF\u652F\u6301\u9AD8\u5E76\u53D1\uFF0C</p><p>\u54CD\u5E94\u65F6\u95F4\uFF1A\u8D8A\u77ED\u8BF4\u660E\u63A5\u53E3\u6027\u80FD\u8D8A\u597D</p><h3 id="_5-2-jmeter" tabindex="-1"><a class="header-anchor" href="#_5-2-jmeter" aria-hidden="true">#</a> 5.2 JMeter</h3><h4 id="_5-2-1-jmeter-\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_5-2-1-jmeter-\u5B89\u88C5" aria-hidden="true">#</a> 5.2.1 JMeter \u5B89\u88C5</h4>',16),Ap=s("jmeter\u5B98\u7F51\uFF1A"),jp={href:"https://jmeter.apache.org/",target:"_blank",rel:"noopener noreferrer"},Rp=s("https://jmeter.apache.org/"),Op=p(`<h4 id="_5-2-2-jmeter-\u538B\u6D4B\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_5-2-2-jmeter-\u538B\u6D4B\u793A\u4F8B" aria-hidden="true">#</a> 5.2.2 JMeter \u538B\u6D4B\u793A\u4F8B</h4><h5 id="_1\u3001\u6DFB\u52A0\u7EBF\u7A0B\u7EC4" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6DFB\u52A0\u7EBF\u7A0B\u7EC4" aria-hidden="true">#</a> 1\u3001\u6DFB\u52A0\u7EBF\u7A0B\u7EC4</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201029084634498.png" alt="image-20201029084634498" loading="lazy"></p><h5 id="_2\u3001\u6DFB\u52A0-http-\u8BF7\u6C42" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6DFB\u52A0-http-\u8BF7\u6C42" aria-hidden="true">#</a> 2\u3001\u6DFB\u52A0 HTTP \u8BF7\u6C42</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201029085843220.png" alt="image-20201029085843220" loading="lazy"></p><h5 id="_3\u3001\u6DFB\u52A0\u76D1\u542C\u5668" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u6DFB\u52A0\u76D1\u542C\u5668" aria-hidden="true">#</a> 3\u3001\u6DFB\u52A0\u76D1\u542C\u5668</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201029085942442.png" alt="image-20201029085942442" loading="lazy"></p><h5 id="_4\u3001\u542F\u52A8\u538B\u6D4B-\u67E5\u770B" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u542F\u52A8\u538B\u6D4B-\u67E5\u770B" aria-hidden="true">#</a> 4\u3001\u542F\u52A8\u538B\u6D4B&amp;\u67E5\u770B</h5><p>\u6C47\u603B\u56FE</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029092357910.png" alt="image-20201029092357910" loading="lazy"></p><p>\u5BDF\u770B\u7ED3\u679C\u6811</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029092436633.png" alt="image-20201029092436633" loading="lazy"></p><p>\u6C47\u603B\u62A5\u544A</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029092454376.png" alt="image-20201029092454376" loading="lazy"></p><p>\u805A\u5408\u62A5\u544A</p><p><img src="http://qnimg.gisfsde.com/work/image-20201029092542876.png" alt="image-20201029092542876" loading="lazy"></p><h4 id="_5-2-3-jmeter-address-already-in-use-\u9519\u8BEF\u89E3\u51B3" tabindex="-1"><a class="header-anchor" href="#_5-2-3-jmeter-address-already-in-use-\u9519\u8BEF\u89E3\u51B3" aria-hidden="true">#</a> 5.2.3 JMeter Address Already in use \u9519\u8BEF\u89E3\u51B3</h4><p>windows\u672C\u8EAB\u63D0\u4F9B\u7684\u7AEF\u53E3\u8BBF\u95EE\u673A\u5236\u7684\u95EE\u9898\u3002 Windows\u63D0\u4F9B\u7ED9TCP/IP \u94FE\u63A5\u7684\u7AEF\u53E3\u4E3A1024-5000\uFF0C\u5E76\u4E14\u8981\u56DB\u5206\u949F\u6765\u5FAA\u73AF\u56DE\u6536\u4ED6\u4EEC\u3002\u5C31\u5BFC\u81F4 \u6211\u4EEC\u5728\u77ED\u65F6\u95F4\u5185\u8DD1\u5927\u91CF\u7684\u8BF7\u6C42\u65F6\u5C06\u7AEF\u53E3\u5360\u6EE1\u4E86\u3002</p><p>1.cmd\u4E2D\uFF0C\u7528regedit\u547D\u4EE4\u6253\u5F00\u6CE8\u518C\u8868</p><p>2.\u5728HKEY_ LOCAL MACHINE\\SYSTEMCurrentControlSet\\Services Tcpip\\Parameters\u4E0B\uFF0C</p><p>\u200B 1.\u53F3\u51FBparameters,\u6DFB\u52A0\u4E00\u4E2A\u65B0\u7684DWORD,\u540D\u5B57\u4E3AMaxUserPort \u200B 2.\u7136\u540E\u53CC\u51FB MaxUserPort,\u8F93\u5165\u6570\u503C\u6570\u636E\u4E3A65534,\u57FA\u6570\u9009\u62E9\u5341\u8FDB\u5236(\u5982\u679C\u662F\u5206\u5E03\u5F0F\u8FD0\u884C\u7684\u8BDD\uFF0C\u63A7\u5236\u673A\u5668\u548C\u8D1F\u8F7D\u673A\u5668\u90FD\u9700\u8981\u8FD9\u6837\u64CD\u4F5C\u54E6)</p><p>3.\u4FEE\u6539\u914D\u7F6E\u5B8C\u6BD5\u4E4B\u540E\u8BB0\u5F97\u91CD\u542F\u673A\u5668\u624D\u4F1A\u751F\u6548</p><p>TCPTimedWaitDelay:30</p><h1 id="_6\u3001\u7F13\u5B58\u4E0E\u5206\u5E03\u5F0F\u9501" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u7F13\u5B58\u4E0E\u5206\u5E03\u5F0F\u9501" aria-hidden="true">#</a> 6\u3001\u7F13\u5B58\u4E0E\u5206\u5E03\u5F0F\u9501</h1><h3 id="_6-1-\u7F13\u5B58" tabindex="-1"><a class="header-anchor" href="#_6-1-\u7F13\u5B58" aria-hidden="true">#</a> 6.1 \u7F13\u5B58</h3><h4 id="_6-1-2-\u7F13\u5B58\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_6-1-2-\u7F13\u5B58\u4F7F\u7528" aria-hidden="true">#</a> 6.1.2 \u7F13\u5B58\u4F7F\u7528</h4><p>\u4E3A\u4E86\u7CFB\u7EDF\u6027\u80FD\u7684\u63D0\u5347\uFF0C\u6211\u4EEC\u4E00\u822C\u90FD\u4F1A\u5C06\u90E8\u5206\u6570\u636E\u653E\u5165\u7F13\u5B58\u4E2D\uFF0C\u52A0\u901F\u8BBF\u95EE\uFF0C\u800C db \u627F\u62C5\u6570\u636E\u843D\u76D8\u5DE5\u4F5C</p><p><strong>\u54EA\u4E9B\u6570\u636E\u9002\u5408\u653E\u5165\u7F13\u5B58\uFF1F</strong></p><ul><li><strong>\u5373\u65F6\u6027\u3001\u6570\u636E\u4E00\u81F4\u6027\u8981\u6C42\u4E0D\u9AD8\u7684</strong></li><li><strong>\u8BBF\u95EE\u91CF\u5927\u4E14\u66F4\u65B0\u9891\u7387\u4E0D\u9AD8\u7684\u6570\u636E\uFF08\u8BFB\u591A\u3001\u5199\u5C11\uFF09</strong></li></ul><p>\u4E3E\u4F8B\uFF1A\u7535\u5546\u7C7B\u5E94\u7528\u3001\u5546\u54C1\u5206\u7C7B\uFF0C\u5546\u54C1\u5217\u8868\u7B49\u9002\u5408\u7F13\u5B58\u5E76\u52A0\u4E00\u4E2A\u5931\u6548\u65F6\u95F4\uFF08\u6839\u636E\u6570\u636E\u66F4\u65B0\u9891\u7387\u6765\u5B9A\uFF09\u540E\u53F0\u5982\u679C\u53D1\u5E03\u4E00\u4E2A\u5546\u54C1\u3001\u4E70\u5BB6\u9700\u8981 5 \u5206\u949F\u624D\u80FD\u770B\u5230\u65B0\u5546\u54C1\u4E00\u822C\u8FD8\u662F\u53EF\u4EE5\u63A5\u53D7\u7684</p><p><img src="http://qnimg.gisfsde.com/work/image-20201030190425556.png" alt="image-20201030190425556" loading="lazy"></p><p>\u4F2A\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>data <span class="token operator">=</span> cche<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u4ECE\u7F13\u5B58\u4E2D\u52A0\u8F7D\u6570\u636E</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>data <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4ECE\u6570\u636E\u5E93\u52A0\u8F7D\u6570\u636E</span>
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4FDD\u5B58\u5230 cache\u4E2D</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> data<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F\uFF1A\u5728\u5F00\u53D1\u4E2D\uFF0C\u51E1\u662F\u653E\u5230\u7F13\u5B58\u4E2D\u7684\u6570\u636E\u6211\u4EEC\u90FD\u5E94\u8BE5\u5236\u5B9A\u8FC7\u671F\u65F6\u95F4\uFF0C\u4F7F\u5176\u53EF\u4EE5\u5728\u7CFB\u7EDF\u5373\u4F7F\u6CA1\u6709\u4E3B\u52A8\u66F4\u65B0\u6570\u636E\u4E5F\u80FD\u81EA\u52A8\u89E6\u53D1\u6570\u636E\u52A0\u8F7D\u7684\u6D41\u7A0B\uFF0C\u907F\u514D\u4E1A\u52A1\u5954\u6E83\u5BFC\u81F4\u7684\u6570\u636E\u6C38\u4E45\u4E0D\u4E00\u81F4\u7684\u95EE\u9898</p><h4 id="_6-1-3-\u6574\u5408-redis-\u4F5C\u4E3A\u7F13\u5B58" tabindex="-1"><a class="header-anchor" href="#_6-1-3-\u6574\u5408-redis-\u4F5C\u4E3A\u7F13\u5B58" aria-hidden="true">#</a> 6.1.3 \u6574\u5408 redis \u4F5C\u4E3A\u7F13\u5B58</h4><h5 id="_1\u3001\u5F15\u5165\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5F15\u5165\u4F9D\u8D56" aria-hidden="true">#</a> 1\u3001\u5F15\u5165\u4F9D\u8D56</h5><p>SpringBoot \u6574\u5408 redis\uFF0C\u67E5\u770BSpringBoot\u63D0\u4F9B\u7684 starts</p><p><img src="http://qnimg.gisfsde.com/work/image-20201031154148722.png" alt="image-20201031154148722" loading="lazy"></p>`,38),Pp=s("\u5B98\u7F51\uFF1A"),Tp={href:"https://docs.spring.io/spring-boot/docs/2.1.18.RELEASE/reference/html/using-boot-build-systems.html#using-boot-starter",target:"_blank",rel:"noopener noreferrer"},Lp=s("https://docs.spring.io/spring-boot/docs/2.1.18.RELEASE/reference/html/using-boot-build-systems.html#using-boot-starter"),Vp=p(`<p>pom.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token comment">&lt;!--\u5F15\u5165redis--&gt;</span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--\u4E0D\u52A0\u8F7D\u81EA\u8EAB\u7684 lettuce--&gt;</span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.lettuce\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lettuce-core\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--jedis--&gt;</span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u914D\u7F6E" aria-hidden="true">#</a> 2\u3001\u914D\u7F6E</h5><p>application.yaml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">Spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.56.10
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>RedisAutoConfig.java</p><p><img src="http://qnimg.gisfsde.com/work/image-20201031154710108.png" alt="image-20201031154710108" loading="lazy"></p><h5 id="_3\u3001\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u6D4B\u8BD5" aria-hidden="true">#</a> 3\u3001\u6D4B\u8BD5</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;world_&quot;</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hello <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4E4B\u524D\u4FDD\u5B58\u7684\u6570\u636E\u662F\uFF1A&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4\u3001\u4F18\u5316\u4E09\u7EA7\u5206\u7C7B\u6570\u636E\u83B7\u53D6" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u4F18\u5316\u4E09\u7EA7\u5206\u7C7B\u6570\u636E\u83B7\u53D6" aria-hidden="true">#</a> 4\u3001\u4F18\u5316\u4E09\u7EA7\u5206\u7C7B\u6570\u636E\u83B7\u53D6</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * TODO \u4EA7\u751F\u5806\u5916\u5185\u5B58\u6EA2\u51FA OutOfDirectMemoryError
 * 1\u3001SpringBoot2.0\u4EE5\u540E\u9ED8\u8BA4\u4F7F\u7528 Lettuce\u4F5C\u4E3A\u64CD\u4F5Credis\u7684\u5BA2\u6237\u7AEF\uFF0C\u5B83\u4F7F\u7528 netty\u8FDB\u884C\u7F51\u7EDC\u901A\u4FE1
 * 2\u3001lettuce \u7684bug\u5BFC\u81F4netty\u5806\u5916\u5185\u5B58\u6EA2\u51FA\uFF0C-Xmx300m netty \u5982\u679C\u6CA1\u6709\u6307\u5B9A\u5806\u5185\u5B58\u79FB\u9664\uFF0C\u9ED8\u8BA4\u4F7F\u7528 -Xmx300m
 *      \u53EF\u4EE5\u901A\u8FC7-Dio.netty.maxDirectMemory \u8FDB\u884C\u8BBE\u7F6E
 *   \u89E3\u51B3\u65B9\u6848 \u4E0D\u80FD\u4F7F\u7528 -Dio.netty.maxDirectMemory\u8C03\u5927\u5185\u5B58
 *   1\u3001\u5347\u7EA7 lettuce\u5BA2\u6237\u7AEF\uFF0C2\u3001 \u5207\u6362\u4F7F\u7528jedis
 *   redisTemplate:
 *   lettuce\u3001jedis \u64CD\u4F5Credis\u7684\u5E95\u5C42\u5BA2\u6237\u7AEF\uFF0CSpring\u518D\u6B21\u5C01\u88C5
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token function">getCatelogJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u7ED9\u7F13\u5B58\u4E2D\u653E json \u5B57\u7B26\u4E32\u3001\u62FF\u51FA\u7684\u662F json \u5B57\u7B26\u4E32\uFF0C\u8FD8\u8981\u9006\u8F6C\u4E3A\u80FD\u7528\u7684\u5BF9\u8C61\u7C7B\u578B\u3010\u5E8F\u5217\u5316\u548C\u53CD\u5E8F\u5217\u5316\u3011</span>

    <span class="token comment">// 1\u3001\u52A0\u5165\u7F13\u5B58\u903B\u8F91\uFF0C\u7F13\u5B58\u4E2D\u653E\u7684\u6570\u636E\u662F json \u5B57\u7B26\u4E32</span>
    <span class="token comment">// JSON \u8DE8\u8BED\u8A00\uFF0C\u8DE8\u5E73\u53F0\u517C\u5BB9</span>
    <span class="token class-name">String</span> catelogJSON <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;catelogJSON&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>catelogJSON<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2\u3001\u7F13\u5B58\u6CA1\u6709\uFF0C\u4ECE\u6570\u636E\u5E93\u4E2D\u67E5\u8BE2</span>
        <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> catelogJsonFromDb <span class="token operator">=</span> <span class="token function">getCatelogJsonFromDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3\u3001\u67E5\u8BE2\u5230\u6570\u636E\uFF0C\u5C06\u6570\u636E\u8F6C\u6210 JSON \u540E\u653E\u5165\u7F13\u5B58\u4E2D</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>catelogJsonFromDb<span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;catelogJSON&quot;</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> catelogJsonFromDb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u8F6C\u6362\u4E3A\u6211\u4EEC\u6307\u5B9A\u7684\u5BF9\u8C61</span>
    <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>catelogJSON<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token operator">&lt;</span><span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-\u7F13\u5B58\u5931\u6548" tabindex="-1"><a class="header-anchor" href="#_6-2-\u7F13\u5B58\u5931\u6548" aria-hidden="true">#</a> 6.2 \u7F13\u5B58\u5931\u6548</h3><h4 id="\u9AD8\u5E76\u53D1\u4E0B\u7F13\u5B58\u5931\u6548\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u9AD8\u5E76\u53D1\u4E0B\u7F13\u5B58\u5931\u6548\u95EE\u9898" aria-hidden="true">#</a> \u9AD8\u5E76\u53D1\u4E0B\u7F13\u5B58\u5931\u6548\u95EE\u9898</h4><h5 id="\u7F13\u5B58\u5931\u6548" tabindex="-1"><a class="header-anchor" href="#\u7F13\u5B58\u5931\u6548" aria-hidden="true">#</a> \u7F13\u5B58\u5931\u6548</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201031163704355.png" alt="" loading="lazy"></p><h5 id="\u7F13\u5B58\u96EA\u5D29" tabindex="-1"><a class="header-anchor" href="#\u7F13\u5B58\u96EA\u5D29" aria-hidden="true">#</a> \u7F13\u5B58\u96EA\u5D29</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201031163949881.png" alt="image-20201031163949881" loading="lazy"></p><h5 id="\u7F13\u5B58\u51FB\u7A7F" tabindex="-1"><a class="header-anchor" href="#\u7F13\u5B58\u51FB\u7A7F" aria-hidden="true">#</a> \u7F13\u5B58\u51FB\u7A7F</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201031164021131.png" alt="image-20201031164021131" loading="lazy"></p><h5 id="\u5206\u5E03\u5F0F\u4E0B\u5982\u4F55\u52A0\u9501" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u4E0B\u5982\u4F55\u52A0\u9501" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u4E0B\u5982\u4F55\u52A0\u9501</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201031112235353.png" alt="image-20201031112235353" loading="lazy"></p><h3 id="_6-4-\u5206\u5E03\u5F0F\u9501" tabindex="-1"><a class="header-anchor" href="#_6-4-\u5206\u5E03\u5F0F\u9501" aria-hidden="true">#</a> 6.4 \u5206\u5E03\u5F0F\u9501</h3><h4 id="\u5206\u5E03\u5F0F\u9501\u539F\u7406\u4E0E\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u9501\u539F\u7406\u4E0E\u5E94\u7528" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u9501\u539F\u7406\u4E0E\u5E94\u7528</h4><h5 id="\u5206\u5E03\u5F0F\u9501\u57FA\u672C\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u9501\u57FA\u672C\u539F\u7406" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u9501\u57FA\u672C\u539F\u7406</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201031122557660.png" alt="image-20201031122557660" loading="lazy"></p><p>**\u7406\u89E3\uFF1A**\u5C31\u5148\u5F531000\u4E2A\u4EBA\u53BB\u5360\u4E00\u4E2A\u5395\u6240\uFF0C\u5395\u6240\u53EA\u80FD\u6709\u4E00\u4E2A\u4EBA\u5360\u5230\u8FD9\u4E2A\u5751\uFF0C\u5360\u5230\u8FD9\u4E2A\u5751\u5176\u4ED6\u4EBA\u5C31\u53EA\u80FD\u5728\u5916\u9762\u7B49\u5F85\uFF0C\u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\u540E\u53EF\u4EE5\u518D\u6B21\u6765\u5360\u5751\uFF0C\u4E1A\u52A1\u6267\u884C\u540E\uFF0C\u91CA\u653E\u9501\uFF0C\u90A3\u4E48\u5176\u4ED6\u4EBA\u5C31\u53EF\u4EE5\u6765\u5360\u8FD9\u4E2A\u5751</p><h5 id="\u5206\u5E03\u5F0F\u9501\u6F14\u8FDB-\u9636\u6BB5\u4E00" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u9501\u6F14\u8FDB-\u9636\u6BB5\u4E00" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u9501\u6F14\u8FDB - \u9636\u6BB5\u4E00</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201031123441336.png" alt="image-20201031123441336" loading="lazy"></p><p><strong>\u4EE3\u7801\uFF1A</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u52A0\u9501\u6210\u529F..\u6267\u884C\u4E1A\u52A1</span>
            <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> dataFromDb <span class="token operator">=</span> <span class="token function">getDataFromDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5220\u9664\u9501</span>
            <span class="token keyword">return</span> dataFromDb<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u52A0\u9501\u5931\u8D25\uFF0C\u91CD\u8BD5 synchronized()</span>
            <span class="token comment">// \u4F11\u7720100ms\u91CD\u8BD5</span>
            <span class="token keyword">return</span> <span class="token function">getCatelogJsonFromDbWithRedisLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u5206\u5E03\u5F0F\u9501\u6F14\u8FDB-\u9636\u6BB5\u4E8C" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u9501\u6F14\u8FDB-\u9636\u6BB5\u4E8C" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u9501\u6F14\u8FDB - \u9636\u6BB5\u4E8C</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201031123640746.png" alt="image-20201031123640746" loading="lazy"></p><p><strong>\u4EE3\u7801\uFF1A</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u52A0\u9501\u6210\u529F..\u6267\u884C\u4E1A\u52A1</span>
            <span class="token comment">// \u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> dataFromDb <span class="token operator">=</span> <span class="token function">getDataFromDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5220\u9664\u9501</span>
            <span class="token keyword">return</span> dataFromDb<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u52A0\u9501\u5931\u8D25\uFF0C\u91CD\u8BD5 synchronized()</span>
            <span class="token comment">// \u4F11\u7720100ms\u91CD\u8BD5</span>
            <span class="token keyword">return</span> <span class="token function">getCatelogJsonFromDbWithRedisLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u5206\u5E03\u5F0F\u9501\u6F14\u8FDB-\u9636\u6BB5\u4E09" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u9501\u6F14\u8FDB-\u9636\u6BB5\u4E09" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u9501\u6F14\u8FDB - \u9636\u6BB5\u4E09</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201031124210112.png" alt="image-20201031124210112" loading="lazy"></p><p><strong>\u4EE3\u7801\uFF1A</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u8BBE\u7F6E\u503C\u540C\u65F6\u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4</span>
<span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;111&quot;</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u52A0\u9501\u6210\u529F..\u6267\u884C\u4E1A\u52A1</span>
    <span class="token comment">// \u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4,\u5FC5\u987B\u548C\u52A0\u9501\u662F\u540C\u6B65\u7684\uFF0C\u539F\u5B50\u7684</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> dataFromDb <span class="token operator">=</span> <span class="token function">getDataFromDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5220\u9664\u9501</span>
    <span class="token keyword">return</span> dataFromDb<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u52A0\u9501\u5931\u8D25\uFF0C\u91CD\u8BD5 synchronized()</span>
    <span class="token comment">// \u4F11\u7720100ms\u91CD\u8BD5</span>
    <span class="token keyword">return</span> <span class="token function">getCatelogJsonFromDbWithRedisLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u5206\u5E03\u5F0F\u9501\u6F14\u8FDB-\u9636\u6BB5\u56DB" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u9501\u6F14\u8FDB-\u9636\u6BB5\u56DB" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u9501\u6F14\u8FDB - \u9636\u6BB5\u56DB</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201031124615670.png" alt="image-20201031124615670" loading="lazy"></p><p>\u56FE\u89E3\uFF1A</p><p><img src="http://qnimg.gisfsde.com/work/image-20201031130547173.png" alt="image-20201031130547173" loading="lazy"></p><p>\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token class-name">String</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E\u503C\u540C\u65F6\u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4</span>
        <span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">,</span>uuid<span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u52A0\u9501\u6210\u529F..\u6267\u884C\u4E1A\u52A1</span>
            <span class="token comment">// \u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4,\u5FC5\u987B\u548C\u52A0\u9501\u662F\u540C\u6B65\u7684\uFF0C\u539F\u5B50\u7684</span>
<span class="token comment">//            redisTemplate.expire(&quot;lock&quot;,30,TimeUnit.SECONDS);</span>
            <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> dataFromDb <span class="token operator">=</span> <span class="token function">getDataFromDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//            String lockValue = redisTemplate.opsForValue().get(&quot;lock&quot;);</span>
<span class="token comment">//            if (lockValue.equals(uuid)) {</span>
<span class="token comment">//                // \u5220\u9664\u6211\u81EA\u5DF1\u7684\u9501</span>
<span class="token comment">//                redisTemplate.delete(&quot;lock&quot;); // \u5220\u9664\u9501</span>
<span class="token comment">//            }</span>
<span class="token comment">// \u901A\u8FC7\u4F7F\u7528lua\u811A\u672C\u8FDB\u884C\u539F\u5B50\u6027\u5220\u9664</span>
            <span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token string">&quot;if redis.call(&#39;get&#39;,KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;,KEYS[1]) else return 0 end&quot;</span><span class="token punctuation">;</span>
                <span class="token comment">//\u5220\u9664\u9501</span>
                <span class="token class-name">Long</span> lock1 <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>script<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> dataFromDb<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u52A0\u9501\u5931\u8D25\uFF0C\u91CD\u8BD5 synchronized()</span>
            <span class="token comment">// \u4F11\u7720100ms\u91CD\u8BD5</span>
            <span class="token keyword">return</span> <span class="token function">getCatelogJsonFromDbWithRedisLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u5206\u5E03\u5F0F\u9501\u6F14\u8FDB-\u9636\u6BB5\u4E94-\u6700\u7EC8\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u9501\u6F14\u8FDB-\u9636\u6BB5\u4E94-\u6700\u7EC8\u6A21\u5F0F" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u9501\u6F14\u8FDB - \u9636\u6BB5\u4E94 \u6700\u7EC8\u6A21\u5F0F</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201031130201609.png" alt="image-20201031130201609" loading="lazy"></p><p>\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token class-name">String</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E\u503C\u540C\u65F6\u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4</span>
        <span class="token class-name">Boolean</span> lock <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">,</span>uuid<span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u83B7\u53D6\u5206\u5E03\u5F0F\u9501\u6210\u529F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u52A0\u9501\u6210\u529F..\u6267\u884C\u4E1A\u52A1</span>
            <span class="token comment">// \u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4,\u5FC5\u987B\u548C\u52A0\u9501\u662F\u540C\u6B65\u7684\uFF0C\u539F\u5B50\u7684</span>
<span class="token comment">//            redisTemplate.expire(&quot;lock&quot;,30,TimeUnit.SECONDS);</span>
            <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Catelog2Vo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> dataFromDb<span class="token punctuation">;</span>
<span class="token comment">//            String lockValue = redisTemplate.opsForValue().get(&quot;lock&quot;);</span>
<span class="token comment">//            if (lockValue.equals(uuid)) {</span>
<span class="token comment">//                // \u5220\u9664\u6211\u81EA\u5DF1\u7684\u9501</span>
<span class="token comment">//                redisTemplate.delete(&quot;lock&quot;); // \u5220\u9664\u9501</span>
<span class="token comment">//            }</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                dataFromDb <span class="token operator">=</span> <span class="token function">getDataFromDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token string">&quot;if redis.call(&#39;get&#39;,KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;,KEYS[1]) else return 0 end&quot;</span><span class="token punctuation">;</span>
                <span class="token comment">//\u5220\u9664\u9501</span>
                <span class="token class-name">Long</span> lock1 <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>script<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> dataFromDb<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u52A0\u9501\u5931\u8D25\uFF0C\u91CD\u8BD5 synchronized()</span>
            <span class="token comment">// \u4F11\u7720200ms\u91CD\u8BD5</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u83B7\u53D6\u5206\u5E03\u5F0F\u9501\u5931\u8D25\uFF0C\u7B49\u5F85\u91CD\u8BD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token function">getCatelogJsonFromDbWithRedisLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u95EE\u9898\uFF1A</p><ul><li>\u5206\u5E03\u5F0F\u52A0\u9501\u89E3\u9501\u90FD\u662F\u8FD9\u4E24\u5957\u4EE3\u7801\uFF0C\u53EF\u4EE5\u5C01\u88C5\u6210\u5DE5\u5177\u7C7B</li><li>\u5206\u5E03\u5F0F\u9501\u6709\u66F4\u4E13\u4E1A\u7684\u6846\u67B6</li></ul><h4 id="\u5206\u5E03\u5F0F\u9501-redisson" tabindex="-1"><a class="header-anchor" href="#\u5206\u5E03\u5F0F\u9501-redisson" aria-hidden="true">#</a> \u5206\u5E03\u5F0F\u9501 - Redisson</h4><h5 id="_1\u3001\u7B80\u4ECB-\u6574\u5408" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7B80\u4ECB-\u6574\u5408" aria-hidden="true">#</a> 1\u3001\u7B80\u4ECB&amp;\u6574\u5408</h5><p>\u5B98\u7F51\u6587\u6863\u4E0A\u8BE6\u7EC6\u8BF4\u660E\u4E86 \u4E0D\u63A8\u8350\u4F7F\u7528 setnx\u6765\u5B9E\u73B0\u5206\u5E03\u5F0F\u9501\uFF0C\u5E94\u8BE5\u53C2\u8003 the Redlock algorithm \u7684\u5B9E\u73B0</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101050725534.png" alt="image-20201101050725534" loading="lazy"></p>`,54),Dp=s("the Redlock algorithm\uFF1A"),Bp={href:"https://redis.io/topics/distlock",target:"_blank",rel:"noopener noreferrer"},Mp=s("https://redis.io/topics/distlock"),Up=n("p",null,"\u5728Java \u8BED\u8A00\u73AF\u5883\u4E0B\u4F7F\u7528 Redisson",-1),Np=n("p",null,[n("img",{src:"http://qnimg.gisfsde.com/work/image-20201101050924914.png",alt:"image-20201101050924914",loading:"lazy"})],-1),zp=s("github\uFF1A"),Fp={href:"https://github.com/redisson/redisson",target:"_blank",rel:"noopener noreferrer"},Gp=s("https://github.com/redisson/redisson"),Qp=p(`<p>\u6709\u5BF9\u5E94\u7684 \u4E2D\u6587\u6587\u6863</p><p>\u5728 Maven \u4ED3\u5E93\u4E2D\u641C\u7D22\u4E5F\u80FD\u641C\u7D22\u51FA Redisson</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101051157803.png" alt="image-20201101051157803" loading="lazy"></p><p>Pom</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--\u4EE5\u540E\u4F7F\u7528 redisson \u4F5C\u4E3A\u5206\u5E03\u9501\uFF0C\u5206\u5E03\u5F0F\u5BF9\u8C61\u7B49\u529F\u80FD--&gt;</span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.12.0\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001redisson-lock-\u9501\u6D4B\u8BD5-redisson-lock-\u770B\u95E8\u72D7\u539F\u7406-redisson-\u5982\u4F55\u89E3\u51B3\u6B7B\u9501" tabindex="-1"><a class="header-anchor" href="#_2\u3001redisson-lock-\u9501\u6D4B\u8BD5-redisson-lock-\u770B\u95E8\u72D7\u539F\u7406-redisson-\u5982\u4F55\u89E3\u51B3\u6B7B\u9501" aria-hidden="true">#</a> 2\u3001Redisson - Lock \u9501\u6D4B\u8BD5 &amp; Redisson - Lock \u770B\u95E8\u72D7\u539F\u7406 - Redisson \u5982\u4F55\u89E3\u51B3\u6B7B\u9501</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 1\u3001\u83B7\u53D6\u4E00\u628A\u9501\uFF0C\u53EA\u8981\u9501\u5F97\u540D\u5B57\u4E00\u6837\uFF0C\u5C31\u662F\u540C\u4E00\u628A\u9501</span>
    <span class="token class-name">RLock</span> lock <span class="token operator">=</span> redission<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;my-lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2\u3001\u52A0\u9501</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u963B\u585E\u5F0F\u7B49\u5F85\uFF0C\u9ED8\u8BA4\u52A0\u7684\u9501\u90FD\u662F30s\u65F6\u95F4</span>
    <span class="token comment">// 1\u3001\u9501\u7684\u81EA\u52A8\u7EED\u671F\uFF0C\u5982\u679C\u4E1A\u52A1\u8D85\u957F\uFF0C\u8FD0\u884C\u671F\u95F4\u81EA\u52A8\u7ED9\u9501\u7EED\u4E0A\u65B0\u768430s\uFF0C\u4E0D\u7528\u62C5\u5FC3\u4E1A\u52A1\u65F6\u95F4\u957F\uFF0C\u9501\u81EA\u52A8\u8FC7\u671F\u540E\u88AB\u5220\u6389</span>
    <span class="token comment">// 2\u3001\u52A0\u9501\u7684\u4E1A\u52A1\u53EA\u8981\u8FD0\u884C\u5B8C\u6210\uFF0C\u5C31\u4E0D\u4F1A\u7ED9\u5F53\u524D\u9501\u7EED\u671F\uFF0C\u5373\u4F7F\u4E0D\u624B\u52A8\u89E3\u9501\uFF0C\u9501\u9ED8\u8BA4\u4F1A\u572830s\u4EE5\u540E\u81EA\u52A8\u5220\u9664</span>

    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//10s \u540E\u81EA\u52A8\u5220\u9664</span>
    <span class="token comment">//\u95EE\u9898 lock.lock(10, TimeUnit.SECONDS) \u5728\u9501\u65F6\u95F4\u5230\u4E86\u540E\uFF0C\u4E0D\u4F1A\u81EA\u52A8\u7EED\u671F</span>
    <span class="token comment">// 1\u3001\u5982\u679C\u6211\u4EEC\u4F20\u9012\u4E86\u9501\u7684\u8D85\u65F6\u65F6\u95F4\uFF0C\u5C31\u53D1\u9001\u7ED9 redis \u6267\u884C\u811A\u672C\uFF0C\u8FDB\u884C\u5360\u9501\uFF0C\u9ED8\u8BA4\u8D85\u65F6\u5C31\u662F\u6211\u4EEC\u6307\u5B9A\u7684\u65F6\u95F4</span>
    <span class="token comment">// 2\u3001\u5982\u679C\u6211\u4EEC\u4E3A\u6307\u5B9A\u9501\u7684\u8D85\u65F6\u65F6\u95F4\uFF0C\u5C31\u662F\u7528 30 * 1000 LockWatchchdogTimeout\u770B\u95E8\u72D7\u7684\u9ED8\u8BA4\u65F6\u95F4\u3001</span>
    <span class="token comment">//      \u53EA\u8981\u5360\u9501\u6210\u529F\uFF0C\u5C31\u4F1A\u542F\u52A8\u4E00\u4E2A\u5B9A\u65F6\u4EFB\u52A1\uFF0C\u3010\u91CD\u65B0\u7ED9\u9501\u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4\uFF0C\u65B0\u7684\u8FC7\u671F\u65F6\u95F4\u5C31\u662F\u770B\u95E8\u72D7\u7684\u9ED8\u8BA4\u65F6\u95F4\u3011,\u6BCF\u969410s\u5C31\u81EA\u52A8\u7EED\u671F</span>
    <span class="token comment">//      internalLockLeaseTime\u3010\u770B\u95E8\u72D7\u65F6\u95F4\u3011 /3,10s</span>

    <span class="token comment">//\u6700\u4F73\u5B9E\u8DF5</span>
    <span class="token comment">// 1\u3001lock.lock(10, TimeUnit.SECONDS);\u7701\u6389\u4E86\u6574\u4E2A\u7EED\u671F\u64CD\u4F5C\uFF0C\u624B\u52A8\u89E3\u9501</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u52A0\u9501\u6210\u529F\uFF0C\u6267\u884C\u4E1A\u52A1...&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u89E3\u9501 \u5C06\u8BBE\u89E3\u9501\u4EE3\u7801\u6CA1\u6709\u8FD0\u884C\uFF0Creidsson\u4F1A\u4E0D\u4F1A\u51FA\u73B0\u6B7B\u9501</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u91CA\u653E\u9501....&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FDB\u5165\u5230 <code>Redisson</code> Lock \u6E90\u7801</p><p>1\u3001\u8FDB\u5165 <code>Lock</code> \u7684\u5B9E\u73B0 \u53D1\u73B0 \u4ED6\u8C03\u7528\u7684\u4E5F\u662F <code>lock</code> \u65B9\u6CD5\u53C2\u6570 \u65F6\u95F4\u4E3A -1</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101051659465.png" alt="image-20201101051659465" loading="lazy"></p><p>2\u3001\u518D\u6B21\u8FDB\u5165 <code>lock</code> \u65B9\u6CD5</p><p>\u53D1\u73B0\u4ED6\u8C03\u7528\u4E86 tryAcquire</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101051925487.png" alt="image-20201101051925487" loading="lazy"></p><p>3\u3001\u8FDB\u5165 tryAcquire</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101052008724.png" alt="image-20201101052008724" loading="lazy"></p><p>4\u3001\u91CC\u5934\u8C03\u7528\u4E86 tryAcquireAsync</p><p>\u8FD9\u91CC\u5224\u65AD laseTime != -1 \u5C31\u4E0E\u521A\u521A\u7684\u7B2C\u4E00\u6B65\u4F20\u5165\u7684\u503C\u6709\u5173\u7CFB</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101052037959.png" alt="image-20201101052037959" loading="lazy"></p><p>5\u3001\u8FDB\u5165\u5230 <code>tryLockInnerAsync</code> \u65B9\u6CD5</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101052158592.png" alt="image-20201101052158592" loading="lazy"></p><p>6\u3001<code>internalLockLeaseTime</code> \u8FD9\u4E2A\u53D8\u91CF\u662F\u9501\u7684\u9ED8\u8BA4\u65F6\u95F4</p><p>\u8FD9\u4E2A\u53D8\u91CF\u5728\u6784\u9020\u7684\u65F6\u5019\u5C31\u8D4B\u521D\u59CB\u503C</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101052346059.png" alt="image-20201101052346059" loading="lazy"></p><p>7\u3001\u6700\u540E\u67E5\u770B <code>lockWatchdogTimeout</code> \u53D8\u91CF</p><p>\u4E5F\u5C31\u662F30\u79D2\u7684\u65F6\u95F4</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101052428198.png" alt="image-20201101052428198" loading="lazy"></p><h5 id="_3\u3001reidsson-\u8BFB\u5199\u9501" tabindex="-1"><a class="header-anchor" href="#_3\u3001reidsson-\u8BFB\u5199\u9501" aria-hidden="true">#</a> 3\u3001Reidsson - \u8BFB\u5199\u9501</h5><p>\u4E8C\u8BDD\u4E0D\u8BF4\uFF0C\u4E0A\u4EE3\u7801\uFF01\uFF01\uFF01</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * \u4FDD\u8BC1\u4E00\u5B9A\u80FD\u8BFB\u53D6\u5230\u6700\u65B0\u6570\u636E\uFF0C\u4FEE\u6539\u671F\u95F4\uFF0C\u5199\u9501\u662F\u4E00\u4E2A\u6392\u4ED6\u9501\uFF08\u4E92\u65A5\u9501\uFF0C\u72EC\u4EAB\u9501\uFF09\u8BFB\u9501\u662F\u4E00\u4E2A\u5171\u4EAB\u9501
     * \u5199\u9501\u6CA1\u91CA\u653E\u8BFB\u9501\u5C31\u5FC5\u987B\u7B49\u5F85
     * \u8BFB + \u8BFB \u76F8\u5F53\u4E8E\u65E0\u9501\uFF0C\u5E76\u53D1\u8BFB\uFF0C\u53EA\u4F1A\u5728 reids\u4E2D\u8BB0\u5F55\u597D\uFF0C\u6240\u6709\u5F53\u524D\u7684\u8BFB\u9501\uFF0C\u4ED6\u4EEC\u90FD\u4F1A\u540C\u65F6\u52A0\u9501\u6210\u529F
     * \u5199 + \u8BFB \u7B49\u5F85\u5199\u9501\u91CA\u653E
     * \u5199 + \u5199 \u963B\u585E\u65B9\u5F0F
     * \u8BFB + \u5199 \u6709\u8BFB\u9501\uFF0C\u5199\u4E5F\u9700\u8981\u7B49\u5F85
     * \u53EA\u8981\u6709\u5199\u7684\u5B58\u5728\uFF0C\u90FD\u5FC5\u987B\u7B49\u5F85
     * <span class="token keyword">@return</span> String
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/write&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">writeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">RReadWriteLock</span> lock <span class="token operator">=</span> redission<span class="token punctuation">.</span><span class="token function">getReadWriteLock</span><span class="token punctuation">(</span><span class="token string">&quot;rw_lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">RLock</span> rLock <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1\u3001\u6539\u6570\u636E\u52A0\u5199\u9501\uFF0C\u8BFB\u6570\u636E\u52A0\u8BFB\u9501</span>
            rLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5199\u9501\u52A0\u9501\u6210\u529F...&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            s <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;writeValue&quot;</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            rLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5199\u9501\u91CA\u653E...&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/read&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">readValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RReadWriteLock</span> lock <span class="token operator">=</span> redission<span class="token punctuation">.</span><span class="token function">getReadWriteLock</span><span class="token punctuation">(</span><span class="token string">&quot;rw_lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RLock</span> rLock <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        rLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BFB\u9501\u52A0\u9501\u6210\u529F...&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;writeValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            rLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BFB\u9501\u91CA\u653E...&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6765\u770B\u4E0B\u5B98\u7F51\u7684\u89E3\u91CA</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101053042268.png" alt="image-20201101053042268" loading="lazy"></p><h5 id="_4\u3001redisson-\u95ED\u9501\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_4\u3001redisson-\u95ED\u9501\u6D4B\u8BD5" aria-hidden="true">#</a> 4\u3001Redisson - \u95ED\u9501\u6D4B\u8BD5</h5><p>\u5B98\u7F51\uFF01\uFF01\uFF01</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101053053554.png" alt="image-20201101053053554" loading="lazy"></p><p>\u4E0A\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u653E\u5047\u9501\u95E8
 * 1\u73ED\u6CA1\u4EBA\u4E86
 * 5\u4E2A\u73ED\u7EA7\u8D70\u5B8C\uFF0C\u6211\u4EEC\u53EF\u4EE5\u9501\u4EEC\u4E86
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/lockDoor&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">lockDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">RCountDownLatch</span> door <span class="token operator">=</span> redission<span class="token punctuation">.</span><span class="token function">getCountDownLatch</span><span class="token punctuation">(</span><span class="token string">&quot;door&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    door<span class="token punctuation">.</span><span class="token function">trySetCount</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    door<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u7B49\u5F85\u95ED\u9501\u90FD\u5B8C\u6210</span>

    <span class="token keyword">return</span> <span class="token string">&quot;\u653E\u5047\u4E86....&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/gogogo/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">gogogo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">RCountDownLatch</span> door <span class="token operator">=</span> redission<span class="token punctuation">.</span><span class="token function">getCountDownLatch</span><span class="token punctuation">(</span><span class="token string">&quot;door&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    door<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u8BA1\u6570\u5668\u51CF\u4E00</span>

    <span class="token keyword">return</span> id <span class="token operator">+</span> <span class="token string">&quot;\u73ED\u7684\u4EBA\u8D70\u5B8C\u4E86.....&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u548C JUC \u7684 CountDownLatch \u4E00\u81F4</p><p>await()\u7B49\u5F85\u95ED\u9501\u5B8C\u6210</p><p>countDown() \u628A\u8BA1\u6570\u5668\u51CF\u6389\u540E await\u5C31\u4F1A\u653E\u884C</p><h5 id="_5\u3001redisson-\u4FE1\u53F7\u91CF\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_5\u3001redisson-\u4FE1\u53F7\u91CF\u6D4B\u8BD5" aria-hidden="true">#</a> 5\u3001Redisson - \u4FE1\u53F7\u91CF\u6D4B\u8BD5</h5><p>\u5B98\u7F51\uFF01\uFF01\uFF01</p><p><img src="http://qnimg.gisfsde.com/work/image-20201101053450708.png" alt="image-20201101053450708" loading="lazy"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u8F66\u5E93\u505C\u8F66
 * 3\u8F66\u4F4D
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/park&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">RSemaphore</span> park <span class="token operator">=</span> redission<span class="token punctuation">.</span><span class="token function">getSemaphore</span><span class="token punctuation">(</span><span class="token string">&quot;park&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> b <span class="token operator">=</span> park<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u83B7\u53D6\u4E00\u4E2A\u4FE1\u53F7\uFF0C\u83B7\u53D6\u4E00\u4E2A\u503C\uFF0C\u5360\u7528\u4E00\u4E2A\u8F66\u4F4D</span>

    <span class="token keyword">return</span> <span class="token string">&quot;ok=&quot;</span> <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/go&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">RSemaphore</span> park <span class="token operator">=</span> redission<span class="token punctuation">.</span><span class="token function">getSemaphore</span><span class="token punctuation">(</span><span class="token string">&quot;park&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    park<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u91CA\u653E\u4E00\u4E2A\u8F66\u4F4D</span>

    <span class="token keyword">return</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7C7B\u4F3C JUC \u4E2D\u7684 Semaphore</p><h5 id="_6\u3001redission-\u7F13\u5B58\u4E00\u81F4\u6027\u89E3\u51B3" tabindex="-1"><a class="header-anchor" href="#_6\u3001redission-\u7F13\u5B58\u4E00\u81F4\u6027\u89E3\u51B3" aria-hidden="true">#</a> 6\u3001Redission - \u7F13\u5B58\u4E00\u81F4\u6027\u89E3\u51B3</h5><h3 id="_6-3-\u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027" tabindex="-1"><a class="header-anchor" href="#_6-3-\u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027" aria-hidden="true">#</a> 6.3 \u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027</h3><h4 id="\u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027-\u53CC\u5199\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027-\u53CC\u5199\u6A21\u5F0F" aria-hidden="true">#</a> \u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027 - \u53CC\u5199\u6A21\u5F0F</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201101053613373.png" alt="image-20201101053613373" loading="lazy"></p><p>\u4E24\u4E2A\u7EBF\u7A0B\u5199 \u6700\u7EC8\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u5199\u6210\u529F\uFF0C\u540E\u5199\u6210\u529F\u7684\u4F1A\u628A\u4E4B\u524D\u5199\u7684\u6570\u636E\u7ED9\u8986\u76D6\uFF0C\u8FD9\u5C31\u4F1A\u9020\u6210\u810F\u6570\u636E</p><h4 id="\u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027-\u5931\u6548\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027-\u5931\u6548\u6A21\u5F0F" aria-hidden="true">#</a> \u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027 - \u5931\u6548\u6A21\u5F0F</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201101053834126.png" alt="image-20201101053834126" loading="lazy"></p><p>\u4E09\u4E2A\u8FDE\u63A5</p><p>\u4E00\u53F7\u8FDE\u63A5 \u5199\u6570\u636E\u5E93 \u7136\u540E\u5220\u7F13\u5B58</p><p>\u4E8C\u53F7\u8FDE\u63A5 \u5199\u6570\u636E\u5E93\u65F6\u7F51\u7EDC\u8FDE\u63A5\u6162\uFF0C\u8FD8\u6CA1\u6709\u5199\u5165\u6210\u529F</p><p>\u4E09\u53F7\u94FE\u63A5 \u76F4\u63A5\u8BFB\u53D6\u6570\u636E\uFF0C\u8BFB\u5230\u7684\u662F\u4E00\u53F7\u8FDE\u63A5\u5199\u5165\u7684\u6570\u636E\uFF0C\u6B64\u65F6 \u4E8C\u53F7\u94FE\u63A5\u5199\u5165\u6570\u636E\u6210\u529F\u5E76\u5220\u9664\u4E86\u7F13\u5B58\uFF0C\u4E09\u53F7\u5F00\u59CB\u66F4\u65B0\u7F13\u5B58\u53D1\u73B0\u66F4\u65B0\u7684\u662F\u4E8C\u53F7\u7684\u7F13\u5B58</p><h4 id="\u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> \u7F13\u5B58\u6570\u636E\u4E00\u81F4\u6027\u89E3\u51B3\u65B9\u6848</h4><p>\u65E0\u8BBA\u662F\u53CC\u5199\u6A21\u5F0F\u8FD8\u662F\u5931\u6548\u6A21\u5F0F\uFF0C\u90FD\u4F1A\u5230\u8FD9\u7F13\u5B58\u4E0D\u4E00\u81F4\u7684\u95EE\u9898\uFF0C\u5373\u591A\u4E2A\u5B9E\u529B\u540C\u65F6\u66F4\u65B0\u4F1A\u51FA\u4E8B\uFF0C\u600E\u4E48\u529E\uFF1F</p><ul><li>1\u3001\u5982\u679C\u662F\u7528\u6237\u7EAF\u5EA6\u6570\u636E\uFF08\u8BA2\u5355\u6570\u636E\u3001\u7528\u6237\u6570\u636E\uFF09\uFF0C\u8FD9\u5E76\u53D1\u51E0\u7387\u5F88\u5C0F\uFF0C\u51E0\u4E4E\u4E0D\u7528\u8003\u8651\u8FD9\u4E2A\u95EE\u9898\uFF0C\u7F13\u5B58\u6570\u636E\u52A0\u4E0A\u8FC7\u671F\u65F6\u95F4\uFF0C\u6BCF\u9694\u4E00\u6BB5\u65F6\u95F4\u89E6\u53D1\u8BFB\u7684\u4E3B\u52A8\u66F4\u65B0\u5373\u53EF</li><li>2\u3001\u5982\u679C\u662F\u83DC\u5355\uFF0C\u5546\u54C1\u4ECB\u7ECD\u7B49\u57FA\u7840\u6570\u636E\uFF0C\u4E5F\u53EF\u4EE5\u53BB\u4F7F\u7528 canal \u8BA2\u9605\uFF0Cbinlog \u7684\u65B9\u5F0F</li><li>3\u3001\u7F13\u5B58\u6570\u636E + \u8FC7\u671F\u65F6\u95F4\u4E5F\u8DB3\u591F\u89E3\u51B3\u5927\u90E8\u5206\u4E1A\u52A1\u5BF9\u7F13\u5B58\u7684\u8981\u6C42</li><li>4\u3001\u901A\u8FC7\u52A0\u9501\u4FDD\u8BC1\u5E76\u53D1\u8BFB\u5199\uFF0C\u5199\u5199\u7684\u65F6\u5019\u6309\u7167\u987A\u5E8F\u6392\u597D\u961F\uFF0C\u8BFB\u8BFB\u65E0\u6240\u8C13\uFF0C\u6240\u4EE5\u9002\u5408\u8BFB\u5199\u9501\uFF0C\uFF08\u4E1A\u52A1\u4E0D\u5173\u5FC3\u810F\u6570\u636E\uFF0C\u5141\u8BB8\u4E34\u65F6\u810F\u6570\u636E\u53EF\u5FFD\u7565\uFF09</li></ul><p>\u603B\u7ED3:</p><ul><li>\u6211\u4EEC\u80FD\u653E\u5165\u7F13\u5B58\u7684\u6570\u636E\u672C\u6765\u5C31\u4E0D\u5E94\u8BE5\u662F\u5B9E\u65F6\u6027\u3001\u4E00\u81F4\u6027\u8981\u6C42\u8D85\u9AD8\u7684\u3002\u6240\u4EE5\u7F13\u5B58\u6570\u636E\u7684\u65F6\u5019\u52A0\u4E0A\u8FC7\u671F\u65F6\u95F4\uFF0C\u4FDD\u8BC1\u6BCF\u5929\u62FF\u5230\u5F53\u524D\u7684\u6700\u65B0\u503C\u5373\u53EF</li><li>\u6211\u4EEC\u4E0D\u5E94\u8BE5\u8FC7\u5EA6\u8BBE\u8BA1\uFF0C\u589E\u52A0\u7CFB\u7EDF\u7684\u590D\u6742\u6027</li><li>\u9047\u5230\u5B9E\u65F6\u6027\u3001\u4E00\u81F4\u6027\u8981\u6C42\u9AD8\u7684\u6570\u636E\uFF0C\u5C31\u5E94\u8BE5\u67E5\u6570\u636E\u5E93\uFF0C\u5373\u4F7F\u6162\u70B9</li></ul><p>![](D:\\java\\gitee\\java-learning-note\\Evan Guo\\\u9879\u76EE\u7B14\u8BB0\\\u8C37\u7C92\u5546\u57CE\u9879\u76EE\u5F00\u53D1\u6587\u6863\\\u5206\u5E03\u5F0F\u9AD8\u7EA7\u7BC7\\image\\image-20201101054937769.png)</p><p>\u6700\u540E\u7B26\u4E0A \u4E09\u7EA7\u5206\u7C7B\u6570\u636E \u52A0\u4E0A\u5206\u5E03\u5F0F\u9501</p><h3 id="_6-5-spring-cache" tabindex="-1"><a class="header-anchor" href="#_6-5-spring-cache" aria-hidden="true">#</a> 6.5 Spring Cache</h3><h4 id="_1\u3001\u7B80\u4ECB-2" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7B80\u4ECB-2" aria-hidden="true">#</a> 1\u3001\u7B80\u4ECB</h4><ul><li>Spring \u4ECE3.1\u5F00\u59CB\u5B9A\u4E49\u4E86 <code>org.springframework.cache.Cache</code> \u548C <code>org.sprngframework.cache.CacheManager</code> \u63A5\u53E3\u7750\u7EDF\u4E00\u4E0D\u540C\u7684\u7F13\u5B58\u6280\u672F</li><li>\u5E76\u652F\u6301\u4F7F\u7528 <code>JCache</code>\uFF08JSR-107\uFF09\u6CE8\u89E3\u7B80\u5316\u6211\u4EEC\u7684\u5F00\u53D1</li><li>Cache \u63A5\u53E3\u4E3A\u7F13\u5B58\u7684\u7EC4\u4EF6\u89C4\u8303\u5B9A\u4E49\uFF0C\u5305\u542B\u7F13\u5B58\u7684\u5404\u79CD\u64CD\u4F5C\u96C6\u5408 <code>Cache</code> \u63A5\u53E3\u4E0B Spring \u63D0\u4F9B\u4E86\u5404\u79CD XXXCache\u7684\u5B9E\u73B0\uFF0C\u5982 <code>RedisCache</code>\u3001<code>EhCache</code>,<code>ConcrrentMapCache</code>\u7B49\u7B49\uFF0C</li><li>\u6BCF\u6B21\u8C03\u7528\u9700\u8981\u7F13\u5B58\u529F\u80FD\u5B9E\u73B0\u65B9\u6CD5\u7684\u65F6\u5019\uFF0C<code>Spring</code> \u4F1A\u68C0\u67E5\u68C0\u67E5\u6307\u5B9A\u53C2\u6570\u7684\u9A6C\u52AA\u8868\u72AF\u6CD5\u662F\u5426\u5DF2\u7ECF\u88AB\u55F2\u7528\u8FC7\uFF0C\u5982\u679C\u6709\u5C31\u76F4\u63A5\u4ECE\u7F13\u5B58\u4E2D\u83B7\u53D6\u65B9\u6CD5\u8C03\u7528\u540E\u7684\u7ED3\u679C\uFF0C\u5982\u679C\u6CA1\u6709\u5C31\u8C03\u7528\u65B9\u6CD5\u5E76\u7F13\u5B58\u7ED3\u679C\u540E\u8FD4\u56DE\u7ED9\u7528\u6237\uFF0C\u4E0B\u6B21\u76F4\u63A5\u8C03\u7528\u4ECE\u7F13\u5B58\u4E2D\u83B7\u53D6</li><li>\u4F7F\u7528 <code>Sprng</code> \u7F13\u5B58\u62BD\u8C61\u65F6\u6211\u4EEC\u9700\u8981\u5173\u6CE8\u7684\u70B9\u6709\u4EE5\u4E0B\u4E24\u70B9 <ul><li>1\u3001\u786E\u5B9A\u65B9\u6CD5\u9700\u8981\u88AB\u7F13\u5B58\u4EE5\u53CA\u4ED6\u4EEC\u7684\u7684\u7F13\u5B58\u7B56\u7565</li><li>2\u3001\u4ECE\u7F13\u5B58\u4E2D\u8BFB\u53D6\u4E4B\u524D\u7F13\u5B58\u5B58\u50A8\u7684\u6570\u636E</li></ul></li></ul>`,65),Hp=s("\u5B98\u7F51\u5730\u5740\uFF1A"),Wp={href:"https://docs.spring.io/spring-framework/docs/5.2.10.RELEASE/spring-framework-reference/integration.html#cache-strategie",target:"_blank",rel:"noopener noreferrer"},Jp=s("https://docs.spring.io/spring-framework/docs/5.2.10.RELEASE/spring-framework-reference/integration.html#cache-strategie"),Kp=p(`<p>\u7F13\u5B58\u6CE8\u89E3\u914D\u7F6E</p><p><img src="http://qnimg.gisfsde.com/work/image-20201228171806703.png" alt="image-20201228171806703" loading="lazy"></p><h4 id="_2\u3001\u57FA\u7840\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u57FA\u7840\u6982\u5FF5" aria-hidden="true">#</a> 2\u3001\u57FA\u7840\u6982\u5FF5</h4><p>\u4ECE3.1\u7248\u672C\u5F00\u59CB\uFF0CSpring \u6846\u67B6\u5C31\u652F\u6301\u900F\u660E\u5730\u5411\u73B0\u6709 Spring \u5E94\u7528\u7A0B\u5E8F\u6DFB\u52A0\u7F13\u5B58\u3002\u4E0E\u4E8B\u52A1\u652F\u6301\u7C7B\u4F3C\uFF0C\u7F13\u5B58\u62BD\u8C61\u5141\u8BB8\u5728\u5BF9\u4EE3\u7801\u5F71\u54CD\u6700\u5C0F\u7684\u60C5\u51B5\u4E0B\u4E00\u81F4\u5730\u4F7F\u7528\u5404\u79CD\u7F13\u5B58\u89E3\u51B3\u65B9\u6848\u3002\u4ECE Spring 4.1 \u5F00\u59CB\uFF0C\u7F13\u5B58\u62BD\u8C61\u5728JSR-107\u6CE8\u91CA\u548C\u66F4\u591A\u5B9A\u5236\u9009\u9879\u7684\u652F\u6301\u4E0B\u5F97\u5230\u4E86\u663E\u8457\u6269\u5C55\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
 *  8\u3001\u6574\u5408SpringCache\u7B80\u5316\u7F13\u5B58\u5F00\u53D1
 *      1\u3001\u5F15\u5165\u4F9D\u8D56
 *          spring-boot-starter-cache
 *      2\u3001\u5199\u914D\u7F6E
 *          1\u3001\u81EA\u52A8\u914D\u7F6E\u4E86\u90A3\u4E9B
 *              CacheAutoConfiguration\u4F1A\u5BFC\u5165 RedisCacheConfiguration
 *              \u81EA\u52A8\u914D\u7F6E\u597D\u4E86\u7F13\u5B58\u7BA1\u7406\u5668\uFF0CRedisCacheManager
 *          2\u3001\u914D\u7F6E\u4F7F\u7528redis\u4F5C\u4E3A\u7F13\u5B58
 *          Spring.cache.type=redis
 *
 *       4\u3001\u539F\u7406
 *       CacheAutoConfiguration -&gt;RedisCacheConfiguration -&gt;
 *       \u81EA\u52A8\u914D\u7F6E\u4E86 RedisCacheManager -&gt;\u521D\u59CB\u5316\u6240\u6709\u7684\u7F13\u5B58 -&gt; \u6BCF\u4E2A\u7F13\u5B58\u51B3\u5B9A\u4F7F\u7528\u4EC0\u4E48\u914D\u7F6E
 *       -&gt;\u5982\u679CredisCacheConfiguration\u6709\u5C31\u7528\u5DF2\u6709\u7684\uFF0C\u6CA1\u6709\u5C31\u7528\u9ED8\u8BA4\u7684
 *       -&gt;\u60F3\u6539\u7F13\u5B58\u7684\u914D\u7F6E\uFF0C\u53EA\u9700\u8981\u628A\u5BB9\u5668\u4E2D\u653E\u4E00\u4E2A RedisCacheConfiguration \u5373\u53EF
 *       -&gt;\u5C31\u4F1A\u5E94\u7528\u5230\u5F53\u524D RedisCacheManager\u7BA1\u7406\u6240\u6709\u7F13\u5B58\u5206\u533A\u4E2D
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001\u6CE8\u89E3" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u6CE8\u89E3" aria-hidden="true">#</a> 3\u3001\u6CE8\u89E3</h4><p>\u5BF9\u4E8E\u7F13\u5B58\u58F0\u660E\uFF0CSpring\u7684\u7F13\u5B58\u62BD\u8C61\u63D0\u4F9B\u4E86\u4E00\u7EC4Java\u6CE8\u89E3</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
@Cacheable: Triggers cache population:\u89E6\u53D1\u5C06\u6570\u636E\u4FDD\u5B58\u5230\u7F13\u5B58\u7684\u64CD\u4F5C
@CacheEvict: Triggers cache eviction: \u89E6\u53D1\u5C06\u6570\u636E\u4ECE\u7F13\u5B58\u5220\u9664\u7684\u64CD\u4F5C
@CachePut: Updates the cache without interfering with the method execution:\u4E0D\u5F71\u54CD\u65B9\u6CD5\u6267\u884C\u66F4\u65B0\u7F13\u5B58
@Caching: Regroups multiple cache operations to be applied on a method:\u7EC4\u5408\u4EE5\u4E0A\u591A\u4E2A\u64CD\u4F5C
@CacheConfig: Shares some common cache-related settings at class-level:\u5728\u7C7B\u7EA7\u522B\u5171\u4EAB\u7F13\u5B58\u7684\u76F8\u540C\u914D\u7F6E
**/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6CE8\u89E3\u4F7F\u7528</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 1\u3001\u6BCF\u4E00\u4E2A\u9700\u8981\u7F13\u5B58\u7684\u6570\u636E\u6211\u4EEC\u90FD\u9700\u8981\u6307\u5B9A\u653E\u5230\u90A3\u4E2A\u540D\u5B57\u7684\u7F13\u5B58\u3010\u7F13\u5B58\u5206\u533A\u7684\u5212\u5206\u3010\u6309\u7167\u4E1A\u52A1\u7C7B\u578B\u5212\u5206\u3011\u3011
     * 2\u3001@Cacheable(<span class="token punctuation">{</span>&quot;category&quot;<span class="token punctuation">}</span>)
     *      \u4EE3\u8868\u5F53\u524D\u65B9\u6CD5\u7684\u7ED3\u679C\u9700\u8981\u7F13\u5B58\uFF0C\u5982\u679C\u7F13\u5B58\u4E2D\u6709\uFF0C\u65B9\u6CD5\u4E0D\u8C03\u7528
     *      \u5982\u679C\u7F13\u5B58\u4E2D\u6CA1\u6709\uFF0C\u8C03\u7528\u65B9\u6CD5\uFF0C\u6700\u540E\u5C06\u65B9\u6CD5\u7684\u7ED3\u679C\u653E\u5165\u7F13\u5B58
     * 3\u3001\u9ED8\u8BA4\u884C\u4E3A:
     *      1\u3001\u5982\u679C\u7F13\u5B58\u4E2D\u6709\uFF0C\u65B9\u6CD5\u4E0D\u7528\u8C03\u7528
     *      2\u3001key\u9ED8\u81EA\u52A8\u751F\u6210\uFF0C\u7F13\u5B58\u7684\u540D\u5B57:SimpleKey[](\u81EA\u52A8\u751F\u6210\u7684key\u503C)
     *      3\u3001\u7F13\u5B58\u4E2Dvalue\u7684\u503C\uFF0C\u9ED8\u8BA4\u4F7F\u7528jdk\u5E8F\u5217\u5316\uFF0C\u5C06\u5E8F\u5217\u5316\u540E\u7684\u6570\u636E\u5B58\u5230redis
     *      3\u3001\u9ED8\u8BA4\u7684\u8FC7\u671F\u65F6\u95F4\uFF0C-1
     *
     *    \u81EA\u5B9A\u4E49\u64CD\u4F5C
     *      1\u3001\u6307\u5B9A\u7F13\u5B58\u4F7F\u7528\u7684key     key\u5C5E\u6027\u6307\u5B9A\uFF0C\u63A5\u6536\u4E00\u4E2ASpEl
     *      2\u3001\u6307\u5B9A\u7F13\u5B58\u6570\u636E\u7684\u5B58\u6D3B\u65F6\u95F4  \u914D\u7F6E\u6587\u4EF6\u4E2D\u4FEE\u6539ttl
     *      3\u3001\u5C06\u6570\u636E\u4FDD\u5B58\u4E3Ajson\u683C\u5F0F
     * <span class="token keyword">@return</span>
     */</span>
	<span class="token comment">//value \u7F13\u5B58\u7684\u522B\u540D</span>
     <span class="token comment">// key redis\u4E2Dkey\u7684\u540D\u79F0\uFF0C\u9ED8\u8BA4\u662F\u65B9\u6CD5\u540D\u79F0</span>
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">&quot;#root.method.name&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">getLevel1Categorys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// parent_cid\u4E3A0\u5219\u662F\u4E00\u7EA7\u76EE\u5F55</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> categoryEntities <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;parent_cid&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8017\u8D39\u65F6\u95F4\uFF1A&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> categoryEntities<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4\u3001\u8868\u8FBE\u5F0F\u8BED\u6CD5" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u8868\u8FBE\u5F0F\u8BED\u6CD5" aria-hidden="true">#</a> 4\u3001\u8868\u8FBE\u5F0F\u8BED\u6CD5</h4><p>\u914D\u7F6E</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">CacheProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">EnableConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableCaching</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">RedisCacheConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">GenericJackson2JsonRedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">RedisSerializationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-01
 */</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">CacheProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCacheConfig</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u4E1C\u897F\u6CA1\u6709\u7528\u4E0A
     * 1\u3001\u539F\u6765\u7684\u914D\u7F6E\u543B\u6280\u5B89\u7ED1\u5B9A\u7684\u914D\u7F6E\u7C7B\u662F\u8FD9\u6837\u5B50\u7684
     *      @ConfigurationProperties(prefix = &quot;Spring.cache&quot;)
     * 2\u3001\u8981\u8BA9\u4ED6\u751F\u6548
     *      @EnableConfigurationProperties(CacheProperties.class)
     * <span class="token keyword">@param</span> <span class="token parameter">cacheProperties</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">RedisCacheConfiguration</span> <span class="token function">redisCacheConfiguration</span><span class="token punctuation">(</span><span class="token class-name">CacheProperties</span> cacheProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisCacheConfiguration</span> config <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6Ekey\u7684\u5E8F\u5217\u5316</span>
        config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6Evalue\u5E8F\u5217\u5316 -&gt;JackSon</span>
        config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CacheProperties<span class="token punctuation">.</span>Redis</span> redisProperties <span class="token operator">=</span> cacheProperties<span class="token punctuation">.</span><span class="token function">getRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getTimeToLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getTimeToLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">prefixKeysWith</span><span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>redisProperties<span class="token punctuation">.</span><span class="token function">isCacheNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>redisProperties<span class="token punctuation">.</span><span class="token function">isUseKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">disableKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> config<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>yaml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">Spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">redis</span><span class="token punctuation">:</span>
      <span class="token key atrule">time-to-live</span><span class="token punctuation">:</span> <span class="token number">3600000</span>           <span class="token comment"># \u8FC7\u671F\u65F6\u95F4</span>
      <span class="token key atrule">key-prefix</span><span class="token punctuation">:</span> CACHE_              <span class="token comment"># key\u524D\u7F00</span>
      <span class="token key atrule">use-key-prefix</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>            <span class="token comment"># \u662F\u5426\u4F7F\u7528\u5199\u5165redis\u524D\u7F00</span>
      <span class="token key atrule">cache-null-values</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>         <span class="token comment"># \u662F\u5426\u5141\u8BB8\u7F13\u5B58\u7A7A\u503C</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5\u3001\u7F13\u5B58\u7A7F\u900F\u95EE\u9898\u89E3\u51B3" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u7F13\u5B58\u7A7F\u900F\u95EE\u9898\u89E3\u51B3" aria-hidden="true">#</a> 5\u3001\u7F13\u5B58\u7A7F\u900F\u95EE\u9898\u89E3\u51B3</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 1\u3001\u6BCF\u4E00\u4E2A\u9700\u8981\u7F13\u5B58\u7684\u6570\u636E\u6211\u4EEC\u90FD\u9700\u8981\u6307\u5B9A\u653E\u5230\u90A3\u4E2A\u540D\u5B57\u7684\u7F13\u5B58\u3010\u7F13\u5B58\u5206\u533A\u7684\u5212\u5206\u3010\u6309\u7167\u4E1A\u52A1\u7C7B\u578B\u5212\u5206\u3011\u3011
 * 2\u3001@Cacheable(<span class="token punctuation">{</span>&quot;category&quot;<span class="token punctuation">}</span>)
 *      \u4EE3\u8868\u5F53\u524D\u65B9\u6CD5\u7684\u7ED3\u679C\u9700\u8981\u7F13\u5B58\uFF0C\u5982\u679C\u7F13\u5B58\u4E2D\u6709\uFF0C\u65B9\u6CD5\u4E0D\u8C03\u7528
 *      \u5982\u679C\u7F13\u5B58\u4E2D\u6CA1\u6709\uFF0C\u8C03\u7528\u65B9\u6CD5\uFF0C\u6700\u540E\u5C06\u65B9\u6CD5\u7684\u7ED3\u679C\u653E\u5165\u7F13\u5B58
 * 3\u3001\u9ED8\u8BA4\u884C\u4E3A:
 *      1\u3001\u5982\u679C\u7F13\u5B58\u4E2D\u6709\uFF0C\u65B9\u6CD5\u4E0D\u7528\u8C03\u7528
 *      2\u3001key\u9ED8\u81EA\u52A8\u751F\u6210\uFF0C\u7F13\u5B58\u7684\u540D\u5B57:SimpleKey[](\u81EA\u52A8\u751F\u6210\u7684key\u503C)
 *      3\u3001\u7F13\u5B58\u4E2Dvalue\u7684\u503C\uFF0C\u9ED8\u8BA4\u4F7F\u7528jdk\u5E8F\u5217\u5316\uFF0C\u5C06\u5E8F\u5217\u5316\u540E\u7684\u6570\u636E\u5B58\u5230redis
 *      3\u3001\u9ED8\u8BA4\u7684\u8FC7\u671F\u65F6\u95F4\uFF0C-1
 *
 *    \u81EA\u5B9A\u4E49\u64CD\u4F5C
 *      1\u3001\u6307\u5B9A\u7F13\u5B58\u4F7F\u7528\u7684key     key\u5C5E\u6027\u6307\u5B9A\uFF0C\u63A5\u6536\u4E00\u4E2ASpEl
 *      2\u3001\u6307\u5B9A\u7F13\u5B58\u6570\u636E\u7684\u5B58\u6D3B\u65F6\u95F4  \u914D\u7F6E\u6587\u4EF6\u4E2D\u4FEE\u6539ttl
 *      3\u3001\u5C06\u6570\u636E\u4FDD\u5B58\u4E3Ajson\u683C\u5F0F
 * 4\u3001Spring-Cache\u7684\u4E0D\u8DB3\uFF1A
 *      1\u3001\u8BFB\u6A21\u5F0F\uFF1A
 *          \u7F13\u5B58\u7A7F\u900F:\u67E5\u8BE2\u4E00\u4E2Anull\u6570\u636E\uFF0C\u89E3\u51B3 \u7F13\u5B58\u7A7A\u6570\u636E\uFF1Aache-null-values=true
 *          \u7F13\u5B58\u51FB\u7A7F:\u5927\u91CF\u5E76\u53D1\u8FDB\u6765\u540C\u65F6\u67E5\u8BE2\u4E00\u4E2A\u6B63\u597D\u8FC7\u671F\u7684\u6570\u636E\uFF0C\u89E3\u51B3:\u52A0\u9501 \uFF1F \u9ED8\u8BA4\u662F\u65E0\u52A0\u9501
 *          \u7F13\u5B58\u96EA\u5D29:\u5927\u91CF\u7684key\u540C\u65F6\u8FC7\u671F\uFF0C\u89E3\u51B3\uFF1A\u52A0\u4E0A\u968F\u673A\u65F6\u95F4\uFF0CSpring-cache-redis-time-to-live
 *       2\u3001\u5199\u6A21\u5F0F\uFF1A\uFF08\u7F13\u5B58\u4E0E\u6570\u636E\u5E93\u5E93\u4E0D\u4E00\u81F4\uFF09
 *          1\u3001\u8BFB\u5199\u52A0\u9501
 *          2\u3001\u5F15\u5165canal\uFF0C\u611F\u77E5\u5230MySQL\u7684\u66F4\u65B0\u53BB\u66F4\u65B0\u6570\u636E\u5E93
 *          3\u3001\u8BFB\u591A\u5199\u591A\uFF0C\u76F4\u63A5\u53BB\u6570\u636E\u5E93\u67E5\u8BE2\u5C31\u884C
 *
 *    \u603B\u7ED3\uFF1A
 *      \u5E38\u89C4\u6570\u636E\uFF08\u8BFB\u591A\u5199\u5C11\uFF0C\u5373\u65F6\u6027\uFF0C\u4E00\u81F4\u6027\u8981\u6C42\u4E0D\u9AD8\u7684\u6570\u636E\uFF09\u5B8C\u5168\u53EF\u4EE5\u4F7F\u7528SpringCache \u5199\u6A21\u5F0F\uFF08 \u53EA\u8981\u7F13\u5B58\u6570\u636E\u6709\u8FC7\u671F\u65F6\u95F4\u5C31\u8DB3\u591F\u4E86\uFF09
 *
 *    \u7279\u6B8A\u6570\u636E\uFF1A\u7279\u6B8A\u8BBE\u8BA1
 *      \u539F\u7406\uFF1A
 *          CacheManager(RedisManager) -&gt; Cache(RedisCache) -&gt;Cache\u8D1F\u8D23\u7F13\u5B58\u7684\u8BFB\u5199
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">&quot;#root.method.name&quot;</span><span class="token punctuation">,</span>sync <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">getLevel1Categorys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// parent_cid\u4E3A0\u5219\u662F\u4E00\u7EA7\u76EE\u5F55</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span> categoryEntities <span class="token operator">=</span> baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;parent_cid&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8017\u8D39\u65F6\u95F4\uFF1A&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> categoryEntities<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6\u3001\u7F13\u5B58\u66F4\u65B0" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u7F13\u5B58\u66F4\u65B0" aria-hidden="true">#</a> 6\u3001\u7F13\u5B58\u66F4\u65B0</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * \u7EA7\u8054\u66F4\u65B0\u6240\u6709\u7684\u5173\u8054\u6570\u636E
     * @CacheEvict \u5931\u6548\u6A21\u5F0F
     * 1\u3001\u540C\u65F6\u8FDB\u884C\u591A\u79CD\u7F13\u5B58\u64CD\u4F5C @Caching
     * 2\u3001\u6307\u5B9A\u5220\u9664\u67D0\u4E2A\u5206\u533A\u4E0B\u7684\u6240\u6709\u6570\u636E @CacheEvict(value = <span class="token punctuation">{</span>&quot;category&quot;<span class="token punctuation">}</span>,allEntries = true)
     * 3\u3001\u5B58\u50A8\u540C\u4E00\u7C7B\u578B\u7684\u6570\u636E\uFF0C\u90FD\u53EF\u4EE5\u6307\u5B9A\u6210\u540C\u4E00\u5206\u533A\uFF0C\u5206\u533A\u540D\u9ED8\u8BA4\u5C31\u662F\u7F13\u5B58\u7684\u524D\u7F00
     *
     * <span class="token keyword">@param</span> <span class="token parameter">category</span>
     */</span>
    <span class="token annotation punctuation">@Caching</span><span class="token punctuation">(</span>evict <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">&quot;&#39;getLevel1Categorys&#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">&quot;&#39;getCatelogJson&#39;&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//    @CacheEvict(value = {&quot;category&quot;},allEntries = true)</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateCascate</span><span class="token punctuation">(</span><span class="token class-name">CategoryEntity</span> category<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u66F4\u65B0\u81EA\u5DF1\u8868\u5BF9\u8C61</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u66F4\u65B0\u5173\u8054\u8868\u5BF9\u8C61</span>
        categoryBrandRelationService<span class="token punctuation">.</span><span class="token function">updateCategory</span><span class="token punctuation">(</span>category<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> category<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u603B\u7ED3\u4E1A\u52A1\u6D41\u7A0B\uFF1A</p><p>\u5982\u679C\u5FD8\u4E86\u8FD9\u4E2A\u6280\u672F\u70B9\u770B\u4E0B\u505A\u7684\u7B14\u8BB0\u7684\u4F8B\u5B50\uFF0C\u7136\u540E\u53BB\u5B98\u7F51\u770B\u4E0B\u6587\u6863\uFF0C\u6E29\u6545\u800C\u77E5\u65B0</p><p>\u6D41\u7A0B\u56FE</p><p><img src="http://qnimg.gisfsde.com/work/image-20201228171552816.png" alt="image-20201228171552816" loading="lazy"></p><h1 id="_7\u3001\u5546\u57CE\u4E1A\u52A1-\u5546\u54C1\u68C0\u7D22" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u5546\u57CE\u4E1A\u52A1-\u5546\u54C1\u68C0\u7D22" aria-hidden="true">#</a> 7\u3001\u5546\u57CE\u4E1A\u52A1 &amp; \u5546\u54C1\u68C0\u7D22</h1><h3 id="_7-1-\u68C0\u7D22\u4E1A\u52A1\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_7-1-\u68C0\u7D22\u4E1A\u52A1\u5206\u6790" aria-hidden="true">#</a> 7.1 \u68C0\u7D22\u4E1A\u52A1\u5206\u6790</h3><h4 id="_7-1-1-\u68C0\u7D22\u67E5\u8BE2\u53C2\u6570\u6A21\u578B\u5206\u6790\u62BD\u53D6" tabindex="-1"><a class="header-anchor" href="#_7-1-1-\u68C0\u7D22\u67E5\u8BE2\u53C2\u6570\u6A21\u578B\u5206\u6790\u62BD\u53D6" aria-hidden="true">#</a> 7.1.1 \u68C0\u7D22\u67E5\u8BE2\u53C2\u6570\u6A21\u578B\u5206\u6790\u62BD\u53D6</h4><p>\u6253\u4E2A\u6BD4\u4F8B\u5427 \u4F60\u80AF\u5B9A\u4E0A\u8FC7\u4EAC\u4E1C\u3001\u6DD8\u5B9D\u4E70\u8FC7\u4E1C\u897F\u5427\uFF1F \u90A3\u4E48\u4F60\u60F3\u8981\u8D2D\u4E70\u4EC0\u4E48\u4E1C\u897F\uFF0C\u4F60\u9700\u8981\u5728\u641C\u7D22\u6846\u4E2D\u641C\u7D22\u4F60\u60F3\u8981\u8D2D\u4E70\u7684\u7269\u54C1\uFF0C\u90A3\u4E48\u7CFB\u7EDF\u5C31\u4F1A\u7ED9\u4F60\u54CD\u5E94</p><p>\u6211\u5728\u4EAC\u4E1C\u641C\u7D22 <code>Iphone</code> \u4ED6\u4F1A\u663E\u793A\u51FA\u76F8\u5BF9\u5E94\u7684\u4EA7\u54C1</p><p><img src="http://qnimg.gisfsde.com/work/image-20201104152544243.png" alt="image-20201104152544243" loading="lazy"></p><p>\u90A3\u4E48\u6211\u4EEC\u5F00\u59CB\u5BF9\u4E1A\u52A1\u6761\u4EF6\u8FDB\u884C\u5206\u6790\uFF0C\u5E76\u521B\u5EFA\u5BF9\u5E94\u7684VO\u7C7B</p><p><img src="http://qnimg.gisfsde.com/work/image-20201104153118677.png" alt="image-20201104153118677" loading="lazy"></p><p>\u597D\u7684\u521B\u5EFA\u51FA\u6765\u4E86........</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5C01\u88C5\u9875\u9762\u6240\u6709\u53EF\u80FD\u4F20\u9012\u8FC7\u6765\u7684\u67E5\u8BE2\u6761\u4EF6
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-02
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SearchParam</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u9875\u9762\u4F20\u9012\u8FC7\u6765\u7684\u5168\u6587\u5339\u914D\u5173\u952E\u5B57
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> keyword<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u4E09\u7EA7\u5206\u7C7Bid
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> catalog3Id<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * sort=saleCout_asc/desc
     * sort=skuPrice_asc/desc
     * sort=hotScore_asc/desc
     * \u6392\u5E8F\u6761\u4EF6
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sort<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * hasStock(\u662F\u5426\u6709\u8D27) skuPrice\u533A\u95F4\uFF0CbrandId\u3001catalog3Id\u3001attrs
     */</span>
    <span class="token doc-comment comment">/**
     * \u662F\u5426\u663E\u793A\u6709\u8D27
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> hasStock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u4EF7\u683C\u533A\u95F4\u67E5\u8BE2
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> skuPrice<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u6309\u7167\u54C1\u724C\u8FDB\u884C\u67E5\u8BE2\uFF0C\u53EF\u4EE5\u591A\u9009
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> brandId<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u6309\u7167\u5C5E\u6027\u8FDB\u884C\u7B5B\u9009
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> attrs<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u9875\u7801
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> pageNum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-1-2-\u68C0\u7D22\u8FD4\u56DE\u7ED3\u679C\u6A21\u578B\u5206\u6790\u62BD\u53D6" tabindex="-1"><a class="header-anchor" href="#_7-1-2-\u68C0\u7D22\u8FD4\u56DE\u7ED3\u679C\u6A21\u578B\u5206\u6790\u62BD\u53D6" aria-hidden="true">#</a> 7.1.2 \u68C0\u7D22\u8FD4\u56DE\u7ED3\u679C\u6A21\u578B\u5206\u6790\u62BD\u53D6</h4><p>\u90A3\u4E48\u8FD4\u56DE\u7684\u6570\u636E\u6211\u4EEC\u662F\u4E0D\u662F\u4E5F\u8981\u521B\u5EFA\u4E00\u4E2A VO \u7528\u6765\u8FD4\u56DE\u9875\u9762\u7684\u6570\u636E\uFF1F</p><p>\u501F\u9274\u4EAC\u4E1C\u7684\u5B9E\u4F8B\u6765\u505A\u53C2\u8003</p><p><img src="http://qnimg.gisfsde.com/work/image-20201104153950990.png" alt="image-20201104153950990" loading="lazy"></p><p>\u90A3\u4E48\u62BD\u53D6\u5B9E\u4F53\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u67E5\u8BE2\u7ED3\u679C\u8FD4\u56DE
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-02
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SearchResult</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u67E5\u8BE2\u5230\u6240\u6709\u5546\u54C1\u7684\u5546\u54C1\u4FE1\u606F
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuEsModel</span><span class="token punctuation">&gt;</span></span> products<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u4EE5\u4E0B\u662F\u5206\u9875\u4FE1\u606F
     * \u5F53\u524D\u9875\u7801
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> pageNum<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u603B\u5171\u8BB0\u5F55\u6570
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> total<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u603B\u9875\u7801
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> totalPages<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5F53\u524D\u67E5\u8BE2\u5230\u7684\u7ED3\u679C\uFF0C\u6240\u6709\u8BBE\u8BA1\u7684\u54C1\u724C
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandVo</span><span class="token punctuation">&gt;</span></span> brands<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5F53\u524D\u67E5\u8BE2\u7ED3\u679C\uFF0C\u6240\u6709\u6D89\u53CA\u5230\u7684\u5206\u7C7B
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CatalogVo</span><span class="token punctuation">&gt;</span></span> catalogs<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5F53\u524D\u67E5\u8BE2\u5230\u7684\u7ED3\u679C\uFF0C\u6240\u6709\u6D89\u53CA\u5230\u7684\u6240\u6709\u5C5E\u6027
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrVo</span><span class="token punctuation">&gt;</span></span> attrs<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u9875\u7801
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> pageNavs<span class="token punctuation">;</span>

    <span class="token comment">//==================\u4EE5\u4E0A\u662F\u8981\u8FD4\u56DE\u7ED9\u9875\u9762\u7684\u6240\u6709\u4FE1\u606F</span>
    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">BrandVo</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * \u54C1\u724Cid
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">Long</span> brandId<span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * \u54C1\u724C\u540D\u5B57
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> brandName<span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * \u54C1\u724C\u56FE\u7247
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> brandImg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CatalogVo</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * \u5206\u7C7Bid
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">Long</span> catalogId<span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * \u54C1\u724C\u540D\u5B57
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token class-name">CatalogName</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AttrVo</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * \u5C5E\u6027id
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">Long</span> attrId<span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5C5E\u6027\u540D\u5B57
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> attrName<span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * \u5C5E\u6027\u503C
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> attrValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-\u68C0\u7D22\u8BED\u53E5\u6784\u5EFA" tabindex="-1"><a class="header-anchor" href="#_7-2-\u68C0\u7D22\u8BED\u53E5\u6784\u5EFA" aria-hidden="true">#</a> 7.2 \u68C0\u7D22\u8BED\u53E5\u6784\u5EFA</h3><h4 id="_7-2-1-\u67E5\u8BE2\u90E8\u5206-\u805A\u5408\u90E8\u5206" tabindex="-1"><a class="header-anchor" href="#_7-2-1-\u67E5\u8BE2\u90E8\u5206-\u805A\u5408\u90E8\u5206" aria-hidden="true">#</a> 7.2.1 \u67E5\u8BE2\u90E8\u5206 &amp; \u805A\u5408\u90E8\u5206</h4><p>\u90A3\u4E48\u8FD9\u4E2A DSL \u7F16\u5199\u6211\u4EEC\u5C31\u5728 Kibana \u4E2D\u6D4B\u8BD5</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>
GET gulimall_product/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;skuTitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\u534E\u4E3A&quot;</span> <span class="token comment">// \u6309\u7167\u5173\u952E\u5B57\u67E5\u8BE2</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;catalogId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;225&quot;</span> <span class="token comment">// \u6839\u636E\u5206\u7C7Bid\u8FC7\u6EE4</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;brandId&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// \u54C1\u724Cid</span>
              <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;9&quot;</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;nested&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// \u6839\u636E\u5C5E\u6027id \u4EE5\u53CA\u5C5E\u6027\u503C\u8FDB\u884C\u8FC7\u6EE4</span>
            <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token punctuation">{</span>
                    <span class="token property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token property">&quot;attrs.attrId&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;8&quot;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span>
                    <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token property">&quot;attrs.attrValue&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">&quot;2019&quot;</span>
                      <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// \u662F\u5426\u6709\u5E93\u5B58</span>
            <span class="token property">&quot;hasStock&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;false&quot;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
                  <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// \u4EF7\u683C\u533A\u95F4</span>
                    <span class="token property">&quot;skuPrice&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token property">&quot;gte&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;lte&quot;</span><span class="token operator">:</span> <span class="token number">7000</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">//\u6392\u5E8F</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;skuPrice&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// \u5BF9\u641C\u7D22\u7530\u95F4\u8FDB\u884C\u9AD8\u4EAE</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;skuTitle&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;pre_tags&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\\&lt;b style=color:red&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;post_tags&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\\&lt;/b&gt;&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;brand_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//\u54C1\u724C\u8FDB\u884C\u805A\u5408</span>
      <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;brandId&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;brand_name_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// \u54C1\u724C\u540D\u5B57</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;brandName&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;brand_img_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//\u54C1\u724C\u56FE\u7247</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;brandImg&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;catalog_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// \u5206\u7C7B</span>
      <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;catalogId&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;catalog_name_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//\u5206\u7C7B\u540D\u5B57</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;catalogName&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;attr_agg&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token property">&quot;nested&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//\u5C5E\u6027\u805A\u5408</span>
        <span class="token property">&quot;attr_id_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs.attrId&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;attr_name_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//\u5C5E\u6027\u540D\u5B57</span>
              <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs.attrName&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;attr_value_agg&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> <span class="token comment">//\u5C5E\u6027\u7684\u503C</span>
              <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs.attrValue&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7528\u4EE3\u7801\u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * \u51C6\u5907\u68C0\u7D22\u8BF7\u6C42
     * #\u6A21\u7CCA\u5339\u914D\u3001\u8FC7\u6EE4\uFF08\u6309\u7167\u5C5E\u6027\u3001\u5206\u7C7B\u3001\u54C1\u724C\u3001\u4EF7\u683C\u533A\u95F4\u3001\u5E93\u5B58\uFF09\u3001\u6392\u5E8F\u3001\u5206\u9875\u3001\u9AD8\u4EAE\u3001\u805A\u5408\u5206\u6790
     *
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">SearchRequest</span> <span class="token function">buildSearchRequest</span><span class="token punctuation">(</span><span class="token class-name">SearchParam</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u6784\u5EFADSL\u8BED\u53E5</span>
        <span class="token doc-comment comment">/**
         * \u6A21\u7CCA\u5339\u914D \u8FC7\u6EE4\uFF08\u6309\u7167\u5C5E\u6027\u3001\u5206\u7C7B\u3001\u54C1\u724C\u3001\u4EF7\u683C\u533A\u95F4\u3001\u5E93\u5B58\uFF09
         */</span>
        <span class="token comment">// 1\u3001\u6784\u5EFAbool - query</span>
        <span class="token class-name">BoolQueryBuilder</span> boolQuery <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.1 must - \u6A21\u7CCA\u5339\u914D</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getKeyword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            boolQuery<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;skuTitle&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getKeyword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 1.2 bool - filter \u6309\u7167\u4E09\u7EA7\u5206\u7C7Bid\u6765\u67E5\u8BE2</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getCatalog3Id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            boolQuery<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;catalogId&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getCatalog3Id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 1.2 bool - filter \u6309\u7167\u54C1\u724Cid\u6765\u67E5\u8BE2</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> param<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            boolQuery<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 1.2 bool - filter \u6309\u7167\u6240\u6709\u6307\u5B9A\u7684\u5C5E\u6027\u6765\u8FDB\u884C\u67E5\u8BE2 *******\u4E0D\u7406\u89E3\u8FD9\u4E2Aattr=1_5\u5BF8:8\u5BF8\u8FD9\u6837\u7684\u8BBE\u8BA1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> param<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> attr <span class="token operator">:</span> param<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// attr=1_5\u5BF8:8\u5BF8&amp;attrs=2_16G:8G</span>
                <span class="token class-name">BoolQueryBuilder</span> nestedboolQuery <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> attr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> attrId <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// \u68C0\u7D22\u7684\u5C5E\u6027id</span>
                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> attrValues <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                nestedboolQuery<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrId&quot;</span><span class="token punctuation">,</span> attrId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                nestedboolQuery<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrValue&quot;</span><span class="token punctuation">,</span> attrValues<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u6BCF\u4E00\u4E2A\u5FC5\u987B\u90FD\u751F\u6210\u4E00\u4E2Anested\u67E5\u8BE2</span>
                <span class="token class-name">NestedQueryBuilder</span> nestedQuery <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">nestedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;attrs&quot;</span><span class="token punctuation">,</span> nestedboolQuery<span class="token punctuation">,</span> <span class="token class-name">ScoreMode<span class="token punctuation">.</span>None</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                boolQuery<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>nestedQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 1.2 bool - filter \u6309\u7167\u5E93\u5B58\u662F\u5426\u5B58\u5728</span>
        boolQuery<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;hasStock&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getHasStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.2 bool - filter \u6309\u7167\u4EF7\u683C\u533A\u95F4</span>
        <span class="token doc-comment comment">/**
         * 1_500/_500/500_
         */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getSkuPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">RangeQueryBuilder</span> rangeQuery <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">rangeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;skuPrice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">getSkuPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u533A\u95F4</span>
                rangeQuery<span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getSkuPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    rangeQuery<span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getSkuPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    rangeQuery<span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            boolQuery<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>rangeQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u628A\u4EE5\u524D\u6240\u6709\u6761\u4EF6\u90FD\u62FF\u6765\u8FDB\u884C\u5C01\u88C5</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u6392\u5E8F\u3001\u5206\u9875\u3001\u9AD8\u4EAE
         */</span>
        <span class="token comment">//2.1\u3001\u6392\u5E8F</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> sort <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//sort=hotScore_asc/desc</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> sort<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SortOrder</span> order <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;asc&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">SortOrder</span><span class="token punctuation">.</span>ASC <span class="token operator">:</span> <span class="token class-name">SortOrder</span><span class="token punctuation">.</span>DESC<span class="token punctuation">;</span>
            sourceBuilder<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//2.2 \u5206\u9875 pageSize:5</span>
        <span class="token comment">// pageNum:1 from 0 size:5 [0,1,2,3,4]</span>
        <span class="token comment">// pageNum:2 from 5 size:5</span>
        <span class="token comment">// from (pageNum - 1)*size</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getPageNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_PAGESIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_PAGESIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.3\u3001\u9AD8\u4EAE</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getKeyword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">HighlightBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HighlightBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;skuTitle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">preTags</span><span class="token punctuation">(</span><span class="token string">&quot;\\&lt;b style=&#39;color:red&#39;&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">postTags</span><span class="token punctuation">(</span><span class="token string">&quot;\\&lt;/b&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sourceBuilder<span class="token punctuation">.</span><span class="token function">highlighter</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token doc-comment comment">/**
         * \u805A\u5408\u5206\u6790
         */</span>
        <span class="token comment">//1\u3001\u54C1\u724C\u805A\u5408</span>
        <span class="token class-name">TermsAggregationBuilder</span> brand_agg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;brand_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        brand_agg<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u54C1\u724C\u805A\u5408\u7684\u5B50\u805A\u5408</span>
        brand_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;brand_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;brandName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        brand_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;brand_img_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;brandImg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// TODO 1\u3001\u805A\u5408brand</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>brand_agg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2\u3001\u5206\u7C7B\u805A\u5408</span>
        <span class="token class-name">TermsAggregationBuilder</span> catalog_agg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;catalogId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        catalog_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;catalogName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// TODO 2\u3001\u805A\u5408catalog</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>catalog_agg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3\u3001\u5C5E\u6027\u805A\u5408 attr_agg</span>
        <span class="token class-name">NestedAggregationBuilder</span> attr_agg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">nested</span><span class="token punctuation">(</span><span class="token string">&quot;attr_agg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;attrs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u805A\u5408\u51FA\u5F53\u524D\u6240\u6709\u7684attrId</span>
        <span class="token class-name">TermsAggregationBuilder</span> attr_id_agg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u805A\u5408\u5206\u6790\u51FA\u5F53\u524Dattr_id\u5BF9\u5E94\u7684\u540D\u5B57</span>
        attr_id_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u805A\u5408\u5206\u6790\u51FA\u5F53\u524Dattr_id\u5BF9\u5E94\u7684\u53EF\u80FD\u7684\u5C5E\u6027\u503CattractValue</span>
        attr_id_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;attr_value_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        attr_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span>attr_id_agg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// TODO 3\u3001\u805A\u5408attr</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>attr_agg<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">String</span> s <span class="token operator">=</span> sourceBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6784\u5EFA\u7684DSL:&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_INDEX<span class="token punctuation">}</span><span class="token punctuation">,</span> sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> searchRequest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u5B9E\u73B0\u57FA\u672C\u4E0A\u662F \u6839\u636E json \u6765\u5199 \u8C03\u7528\u5BF9\u5E94\u7684 API</p><p>term \u548C terms \u4E0D\u8981\u8C03\u7528\u9519\u8BEF</p><h3 id="_7-3-\u7ED3\u679C\u63D0\u53D6\u5C01\u88C5" tabindex="-1"><a class="header-anchor" href="#_7-3-\u7ED3\u679C\u63D0\u53D6\u5C01\u88C5" aria-hidden="true">#</a> 7.3 \u7ED3\u679C\u63D0\u53D6\u5C01\u88C5</h3><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>	<span class="token doc-comment comment">/**
     * \u81EA\u52A8\u5C06\u9875\u9762\u63D0\u4EA4\u8FC7\u6765\u7684\u6240\u6709\u8BF7\u6C42\u67E5\u8BE2\u53C2\u6570\u81EA\u52A8\u5C01\u88C5\u6210\u6307\u5B9A\u7684\u5BF9\u8C61
     * <span class="token keyword">@param</span> <span class="token parameter">param</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list.html&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">listPage</span><span class="token punctuation">(</span><span class="token class-name">SearchParam</span> param<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">//1\u3001\u6839\u636E\u4F20\u9012\u6765\u7684\u9875\u9762\u53C2\u6570\uFF0C\u53BBes\u4E2D\u68C0\u7D22\u5546\u54C1</span>
        <span class="token class-name">SearchResult</span> result <span class="token operator">=</span> mallSearchService<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SearchResult</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">SearchParam</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1\u3001\u52A8\u6001\u6784\u5EFA\u51FA\u67E5\u8BE2\u9700\u8981\u7684DSL\u8BED\u53E5</span>
    <span class="token class-name">SearchResult</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//1\u3001\u51C6\u5907\u68C0\u7D22\u8BF7\u6C42</span>
    <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token function">buildSearchRequest</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2\u3001\u6267\u884C\u68C0\u7D22\u8BF7\u6C42</span>
        <span class="token class-name">SearchResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">GulimallElasticsearchConfig</span><span class="token punctuation">.</span>COMMON_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3\u3001\u5206\u6790\u54CD\u5E94\u6570\u636E\u5C01\u88C5\u6210\u6211\u4EEC\u9700\u8981\u7684\u683C\u5F0F</span>
        result <span class="token operator">=</span> <span class="token function">buildSearchResult</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5177\u4F53\u4E1A\u52A1\u6267\u884C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6784\u5EFA\u7ED3\u679C\u6570\u636E
 *
 * <span class="token keyword">@param</span> <span class="token parameter">response</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token keyword">private</span> <span class="token class-name">SearchResult</span> <span class="token function">buildSearchResult</span><span class="token punctuation">(</span><span class="token class-name">SearchResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">SearchParam</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">SearchResult</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuEsModel</span><span class="token punctuation">&gt;</span></span> esModels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> sourceAsString <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SkuEsModel</span> skuEsModel <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>sourceAsString<span class="token punctuation">,</span> <span class="token class-name">SkuEsModel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getKeyword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">HighlightField</span> skuTitle <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;skuTitle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> string <span class="token operator">=</span> skuTitle<span class="token punctuation">.</span><span class="token function">getFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                skuEsModel<span class="token punctuation">.</span><span class="token function">setSkuTitle</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            esModels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>skuEsModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//1\u3001\u8FD4\u56DE\u6240\u6709\u67E5\u8BE2\u5230\u7684\u5546\u54C1</span>
    result<span class="token punctuation">.</span><span class="token function">setProducts</span><span class="token punctuation">(</span>esModels<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2\u3001\u5F53\u524D\u6240\u6709\u5546\u54C1\u8BBE\u8BA1\u5230\u7684\u6240\u6709\u5C5E\u6027\u4FE1\u606F</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchResult<span class="token punctuation">.</span>AttrVo</span><span class="token punctuation">&gt;</span></span> attrVos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ParsedNested</span> attr_agg <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;attr_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ParsedLongTerms</span> attr_id_agg <span class="token operator">=</span> attr_agg<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> bucket <span class="token operator">:</span> attr_id_agg<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchResult<span class="token punctuation">.</span>AttrVo</span> attrVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchResult<span class="token punctuation">.</span>AttrVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1\u3001\u5F97\u5230\u5C5E\u6027\u7684id</span>
        <span class="token class-name">Long</span> attrId <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getKeyAsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2\u3001\u5F97\u5230\u5C5E\u6027\u7684\u540D\u5B57</span>
        <span class="token class-name">String</span> attrName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ParsedStringTerms</span><span class="token punctuation">)</span> bucket<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3\u3001\u5F97\u5230\u5C5E\u6027\u7684\u6240\u6709\u503C</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> attrValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ParsedStringTerms</span><span class="token punctuation">)</span> bucket<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;attr_value_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> keyAsString <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> keyAsString<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        attrVo<span class="token punctuation">.</span><span class="token function">setAttrId</span><span class="token punctuation">(</span>attrId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        attrVo<span class="token punctuation">.</span><span class="token function">setAttrName</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        attrVo<span class="token punctuation">.</span><span class="token function">setAttrValue</span><span class="token punctuation">(</span>attrValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        attrVos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>attrVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    result<span class="token punctuation">.</span><span class="token function">setAttrs</span><span class="token punctuation">(</span>attrVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3\u3001\u5F53\u524D\u6240\u6709\u5546\u54C1\u7684\u5206\u7C7B\u4FE1\u606F</span>
    <span class="token class-name">ParsedLongTerms</span> <span class="token class-name">Catalog_agg</span> <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchResult<span class="token punctuation">.</span>CatalogVo</span><span class="token punctuation">&gt;</span></span> catalogVos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span><span class="token punctuation">&gt;</span></span> buckets <span class="token operator">=</span> <span class="token class-name">Catalog_agg</span><span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> bucket <span class="token operator">:</span> buckets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchResult<span class="token punctuation">.</span>CatalogVo</span> catalogVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchResult<span class="token punctuation">.</span>CatalogVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5F97\u5230\u5206\u7C7Bid</span>
        <span class="token class-name">String</span> keyAsString <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        catalogVo<span class="token punctuation">.</span><span class="token function">setCatalogId</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>keyAsString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5F97\u5230\u5206\u7C7B\u540D</span>
        <span class="token class-name">ParsedStringTerms</span> catalog_name_agg <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> catalog_name <span class="token operator">=</span> catalog_name_agg<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        catalogVo<span class="token punctuation">.</span><span class="token function">setCatalogName</span><span class="token punctuation">(</span>catalog_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        catalogVos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>catalogVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    result<span class="token punctuation">.</span><span class="token function">setCatalogs</span><span class="token punctuation">(</span>catalogVos<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//4\u3001\u5F53\u524D\u6240\u6709\u5546\u54C1\u7684\u54C1\u724C\u4FE1\u606F</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchResult<span class="token punctuation">.</span>BrandVo</span><span class="token punctuation">&gt;</span></span> brandVos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ParsedLongTerms</span> brand_agg <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brand_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> bucket <span class="token operator">:</span> brand_agg<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchResult<span class="token punctuation">.</span>BrandVo</span> brandVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchResult<span class="token punctuation">.</span>BrandVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1\u3001\u5F97\u5230\u54C1\u724C\u7684id</span>
        <span class="token keyword">long</span> brandId <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getKeyAsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2\u3001\u5F97\u5230\u54C1\u724C\u7684\u56FE\u7247</span>
        <span class="token class-name">String</span> brandImg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ParsedStringTerms</span><span class="token punctuation">)</span> bucket<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brand_img_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3\u3001\u5F97\u5230\u54C1\u724C\u7684\u59D3\u540D</span>
        <span class="token class-name">String</span> brandname <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ParsedStringTerms</span><span class="token punctuation">)</span> bucket<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brand_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        brandVo<span class="token punctuation">.</span><span class="token function">setBrandName</span><span class="token punctuation">(</span>brandname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        brandVo<span class="token punctuation">.</span><span class="token function">setBrandId</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        brandVo<span class="token punctuation">.</span><span class="token function">setBrandImg</span><span class="token punctuation">(</span>brandImg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        brandVos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>brandVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    result<span class="token punctuation">.</span><span class="token function">setBrands</span><span class="token punctuation">(</span>brandVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//5\u3001\u5206\u9875\u4FE1\u606F - \u603B\u8BB0\u5F55\u6570</span>
    <span class="token keyword">long</span> total <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//6\u3001\u5206\u9875\u4FE1\u606F - \u9875\u7801</span>
    result<span class="token punctuation">.</span><span class="token function">setPageNum</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getPageNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//7\u3001\u5206\u9875\u4FE1\u606F - \u603B\u9875\u7801</span>
    <span class="token keyword">int</span> totalPages <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> total <span class="token operator">%</span> <span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_PAGESIZE <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> total <span class="token operator">/</span> <span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_PAGESIZE <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> total <span class="token operator">/</span> <span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_PAGESIZE <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">setTotalPages</span><span class="token punctuation">(</span>totalPages<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> pageNavs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i \\<span class="token operator">&lt;=</span> totalPages<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pageNavs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    result<span class="token punctuation">.</span><span class="token function">setPageNavs</span><span class="token punctuation">(</span>pageNavs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-4-\u9875\u9762\u6570\u636E\u6E32\u67D3" tabindex="-1"><a class="header-anchor" href="#_7-4-\u9875\u9762\u6570\u636E\u6E32\u67D3" aria-hidden="true">#</a> 7.4 \u9875\u9762\u6570\u636E\u6E32\u67D3</h3><h4 id="_7-4-1\u57FA\u672C\u6570\u636E\u6E32\u67D3" tabindex="-1"><a class="header-anchor" href="#_7-4-1\u57FA\u672C\u6570\u636E\u6E32\u67D3" aria-hidden="true">#</a> 7.4.1\u57FA\u672C\u6570\u636E\u6E32\u67D3</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201105124530345.png" alt="image-20201105124530345" loading="lazy"></p><p>\u904D\u5386\u540E\u663E\u793A\u7ED3\u679C</p><p><img src="http://qnimg.gisfsde.com/work/image-20201105124552833.png" alt="image-20201105124552833" loading="lazy"></p><h4 id="_7-4-3-\u7B5B\u9009\u6761\u4EF6\u6E32\u67D3" tabindex="-1"><a class="header-anchor" href="#_7-4-3-\u7B5B\u9009\u6761\u4EF6\u6E32\u67D3" aria-hidden="true">#</a> 7.4.3 \u7B5B\u9009\u6761\u4EF6\u6E32\u67D3</h4><p>\u54C1\u724C\u6761\u4EF6\u7B5B\u9009</p><p><img src="http://qnimg.gisfsde.com/work/image-20201105125018666.png" alt="image-20201105125018666" loading="lazy"></p><p>\u5206\u7C7B</p><p><img src="http://qnimg.gisfsde.com/work/image-20201105125250519.png" alt="image-20201105125250519" loading="lazy"></p><p>\u5C5E\u6027\u7B5B\u9009</p><p><img src="http://qnimg.gisfsde.com/work/image-20201105125718289.png" alt="image-20201105125718289" loading="lazy"></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> 
<span class="token keyword">function</span> <span class="token function">searchProducts</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8DF3\u8F6C\u5BF9\u5E94\u5730\u5740</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token function">replaceAndParamVal</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>name<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
   <span class="token doc-comment comment">/**
     * \u6B63\u5219\u8868\u8FBE\u5F0F\u66FF\u6362
     * **/</span>
    <span class="token keyword">function</span> <span class="token function">replaceAndParamVal</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> paramName<span class="token punctuation">,</span> replaceVal<span class="token punctuation">,</span>forceAdd</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> oUrl <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1\u3001\u5982\u679C\u6CA1\u6709\u5C31\u6DFB\u52A0\uFF0C\u6709\u5C31\u66FF\u6362</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oUrl<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>paramName<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>forceAdd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> nUrl <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>oUrl<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    nUrl <span class="token operator">=</span> oUrl <span class="token operator">+</span> <span class="token string">&quot;&amp;&quot;</span> <span class="token operator">+</span> paramName <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> replaceVal<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    nUrl <span class="token operator">=</span> oUrl <span class="token operator">+</span> <span class="token string">&quot;?&quot;</span> <span class="token operator">+</span> paramName <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> replaceVal<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> nUrl<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> re <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&#39;/(&#39;</span> <span class="token operator">+</span> paramName <span class="token operator">+</span> <span class="token string">&#39;=)([^&amp;]*)/gi&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> nUrl <span class="token operator">=</span> oUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>re<span class="token punctuation">,</span> paramName <span class="token operator">+</span> <span class="token string">&#39;=&#39;</span> <span class="token operator">+</span> replaceVal<span class="token punctuation">)</span>
                <span class="token keyword">return</span> nUrl<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> nUrl <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>oUrl<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                nUrl <span class="token operator">=</span> oUrl <span class="token operator">+</span> <span class="token string">&quot;&amp;&quot;</span> <span class="token operator">+</span> paramName <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> replaceVal<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                nUrl <span class="token operator">=</span> oUrl <span class="token operator">+</span> <span class="token string">&quot;?&quot;</span> <span class="token operator">+</span> paramName <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> replaceVal<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> nUrl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-4-4-\u5206\u9875\u6570\u636E\u7B5B\u9009" tabindex="-1"><a class="header-anchor" href="#_7-4-4-\u5206\u9875\u6570\u636E\u7B5B\u9009" aria-hidden="true">#</a> 7.4.4 \u5206\u9875\u6570\u636E\u7B5B\u9009</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201105125925391.png" alt="image-20201105125925391" loading="lazy"></p><h4 id="_7-4-5-\u9875\u9762\u6392\u5E8F\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#_7-4-5-\u9875\u9762\u6392\u5E8F\u529F\u80FD" aria-hidden="true">#</a> 7.4.5 \u9875\u9762\u6392\u5E8F\u529F\u80FD</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201105130422378.png" alt="image-20201105130422378" loading="lazy"></p><h4 id="_7-4-6-\u9875\u9762\u4EF7\u683C\u7B5B\u9009" tabindex="-1"><a class="header-anchor" href="#_7-4-6-\u9875\u9762\u4EF7\u683C\u7B5B\u9009" aria-hidden="true">#</a> 7.4.6 \u9875\u9762\u4EF7\u683C\u7B5B\u9009</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201105131105507.png" alt="image-20201105131105507" loading="lazy"></p><p>JS</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#skuPriceSearchBtn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1\u3001\u62FC\u4E0A\u4EF7\u683C\u533A\u95F4\u7684\u67E5\u8BE2\u6761\u4EF6</span>
    <span class="token keyword">var</span> from <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#skuPriceFrom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> to <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#skuPriceTo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2\u3001\u62FC\u63A5\u8BED\u53E5</span>
    <span class="token keyword">var</span> query <span class="token operator">=</span> from <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> to<span class="token punctuation">;</span>
    <span class="token comment">// 3\u3001\u66FF\u6362 skuPrice</span>
    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token function">replaceAndParamVal</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href<span class="token punctuation">,</span><span class="token string">&quot;skuPrice&quot;</span><span class="token punctuation">,</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-4-7-\u9762\u5305\u5C51\u5BFC\u822A-\u9047\u5230\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_7-4-7-\u9762\u5305\u5C51\u5BFC\u822A-\u9047\u5230\u95EE\u9898" aria-hidden="true">#</a> 7.4.7 \u9762\u5305\u5C51\u5BFC\u822A\uFF08\u9047\u5230\u95EE\u9898\uFF01\uFF09</h4><p>\u524D\u7AEF\u9875\u9762\uFF1A</p><p><img src="http://qnimg.gisfsde.com/work/image-20201105131701322.png" alt="image-20201105131701322" loading="lazy"></p><p>\u5728\u8FD4\u56DEVo\u7C7B\u4E2D \u65B0\u589E\u4E86</p><p><img src="http://qnimg.gisfsde.com/work/image-20201105131841728.png" alt="image-20201105131841728" loading="lazy"></p><p>Controller\u4E2D \u7684\u89E3\u6790\u65B9\u6CD5\u4E2D</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 8\u3001\u6784\u5EFA\u9762\u5305\u5C51\u5BFC\u822A\u529F\u80FD</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> param<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchResult<span class="token punctuation">.</span>NavVo</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>attr <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// 1\u3001\u5206\u6790\u6BCF\u4E2A attrs\u4F20\u9012\u8FC7\u6765\u7684\u503C</span>
                <span class="token class-name">SearchResult<span class="token punctuation">.</span>NavVo</span> navo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchResult<span class="token punctuation">.</span>NavVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// attrs=2_5\u5BF8\uFF1A6\u5BF8</span>
                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> attr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                navo<span class="token punctuation">.</span><span class="token function">setNavValue</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">R</span> r <span class="token operator">=</span> productFeignService<span class="token punctuation">.</span><span class="token function">getAttrInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                result<span class="token punctuation">.</span><span class="token function">getAttrIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">AttrResponseVo</span> data <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;attr&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrResponseVo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    navo<span class="token punctuation">.</span><span class="token function">setNavName</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getAttrName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    navo<span class="token punctuation">.</span><span class="token function">setNavName</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// \u53D6\u6D88\u8FD9\u4E2A\u9762\u5305\u5C51\u5BFC\u822A\u4EE5\u540E\uFF0C\u6211\u4EEC\u8981\u8DF3\u8F6C\u5230\u90A3\u4E2A\u5730\u65B9\uFF0C\u5C06\u8BF7\u6C42\u5730\u5740\u7684url\u91CC\u9762\u7684\u5F53\u524D\u7F6E\u7A7A</span>
                <span class="token comment">//\u62FF\u5230\u6240\u6709\u7684\u67E5\u8BE2\u6761\u4EF6\u540E\uFF0C\u53BB\u6389\u5F53\u524D</span>
                <span class="token comment">// attrs=15_\u6D77\u601D(Hisilicon)</span>

                <span class="token class-name">String</span> replace <span class="token operator">=</span> <span class="token function">replaceQueryString</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> attr<span class="token punctuation">,</span><span class="token string">&quot;attrs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                navo<span class="token punctuation">.</span><span class="token function">setLink</span><span class="token punctuation">(</span><span class="token string">&quot;http://search.gulimall.com/list.html?&quot;</span> <span class="token operator">+</span> replace<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> navo<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">setNavs</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u54C1\u724C\u3001\u5206\u7C7B</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> param<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchResult<span class="token punctuation">.</span>NavVo</span><span class="token punctuation">&gt;</span></span> navs <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getNavs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SearchResult<span class="token punctuation">.</span>NavVo</span> navVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchResult<span class="token punctuation">.</span>NavVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            navVo<span class="token punctuation">.</span><span class="token function">setNavName</span><span class="token punctuation">(</span><span class="token string">&quot;\u54C1\u724C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//TODO \u8FDC\u7A0B\u67E5\u8BE2\u6240\u6709\u54C1\u724C</span>
            <span class="token class-name">R</span> info <span class="token operator">=</span> productFeignService<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandVo</span><span class="token punctuation">&gt;</span></span> brand <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;brand&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token operator">&lt;</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BrandVo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">StringBuffer</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> replace <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BrandVo</span> brandVo <span class="token operator">:</span> brand<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>brandVo<span class="token punctuation">.</span><span class="token function">getBrandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    replace <span class="token operator">=</span> <span class="token function">replaceQueryString</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span>brandVo<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                navVo<span class="token punctuation">.</span><span class="token function">setNavValue</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                navVo<span class="token punctuation">.</span><span class="token function">setLink</span><span class="token punctuation">(</span><span class="token string">&quot;http://search.gulimall.com/list.html?&quot;</span> <span class="token operator">+</span> replace<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            navs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>navVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//TODO \u5206\u7C7B\uFF1A\u4E0D\u9700\u8981\u5BFC\u822A</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_8\u3001\u5F02\u6B65-\u7EBF\u7A0B\u6C60" tabindex="-1"><a class="header-anchor" href="#_8\u3001\u5F02\u6B65-\u7EBF\u7A0B\u6C60" aria-hidden="true">#</a> 8\u3001\u5F02\u6B65 &amp; \u7EBF\u7A0B\u6C60</h1><h3 id="_8-1-\u7EBF\u7A0B\u56DE\u987E" tabindex="-1"><a class="header-anchor" href="#_8-1-\u7EBF\u7A0B\u56DE\u987E" aria-hidden="true">#</a> 8.1 \u7EBF\u7A0B\u56DE\u987E</h3><h4 id="_8-1-1-\u521D\u59CB\u5316\u7EBF\u7A0B\u7684-4-\u79CD\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#_8-1-1-\u521D\u59CB\u5316\u7EBF\u7A0B\u7684-4-\u79CD\u65B9\u5F0F" aria-hidden="true">#</a> 8.1.1 \u521D\u59CB\u5316\u7EBF\u7A0B\u7684 4 \u79CD\u65B9\u5F0F</h4><p>1\u3001\u7EE7\u627F Thread</p><p>2\u3001\u5B9E\u73B0 Runnable</p><p>3\u3001\u5B9E\u73B0 Callable \u63A5\u53E3 + FutureTask\uFF08\u53EF\u4EE5\u62FF\u5230\u8FD4\u56DE\u7ED3\u679C\uFF0C\u53EF\u4EE5\u5904\u7406\u5F02\u5E38\uFF09</p><p>4\u3001\u7EBF\u7A0B\u6C60</p><p>\u65B9\u5F0F\u4E00\u548C\u65B9\u5F0F\u4E8C \u4E3B\u8FDB\u7A0B\u65E0\u6CD5\u83B7\u53D6\u7EBF\u7A0B\u7684\u8FD0\u7B97\u7ED3\u679C\uFF0C\u4E0D\u9002\u5408\u5F53\u524D\u573A\u666F</p><p>\u65B9\u5F0F\u4E09\uFF1A\u4E3B\u8FDB\u7A0B\u53EF\u4EE5\u83B7\u53D6\u5F53\u524D\u7EBF\u7A0B\u7684\u8FD0\u7B97\u7ED3\u679C\uFF0C\u4F46\u662F\u4E0D\u5229\u4E8E\u63A7\u5236\u670D\u52A1\u5668\u79CD\u7684\u7EBF\u7A0B\u8D44\u6E90\uFF0C\u53EF\u4EE5\u5BFC\u81F4\u670D\u52A1\u5668\u8D44\u6E90\u8017\u5C3D</p><p>\u65B9\u5F0F\u56DB\uFF1A\u901A\u8FC7\u5982\u4E0B\u4E24\u79CD\u65B9\u5F0F\u521D\u59CB\u5316\u7EBF\u7A0B\u6C60</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u6216\u8005</span>
<span class="token keyword">new</span> <span class="token class-name">ThreadPollExecutor</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">,</span>maximumPoolSize<span class="token punctuation">,</span>keepAliveTime<span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">,</span>unit<span class="token punctuation">,</span>workQueue<span class="token punctuation">,</span>threadFactory<span class="token punctuation">,</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>&lt;span style=&quot;color:blue;font-&quot;&gt;\u901A\u8FC7\u7EBF\u7A0B\u6C60\u6027\u80FD\u7A33\u5B9A\uFF0C\u4E5F\u53EF\u4EE5\u83B7\u53D6\u6267\u884C\u7ED3\u679C\uFF0C\u5E76\u6355\u83B7\u5F02\u5E38\uFF0C\u4F46\u662F&lt;/span&gt;\uFF0C<strong>\u5728\u4E1A\u52A1\u590D\u6742\u60C5\u51B5\u4E0B\uFF0C\u4E00\u4E2A\u5F02\u6B65\u8C03\u7528\u53EF\u80FD\u4F1A\u4F9D\u8D56\u53E6\u4E00\u4E2A\u5F02\u6B65\u8C03\u7528\u7684\u6267\u884C\u7ED3\u679C</strong></p><h4 id="_8-1-2-\u7EBF\u7A0B\u6C60\u7684-7-\u5927\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_8-1-2-\u7EBF\u7A0B\u6C60\u7684-7-\u5927\u53C2\u6570" aria-hidden="true">#</a> 8.1.2 \u7EBF\u7A0B\u6C60\u7684 7 \u5927\u53C2\u6570</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201105154808826.png" alt="image-20201105154808826" loading="lazy"></p><p>\u8FD0\u884C\u6D41\u7A0B\uFF1A</p><p>1\u3001\u7EBF\u7A0B\u6C60\u521B\u5EFA\uFF0C\u51C6\u5907\u597D <code>core</code> \u6570\u91CF \u7684\u6838\u5FC3\u7EBF\u7A0B\uFF0C\u51C6\u5907\u63A5\u53D7\u4EFB\u52A1</p><p>2\u3001\u65B0\u7684\u4EFB\u52A1\u8FDB\u6765\uFF0C\u7528 <code>core</code> \u51C6\u5907\u597D\u7684\u7A7A\u95F2\u7EBF\u7A0B\u6267\u884C</p><ul><li><code>core</code> \u6EE1\u4E86\uFF0C\u5C31\u5C06\u518D\u8FDB\u6765\u7684\u4EFB\u52A1\u653E\u5165\u963B\u585E\u961F\u5217\u4E2D\uFF0C\u7A7A\u95F2\u7684 core \u5C31\u4F1A\u81EA\u5DF1\u53BB\u963B\u585E\u961F\u5217\u83B7\u53D6\u4EFB\u52A1\u6267\u884C</li><li>\u963B\u585E\u961F\u5217\u4E5F\u6EE1\u4E86\uFF0C\u5C31\u76F4\u63A5\u5F00\u65B0\u7EBF\u7A0B\u53BB\u6267\u884C\uFF0C\u6700\u5927\u53EA\u80FD\u5F00\u5230 <code>max</code> \u6307\u5B9A\u7684\u6570\u91CF</li><li><code>max</code> \u90FD\u6267\u884C\u597D\u4E86\uFF0C<code>Max-core</code> \u6570\u91CF\u7A7A\u95F2\u7684\u7EBF\u7A0B\u4F1A\u5728 <code>keepAliveTime</code> \u6307\u5B9A\u7684\u65F6\u95F4\u540E\u81EA\u52A8\u9500\u6BC1\uFF0C\u7EC8\u4FDD\u6301\u5230 <code>core</code> \u5927\u5C0F</li><li>\u5982\u679C\u7EBF\u7A0B\u6570\u5F00\u5230\u4E86 <code>max</code> \u6570\u91CF\uFF0C\u8FD8\u6709\u65B0\u7684\u4EFB\u52A1\u8FDB\u6765\uFF0C\u5C31\u4F1A\u4F7F\u7528 reject \u6307\u5B9A\u7684\u62D2\u7EDD\u7B56\u7565\u8FDB\u884C\u5904\u7406</li></ul><p>3\u3001\u6240\u6709\u7684\u7EBF\u7A0B\u521B\u5EFA\u90FD\u662F\u7531\u6307\u5B9A\u7684 <code>factory</code> \u521B\u5EFA\u7684</p><p>\u9762\u8BD5;</p><p>\u4E00\u4E2A\u7EBF\u7A0B\u6C60 core 7\u3001max 20 \uFF0Cqueue 50 100 \u5E76\u53D1\u8FDB\u6765\u600E\u4E48\u5206\u914D\u7684 ?</p><p>\u5148\u6709 7 \u4E2A\u80FD\u76F4\u63A5\u5F97\u5230\u8FD0\u884C\uFF0C\u63A5\u4E0B\u6765 50 \u4E2A\u8FDB\u5165\u961F\u5217\u6392\u961F\uFF0C\u518D\u591A\u5F00 13 \u4E2A\u7EE7\u7EED\u6267\u884C\uFF0C\u7EBF\u7A0B70\u4E2A\u88AB\u5B89\u6392\u4E0A\u4E86\uFF0C\u5269\u4E0B30\u4E2A\u9ED8\u8BA4\u62D2\u7EDD\u7B56\u7565</p><h4 id="_8-1-3-\u5E38\u89C1\u7684-4-\u79CD\u7EBF\u7A0B\u6C60" tabindex="-1"><a class="header-anchor" href="#_8-1-3-\u5E38\u89C1\u7684-4-\u79CD\u7EBF\u7A0B\u6C60" aria-hidden="true">#</a> 8.1.3 \u5E38\u89C1\u7684 4 \u79CD\u7EBF\u7A0B\u6C60</h4><ul><li><code>newCacheThreadPool</code><ul><li>\u521B\u5EFA\u4E00\u4E2A\u53EF\u7F13\u5B58\u7684\u7EBF\u7A0B\u6C60\uFF0C\u5982\u679C\u7EBF\u7A0B\u6C60\u957F\u5EA6\u8D85\u8FC7\u9700\u8981\uFF0C\u53EF\u7075\u6D3B\u56DE\u6536\u7A7A\u95F2\u7EBF\u7A0B\uFF0C\u82E5\u65E0\u53EF\u56DE\u6536\uFF0C\u5219\u65B0\u5EFA\u7EBF\u7A0B</li></ul></li><li><code>newFixedThreadPool</code><ul><li>\u521B\u5EFA\u4E00\u4E2A\u6307\u5B9A\u957F\u5EA6\u7684\u7EBF\u7A0B\u6C60\uFF0C\u53EF\u63A7\u5236\u7EBF\u7A0B\u6700\u5927\u5E76\u53D1\u6570\uFF0C\u8D85\u51FA\u7684\u7EBF\u7A0B\u4F1A\u518D\u961F\u5217\u4E2D\u7B49\u5F85</li></ul></li><li><code>newScheduleThreadPool</code><ul><li>\u521B\u5EFA\u4E00\u4E2A\u5B9A\u957F\u7EBF\u7A0B\u6C60\uFF0C\u652F\u6301\u5B9A\u65F6\u53CA\u5468\u671F\u6027\u4EFB\u52A1\u6267\u884C</li></ul></li><li><code>newSingleThreadExecutor</code><ul><li>\u521B\u5EFA\u4E00\u4E2A\u5355\u7EBF\u7A0B\u5316\u7684\u7EBF\u7A0B\u6C60\uFF0C\u5979\u53EA\u4F1A\u7528\u552F\u4E00\u7684\u5DE5\u4F5C\u7EBF\u7A0B\u6765\u6267\u884C\u4EFB\u52A1\uFF0C\u4FDD\u8BC1\u6240\u6709\u4EFB\u52A1</li></ul></li></ul><h4 id="_8-1-4-\u5F00\u53D1\u4E2D\u4E3A\u4EC0\u4E48\u4F7F\u7528\u7EBF\u7A0B\u6C60" tabindex="-1"><a class="header-anchor" href="#_8-1-4-\u5F00\u53D1\u4E2D\u4E3A\u4EC0\u4E48\u4F7F\u7528\u7EBF\u7A0B\u6C60" aria-hidden="true">#</a> 8.1.4 \u5F00\u53D1\u4E2D\u4E3A\u4EC0\u4E48\u4F7F\u7528\u7EBF\u7A0B\u6C60</h4><ul><li>\u964D\u4F4E\u8D44\u6E90\u7684\u6D88\u8017 <ul><li>\u901A\u8FC7\u91CD\u590D\u5229\u7528\u5DF2\u521B\u5EFA\u597D\u7684\u7EBF\u7A0B\u964D\u4F4E\u7EBF\u7A0B\u7684\u521B\u5EFA\u548C\u9500\u6BC1\u5E26\u6765\u7684\u635F\u8017</li></ul></li><li>\u63D0\u9AD8\u54CD\u5E94\u901F\u5EA6 <ul><li>\u56E0\u4E3A\u7EBF\u7A0B\u6C60\u4E2D\u7684\u7EBF\u7A0B\u6CA1\u6709\u8D85\u8FC7\u7EBF\u7A0B\u6C60\u7684\u6700\u5927\u4E0A\u9650\u65F6\uFF0C\u6709\u7684\u7EBF\u7A0B\u5904\u4E8E\u7B49\u5F85\u5206\u914D\u4EFB\u52A1\u7684\u72B6\u6001\uFF0C\u5F53\u4EFB\u52A1\u6765\u65F6\u65E0\u9700\u521B\u5EFA\u65B0\u7684\u7EBF\u7A0B\u5C31\u80FD\u6267\u884C</li></ul></li><li>\u63D0\u9AD8\u7EBF\u7A0B\u7684\u5BA2\u89C2\u7406\u6027 <ul><li>\u7EBF\u7A0B\u6C60\u4F1A\u6839\u636E\u5F53\u524D\u7CFB\u7EDF\u7684\u7279\u70B9\u5BF9\u6C60\u5185\u7684\u7EBF\u7A0B\u8FDB\u884C\u4F18\u5316\u5904\u7406\uFF0C\u51CF\u5C11\u521B\u5EFA\u548C\u9500\u6BC1\u7EBF\u7A0B\u5E26\u6765\u7684\u7CFB\u7EDF\u5F00\u9500\uFF0C\u65E0\u9650\u7684\u521B\u5EFA\u548C\u9500\u6BC1\u7EBF\u7A0B\u4E0D\u4EC5\u6D88\u8017\u7CFB\u7EDF\u8D44\u6E90\uFF0C\u8FD8\u964D\u4F4E\u7CFB\u7EDF\u7684\u7A33\u5B9A\u6027\uFF0C\u4F7F\u7528\u7EBF\u7A0B\u6C60\u8FDB\u884C\u7EDF\u4E00\u5206\u914D</li></ul></li></ul><h3 id="_8-2-completablefuture-\u5F02\u6B65\u7F16\u6392" tabindex="-1"><a class="header-anchor" href="#_8-2-completablefuture-\u5F02\u6B65\u7F16\u6392" aria-hidden="true">#</a> 8.2 CompletableFuture \u5F02\u6B65\u7F16\u6392</h3><p>\u4E1A\u52A1\u573A\u666F\uFF1A</p><p>\u67E5\u8BE2\u5546\u54C1\u8BE6\u60C5\u9875\u903B\u8F91\u6BD4\u8F83\u590D\u6742\uFF0C\u6709\u4E9B\u6570\u636E\u8FD8\u9700\u8981\u8FDC\u7A0B\u8C03\u7528\uFF0C\u5FC5\u7136\u9700\u8981\u82B1\u8D39\u66F4\u591A\u7684\u65F6\u95F4</p><p><img src="http://qnimg.gisfsde.com/work/image-20201105163535757.png" alt="image-20201105163535757" loading="lazy"></p><p>\u5047\u5982\u5546\u54C1\u8BE6\u60C5\u9875\u7684\u6BCF\u4E2A\u67E5\u8BE2\uFF0C\u9700\u8981\u5982\u4E0B\u6807\u6CE8\u65F6\u95F4\u624D\u80FD\u5B8C\u6210</p><p>\u90A3\u4E48\uFF0C\u7528\u6237\u9700\u89815.5s\u540E\u624D\u80FD\u770B\u5230\u5546\u54C1\u76F8\u8BE6\u60C5\u9875\u7684\u5185\u5BB9\uFF0C\u5F88\u663E\u7136\u662F\u4E0D\u80FD\u63A5\u53D7\u7684</p><p>\u5982\u679C\u6709\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u5B8C\u6210\u8FD9 6 \u6B65\u64CD\u4F5C\uFF0C\u4E5F\u8BB8\u53EA\u9700\u8981 1.5s \u5373\u53EF\u5B8C\u6210\u54CD\u5E94</p><h4 id="_8-2-1-\u521B\u5EFA\u5F02\u6B65\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_8-2-1-\u521B\u5EFA\u5F02\u6B65\u5BF9\u8C61" aria-hidden="true">#</a> 8.2.1 \u521B\u5EFA\u5F02\u6B65\u5BF9\u8C61</h4><p>CompletableFuture \u63D0\u4F9B\u4E86\u56DB\u4E2A\u9759\u6001\u65B9\u6CD5\u6765\u521B\u5EFA\u4E00\u4E2A\u5F02\u6B65\u64CD\u4F5C</p><p><img src="http://qnimg.gisfsde.com/work/image-20201105185420349.png" alt="image-20201105185420349" loading="lazy"></p><p>1\u3001<strong>runXxx \u90FD\u662F\u6CA1\u6709\u8FD4\u56DE\u7ED3\u679C\u7684\uFF0CsupplyXxxx\u90FD\u662F\u53EF\u4EE5\u83B7\u53D6\u8FD4\u56DE\u7ED3\u679C\u7684</strong></p><p>2\u3001\u53EF\u4EE5\u4F20\u5165\u81EA\u5B9A\u4E49\u7684\u7EBF\u7A0B\u6C60\uFF0C\u5426\u5219\u5C31\u662F\u7528\u9ED8\u8BA4\u7684\u7EBF\u7A0B\u6C60</p><p>3\u3001\u6839\u636E\u65B9\u6CD5\u7684\u8FD4\u56DE\u7C7B\u578B\u6765\u5224\u65AD\u662F\u5426\u8BE5\u65B9\u6CD5\u662F\u5426\u6709\u8FD4\u56DE\u7C7B\u578B</p><p>\u4EE3\u7801\u5B9E\u73B0\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main....start.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> completableFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F53\u524D\u7EBF\u7A0B\uFF1A&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FD0\u884C\u7ED3\u679C\uFF1A&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F53\u524D\u7EBF\u7A0B\uFF1A&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FD0\u884C\u7ED3\u679C\uFF1A&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> integer <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main....stop.....&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-2-2-\u8BA1\u7B97\u5B8C\u6210\u65F6\u56DE\u8C03\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_8-2-2-\u8BA1\u7B97\u5B8C\u6210\u65F6\u56DE\u8C03\u65B9\u6CD5" aria-hidden="true">#</a> 8.2.2 \u8BA1\u7B97\u5B8C\u6210\u65F6\u56DE\u8C03\u65B9\u6CD5</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201105185821263.png" alt="image-20201105185821263" loading="lazy"></p><p>whenComplete \u53EF\u4EE5\u5904\u7406\u6B63\u5E38\u548C\u5F02\u5E38\u7684\u8BA1\u7B97\u7ED3\u679C\uFF0Cexceptionally \u5904\u7406\u5F02\u5E38\u60C5\u51B5</p><p>whenComplete \u548C whenCompleteAsync \u7684\u533A\u522B</p><p>\u200B whenComplete \uFF1A\u662F\u6267\u884C\u5F53\u524D\u4EFB\u52A1\u7684\u7EBF\u7A0B\u7EE7\u7EED\u6267\u884C whencomplete \u7684\u4EFB\u52A1</p><p>\u200B whenCompleteAsync\uFF1A \u662F\u6267\u884C\u628A whenCompleteAsync \u8FD9\u4E2A\u4EFB\u52A1\u7EE7\u7EED\u63D0\u4EA4\u7ED9\u7EBF\u7A0B\u6C60\u6765\u8FDB\u884C\u6267\u884C</p><p><strong>\u65B9\u6CD5\u4E0D\u4EE5 Async \u7ED3\u5C3E\uFF0C\u610F\u5473\u7740 Action \u4F7F\u7528\u76F8\u540C\u7684\u7EBF\u7A0B\u6267\u884C\uFF0C\u800C Async \u53EF\u80FD\u4F1A\u4F7F\u7528\u5176\u4ED6\u7EBF\u7A0B\u6267\u884C\uFF08\u5982\u679C\u662F\u4F7F\u7528\u76F8\u540C\u7684\u7EBF\u7A0B\u6C60\uFF0C\u4E5F\u53EF\u80FD\u4F1A\u88AB\u540C\u4E00\u4E2A\u7EBF\u7A0B\u9009\u4E2D\u6267\u884C\uFF09</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F53\u524D\u7EBF\u7A0B\uFF1A&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FD0\u884C\u7ED3\u679C\uFF1A&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>exception<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// \u867D\u7136\u80FD\u5F97\u5230\u5F02\u5E38\u4FE1\u606F\uFF0C\u4F46\u662F\u6CA1\u6CD5\u4FEE\u6539\u8FD4\u56DE\u7684\u6570\u636E</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F02\u6B65\u4EFB\u52A1\u6210\u529F\u5B8C\u6210\u4E86...\u7ED3\u679C\u662F\uFF1A&quot;</span> <span class="token operator">+</span>res <span class="token operator">+</span> <span class="token string">&quot;\u5F02\u5E38\u662F\uFF1A&quot;</span> <span class="token operator">+</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span>throwable <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u53EF\u4EE5\u611F\u77E5\u5230\u5F02\u5E38\uFF0C\u540C\u65F6\u8FD4\u56DE\u9ED8\u8BA4\u503C</span>
    <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-2-3-handle-\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_8-2-3-handle-\u65B9\u6CD5" aria-hidden="true">#</a> 8.2.3 handle \u65B9\u6CD5</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201105194503175.png" alt="image-20201105194503175" loading="lazy"></p><p>\u548C complete \u4E00\u6837\uFF0C\u53EF\u4EE5\u5BF9\u7ED3\u679C\u505A\u6700\u540E\u7684\u5904\u7406\uFF08\u53EF\u5904\u7406\u5F02\u5E38\uFF09\uFF0C\u53EF\u6539\u53D8\u8FD4\u56DE\u503C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F53\u524D\u7EBF\u7A0B\uFF1A&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FD0\u884C\u7ED3\u679C\uFF1A&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>thr<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>thr <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-2-4-\u7EBF\u7A0B\u4E32\u884C\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_8-2-4-\u7EBF\u7A0B\u4E32\u884C\u65B9\u6CD5" aria-hidden="true">#</a> 8.2.4 \u7EBF\u7A0B\u4E32\u884C\u65B9\u6CD5</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201105195632819.png" alt="image-20201105195632819" loading="lazy"></p><p>thenApply \u65B9\u6CD5\uFF1A<strong>\u5F53\u4E00\u4E2A\u7EBF\u7A0B\u4F9D\u8D56\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u65F6\uFF0C\u83B7\u53D6\u4E0A\u4E00\u4E2A\u4EFB\u52A1\u8FD4\u56DE\u7684\u7ED3\u679C\uFF0C\u5E76\u8FD4\u56DE\u5F53\u524D\u4EFB\u7269\u7684\u8FD4\u56DE\u503C</strong></p><p>thenAccept\u65B9\u6CD5\uFF1A<strong>\u6D88\u8D39\u5904\u7406\u7ED3\u679C\uFF0C\u63A5\u53D7\u4EFB\u52A1\u5904\u7406\u7ED3\u679C\uFF0C\u5E76\u6D88\u8D39\u5904\u7406\uFF0C\u65E0\u8FD4\u56DE\u7ED3\u679C</strong></p><p>thenRun \u65B9\u6CD5\uFF1A<strong>\u53EA\u8981\u4E0A\u9762\u4EFB\u52A1\u6267\u884C\u5B8C\u6210\uFF0C\u5C31\u5F00\u59CB\u6267\u884C thenRun ,\u53EA\u662F\u5904\u7406\u5B8C\u4EFB\u52A1\u540E\uFF0C\u6267\u884C thenRun\u7684\u540E\u7EED\u64CD\u4F5C</strong></p><p>\u5E26\u6709 Async \u9ED8\u8BA4\u662F\u5F02\u6B65\u6267\u884C\u7684\uFF0C\u540C\u4E4B\u524D\uFF0C</p><p>\u4EE5\u4E0A\u90FD\u8981\u524D\u7F6E\u4EFB\u52A1\u5B8C\u6210</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>   <span class="token doc-comment comment">/**
         * \u7EBF\u7A0B\u4E32\u884C\u5316\uFF0C
         * 1\u3001thenRun:\u4E0D\u80FD\u83B7\u53D6\u5230\u4E0A\u4E00\u6B65\u7684\u6267\u884C\u7ED3\u679C\uFF0C\u65E0\u8FD4\u56DE\u503C
         * .thenRunAsync(() -&gt;<span class="token punctuation">{</span>
         *             System.out.println(&quot;\u4EFB\u52A12\u542F\u52A8\u4E86....&quot;);
         *         <span class="token punctuation">}</span>,executor);
         * 2\u3001\u80FD\u63A5\u53D7\u4E0A\u4E00\u6B65\u7ED3\u679C\uFF0C\u4F46\u662F\u65E0\u8FD4\u56DE\u503C thenAcceptAsync
         * 3\u3001thenApplyAsync \u80FD\u6536\u53D7\u4E0A\u4E00\u6B65\u7ED3\u679C\uFF0C\u6709\u8FD4\u56DE\u503C
         *
         */</span>
        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F53\u524D\u7EBF\u7A0B\uFF1A&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FD0\u884C\u7ED3\u679C\uFF1A&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4EFB\u52A12\u542F\u52A8\u4E86...&quot;</span> <span class="token operator">+</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Hello &quot;</span> <span class="token operator">+</span> res<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main....stop.....&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-2-5-\u4E24\u4EFB\u52A1\u7EC4\u5408-\u90FD\u8981\u5B8C\u6210" tabindex="-1"><a class="header-anchor" href="#_8-2-5-\u4E24\u4EFB\u52A1\u7EC4\u5408-\u90FD\u8981\u5B8C\u6210" aria-hidden="true">#</a> 8.2.5 \u4E24\u4EFB\u52A1\u7EC4\u5408 - \u90FD\u8981\u5B8C\u6210</h4><p><img src="http://qnimg.gisfsde.com/work/image-20210102044028142.png" alt="image-20210102044028142" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20210102044044914.png" alt="image-20210102044044914" loading="lazy"></p><p>\u4E24\u4E2A\u4EFB\u52A1\u5FC5\u987B\u90FD\u5B8C\u6210\uFF0C\u89E6\u53D1\u8BE5\u4EFB\u52A1</p><p>thenCombine: \u7EC4\u5408\u4E24\u4E2A future\uFF0C\u83B7\u53D6\u4E24\u4E2A future\u7684\u8FD4\u56DE\u7ED3\u679C\uFF0C\u5E76\u8FD4\u56DE\u5F53\u524D\u4EFB\u52A1\u7684\u8FD4\u56DE\u503C</p><p>thenAccpetBoth: \u7EC4\u5408\u4E24\u4E2A future\uFF0C\u83B7\u53D6\u4E24\u4E2A future \u4EFB\u52A1\u7684\u8FD4\u56DE\u7ED3\u679C\uFF0C\u7136\u540E\u5904\u7406\u4EFB\u52A1\uFF0C\u6CA1\u6709\u8FD4\u56DE\u503C</p><p>runAfterBoth:\u7EC4\u5408 \u4E24\u4E2A future\uFF0C\u4E0D\u9700\u8981\u83B7\u53D6 future \u7684\u7ED3\u679C\uFF0C\u53EA\u9700\u8981\u4E24\u4E2A future\u5904\u7406\u5B8C\u6210\u4EFB\u52A1\u540E\uFF0C\u5904\u7406\u8BE5\u4EFB\u52A1\uFF0C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>   <span class="token doc-comment comment">/**
         * \u4E24\u4E2A\u90FD\u5B8C\u6210
         */</span>
        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future01 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4EFB\u52A11\u5F53\u524D\u7EBF\u7A0B\uFF1A&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4EFB\u52A11\u7ED3\u675F\uFF1A&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future02 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4EFB\u52A12\u5F53\u524D\u7EBF\u7A0B\uFF1A&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4EFB\u52A12\u7ED3\u675F\uFF1A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// f1 \u548C f2 \u6267\u884C\u5B8C\u6210\u540E\u5728\u6267\u884C\u8FD9\u4E2A</span>
<span class="token comment">//        future01.runAfterBothAsync(future02,() -&gt; {</span>
<span class="token comment">//            System.out.println(&quot;\u4EFB\u52A13\u5F00\u59CB&quot;);</span>
<span class="token comment">//        },executor);</span>

        <span class="token comment">// \u8FD4\u56DEf1 \u548C f2 \u7684\u8FD0\u884C\u7ED3\u679C</span>
<span class="token comment">//        future01.thenAcceptBothAsync(future02,(f1,f2) -&gt; {</span>
<span class="token comment">//            System.out.println(&quot;\u4EFB\u52A13\u5F00\u59CB....\u4E4B\u524D\u7684\u7ED3\u679C:&quot; + f1 + &quot;==&gt;&quot; + f2);</span>
<span class="token comment">//        },executor);</span>

        <span class="token comment">// f1 \u548C f2 \u5355\u72EC\u5B9A\u4E49\u8FD4\u56DE\u7ED3\u679C</span>
        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> future01<span class="token punctuation">.</span><span class="token function">thenCombineAsync</span><span class="token punctuation">(</span>future02<span class="token punctuation">,</span> <span class="token punctuation">(</span>f1<span class="token punctuation">,</span> f2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> f1 <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> f2 <span class="token operator">+</span> <span class="token string">&quot;-&gt; Haha&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main....end.....&quot;</span> <span class="token operator">+</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-2-6-\u4E24\u4EFB\u52A1\u7EC4\u5408-\u4E00\u4E2A\u5B8C\u6210" tabindex="-1"><a class="header-anchor" href="#_8-2-6-\u4E24\u4EFB\u52A1\u7EC4\u5408-\u4E00\u4E2A\u5B8C\u6210" aria-hidden="true">#</a> 8.2.6 \u4E24\u4EFB\u52A1\u7EC4\u5408 - \u4E00\u4E2A\u5B8C\u6210</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201106101904880.png" alt="image-20201106101904880" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201106101918013.png" alt="image-20201106101918013" loading="lazy"></p><p>\u5F53\u4E24\u4E2A\u4EFB\u52A1\u4E2D\uFF0C\u4EFB\u610F\u4E00\u4E2Afuture \u4EFB\u52A1\u5B8C\u6210\u65F6\uFF0C\u6267\u884C\u4EFB\u52A1</p><p><strong>applyToEither</strong>;\u4E24\u4E2A\u4EFB\u52A1\u6709\u4E00\u4E2A\u6267\u884C\u5B8C\u6210\uFF0C\u83B7\u53D6\u5B83\u7684\u8FD4\u56DE\u503C\uFF0C\u5904\u7406\u4EFB\u52A1\u5E76\u6709\u65B0\u7684\u8FD4\u56DE\u503C</p><p><strong>acceptEither</strong>: \u4E24\u4E2A\u4EFB\u52A1\u6709\u4E00\u4E2A\u6267\u884C\u5B8C\u6210\uFF0C\u83B7\u53D6\u5B83\u7684\u8FD4\u56DE\u503C\uFF0C\u5904\u7406\u4EFB\u52A1\uFF0C\u6CA1\u6709\u65B0\u7684\u8FD4\u56DE\u503C</p><p><strong>runAfterEither</strong>:\u4E24\u4E2A\u4EFB\u52A1\u6709\u4E00\u4E2A\u6267\u884C\u5B8C\u6210\uFF0C\u4E0D\u9700\u8981\u83B7\u53D6 future \u7684\u7ED3\u679C\uFF0C\u5904\u7406\u4EFB\u52A1\uFF0C\u4E5F\u6CA1\u6709\u8FD4\u56DE\u503C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
         * \u4E24\u4E2A\u4EFB\u52A1\uFF0C\u53EA\u8981\u6709\u4E00\u4E2A\u5B8C\u6210\uFF0C\u6211\u4EEC\u5C31\u6267\u884C\u4EFB\u52A1
         * runAfterEnitherAsync\uFF1A\u4E0D\u611F\u77E5\u7ED3\u679C\uFF0C\u81EA\u5DF1\u6CA1\u6709\u8FD4\u56DE\u503C
         * acceptEitherAsync\uFF1A\u611F\u77E5\u7ED3\u679C\uFF0C\u81EA\u5DF1\u6CA1\u6709\u8FD4\u56DE\u503C
         *  applyToEitherAsync\uFF1A\u611F\u77E5\u7ED3\u679C\uFF0C\u81EA\u5DF1\u6709\u8FD4\u56DE\u503C
         */</span>
<span class="token comment">//        future01.runAfterEitherAsync(future02,() -&gt;{</span>
<span class="token comment">//            System.out.println(&quot;\u4EFB\u52A13\u5F00\u59CB...\u4E4B\u524D\u7684\u7ED3\u679C:&quot;);</span>
<span class="token comment">//        },executor);</span>

<span class="token comment">//        future01.acceptEitherAsync(future02,(res) -&gt; {</span>
<span class="token comment">//            System.out.println(&quot;\u4EFB\u52A13\u5F00\u59CB...\u4E4B\u524D\u7684\u7ED3\u679C:&quot; + res);</span>
<span class="token comment">//        },executor);</span>

        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> future01<span class="token punctuation">.</span><span class="token function">applyToEitherAsync</span><span class="token punctuation">(</span>future02<span class="token punctuation">,</span> res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4EFB\u52A13\u5F00\u59CB...\u4E4B\u524D\u7684\u7ED3\u679C\uFF1A&quot;</span> <span class="token operator">+</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&gt;\u54C8\u54C8&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-2-7-\u591A\u4EFB\u52A1\u7EC4\u5408" tabindex="-1"><a class="header-anchor" href="#_8-2-7-\u591A\u4EFB\u52A1\u7EC4\u5408" aria-hidden="true">#</a> 8.2.7 \u591A\u4EFB\u52A1\u7EC4\u5408</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201106104031315.png" alt="image-20201106104031315" loading="lazy"></p><p>allOf\uFF1A<strong>\u7B49\u5F85\u6240\u6709\u4EFB\u52A1\u5B8C\u6210</strong></p><p>anyOf:<strong>\u53EA\u8981\u6709\u4E00\u4E2A\u4EFB\u52A1\u5B8C\u6210</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> futureImg <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u5546\u54C1\u7684\u56FE\u7247\u4FE1\u606F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;hello.jpg&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> futureAttr <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u5546\u54C1\u7684\u5C5E\u6027&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;\u9ED1\u8272+256G&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> futureDesc <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u67E5\u8BE2\u5546\u54C1\u4ECB\u7ECD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;\u534E\u4E3A&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u7B49\u5F85\u5168\u90E8\u6267\u884C\u5B8C</span>
<span class="token comment">//        CompletableFuture\\&lt;Void&gt; allOf = CompletableFuture.allOf(futureImg, futureAttr, futureDesc);</span>
<span class="token comment">//        allOf.get();</span>

        <span class="token comment">// \u53EA\u9700\u8981\u6709\u4E00\u4E2A\u6267\u884C\u5B8C</span>
        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> anyOf <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">anyOf</span><span class="token punctuation">(</span>futureImg<span class="token punctuation">,</span> futureAttr<span class="token punctuation">,</span> futureDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        anyOf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main....end.....&quot;</span> <span class="token operator">+</span> anyOf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u90FD\u662F\u64CD\u4F5C CompletableFuture \u7C7B \u66F4\u591A\u65B9\u6CD5\u8FD8\u8BF7\u53C2\u8003\u8BE5\u7C7B</p><h1 id="_9\u3001\u5546\u54C1\u8BE6\u60C5" tabindex="-1"><a class="header-anchor" href="#_9\u3001\u5546\u54C1\u8BE6\u60C5" aria-hidden="true">#</a> 9\u3001\u5546\u54C1\u8BE6\u60C5</h1><h3 id="_9-1-\u8BE6\u60C5\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_9-1-\u8BE6\u60C5\u6570\u636E" aria-hidden="true">#</a> 9.1 \u8BE6\u60C5\u6570\u636E</h3><p><img src="http://qnimg.gisfsde.com/work/image-20201229121729595.png" alt="image-20201229121729595" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201109080935340.png" alt="image-20201109080935340" loading="lazy"></p><p>**\u9700\u6C42\u5206\u6790\uFF1A**\u901A\u8FC7 <code>skuId</code> \u67E5\u8BE2\u51FA\u5546\u54C1\u7684\u76F8\u5173\u4FE1\u606F\uFF0C\u56FE\u7247\u3001\u6807\u9898\u3001\u4EF7\u683C\uFF0C\u5C5E\u6027\u5BF9\u5E94\u7248\u672C\u7B49\u7B49</p><h4 id="_9-1-1-\u8FD4\u56DE\u6570\u636E\u6A21\u578B\u62BD\u53D6" tabindex="-1"><a class="header-anchor" href="#_9-1-1-\u8FD4\u56DE\u6570\u636E\u6A21\u578B\u62BD\u53D6" aria-hidden="true">#</a> 9.1.1 \u8FD4\u56DE\u6570\u636E\u6A21\u578B\u62BD\u53D6</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-06
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SkuItemVo</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1\u3001sku\u57FA\u672C\u83B7\u53D6 pms_sku_info</span>
    <span class="token class-name">SkuInfoEntity</span> skuInfo<span class="token punctuation">;</span>
    <span class="token comment">// \u662F\u5426\u6709\u5E93\u5B58</span>
    <span class="token keyword">boolean</span>  hasStock <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// 2\u3001sku\u7684\u56FE\u7247\u4FE1\u606F pms_sku_images</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuImagesEntity</span><span class="token punctuation">&gt;</span></span> images<span class="token punctuation">;</span>
    <span class="token comment">// 3\u3001\u83B7\u53D6spu\u7684\u9500\u552E\u5C5E\u6027\u7EC4</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemSalAttrVo</span><span class="token punctuation">&gt;</span></span> saleAttr<span class="token punctuation">;</span>
    <span class="token comment">// 4\u3001\u83B7\u53D6spu\u7684\u4ECB\u7ECD</span>
    <span class="token class-name">SpuInfoDescEntity</span> desc<span class="token punctuation">;</span>
    <span class="token comment">// 5\u3001\u83B7\u53D6spu\u7684\u89C4\u683C\u53C2\u6570\u4FE1\u606F</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuItemAttrGroupVo</span><span class="token punctuation">&gt;</span></span> groupAttrs<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-08
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SkuItemSalAttrVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> attrId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> attrName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttrValueWithSkuIdVo</span><span class="token punctuation">&gt;</span></span> attrValues<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-08
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AttrValueWithSkuIdVo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> attrValue<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> skuIds<span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-\u67E5\u8BE2\u8BE6\u60C5" tabindex="-1"><a class="header-anchor" href="#_9-2-\u67E5\u8BE2\u8BE6\u60C5" aria-hidden="true">#</a> 9.2 \u67E5\u8BE2\u8BE6\u60C5</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SkuItemVo</span> <span class="token function">item</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">SkuItemVo</span> skuItemVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuItemVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1\u3001sku\u57FA\u672C\u83B7\u53D6 pms_sku_info</span>
    <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoEntity</span><span class="token punctuation">&gt;</span></span> infoFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6839\u636E skuid \u67E5\u8BE2\u51FA spuInfo\u5BF9\u8C61</span>
        <span class="token class-name">SkuInfoEntity</span> info <span class="token operator">=</span> <span class="token function">getById</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuItemVo<span class="token punctuation">.</span><span class="token function">setSkuInfo</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> info<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> saleAttrFuture <span class="token operator">=</span> infoFuture<span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 3\u3001\u83B7\u53D6spu\u7684\u9500\u552E\u5C5E\u6027\u7EC4\u5408</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemSalAttrVo</span><span class="token punctuation">&gt;</span></span> saleAttrVos <span class="token operator">=</span> skuSaleAttrValueService<span class="token punctuation">.</span><span class="token function">getSaleAttrBySpuId</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuItemVo<span class="token punctuation">.</span><span class="token function">setSaleAttr</span><span class="token punctuation">(</span>saleAttrVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> descFuture <span class="token operator">=</span> infoFuture<span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 4\u3001\u83B7\u53D6spu\u7684\u4ECB\u7ECD</span>
        <span class="token comment">// \u901A\u8FC7spuid\u67E5\u8BE2\u51FAspu\u63CF\u8FF0\u4FE1\u606F</span>
        <span class="token class-name">SpuInfoDescEntity</span> spuInfoDescEntity <span class="token operator">=</span> spuInfoDescService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuItemVo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span>spuInfoDescEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> baseFuture <span class="token operator">=</span> infoFuture<span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 5\u3001\u83B7\u53D6spu\u7684\u89C4\u683C\u53C2\u6570\u4FE1\u606F</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuItemAttrGroupVo</span><span class="token punctuation">&gt;</span></span> attrGroupVos <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getAttrGroupWithAttrBySpuId</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token function">getCatalogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuItemVo<span class="token punctuation">.</span><span class="token function">setGroupAttrs</span><span class="token punctuation">(</span>attrGroupVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> imageFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2\u3001sku\u7684\u56FE\u7247\u4FE1\u606F pms_sku_images</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuImagesEntity</span><span class="token punctuation">&gt;</span></span> images <span class="token operator">=</span> imagesService<span class="token punctuation">.</span><span class="token function">getImagesBySkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuItemVo<span class="token punctuation">.</span><span class="token function">setImages</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u7B49\u5F85\u6240\u6709\u4EFB\u52A1\u5B8C\u6210</span>
    <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>saleAttrFuture<span class="token punctuation">,</span> descFuture<span class="token punctuation">,</span> baseFuture<span class="token punctuation">,</span> imageFuture<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> skuItemVo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u83B7\u53D6spu\u7684\u9500\u552E\u5C5E\u6027\u7EC4\u5408</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  \\<span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">&quot;getSaleAttrBySpuId&quot;</span> resultMap<span class="token operator">=</span><span class="token string">&quot;SkuItemSaleAttrVo&quot;</span><span class="token operator">&gt;</span>
             SELECT
          ssav<span class="token punctuation">.</span>\`attr_id\` attr_id<span class="token punctuation">,</span>
          ssav<span class="token punctuation">.</span>\`attr_name\` attr_name<span class="token punctuation">,</span>
          ssav<span class="token punctuation">.</span>\`attr_value\` <span class="token punctuation">,</span>
          <span class="token function">GROUP_CONCAT</span><span class="token punctuation">(</span>DISTINCT info<span class="token punctuation">.</span>\`sku_id\`<span class="token punctuation">)</span> sku_ids
        FROM
          \`pms_sku_info\` info
          LEFT JOIN \`pms_sku_sale_attr_value\` ssav
            ON ssav<span class="token punctuation">.</span>\`sku_id\` <span class="token operator">=</span> info<span class="token punctuation">.</span>\`sku_id\`
        WHERE info<span class="token punctuation">.</span>\`spu_id\` <span class="token operator">=</span> #<span class="token punctuation">{</span>spuId<span class="token punctuation">}</span>
        GROUP BY ssav<span class="token punctuation">.</span>\`attr_id\`<span class="token punctuation">,</span>ssav<span class="token punctuation">.</span>\`attr_name\`<span class="token punctuation">,</span>ssav<span class="token punctuation">.</span>\`attr_value\`
    \\<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u83B7\u53D6spu\u7684\u89C4\u683C\u53C2\u6570\u4FE1\u606F</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\\&lt;select id=&quot;getAttrGroupWithAttrsBySpuId&quot;
        resultMap=&quot;spuItemAttrGroupVo&quot;&gt;
    SELECT
      pav.\`spu_id\`,
      ag.\`attr_group_name\` ,
      ag.\`attr_group_id\`,
      aar.\`attr_id\`,
      attr.\`attr_name\`,
      pav.\`attr_value\`
    FROM
      \`pms_attr_group\` ag
      LEFT JOIN \`pms_attr_attrgroup_relation\` aar
        ON aar.\`attr_group_id\` = ag.\`attr_group_id\`
      LEFT JOIN \`pms_attr\` attr
        ON attr.\`attr_id\` = aar.\`attr_id\`
      LEFT JOIN \`pms_product_attr_value\` pav
        ON pav.\`attr_id\` = attr.\`attr_id\`
    WHERE ag.\`catelog_id\` = #{catalogId}
      AND pav.\`spu_id\` = #{spuId}
\\&lt;/select&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4ED6\u90FD\u662F\u901A\u8FC7\u5BF9\u5E94\u5173\u8054\u7684 <code>id</code> \u8FDB\u884C\u67E5\u8BE2\uFF0C\u5C31\u4E0A\u9762\u4E24\u4E2A\u67E5\u8BE2\u9500\u552E\u5C5E\u6027\u3001\u89C4\u683C\u53C2\u6570\u5C5E\u6027 \u6BD4\u8F83\u96BE\uFF0CSQL\u8FD9\u5757\u6BD4\u8F83\u96BE\u4EE5\u7406\u89E3</p><h3 id="_9-3-sku-\u7EC4\u5408\u5207\u6362" tabindex="-1"><a class="header-anchor" href="#_9-3-sku-\u7EC4\u5408\u5207\u6362" aria-hidden="true">#</a> 9.3 sku \u7EC4\u5408\u5207\u6362</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token comment">// sku \u7EC4\u5408\u5207\u6362</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.sku_attr_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> skus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1\u3001\u70B9\u51FB\u7684\u5143\u7D20\u6DFB\u52A0\u4E0A\u81EA\u5B9A\u4E49\u5C5E\u6027,\u4E3A\u4E86\u8BC6\u522B\u6211\u4EEC\u521A\u5728\u88AB\u70B9\u51FB\u7684</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">&quot;clicked&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// 1.1\u3001\u5F53\u524D\u88AB\u9009\u4E2D\u7684\u5C5E\u6027\u7684skus\u4FE1\u606F</span>
        <span class="token keyword">var</span> curr <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2\u3001\u6DFB\u52A0\u5230\u6570\u7EC4\u4E2D</span>
        skus<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3\u3001\u53BB\u6389\u540C\u4E00\u884C\u7684\u6240\u6709\u7684 checked  a-&gt;dd-&gt;dl</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;.sku_attr_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">&quot;checked&quot;</span><span class="token punctuation">)</span>

        <span class="token comment">// 4\u3001\u5176\u4ED6\u9879\u4E5F\u9700\u8981\u6DFB\u52A0\u5230\u6570\u7EC4\u91CC\u9762</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;a[class=&#39;sku_attr_value checked&#39;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            skus<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token comment">// 5\u3001\u53D6\u51FA\u4ED6\u4EEC\u7684\u4EA4\u96C6 jquery \u4E2D\u4F7F\u7528 filter\u65B9\u6CD5\u6765\u53D6\u51FA\u4ED6\u4EEC\u7684\u4EA4\u96C6</span>
        <span class="token comment">// 5.1 \u5C5E\u6027\u9879\u53EF\u80FD\u6709\u591A\u4E2A\uFF0C\u5185\u5B58\u3001\u7248\u672C\u7B49\u7B49\uFF0C\u6240\u4EE5\u9700\u8981\u904D\u5386</span>
        <span class="token keyword">var</span> filterEle <span class="token operator">=</span> skus<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i \\<span class="token operator">&lt;</span> skus<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            filterEle <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>filterEle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>skus<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 6\u3001\u8DF3\u8F6C\u5230\u4EA4\u96C6\u9875\u9762</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filterEle<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;http://item.gulimall.com/&quot;</span> <span class="token operator">+</span> filterEle<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;.html&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u9ED8\u8BA4\u7236\u5143\u7D20\u662F\u7070\u8272</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.sku_attr_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;border&quot;</span><span class="token operator">:</span> <span class="token string">&quot;solid 1px #CCC&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u62E5\u6709checked\u6837\u5F0F\u8868\u793A\u9009\u4E2D\u5F53\u524D\u5143\u7D20</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;a[class=&#39;sku_attr_value checked&#39;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;border&quot;</span><span class="token operator">:</span> <span class="token string">&quot;solid 1px red&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> 	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_10\u3001\u5546\u54C1\u4E1A\u52A1-\u8BA4\u8BC1\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_10\u3001\u5546\u54C1\u4E1A\u52A1-\u8BA4\u8BC1\u670D\u52A1" aria-hidden="true">#</a> 10\u3001\u5546\u54C1\u4E1A\u52A1 &amp; \u8BA4\u8BC1\u670D\u52A1</h1><h3 id="_10-1-\u73AF\u5883\u642D\u5EFA" tabindex="-1"><a class="header-anchor" href="#_10-1-\u73AF\u5883\u642D\u5EFA" aria-hidden="true">#</a> 10.1 \u73AF\u5883\u642D\u5EFA</h3><ul><li>\u4E3A\u767B\u5F55\u548C\u6CE8\u518C\u521B\u5EFA\u4E00\u4E2A\u670D\u52A1</li><li>\u8BB2\u63D0\u4F9B\u7684\u524D\u7AEF\u653E\u5230 <code>templates</code> \u76EE\u5F55\u4E0B</li></ul><p><img src="http://qnimg.gisfsde.com/work/image-20201110084252039.png" alt="image-20201110084252039" loading="lazy"></p><h3 id="_10-2-\u524D\u7AEF\u9A8C\u8BC1\u7801\u5012\u8BA1\u65F6" tabindex="-1"><a class="header-anchor" href="#_10-2-\u524D\u7AEF\u9A8C\u8BC1\u7801\u5012\u8BA1\u65F6" aria-hidden="true">#</a> 10.2 \u524D\u7AEF\u9A8C\u8BC1\u7801\u5012\u8BA1\u65F6</h3><p>\u5B9A\u4E49id \u4F7F\u7528 <code>Jquery</code> \u89E6\u53D1\u70B9\u51FB\u4E8B\u4EF6</p><p><img src="http://qnimg.gisfsde.com/work/image-20201110084521166.png" alt="image-20201110084521166" loading="lazy"></p><p>Jquery</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u9A8C\u8BC1\u7801\u53D1\u9001
     */</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#sendCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u5224\u65AD\u662F\u5426\u6709\u8BE5\u6837\u5F0F</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasClass</span><span class="token punctuation">(</span><span class="token string">&quot;disabled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u6B63\u5728\u5012\u8BA1\u65F6</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u53D1\u9001\u9A8C\u8BC1\u7801</span>
            $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/sms/sendCode?phone=&quot;</span> <span class="token operator">+</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#phoneNum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token function">timeoutChangeStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 60\u79D2</span>
<span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">timeoutChangeStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5148\u6DFB\u52A0\u6837\u5F0F\uFF0C\u9632\u6B62\u91CD\u590D\u70B9\u51FB</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#sendCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;disabled&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// \u5230\u8FBE0\u79D2\u540E \u91CD\u7F6E\u65F6\u95F4\uFF0C\u53BB\u9664\u6837\u5F0F</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#sendCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">&quot;\u53D1\u9001\u9A8C\u8BC1\u7801&quot;</span><span class="token punctuation">)</span>
        num <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
        <span class="token comment">// \u65F6\u95F4\u5230\u8FBE\u540E\u6E05\u9664\u6837\u5F0F</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#sendCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> str <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token string">&quot;s \u540E\u518D\u6B21\u53D1\u9001&quot;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#sendCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">&quot;timeoutChangeStyle()&quot;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    num<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BF9\u5E94\u6548\u679C</p><p><img src="http://qnimg.gisfsde.com/work/image-20201110084733372.png" alt="image-20201110084733372" loading="lazy"></p><h3 id="_10-3-\u6574\u5408\u77ED\u4FE1\u9A8C\u8BC1\u7801" tabindex="-1"><a class="header-anchor" href="#_10-3-\u6574\u5408\u77ED\u4FE1\u9A8C\u8BC1\u7801" aria-hidden="true">#</a> 10.3 \u6574\u5408\u77ED\u4FE1\u9A8C\u8BC1\u7801</h3><h4 id="_1\u3001\u77ED\u4FE1\u9A8C\u8BC1\u6211\u4EEC\u9009\u62E9\u7684\u662F\u963F\u91CC\u4E91\u7684\u77ED\u4FE1\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u77ED\u4FE1\u9A8C\u8BC1\u6211\u4EEC\u9009\u62E9\u7684\u662F\u963F\u91CC\u4E91\u7684\u77ED\u4FE1\u670D\u52A1" aria-hidden="true">#</a> 1\u3001\u77ED\u4FE1\u9A8C\u8BC1\u6211\u4EEC\u9009\u62E9\u7684\u662F\u963F\u91CC\u4E91\u7684\u77ED\u4FE1\u670D\u52A1</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201110084936446.png" alt="image-20201110084936446" loading="lazy"></p><h4 id="_2\u3001\u9009\u62E9\u5BF9\u5E94\u77ED\u4FE1\u670D\u52A1\u8FDB\u884C\u5F00\u901A" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u9009\u62E9\u5BF9\u5E94\u77ED\u4FE1\u670D\u52A1\u8FDB\u884C\u5F00\u901A" aria-hidden="true">#</a> 2\u3001\u9009\u62E9\u5BF9\u5E94\u77ED\u4FE1\u670D\u52A1\u8FDB\u884C\u5F00\u901A</h4><p>\u5728\u4E91\u5E02\u573A\u5C31\u80FD\u770B\u5230\u8D2D\u4E70\u7684\u670D\u52A1</p><p><img src="http://qnimg.gisfsde.com/work/image-20201110085141506.png" alt="image-20201110085141506" loading="lazy"></p><h4 id="_3\u3001\u9A8C\u8BC1\u77ED\u4FE1\u529F\u80FD\u662F\u5426\u80FD\u53D1\u9001" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u9A8C\u8BC1\u77ED\u4FE1\u529F\u80FD\u662F\u5426\u80FD\u53D1\u9001" aria-hidden="true">#</a> 3\u3001\u9A8C\u8BC1\u77ED\u4FE1\u529F\u80FD\u662F\u5426\u80FD\u53D1\u9001</h4><p>\u5728\u8D2D\u4E70\u77ED\u4FE1\u7684\u9875\u9762\uFF0C\u80FD\u8FDB\u884C\u8C03\u8BD5\u77ED\u4FE1</p><p><img src="http://qnimg.gisfsde.com/work/image-20201110085315288.png" alt="image-20201110085315288" loading="lazy"></p><p>\u8F93\u5165\u5BF9\u5E94\u624B\u673A\u53F7\uFF0CappCode \u5177\u4F53\u529F\u80FD\u4E0D\u505A\u6F14\u793A</p><p><img src="http://qnimg.gisfsde.com/work/image-20201110085348103.png" alt="image-20201110085348103" loading="lazy"></p><h4 id="_4\u3001\u4F7F\u7528-java-\u6D4B\u8BD5\u77ED\u4FE1\u662F\u5426\u80FD\u8FDB\u884C\u53D1\u9001" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u4F7F\u7528-java-\u6D4B\u8BD5\u77ED\u4FE1\u662F\u5426\u80FD\u8FDB\u884C\u53D1\u9001" aria-hidden="true">#</a> 4\u3001\u4F7F\u7528 Java \u6D4B\u8BD5\u77ED\u4FE1\u662F\u5426\u80FD\u8FDB\u884C\u53D1\u9001</h4><p>\u5F80\u4E0B\u62C9\u627E\u5230\u5BF9\u5E94 Java \u4EE3\u7801</p><p><strong>\u6CE8\u610F\uFF1A</strong></p><p>\u200B \u670D\u52A1\u5546\u63D0\u4F9B\u7684<strong>\u63A5\u53E3\u5730\u5740</strong>\uFF0C<strong>\u8BF7\u6C42\u53C2\u6570</strong>\u90FD\u4E0D\u540C\uFF0C\u8BF7\u53C2\u8003\u670D\u52A1\u5546\u63D0\u4F9B\u7684\u6D4B\u8BD5\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;http://dingxin.market.alicloudapi.com&quot;</span><span class="token punctuation">;</span>
	    <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/dx/sendSms&quot;</span><span class="token punctuation">;</span>
	    <span class="token class-name">String</span> method <span class="token operator">=</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">;</span>
	    <span class="token class-name">String</span> appcode <span class="token operator">=</span> <span class="token string">&quot;\u4F60\u81EA\u5DF1\u7684AppCode&quot;</span><span class="token punctuation">;</span>
	    <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token comment">//\u6700\u540E\u5728header\u4E2D\u7684\u683C\u5F0F(\u4E2D\u95F4\u662F\u82F1\u6587\u7A7A\u683C)\u4E3AAuthorization:APPCODE 83359fd73fe94948385f570e3c139105</span>
	    headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;APPCODE &quot;</span> <span class="token operator">+</span> appcode<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> querys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    querys<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mobile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;159xxxx9999&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    querys<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;param&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;code:1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    querys<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;tpl_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TP1711063&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bodys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	    <span class="token keyword">try</span> <span class="token punctuation">{</span>
	    	<span class="token doc-comment comment">/**
	    	* \u91CD\u8981\u63D0\u793A\u5982\u4E0B:
	    	* HttpUtils\u8BF7\u4ECE
	    	* https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/src/main/java/com/aliyun/api/gateway/demo/util/HttpUtils.java
	    	* \u4E0B\u8F7D
	    	*
	    	* \u76F8\u5E94\u7684\u4F9D\u8D56\u8BF7\u53C2\u7167
	    	* https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/pom.xml
	    	*/</span>
	    	<span class="token class-name">HttpResponse</span> response <span class="token operator">=</span> <span class="token class-name">HttpUtils</span><span class="token punctuation">.</span><span class="token function">doPost</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> path<span class="token punctuation">,</span> method<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> querys<span class="token punctuation">,</span> bodys<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    	<span class="token comment">//\u83B7\u53D6response\u7684body</span>
	    	<span class="token comment">//System.out.println(EntityUtils.toString(response.getEntity()));</span>
	    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9700\u8981\u5BFC\u5165\u5BF9\u5E94\u5DE5\u5177\u7C7B\uFF0C\u53C2\u7167\u6CE8\u91CA\u5C31\u884C</p><h3 id="_10-4-\u9A8C\u8BC1\u7801\u9632\u5237\u6821\u9A8C" tabindex="-1"><a class="header-anchor" href="#_10-4-\u9A8C\u8BC1\u7801\u9632\u5237\u6821\u9A8C" aria-hidden="true">#</a> 10.4 \u9A8C\u8BC1\u7801\u9632\u5237\u6821\u9A8C</h3><p>\u7528\u6237\u8981\u662F\u4E00\u76F4\u63D0\u4EA4\u9A8C\u8BC1\u7801</p><ul><li><p>\u524D\u53F0\uFF1A\u9650\u5236\u4E00\u5206\u949F\u540E\u63D0\u4EA4</p></li><li><p>\u540E\u53F0\uFF1A\u5B58\u5165redis \u5982\u679C\u6709\u5C31\u8FD4\u56DE</p></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u53D1\u9001\u77ED\u4FE1\u9A8C\u8BC1\u7801
 * <span class="token keyword">@param</span> <span class="token parameter">phone</span> \u624B\u673A\u53F7
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sms/sendCode&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">sendCode</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO 1\u3001\u63A5\u53E3\u9632\u5237</span>
    <span class="token comment">// \u5148\u4ECEredis\u4E2D\u62FF\u53D6</span>
    <span class="token class-name">String</span> redisCode <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AuthServerConstant</span><span class="token punctuation">.</span>SMS_CODE_CACHE_PREFIX <span class="token operator">+</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>redisCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u62C6\u5206</span>
        <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>redisCode<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5F53\u524D\u7CFB\u7EDF\u4E8B\u4EF6\u51CF\u53BB\u4E4B\u524D\u9A8C\u8BC1\u7801\u5B58\u5165\u7684\u4E8B\u4EF6 \u5C0F\u4E8E60000\u6BEB\u79D2=60\u79D2</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>l \\<span class="token operator">&lt;</span> <span class="token number">60000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 60\u79D2\u5185\u4E0D\u80FD\u518D\u53D1</span>
            <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>SMS_CODE_EXCEPTION<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>SMS_CODE_EXCEPTION<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2\u3001\u9A8C\u8BC1\u7801\u7684\u518D\u6B21\u6548\u9A8C</span>
    <span class="token comment">// \u6570\u636E\u5B58\u5165 =\u300Bredis key-phone value - code sms:code:131xxxxx - &gt;45678</span>
    <span class="token class-name">String</span> code <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u62FC\u63A5\u9A8C\u8BC1\u7801</span>
    <span class="token class-name">String</span> substring <span class="token operator">=</span> code<span class="token operator">+</span><span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// redis\u7F13\u5B58\u9A8C\u8BC1\u7801 \u9632\u6B62\u540C\u4E00\u4E2Aphone\u572860\u79D2\u5185\u53D1\u51FA\u591A\u6B21\u9A8C\u8BC1\u5417</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">AuthServerConstant</span><span class="token punctuation">.</span>SMS_CODE_CACHE_PREFIX<span class="token operator">+</span>phone<span class="token punctuation">,</span>substring<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8C03\u7528\u7B2C\u4E09\u65B9\u670D\u52A1\u53D1\u9001\u9A8C\u8BC1\u7801</span>
    thirdPartFeignService<span class="token punctuation">.</span><span class="token function">sendCode</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-5-\u4E00\u6B65\u4E00\u5751\u6CE8\u518C\u9875\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#_10-5-\u4E00\u6B65\u4E00\u5751\u6CE8\u518C\u9875\u73AF\u5883" aria-hidden="true">#</a> 10.5 \u4E00\u6B65\u4E00\u5751\u6CE8\u518C\u9875\u73AF\u5883</h3><h4 id="_1\u3001\u7F16\u5199-vo-\u63A5\u6536\u9875\u9762\u63D0\u4EA4" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7F16\u5199-vo-\u63A5\u6536\u9875\u9762\u63D0\u4EA4" aria-hidden="true">#</a> 1\u3001\u7F16\u5199 vo \u63A5\u6536\u9875\u9762\u63D0\u4EA4</h4><ul><li>\u4F7F\u7528\u5230\u4E86 JSR303\u6821\u9A8C</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6CE8\u518C\u6570\u636E\u5C01\u88C5Vo
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-09
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRegistVo</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;\u7528\u6237\u540D\u5FC5\u987B\u63D0\u4EA4&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Length</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>max <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">,</span>message <span class="token operator">=</span> <span class="token string">&quot;\u7528\u6237\u540D\u5FC5\u987B\u662F6-18\u4F4D\u5B57\u7B26&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;\u5BC6\u7801\u5FC5\u987B\u586B\u5199&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Length</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>max <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">,</span>message <span class="token operator">=</span> <span class="token string">&quot;\u5BC6\u7801\u5FC5\u987B\u662F6-18\u4F4D\u5B57\u7B26&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;\u624B\u673A\u53F7\u7801\u5FC5\u987B\u63D0\u4EA4&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">&quot;^[1]([3-9])[0-9]{9}$&quot;</span><span class="token punctuation">,</span>message <span class="token operator">=</span> <span class="token string">&quot;\u624B\u673A\u683C\u5F0F\u4E0D\u6B63\u786E&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;\u9A8C\u8BC1\u7801\u5FC5\u987B\u586B\u5199&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u9875\u9762\u63D0\u4EA4\u6570\u636E\u4E0Evo\u4E00\u81F4" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u9875\u9762\u63D0\u4EA4\u6570\u636E\u4E0Evo\u4E00\u81F4" aria-hidden="true">#</a> 2\u3001\u9875\u9762\u63D0\u4EA4\u6570\u636E\u4E0EVo\u4E00\u81F4</h4><p>\u8BBE\u7F6E <code>name</code> \u5C5E\u6027\u4E0E <code>Vo</code> \u4E00\u81F4\uFF0C\u65B9\u4FBF\u5C06\u4F20\u9012\u8FC7\u6765\u7684\u6570\u636E\u8F6C\u6362\u6210 JSON</p><p><img src="http://qnimg.gisfsde.com/work/image-20201110100732631.png" alt="image-20201110100732631" loading="lazy"></p><h4 id="_3\u3001\u6570\u636E\u6821\u9A8C" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u6570\u636E\u6821\u9A8C" aria-hidden="true">#</a> 3\u3001\u6570\u636E\u6821\u9A8C</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * //TODO \u91CD\u5B9A\u5411\u643A\u5E26\u6570\u636E\uFF0C\u5229\u7528session\u539F\u7406\uFF0C\u5C06\u6570\u636E\u653E\u5728session\u4E2D\uFF0C
 * \u53EA\u8981\u8DF3\u8F6C\u5230\u4E0B\u4E00\u4E2A\u9875\u9762\u53D6\u51FA\u8FD9\u4E2A\u6570\u636E\uFF0Csession\u4E2D\u7684\u6570\u636E\u5C31\u4F1A\u5220\u6389
 * //TODO\u5206\u5E03\u5F0F\u4E0B session \u7684\u95EE\u9898
 * RedirectAttributes redirectAttributes \u91CD\u5B9A\u5411\u643A\u5E26\u6570\u636E
 * redirectAttributes.addFlashAttribute(&quot;errors&quot;, errors); \u53EA\u80FD\u53D6\u4E00\u6B21
 * <span class="token keyword">@param</span> <span class="token parameter">vo</span> \u6570\u636E\u4F20\u8F93\u5BF9\u8C61
 * <span class="token keyword">@param</span> <span class="token parameter">result</span> \u7528\u4E8E\u9A8C\u8BC1\u53C2\u6570
 * <span class="token keyword">@param</span> <span class="token parameter">redirectAttributes</span> \u6570\u636E\u91CD\u5B9A\u5411
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/regist&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">regist</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token class-name">UserRegistVo</span> vo<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> result<span class="token punctuation">,</span>
                     <span class="token class-name">RedirectAttributes</span> redirectAttributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6821\u9A8C\u662F\u5426\u901A\u8FC7</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u62FF\u5230\u9519\u8BEF\u4FE1\u606F\u8F6C\u6362\u6210Map</span>
        <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errors <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getFieldErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">FieldError</span><span class="token operator">::</span><span class="token function">getField</span><span class="token punctuation">,</span> <span class="token class-name">FieldError</span><span class="token operator">::</span><span class="token function">getDefaultMessage</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u7528\u4E00\u6B21\u7684\u5C5E\u6027</span>
        redirectAttributes<span class="token punctuation">.</span><span class="token function">addFlashAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;errors&quot;</span><span class="token punctuation">,</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6821\u9A8C\u51FA\u9519\uFF0C\u8F6C\u53D1\u5230\u6CE8\u518C\u9875</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u5C06\u4F20\u9012\u8FC7\u6765\u7684\u9A8C\u8BC1\u7801 \u4E0E \u5B58redis\u4E2D\u7684\u9A8C\u8BC1\u7801\u8FDB\u884C\u6BD4\u8F83</span>
    <span class="token class-name">String</span> code <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AuthServerConstant</span><span class="token punctuation">.</span>SMS_CODE_CACHE_PREFIX <span class="token operator">+</span> vo<span class="token punctuation">.</span><span class="token function">getPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u9A8C\u8BC1\u7801\u548Credis\u4E2D\u7684\u4E00\u81F4</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5220\u9664\u9A8C\u8BC1\u7801\uFF1A\u4EE4\u724C\u673A\u5236</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">AuthServerConstant</span><span class="token punctuation">.</span>SMS_CODE_CACHE_PREFIX <span class="token operator">+</span> vo<span class="token punctuation">.</span><span class="token function">getPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8C03\u7528\u8FDC\u7A0B\u670D\u52A1\uFF0C\u771F\u6B63\u6CE8\u518C</span>
            <span class="token class-name">R</span> r <span class="token operator">=</span> memberFeignService<span class="token punctuation">.</span><span class="token function">regist</span><span class="token punctuation">(</span>vo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u8FDC\u7A0B\u8C03\u7528\u6CE8\u518C\u670D\u52A1\u6210\u529F</span>
                <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://auth.gulimall.com/login.html&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                errors<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                redirectAttributes<span class="token punctuation">.</span><span class="token function">addFlashAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;errors&quot;</span><span class="token punctuation">,</span> errors<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            errors<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\u9A8C\u8BC1\u7801\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            redirectAttributes<span class="token punctuation">.</span><span class="token function">addFlashAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\u9A8C\u8BC1\u7801\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u6821\u9A8C\u51FA\u9519\uFF0C\u8F6C\u53D1\u5230\u6CE8\u518C\u9875</span>
            <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        errors<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\u9A8C\u8BC1\u7801\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redirectAttributes<span class="token punctuation">.</span><span class="token function">addFlashAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\u9A8C\u8BC1\u7801\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6821\u9A8C\u51FA\u9519\uFF0C\u8F6C\u53D1\u5230\u6CE8\u518C\u9875</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4\u3001\u524D\u7AEF\u9875\u9762\u63A5\u6536\u9519\u8BEF\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u524D\u7AEF\u9875\u9762\u63A5\u6536\u9519\u8BEF\u4FE1\u606F" aria-hidden="true">#</a> 4\u3001\u524D\u7AEF\u9875\u9762\u63A5\u6536\u9519\u8BEF\u4FE1\u606F</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201110101306173.png" alt="image-20201110101306173" loading="lazy"></p><h4 id="_5\u3001\u5F02\u5E38\u673A\u5236-\u7528\u6237\u6CE8\u518C" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u5F02\u5E38\u673A\u5236-\u7528\u6237\u6CE8\u518C" aria-hidden="true">#</a> 5\u3001\u5F02\u5E38\u673A\u5236 &amp; \u7528\u6237\u6CE8\u518C</h4><ul><li>\u7528\u6237\u6CE8\u518C\u5355\u72EC\u62BD\u51FA\u4E86\u4E00\u4E2A\u670D\u52A1</li></ul><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6CE8\u518C
 * <span class="token keyword">@param</span> <span class="token parameter">registVo</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/regist&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">regist</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">MemberRegistVo</span> registVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        memberService<span class="token punctuation">.</span><span class="token function">regist</span><span class="token punctuation">(</span>registVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PhoneExsitException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8FD4\u56DE\u5BF9\u5E94\u7684\u5F02\u5E38\u4FE1\u606F</span>
       <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>PHONE_EXIST_EXCEPTION<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>PHONE_EXIST_EXCEPTION<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UserNameExistException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>USER_EXIST_EXCEPTION<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">BizCodeEnume</span><span class="token punctuation">.</span>USER_EXIST_EXCEPTION<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">regist</span><span class="token punctuation">(</span><span class="token class-name">MemberRegistVo</span> registVo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">MemberDao</span> memberDao <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">;</span>
    <span class="token class-name">MemberEntity</span> entity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MemberEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u9ED8\u8BA4\u7B49\u7EA7</span>
    <span class="token class-name">MemberLevelEntity</span> memberLevelEntity <span class="token operator">=</span> memberLevelDao<span class="token punctuation">.</span><span class="token function">getDefaultLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    entity<span class="token punctuation">.</span><span class="token function">setLevelId</span><span class="token punctuation">(</span>memberLevelEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// \u68C0\u67E5\u624B\u673A\u53F7\u548C\u7528\u6237\u540D\u662F\u5426\u552F\u4E00</span>
    <span class="token function">checkPhoneUnique</span><span class="token punctuation">(</span>registVo<span class="token punctuation">.</span><span class="token function">getPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkUserNameUnique</span><span class="token punctuation">(</span>registVo<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    entity<span class="token punctuation">.</span><span class="token function">setMobile</span><span class="token punctuation">(</span>registVo<span class="token punctuation">.</span><span class="token function">getPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    entity<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>registVo<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u5BC6\u7801\u8981\u52A0\u5BC6\u5B58\u50A8</span>
    <span class="token class-name">BCryptPasswordEncoder</span> passwordEncoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> encode <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>registVo<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    entity<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>encode<span class="token punctuation">)</span><span class="token punctuation">;</span>

    memberDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkPhoneUnique</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">PhoneExsitException</span> <span class="token punctuation">{</span>
    <span class="token class-name">MemberDao</span> memberDao <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> mobile <span class="token operator">=</span> memberDao<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;mobile&quot;</span><span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mobile <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">PhoneExsitException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkUserNameUnique</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UserNameExistException</span> <span class="token punctuation">{</span>
    <span class="token class-name">MemberDao</span> memberDao <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> count <span class="token operator">=</span> memberDao<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">PhoneExsitException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u5904\u5F15\u5165\u4E00\u4E2A\u95EE\u9898</p><ul><li>\u5BC6\u7801\u662F\u76F4\u63A5\u5B58\u5165\u6570\u636E\u5E93\u5417\uFF1F \u8FD9\u6837\u5B50\u4F1A\u5BFC\u81F4\u6570\u636E\u7684\u4E0D\u5B89\u5168\uFF0C</li><li>\u5F15\u51FA\u4E86\u4F7F\u7528 MD5\u8FDB\u884C\u52A0\u5BC6\uFF0C\u4F46\u662FMD5\u52A0\u5BC6\u540E\uFF0C\u522B\u4EBA\u4EFB\u7136\u53EF\u4EE5\u66B4\u529B\u7834\u89E3</li><li>\u53EF\u4EE5\u4F7F\u7528\u52A0\u76D0\u7684\u65B9\u5F0F\uFF0C\u5C06\u5BC6\u7801\u52A0\u5BC6\u540E\uFF0C\u5F97\u5230\u4E00\u4E32\u968F\u673A\u5B57\u7B26\uFF0C</li><li>\u968F\u673A\u5B57\u7B26\u548C\u5BC6\u7801\u548C\u8FDB\u884C\u9A8C\u8BC1\u76F8\u540C\u7ED3\u679C\u8FD4\u56DEtrue\u5426\u5219false</li></ul><p>\u81F3\u6B64\u6CE8\u518C\u76F8\u5173\u7ED3\u675F~</p><h3 id="_10-6-\u8D26\u53F7\u5BC6\u7801\u767B\u5F55" tabindex="-1"><a class="header-anchor" href="#_10-6-\u8D26\u53F7\u5BC6\u7801\u767B\u5F55" aria-hidden="true">#</a> 10.6 \u8D26\u53F7\u5BC6\u7801\u767B\u5F55</h3><h4 id="_1\u3001\u5B9A\u4E49-vo-\u63A5\u6536\u6570\u636E\u63D0\u4EA4" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5B9A\u4E49-vo-\u63A5\u6536\u6570\u636E\u63D0\u4EA4" aria-hidden="true">#</a> 1\u3001\u5B9A\u4E49 Vo \u63A5\u6536\u6570\u636E\u63D0\u4EA4</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-10
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserLoginVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> loginacct<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u540C\u65F6\u9700\u8981\u4FDD\u8BC1\u524D\u7AEF\u9875\u9762\u63D0\u4EA4\u5B57\u6BB5\u4E0E Vo \u7C7B\u4E2D\u4E00\u81F4</p><h4 id="_2\u3001\u5728-member-\u670D\u52A1\u4E2D\u7F16\u5199\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5728-member-\u670D\u52A1\u4E2D\u7F16\u5199\u63A5\u53E3" aria-hidden="true">#</a> 2\u3001\u5728 Member \u670D\u52A1\u4E2D\u7F16\u5199\u63A5\u53E3</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">MemberEntity</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">MemberLoginVo</span> vo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> loginacct <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getLoginacct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 1\u3001\u53BB\u6570\u636E\u5E93\u67E5\u8BE2 select * from  ums_member where username=? or mobile =?</span>
    <span class="token class-name">MemberDao</span> memberDao <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">;</span>
    <span class="token class-name">MemberEntity</span> memberEntity <span class="token operator">=</span> memberDao<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> loginacct<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                    <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;mobile&quot;</span><span class="token punctuation">,</span> loginacct<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>memberDao <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u767B\u5F55\u5931\u8D25</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u83B7\u53D6\u6570\u636E\u5E93\u7684\u5BC6\u7801</span>
        <span class="token class-name">String</span> passwordDB <span class="token operator">=</span> memberEntity<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BCryptPasswordEncoder</span> passwordEncoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u548C\u7528\u6237\u5BC6\u7801\u8FDB\u884C\u6821\u9A8C</span>
        <span class="token keyword">boolean</span> matches <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> passwordDB<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>matches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5BC6\u7801\u9A8C\u8BC1\u6210\u529F \u8FD4\u56DE\u5BF9\u8C61</span>
            <span class="token keyword">return</span> memberEntity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-7-\u5206\u5E03\u5F0F-session\u4E0D\u5171\u4EAB\u4E0D\u540C\u6B65\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_11-7-\u5206\u5E03\u5F0F-session\u4E0D\u5171\u4EAB\u4E0D\u540C\u6B65\u95EE\u9898" aria-hidden="true">#</a> 11.7 \u5206\u5E03\u5F0F Session\u4E0D\u5171\u4EAB\u4E0D\u540C\u6B65\u95EE\u9898</h3><p>\u6211\u4EEC\u5728auth.gulimall.com\u4E2D\u4FDD\u5B58session\uFF0C\u4F46\u662F\u7F51\u5740\u8DF3\u8F6C\u5230 gulimall.com\u4E2D\uFF0C\u53D6\u4E0D\u51FAauth.gulimall.com\u4E2D\u4FDD\u5B58\u7684session\uFF0C\u8FD9\u5C31\u9020\u6210\u4E86\u5FAE\u670D\u52A1\u4E0B\u7684session\u4E0D\u540C\u6B65\u95EE\u9898</p><p><img src="http://qnimg.gisfsde.com/work/image-20201111103637615.png" alt="image-20201111103637615" loading="lazy"></p><h4 id="_1\u3001session\u540C\u6B65\u89E3\u51B3\u65B9\u6848-\u5206\u5E03\u5F0F\u4E0Bsession\u5171\u4EAB\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_1\u3001session\u540C\u6B65\u89E3\u51B3\u65B9\u6848-\u5206\u5E03\u5F0F\u4E0Bsession\u5171\u4EAB\u95EE\u9898" aria-hidden="true">#</a> 1\u3001Session\u540C\u6B65\u89E3\u51B3\u65B9\u6848-\u5206\u5E03\u5F0F\u4E0Bsession\u5171\u4EAB\u95EE\u9898</h4><p>\u540C\u4E00\u4E2A\u670D\u52A1\u590D\u5236\u591A\u4E2A\uFF0C\u4F46\u662Fsession\u8FD8\u662F\u53EA\u80FD\u5728\u4E00\u4E2A\u670D\u52A1\u4E0A\u4FDD\u5B58\uFF0C\u6D4F\u89C8\u5668\u4E5F\u662F\u53EA\u80FD\u8BFB\u53D6\u5230\u4E00\u4E2A\u670D\u52A1\u7684session</p><p><img src="http://qnimg.gisfsde.com/work/image-20201111104758917.png" alt="image-20201111104758917" loading="lazy"></p><h4 id="_2\u3001session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-session\u590D\u5236" tabindex="-1"><a class="header-anchor" href="#_2\u3001session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-session\u590D\u5236" aria-hidden="true">#</a> 2\u3001Session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-session\u590D\u5236</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201111104851977.png" alt="image-20201111104851977" loading="lazy"></p><h4 id="_3\u3001session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-\u5BA2\u6237\u7AEF\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#_3\u3001session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-\u5BA2\u6237\u7AEF\u5B58\u50A8" aria-hidden="true">#</a> 3\u3001Session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-\u5BA2\u6237\u7AEF\u5B58\u50A8</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201111104913888.png" alt="image-20201111104913888" loading="lazy"></p><h4 id="_4\u3001session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-hash\u4E00\u81F4\u6027" tabindex="-1"><a class="header-anchor" href="#_4\u3001session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-hash\u4E00\u81F4\u6027" aria-hidden="true">#</a> 4\u3001Session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-hash\u4E00\u81F4\u6027</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201111105039741.png" alt="image-20201111105039741" loading="lazy"></p><h4 id="_5\u3001session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-\u7EDF\u4E00\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#_5\u3001session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-\u7EDF\u4E00\u5B58\u50A8" aria-hidden="true">#</a> 5\u3001Session\u5171\u4EAB\u95EE\u9898\u89E3\u51B3-\u7EDF\u4E00\u5B58\u50A8</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201111105135178.png" alt="image-20201111105135178" loading="lazy"></p><h3 id="_11-8-springsession\u6574\u5408" tabindex="-1"><a class="header-anchor" href="#_11-8-springsession\u6574\u5408" aria-hidden="true">#</a> 11.8 SpringSession\u6574\u5408</h3><h4 id="_1\u3001\u5B98\u7F51\u6587\u6863-\u9605\u8BFB" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5B98\u7F51\u6587\u6863-\u9605\u8BFB" aria-hidden="true">#</a> 1\u3001\u5B98\u7F51\u6587\u6863 \u9605\u8BFB</h4><ul><li>\u8FDB\u5165\u5230 Spring Framework</li></ul><p><img src="http://qnimg.gisfsde.com/work/image-20201111144109273.png" alt="image-20201111144109273" loading="lazy"></p><h5 id="_2\u3001\u9009\u62E9spring-session\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u9009\u62E9spring-session\u6587\u6863" aria-hidden="true">#</a> 2\u3001\u9009\u62E9Spring Session\u6587\u6863</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201111144350506.png" alt="image-20201111144350506" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201111144438592.png" alt="image-20201111144438592" loading="lazy"></p><h5 id="_3\u3001\u5F00\u59CB\u4F7F\u7528spring-session" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5F00\u59CB\u4F7F\u7528spring-session" aria-hidden="true">#</a> 3\u3001\u5F00\u59CB\u4F7F\u7528Spring Session</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201111144639786.png" alt="image-20201111144639786" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201111144718176.png" alt="image-20201111144718176" loading="lazy"></p><h4 id="_2\u3001\u6574\u5408springboot" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6574\u5408springboot" aria-hidden="true">#</a> 2\u3001\u6574\u5408SpringBoot</h4><h5 id="_1\u3001\u6DFB\u52A0pom-xml\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6DFB\u52A0pom-xml\u4F9D\u8D56" aria-hidden="true">#</a> 1\u3001\u6DFB\u52A0Pom.xml\u4F9D\u8D56</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201111144914600.png" alt="image-20201111144914600" loading="lazy"></p><h5 id="_2\u3001application-yml-\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_2\u3001application-yml-\u914D\u7F6E" aria-hidden="true">#</a> 2\u3001application.yml \u914D\u7F6E</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201111145601673.png" alt="image-20201111145601673" loading="lazy"></p><h5 id="_3\u3001reids\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3\u3001reids\u914D\u7F6E" aria-hidden="true">#</a> 3\u3001reids\u914D\u7F6E</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201111150056671.png" alt="image-20201111150056671" loading="lazy"></p><h5 id="_4\u3001\u542F\u52A8\u7C7B\u52A0\u4E0A-enableredishttpsession" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u542F\u52A8\u7C7B\u52A0\u4E0A-enableredishttpsession" aria-hidden="true">#</a> 4\u3001\u542F\u52A8\u7C7B\u52A0\u4E0A @EnableRedisHttpSession</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableRedisHttpSession</span> <span class="token comment">// \u6574\u5408spring session</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_3\u3001\u81EA\u5B9A\u4E49-springsession-\u5B8C\u6210-session-\u5B50\u57DF\u5171\u4EAB" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u81EA\u5B9A\u4E49-springsession-\u5B8C\u6210-session-\u5B50\u57DF\u5171\u4EAB" aria-hidden="true">#</a> 3\u3001\u81EA\u5B9A\u4E49 SpringSession \u5B8C\u6210 Session \u5B50\u57DF\u5171\u4EAB</h4><h5 id="cookieserializer" tabindex="-1"><a class="header-anchor" href="#cookieserializer" aria-hidden="true">#</a> <code>CookieSerializer</code></h5>`,275),$p=s("api\u6587\u6863\u53C2\u8003\uFF1A"),Xp={href:"https://docs.spring.io/spring-session/docs/2.4.1/reference/html5/index.html#api-cookieserializer",target:"_blank",rel:"noopener noreferrer"},Yp=s("https://docs.spring.io/spring-session/docs/2.4.1/reference/html5/index.html#api-cookieserializer"),Zp=n("p",null,[n("img",{src:"http://qnimg.gisfsde.com/work/image-20210101124234037.png",alt:"image-20210101124234037",loading:"lazy"})],-1),ne=n("h5",{id:"\u6307\u5B9Aredis\u5E8F\u5217\u5316",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u6307\u5B9Aredis\u5E8F\u5217\u5316","aria-hidden":"true"},"#"),s(" \u6307\u5B9Aredis\u5E8F\u5217\u5316")],-1),se=n("p",null,"\u6587\u6863\u5730\u5740\uFF1A",-1),ae={href:"https://docs.spring.io/spring-session/docs/2.4.1/reference/html5/index.html#api-redisindexedsessionrepository-config",target:"_blank",rel:"noopener noreferrer"},te=s("https://docs.spring.io/spring-session/docs/2.4.1/reference/html5/index.html#api-redisindexedsessionrepository-config"),pe=n("p",null,[n("img",{src:"http://qnimg.gisfsde.com/work/image-20210101124513827.png",alt:"image-20210101124513827",loading:"lazy"})],-1),ee=n("p",null,"redis\u4E2Djson\u5E8F\u5217\u5316",-1),oe=s("\u5B98\u7F51\u6587\u6863\u5730\u5740\uFF1A"),ce={href:"https://docs.spring.io/spring-session/docs/2.4.1/reference/html5/index.html#samples",target:"_blank",rel:"noopener noreferrer"},ie=s("https://docs.spring.io/spring-session/docs/2.4.1/reference/html5/index.html#samples"),le=n("p",null,[n("img",{src:"http://qnimg.gisfsde.com/work/image-20210101125216426.png",alt:"image-20210101125216426",loading:"lazy"})],-1),ue=n("p",null,"\u63D0\u4F9B\u7684\u5B9E\u4F8B\uFF1A",-1),re={href:"https://github.com/spring-projects/spring-session/blob/2.4.1/spring-session-samples/spring-session-sample-boot-redis-json/src/main/java/sample/config/SessionConfig.java",target:"_blank",rel:"noopener noreferrer"},ke=s("https://github.com/spring-projects/spring-session/blob/2.4.1/spring-session-samples/spring-session-sample-boot-redis-json/src/main/java/sample/config/SessionConfig.java"),de=p(`<p><img src="http://qnimg.gisfsde.com/work/image-20210101125303807.png" alt="image-20210101125303807" loading="lazy"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * SpringSession\u6574\u5408\u5B50\u57DF
 * \u4EE5\u53CAredis\u6570\u636E\u5B58\u50A8\u4E3Ajson
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-11
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallSessionConfig</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u8BBE\u7F6Ecookie\u4FE1\u606F
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CookieSerializer</span> <span class="token class-name">CookieSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">DefaultCookieSerializer</span> cookieSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultCookieSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E\u4E00\u4E2A\u57DF\u540D\u7684\u540D\u5B57</span>
        cookieSerializer<span class="token punctuation">.</span><span class="token function">setDomainName</span><span class="token punctuation">(</span><span class="token string">&quot;gulimall.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// cookie\u7684\u8DEF\u5F84</span>
        cookieSerializer<span class="token punctuation">.</span><span class="token function">setCookieName</span><span class="token punctuation">(</span><span class="token string">&quot;GULIMALLSESSION&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cookieSerializer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u8BBE\u7F6Ejson\u8F6C\u6362
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisSerializer</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">springSessionDefaultRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u4F7F\u7528jackson\u63D0\u4F9B\u7684\u8F6C\u6362\u5668</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4\u3001springsession-\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_4\u3001springsession-\u539F\u7406" aria-hidden="true">#</a> 4\u3001SpringSession \u539F\u7406</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6838\u5FC3\u539F\u7406
 * 1\u3001@EnableRedisHttpSession\u5BFC\u5165RedisHttpSessionConfiguration\u914D\u7F6E
 *      1\u3001\u7ED9\u5BB9\u5668\u4E2D\u6DFB\u52A0\u4E86\u4E00\u4E2A\u7EC4\u4EF6
 *          sessionRepository = \u300B\u300B\u300B\u3010RedisOperationsSessionRepository\u3011 redis \u64CD\u4F5C session session\u7684\u589E\u5220\u6539\u67E5\u5C01\u88C5\u7C7B
 *      2\u3001SessionRepositoryFilter==&gt;:session\u5B58\u50A8\u8FC7\u6EE4\u5668\uFF0C\u6BCF\u4E2A\u8BF7\u6C42\u8FC7\u6765\u5FC5\u987B\u7ECF\u8FC7Filter
 *          1\u3001\u521B\u5EFA\u7684\u65F6\u5019\uFF0C\u5C31\u81EA\u52A8\u4ECE\u5BB9\u5668\u4E2D\u83B7\u53D6\u5230\u4E86SessionRepostiory
 *          2\u3001\u539F\u59CB\u7684request,response\u90FD\u88AB\u5305\u88C5\u4E86 SessionRepositoryRequestWrapper\u3001SessionRepositoryResponseWrapper
 *          3\u3001\u4EE5\u540E\u83B7\u53D6session.request.getSession()
 *              SessionRepositoryResponseWrapper
 *          4\u3001wrappedRequest.getSession() ==&gt;SessionRepository
 *
 *          \u88C5\u9970\u8005\u6A21\u5F0F
 *          spring-redis\u7684\u76F8\u5173\u529F\u80FD:
 *                 \u6267\u884Csession\u76F8\u5173\u64CD\u4F5C\u540E\uFF0Credis\u91CC\u9762\u5B58\u50A8\u7684\u65F6\u95F4\u4E5F\u4F1A\u5237\u65B0
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6838\u5FC3\u6E90\u7801\u662F\uFF1A</p><ul><li><p><code>SessionRepositoryFilter</code> \u7C7B\u4E0B\u9762\u7684 <code>doFilterInternal</code> \u65B9\u6CD5</p></li><li><p>\u53CA\u90A3\u4E2A <code>request</code>\u3001<code>response</code> \u5305\u88C5\u6210 <code>SessionRepositoryRequestWrapper</code></p><p><img src="http://qnimg.gisfsde.com/work/image-20201111195249024.png" alt="image-20201111195249024" loading="lazy"></p></li></ul><h1 id="_11\u3001\u5355\u70B9\u767B\u5F55\u548C\u793E\u4EA4\u767B\u5F55" tabindex="-1"><a class="header-anchor" href="#_11\u3001\u5355\u70B9\u767B\u5F55\u548C\u793E\u4EA4\u767B\u5F55" aria-hidden="true">#</a> 11\u3001\u5355\u70B9\u767B\u5F55\u548C\u793E\u4EA4\u767B\u5F55</h1><h3 id="_11-1-\u793E\u4EA4\u767B\u5F55" tabindex="-1"><a class="header-anchor" href="#_11-1-\u793E\u4EA4\u767B\u5F55" aria-hidden="true">#</a> 11.1 \u793E\u4EA4\u767B\u5F55</h3><p><img src="http://qnimg.gisfsde.com/work/image-20201110124933726.png" alt="image-20201110124933726" loading="lazy"></p><p>QQ\u3001\u5FAE\u535A\uFF0Cgithub\u7B49\u7F51\u7AD9\u7684\u7528\u6237\u91CF\u975E\u5E38\u5927\uFF0C\u522B\u7684\u7F51\u7AD9\u4E3A\u4E86\u7B80\u5316\u7F51\u7AD9\u7684\u767B\u9646\u548C\u6CE8\u518C\u903B\u8F91\uFF0C\u5F15\u5165\u793E\u4EA4\u767B\u5F55\u529F\u80FD</p><p>\u6B65\u9AA4</p><p>1\u3001\u7528\u6237\u70B9\u51FB QQ\u6309\u94AE</p><p>2\u3001\u5F15\u5BFC\u8DF3\u8F6C\u8FDB QQ \u6388\u6743\u9875</p><p><img src="http://qnimg.gisfsde.com/work/image-20201110124945111.png" alt="image-20201110124945111" loading="lazy"></p><p>3\u3001\u7528\u6237\u4E3B\u52A8\u70B9\u51FB\u6388\u6743\uFF0C\u8DF3\u56DE\u4E4B\u524D\u7F51\u9875</p><h4 id="_11-1-1-oauth2-0" tabindex="-1"><a class="header-anchor" href="#_11-1-1-oauth2-0" aria-hidden="true">#</a> 11.1.1 OAuth2.0</h4><ul><li><p>**OAuth\uFF1A**OAuth\uFF08\u5F00\u653E\u6388\u6743\uFF09\u662F\u4E00\u4E2A\u5F00\u653E\u6807\u51C6\uFF0C\u5141\u8BB8\u7528\u6237\u6388\u6743\u7B2C\u4E09\u65B9\u7F51\u7AD9\u8BBF\u95EE\u4ED6\u4EEC\u5B58\u50A8\u5728\u53E6\u5916\u7684\u670D\u52A1\u63D0\u4F9B\u8005\u4E0A\u7684\u4FE1\u606F\uFF0C\u800C\u4E0D\u9700\u8981\u5C06\u7528\u6237\u540D\u548C\u5BC6\u7801\u63D0\u4F9B\u7ED9\u7B2C\u4E09\u65B9\u7F51\u7AD9\u6216\u5206\u4EAB\u4ED6\u4EEC\u7684\u6570\u636E\u7684\u5185\u5BB9</p></li><li><p>**OAuth2.0\uFF1A**\u5BF9\u4E8E\u7528\u6237\u76F8\u5173\u7684 OpenAPI\uFF08\u4F8B\u5982\u83B7\u53D6\u7528\u6237\u4FE1\u606F\uFF0C\u52A8\u6001\u540C\u6B65\uFF0C\u7167\u7247\uFF0C\u65E5\u5FD7\uFF0C\u5206\u4EAB\u7B49\uFF09\uFF0C\u4E3A\u4E86\u4FDD\u5B58\u7528\u6237\u6570\u636E\u7684\u5B89\u5168\u548C\u9690\u79C1\uFF0C\u7B2C\u4E09\u65B9\u7F51\u7AD9\u8BBF\u95EE\u7528\u6237\u6570\u636E\u524D\u90FD\u9700\u8981\u663E\u793A\u5411\u7528\u6237\u6388\u6743</p></li><li><p>\u5B98\u65B9\u7248\u6D41\u7A0B</p><p><img src="http://qnimg.gisfsde.com/work/oAuth2_01.gif" alt="img" loading="lazy"></p></li></ul><p>\u6587\u6863\u5730\u5740\uFF1A</p><p>\u76F8\u5173\u6D41\u7A0B\u5206\u6790</p><p><img src="http://qnimg.gisfsde.com/work/image-20201110154532752.png" alt="image-20201110154532752" loading="lazy"></p><h4 id="_11-2-\u5FAE\u535A\u767B\u5F55\u51C6\u5907\u5DE5\u4F5C" tabindex="-1"><a class="header-anchor" href="#_11-2-\u5FAE\u535A\u767B\u5F55\u51C6\u5907\u5DE5\u4F5C" aria-hidden="true">#</a> 11.2 \u5FAE\u535A\u767B\u5F55\u51C6\u5907\u5DE5\u4F5C</h4><h5 id="_1\u3001\u8FDB\u5165\u5FAE\u535A\u5F00\u653E\u5E73\u53F0" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u8FDB\u5165\u5FAE\u535A\u5F00\u653E\u5E73\u53F0" aria-hidden="true">#</a> 1\u3001\u8FDB\u5165\u5FAE\u535A\u5F00\u653E\u5E73\u53F0</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201110154702360.png" alt="image-20201110154702360" loading="lazy"></p><h5 id="_2\u3001\u767B\u5F55\u5FAE\u535A-\u8FDB\u5165\u5FAE\u8FDE\u63A5-\u9009\u62E9\u7F51\u7AD9\u63A5\u5165" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u767B\u5F55\u5FAE\u535A-\u8FDB\u5165\u5FAE\u8FDE\u63A5-\u9009\u62E9\u7F51\u7AD9\u63A5\u5165" aria-hidden="true">#</a> 2\u3001\u767B\u5F55\u5FAE\u535A\uFF0C\u8FDB\u5165\u5FAE\u8FDE\u63A5\uFF0C\u9009\u62E9\u7F51\u7AD9\u63A5\u5165</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201110160834589.png" alt="image-20201110160834589" loading="lazy"></p><h5 id="_3\u3001\u9009\u62E9\u7ACB\u5373\u63A5\u5165" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u9009\u62E9\u7ACB\u5373\u63A5\u5165" aria-hidden="true">#</a> 3\u3001\u9009\u62E9\u7ACB\u5373\u63A5\u5165</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201110161001013.png" alt="image-20201110161001013" loading="lazy"></p><h5 id="_4\u3001\u521B\u5EFA\u81EA\u5DF1\u7684\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u521B\u5EFA\u81EA\u5DF1\u7684\u5E94\u7528" aria-hidden="true">#</a> 4\u3001\u521B\u5EFA\u81EA\u5DF1\u7684\u5E94\u7528</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201110161032203.png" alt="image-20201110161032203" loading="lazy"></p><h5 id="_5\u3001\u6211\u4EEC\u53EF\u4EE5\u5728\u5F00\u53D1\u9636\u6BB5" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u6211\u4EEC\u53EF\u4EE5\u5728\u5F00\u53D1\u9636\u6BB5" aria-hidden="true">#</a> 5\u3001\u6211\u4EEC\u53EF\u4EE5\u5728\u5F00\u53D1\u9636\u6BB5</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201110161152105.png" alt="image-20201110161152105" loading="lazy"></p><h5 id="_6\u3001\u8FDB\u5165\u9AD8\u7EA7\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u8FDB\u5165\u9AD8\u7EA7\u4FE1\u606F" aria-hidden="true">#</a> 6\u3001\u8FDB\u5165\u9AD8\u7EA7\u4FE1\u606F</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201110161407018.png" alt="image-20201110161407018" loading="lazy"></p><h5 id="_7\u3001\u6DFB\u52A0\u6D4B\u8BD5\u8D26\u53F7" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u6DFB\u52A0\u6D4B\u8BD5\u8D26\u53F7" aria-hidden="true">#</a> 7\u3001\u6DFB\u52A0\u6D4B\u8BD5\u8D26\u53F7</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201110161451881.png" alt="image-20201110161451881" loading="lazy"></p><h5 id="_8\u3001\u8FDB\u5165\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#_8\u3001\u8FDB\u5165\u6587\u6863" aria-hidden="true">#</a> 8\u3001\u8FDB\u5165\u6587\u6863</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201110161634486.png" alt="image-20201110161634486" loading="lazy"></p><h4 id="_11-3-\u5FAE\u535A\u767B\u5F55\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_11-3-\u5FAE\u535A\u767B\u5F55\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 11.3 \u5FAE\u535A\u767B\u5F55\u4EE3\u7801\u5B9E\u73B0</h4><h5 id="\u767B\u9646\u6CE8\u518C\u6D41\u7A0B\u56FE" tabindex="-1"><a class="header-anchor" href="#\u767B\u9646\u6CE8\u518C\u6D41\u7A0B\u56FE" aria-hidden="true">#</a> \u767B\u9646\u6CE8\u518C\u6D41\u7A0B\u56FE</h5><p>\u770B\u4E0D\u6E05\uFF0C\u653E\u5927\u4E00\u70B9</p><h5 id="\u5FAE\u535A\u767B\u5F55\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u5FAE\u535A\u767B\u5F55\u6D41\u7A0B" aria-hidden="true">#</a> <strong>\u5FAE\u535A\u767B\u5F55\u6D41\u7A0B</strong><img src="http://qnimg.gisfsde.com/work/image-20201231084733753.png" alt="image-20201231084733753" loading="lazy"></h5><h6 id="\u6CE8\u518C\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u518C\u6D41\u7A0B" aria-hidden="true">#</a> <strong>\u6CE8\u518C\u6D41\u7A0B</strong></h6><p><img src="http://qnimg.gisfsde.com/work/image-20201231084909415.png" alt="image-20201231084909415" loading="lazy"></p><h6 id="\u8D26\u53F7\u5BC6\u7801\u767B\u5F55\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u8D26\u53F7\u5BC6\u7801\u767B\u5F55\u6D41\u7A0B" aria-hidden="true">#</a> <strong>\u8D26\u53F7\u5BC6\u7801\u767B\u5F55\u6D41\u7A0B\uFF1A</strong></h6><p><img src="http://qnimg.gisfsde.com/work/image-20201231012134722.png" alt="image-20201231012134722" loading="lazy"></p><h6 id="\u624B\u673A\u9A8C\u8BC1\u7801\u53D1\u9001\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u624B\u673A\u9A8C\u8BC1\u7801\u53D1\u9001\u6D41\u7A0B" aria-hidden="true">#</a> <strong>\u624B\u673A\u9A8C\u8BC1\u7801\u53D1\u9001\u6D41\u7A0B\uFF1A</strong></h6><p><img src="http://qnimg.gisfsde.com/work/image-20201231012207446.png" alt="image-20201231012207446" loading="lazy"></p><h5 id="_11-3-1-\u67E5\u770B\u5FAE\u535A\u5F00\u653E\u5E73\u53F0\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#_11-3-1-\u67E5\u770B\u5FAE\u535A\u5F00\u653E\u5E73\u53F0\u6587\u6863" aria-hidden="true">#</a> 11.3.1 \u67E5\u770B\u5FAE\u535A\u5F00\u653E\u5E73\u53F0\u6587\u6863</h5>`,48),me={href:"https://open.weibo.com/wiki/%E6%8E%88%E6%9D%83%E6%9C%BA%E5%88%B6%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"},ve=s("https://open.weibo.com/wiki/\u6388\u6743\u673A\u5236\u8BF4\u660E"),ge=p(`<p><img src="http://qnimg.gisfsde.com/work/image-20201111093019560.png" alt="image-20201111093019560" loading="lazy"></p><h5 id="_11-3-2-\u70B9\u51FB\u5FAE\u535A\u767B\u5F55\u540E-\u8DF3\u8F6C\u5230\u5FAE\u535A\u6388\u6743\u9875\u9762" tabindex="-1"><a class="header-anchor" href="#_11-3-2-\u70B9\u51FB\u5FAE\u535A\u767B\u5F55\u540E-\u8DF3\u8F6C\u5230\u5FAE\u535A\u6388\u6743\u9875\u9762" aria-hidden="true">#</a> 11.3.2 \u70B9\u51FB\u5FAE\u535A\u767B\u5F55\u540E\uFF0C\u8DF3\u8F6C\u5230\u5FAE\u535A\u6388\u6743\u9875\u9762</h5><p><img src="http://qnimg.gisfsde.com/work/image-20201111093153199.png" alt="image-20201111093153199" loading="lazy"></p><h5 id="_11-3-3-\u7528\u6237\u6388\u6743\u540E\u8C03\u7528\u56DE\u8C03\u63A5\u53E3-\u5E76\u5E26\u4E0A\u53C2\u6570code\u6362\u53D6accesstoken" tabindex="-1"><a class="header-anchor" href="#_11-3-3-\u7528\u6237\u6388\u6743\u540E\u8C03\u7528\u56DE\u8C03\u63A5\u53E3-\u5E76\u5E26\u4E0A\u53C2\u6570code\u6362\u53D6accesstoken" aria-hidden="true">#</a> 11.3.3 \u7528\u6237\u6388\u6743\u540E\u8C03\u7528\u56DE\u8C03\u63A5\u53E3\uFF0C\u5E76\u5E26\u4E0A\u53C2\u6570code\u6362\u53D6AccessToken</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * \u56DE\u8C03\u63A5\u53E3
     * <span class="token keyword">@param</span> <span class="token parameter">code</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/oauth2.0/weibo/success&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">weibo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u6839\u636Ecode\u6362\u53D6accessToken</span>
        <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;client_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1133714539&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;client_secret&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;f22eb330342e7f8797a7dbe173bd9424&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;grant_type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authorization_code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;redirect_uri&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://auth.gulimall.com/oauth2.0/weibo/success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">HttpResponse</span> response <span class="token operator">=</span> <span class="token class-name">HttpUtils</span><span class="token punctuation">.</span><span class="token function">doPost</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.weibo.com&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;/oauth2/access_token&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                map<span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u72B6\u6001\u7801\u4E3A200\u8BF7\u6C42\u6210\u529F</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getStatusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// \u83B7\u53D6\u5230\u4E86accessToken</span>
            <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token class-name">EntityUtils</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SocialUser</span> socialUser <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token class-name">SocialUser</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">memberFeignService<span class="token punctuation">.</span></span>OAuthlogin</span><span class="token punctuation">(</span>socialUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">MemberRespVo</span> data <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberRespVo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u767B\u5F55\u6210\u529F:\u7528\u6237:{}&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 2\u3001\u767B\u5F55\u6210\u529F\u8DF3\u8F6C\u5230\u9996\u9875</span>
                <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://gulimall.com&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u6CE8\u518C\u5931\u8D25</span>
                <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://auth.gulimall.com/login.html&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u8BF7\u6C42\u5931\u8D25</span>
            <span class="token comment">// \u6CE8\u518C\u5931\u8D25</span>
            <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://auth.gulimall.com/login.html&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2\u3001\u767B\u5F55\u6210\u529F\u8DF3\u8F6C\u5230\u9996\u9875</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://gulimall.com&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_11-3-4-\u62FF\u5230accesstoken-\u8BF7\u6C42\u5BF9\u5E94\u63A5\u53E3\u62FF\u5230\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_11-3-4-\u62FF\u5230accesstoken-\u8BF7\u6C42\u5BF9\u5E94\u63A5\u53E3\u62FF\u5230\u4FE1\u606F" aria-hidden="true">#</a> 11.3.4 \u62FF\u5230AccessToken \u8BF7\u6C42\u5BF9\u5E94\u63A5\u53E3\u62FF\u5230\u4FE1\u606F</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">MemberEntity</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">SocialUser</span> vo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u767B\u5F55\u548C\u6CE8\u518C\u5408\u5E76\u903B\u8F91</span>
    <span class="token class-name">String</span> uid <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MemberDao</span> memberDao <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">;</span>
    <span class="token comment">// \u6839\u636E\u793E\u4EA4\u7528\u6237\u7684uuid\u67E5\u8BE2</span>
    <span class="token class-name">MemberEntity</span> memberEntity <span class="token operator">=</span> memberDao<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;social_uid&quot;</span><span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u80FD\u67E5\u8BE2\u5230\u8BE5\u7528\u6237</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>memberEntity <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// \u66F4\u65B0\u5BF9\u5E94\u503C</span>
        <span class="token class-name">MemberEntity</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MemberEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        update<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>memberEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        update<span class="token punctuation">.</span><span class="token function">setAccessToken</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getAccess_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        update<span class="token punctuation">.</span><span class="token function">setExpiresIn</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getExpires_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        memberDao<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>

        memberEntity<span class="token punctuation">.</span><span class="token function">setAccessToken</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getAccess_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        memberEntity<span class="token punctuation">.</span><span class="token function">setExpiresIn</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getExpires_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> memberEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2\u3001\u6CA1\u6709\u67E5\u8BE2\u5230\u5F53\u524D\u793E\u4EA4\u7528\u6237\u5BF9\u5E94\u7684\u8BB0\u5F55\u5C31\u9700\u8981\u6CE8\u518C\u4E00\u4E2A</span>
        <span class="token class-name">MemberEntity</span> regist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MemberEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8BBE\u7F6E\u8BF7\u6C42\u53C2\u6570</span>
            query<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;access_token&quot;</span><span class="token punctuation">,</span>vo<span class="token punctuation">.</span><span class="token function">getAccess_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            query<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;uid&quot;</span><span class="token punctuation">,</span>vo<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u53D1\u9001get\u8BF7\u6C42\u83B7\u53D6\u793E\u4EA4\u7528\u6237\u4FE1\u606F</span>
            <span class="token class-name">HttpResponse</span> response <span class="token operator">=</span> <span class="token class-name">HttpUtils</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.weibo.com/&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;2/users/show.json&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    query<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u72B6\u6001\u7801\u4E3A200 \u8BF4\u660E\u8BF7\u6C42\u6210\u529F</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getStatusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// \u5C06\u8FD4\u56DE\u7ED3\u679C\u8F6C\u6362\u6210json</span>
                <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token class-name">EntityUtils</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u5229\u7528fastjson\u5C06\u8BF7\u6C42\u8FD4\u56DE\u7684json\u8F6C\u6362\u4E3A\u5BF9\u8C61</span>
                <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u62FF\u5230\u9700\u8981\u7684\u503C</span>
                <span class="token class-name">String</span> name <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> gender <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//.. \u62FF\u5230\u591A\u4E2A\u4FE1\u606F</span>
                regist<span class="token punctuation">.</span><span class="token function">setNickname</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                regist<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token string">&quot;m&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>gender<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u8BBE\u7F6E\u793E\u4EA4\u7528\u6237\u76F8\u5173\u4FE1\u606F</span>
        regist<span class="token punctuation">.</span><span class="token function">setSocialUid</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        regist<span class="token punctuation">.</span><span class="token function">setAccessToken</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getAccess_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        regist<span class="token punctuation">.</span><span class="token function">setExpiresIn</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getExpires_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        memberDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>regist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> regist<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-2-sso-\u5355\u70B9\u767B\u5F55" tabindex="-1"><a class="header-anchor" href="#_11-2-sso-\u5355\u70B9\u767B\u5F55" aria-hidden="true">#</a> 11.2 SSO(\u5355\u70B9\u767B\u5F55)</h3><h4 id="_1\u3001\u4EC0\u4E48\u662Fsso" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u4EC0\u4E48\u662Fsso" aria-hidden="true">#</a> 1\u3001\u4EC0\u4E48\u662FSSO</h4><p>\u5355\u70B9\u767B\u5F55(SingleSignOn\uFF0CSSO)\uFF0C\u5C31\u662F\u901A\u8FC7\u7528\u6237\u7684\u4E00\u6B21\u6027\u9274\u522B\u767B\u5F55\u3002\u5F53\u7528\u6237\u5728\u8EAB\u4EFD\u8BA4\u8BC1\u670D\u52A1\u5668\u4E0A\u767B\u5F55\u4E00\u6B21\u4EE5\u540E\uFF0C\u5373\u53EF\u83B7\u5F97\u8BBF\u95EE\u5355\u70B9\u767B\u5F55\u7CFB\u7EDF\u4E2D\u5176\u4ED6\u5173\u8054\u7CFB\u7EDF\u548C\u5E94\u7528\u8F6F\u4EF6\u7684\u6743\u9650\uFF0C\u540C\u65F6\u8FD9\u79CD\u5B9E\u73B0\u662F\u4E0D\u9700\u8981\u7BA1\u7406\u5458\u5BF9\u7528\u6237\u7684\u767B\u5F55\u72B6\u6001\u6216\u5176\u4ED6\u4FE1\u606F\u8FDB\u884C\u4FEE\u6539\u7684\uFF0C\u8FD9\u610F\u5473\u7740\u5728\u591A\u4E2A\u5E94\u7528\u7CFB\u7EDF\u4E2D\uFF0C\u7528\u6237\u53EA\u9700\u4E00\u6B21\u767B\u5F55\u5C31\u53EF\u4EE5\u8BBF\u95EE\u6240\u6709\u76F8\u4E92\u4FE1\u4EFB\u7684\u5E94\u7528\u7CFB\u7EDF\u3002\u8FD9\u79CD\u65B9\u5F0F\u51CF\u5C11\u4E86\u7531\u767B\u5F55\u4EA7\u751F\u7684\u65F6\u95F4\u6D88\u8017\uFF0C\u8F85\u52A9\u4E86\u7528\u6237\u7BA1\u7406\uFF0C\u662F\u76EE\u524D\u6BD4\u8F83\u6D41\u884C\u7684 [1]</p><h4 id="_2\u3001\u524D\u7F6E\u77E5\u8BC6" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u524D\u7F6E\u77E5\u8BC6" aria-hidden="true">#</a> 2\u3001\u524D\u7F6E\u77E5\u8BC6</h4>`,11),be={href:"https://gitee.com/xuxueli0323/xxl-sso",target:"_blank",rel:"noopener noreferrer"},he=s("https://gitee.com/xuxueli0323/xxl-sso"),ye=p('<h4 id="_3\u3001\u540C\u57DF\u4E0B\u7684\u5355\u70B9\u767B\u5F55" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u540C\u57DF\u4E0B\u7684\u5355\u70B9\u767B\u5F55" aria-hidden="true">#</a> 3\u3001\u540C\u57DF\u4E0B\u7684\u5355\u70B9\u767B\u5F55</h4><h4 id="_4\u3001\u4E0D\u540C\u57DF\u4E0B\u7684\u5355\u70B9\u767B\u5F55" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u4E0D\u540C\u57DF\u4E0B\u7684\u5355\u70B9\u767B\u5F55" aria-hidden="true">#</a> 4\u3001\u4E0D\u540C\u57DF\u4E0B\u7684\u5355\u70B9\u767B\u5F55</h4><h4 id="_5\u3001\u5355\u70B9\u767B\u5F55\u6846\u67B6-\u539F\u7406\u6F14\u793A" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u5355\u70B9\u767B\u5F55\u6846\u67B6-\u539F\u7406\u6F14\u793A" aria-hidden="true">#</a> 5\u3001\u5355\u70B9\u767B\u5F55\u6846\u67B6 &amp; \u539F\u7406\u6F14\u793A</h4><p>XXL-SSO \u662F\u4E00\u4E2A\u5206\u5E03\u5F0F\u5355\u70B9\u767B\u5F55\u6846\u67B6\u3002\u53EA\u9700\u8981\u767B\u5F55\u4E00\u6B21\u5C31\u53EF\u4EE5\u8BBF\u95EE\u6240\u6709\u76F8\u4E92\u4FE1\u4EFB\u7684\u5E94\u7528\u7CFB\u7EDF\u3002 \u62E5\u6709&quot;\u8F7B\u91CF\u7EA7\u3001\u5206\u5E03\u5F0F\u3001\u8DE8\u57DF\u3001Cookie+Token\u5747\u652F\u6301\u3001Web+APP\u5747\u652F\u6301&quot;\u7B49\u7279\u6027\u3002\u73B0\u5DF2\u5F00\u653E\u6E90\u4EE3\u7801\uFF0C\u5F00\u7BB1\u5373\u7528\u3002</p><p>\u9996\u5148\u5BF9\u6574\u4E2A\u9879\u76EE\u8FDB\u884C\uFF1Amvn clean package -Dmaven.skip.test=true</p><p>xxl-sso-server:</p>',6),fe=n("li",null,[n("p",null,"8080/xxl-sso-server")],-1),qe=n("p",null,"\u7F16\u6392\uFF1A",-1),we={href:"http://ssoserver.com",target:"_blank",rel:"noopener noreferrer"},_e=s("ssoserver.com"),Se=s(" \u767B\u9646\u9A8C\u8BC1\u670D\u52A1\u5668"),xe={href:"http://client1.com",target:"_blank",rel:"noopener noreferrer"},Ee=s("client1.com"),Ie=s(" \u5BA2\u6237\u7AEF1"),Ce={href:"http://client2.com",target:"_blank",rel:"noopener noreferrer"},Ae=s("client2.com"),je=s(" \u5BA2\u6237\u7AEF2"),Re=p(`<p>\u5148\u542F\u52A8xxl-sso-server \u7136\u540E\u542F\u52A8client1</p><p>\u53EA\u8981 <code>client1</code> \u767B\u5F55\u6210\u529F <code>client2</code> \u5C31\u4E0D\u7528\u8FDB\u884C\u767B\u5F55\u76F4\u63A5\u767B\u5F55\u6210\u529F</p><p>\u4EE3\u7801\u6D4B\u8BD5:</p><p>sso-client</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-12
 */</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${sso.server.url}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> ssoServerUrl<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u65E0\u9700\u767B\u5F55\u5C31\u53EF\u4EE5\u8BBF\u95EE
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u9700\u8981\u9A8C\u8BC1\u7684\u8FDE\u63A5
     * <span class="token keyword">@param</span> <span class="token parameter">model</span>
     * <span class="token keyword">@param</span> <span class="token parameter">token</span> \u53EA\u8981\u662Fssoserver\u767B\u9646\u6210\u529F\u56DE\u6765\u5C31\u4F1A\u5E26\u4E0A
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/employees&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">employees</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span>
                            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u53BBssoserver\u767B\u5F55\u6210\u529F\u8C03\u56DE\u6765\u5C31\u4F1A\u5E26\u4E0A</span>
            <span class="token comment">//TODO 1\u3001\u53BBssoserver\u83B7\u53D6\u5F53\u524Dtoken\u771F\u6B63\u5BF9\u5E94\u7684\u7528\u6237\u4FE1\u606F</span>
            <span class="token class-name">RestTemplate</span> restTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u4F7F\u7528restTemplate\u8FDB\u884C\u8FDC\u7A0B\u8BF7\u6C42</span>
            <span class="token class-name">ResponseEntity</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> forEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span><span class="token string">&quot;http://ssoserver.com:8080/userInfo?token=&quot;</span> <span class="token operator">+</span> token<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u62FF\u5230\u6570\u636E</span>
            <span class="token class-name">String</span> body <span class="token operator">=</span> forEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8BBE\u7F6E\u5230session\u4E2D</span>
            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;loginUser&quot;</span><span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Object</span> loginUser <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;loginUser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>loginUser <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// \u6CA1\u6709\u767B\u5F55\u91CD\u5B9A\u5411\u5230\u767B\u9646\u9875\u9762\uFF0C\u5E76\u5E26\u4E0A\u5F53\u524D\u5730\u5740</span>
            <span class="token keyword">return</span> <span class="token string">&quot;redirect:&quot;</span> <span class="token operator">+</span> ssoServerUrl <span class="token operator">+</span> <span class="token string">&quot;?redirect_url=http://client1.com:8081/employees&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> emps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            emps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            emps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;\u674E\u56DB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;emps&quot;</span><span class="token punctuation">,</span>emps<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>sso-server</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-12
 */</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u6839\u636Etoken\u4ECEredis\u4E2D\u67E5\u8BE2\u7528\u6237\u4FE1\u606F
     * <span class="token keyword">@param</span> <span class="token parameter">token</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/userInfo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;login.html&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;redirect_url&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;sso_token&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token class-name">String</span> sso_token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>sso_token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u8BF4\u660E\u6709\u4EBA\u4E4B\u524D\u767B\u5F55\u8FC7\uFF0C\u7ED9\u6D4F\u89C8\u5668\u7559\u4E0B\u4E86\u75D5\u8FF9</span>
            <span class="token keyword">return</span> <span class="token string">&quot;redirect:&quot;</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">&quot;?token=&quot;</span> <span class="token operator">+</span> sso_token<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u6DFB\u52A0url\u5230model\u5730\u5740\u4E2D\uFF0C\u5728\u524D\u7AEF\u9875\u9762\u8FDB\u884C\u53D6\u51FA</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u767B\u5F55
     * <span class="token keyword">@param</span> <span class="token parameter">username</span>
     * <span class="token keyword">@param</span> <span class="token parameter">password</span>
     * <span class="token keyword">@param</span> <span class="token parameter">url</span> client\u7AEF\u5E26\u8FC7\u6765\u7684\u5730\u5740
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/doLogin&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doLogin</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span>
                          <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// \u8D26\u53F7\u5BC6\u7801\u4E0D\u4E3A\u7A7A </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u767B\u9646\u6210\u529F</span>
            <span class="token comment">// \u628A\u767B\u5F55\u6210\u529F\u7684\u7528\u6237\u5B58\u8D77\u6765</span>
            <span class="token class-name">String</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>uuid<span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u5C06uuid\u5B58\u5165cookie</span>
            <span class="token class-name">Cookie</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">&quot;sso_token&quot;</span><span class="token punctuation">,</span>uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u4FDD\u5B58\u5230cookie</span>
            <span class="token keyword">return</span> <span class="token string">&quot;redirect:&quot;</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">&quot;?token=&quot;</span> <span class="token operator">+</span> uuid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u767B\u5F55\u5931\u8D25\uFF0C\u5C55\u793A\u767B\u5F55\u9875</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6\u3001\u4F7F\u7528-jwt" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u4F7F\u7528-jwt" aria-hidden="true">#</a> 6\u3001\u4F7F\u7528 jwt</h4><h3 id="_11-3-jwt" tabindex="-1"><a class="header-anchor" href="#_11-3-jwt" aria-hidden="true">#</a> 11.3 JWT</h3><h1 id="_12\u3001\u8D2D\u7269\u8F66" tabindex="-1"><a class="header-anchor" href="#_12\u3001\u8D2D\u7269\u8F66" aria-hidden="true">#</a> 12\u3001\u8D2D\u7269\u8F66</h1><h3 id="_12-1-\u8D2D\u7269\u8F66\u9700\u6C42" tabindex="-1"><a class="header-anchor" href="#_12-1-\u8D2D\u7269\u8F66\u9700\u6C42" aria-hidden="true">#</a> 12.1 \u8D2D\u7269\u8F66\u9700\u6C42</h3><h4 id="_1\u3001\u9700\u6C42\u63CF\u8FF0" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u9700\u6C42\u63CF\u8FF0" aria-hidden="true">#</a> 1\u3001\u9700\u6C42\u63CF\u8FF0\uFF1A</h4><p>\u7528\u6237\u53EF\u4EE5\u5728<strong>\u767B\u5F55\u72B6\u6001</strong>\u4E0B\u5C06\u5546\u54C1\u6DFB\u52A0\u5230\u8D2D\u7269\u8F66**\u3010\u767B\u5F55\u8D2D\u7269\u8F66/\u5728\u7EBF\u8D2D\u7269\u8F66\u3011**</p><p>\u653E\u5165\u6570\u636E\u5E93</p><p>mongodb</p><p><strong>\u653E\u5165 redis\uFF08\u91C7\u7528\uFF09</strong></p><p>\u7528\u6237\u53EF\u4EE5\u5728<strong>\u672A\u767B\u5F55\u72B6\u6001</strong>\u4E0B\u5C06\u5546\u54C1\u6DFB\u52A0\u5230\u8D2D\u7269\u8F66**\u3010\u6E38\u5BA2\u8D2D\u7269\u8F66/\u79BB\u7EBF\u8D2D\u7269\u8F66\u3011**</p><p>\u653E\u5165 localstorage</p><p>cookie</p><p>WebSQL</p><p><strong>\u653E\u5165 redis (\u91C7\u7528)</strong></p><p>\u7528\u6237\u53EF\u4EE5\u4F7F\u7528\u8D2D\u7269\u8F66\u4E00\u8D77\u7ED3\u7B97\u4E0B\u5355</p><p>\u7528\u6237\u53EF\u4EE5<strong>\u67E5\u8BE2\u81EA\u5DF1\u7684\u8D2D\u7269\u8F66</strong></p><p>\u7528\u6237\u53EF\u4EE5\u5728<strong>\u8D2D\u7269\u4E2D\u4FEE\u6539\u8D2D\u4E70\u5546\u54C1\u7684\u6570\u91CF</strong></p><p>\u7528\u6237\u53EF\u4EE5\u5728<strong>\u8D2D\u7269\u8F66\u4E2D\u5220\u9664\u5546\u54C1</strong></p><p><strong>\u9009\u4E2D\u4E0D\u9009\u4E2D\u5546\u54C1</strong></p><p>\u5728\u8D2D\u7269\u8F66\u4E2D<strong>\u5C55\u793A\u5546\u54C1\u4F18\u60E0\u4FE1\u606F</strong></p><p>\u63D0\u793A\u8D2D\u7269\u8F66\u5546\u54C1\u4EF7\u683C\u53D8\u5316</p><p>\u8D2D\u7269\u8F66\u6570\u636E\u7ED3\u6784</p><p><img src="http://qnimg.gisfsde.com/work/image-20201113110938713.png" alt="image-20201113110938713" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201115154652394.png" alt="image-20201115154652394" loading="lazy"></p><p>\u6BCF\u4E00\u4E2A\u8D2D\u7269\u9879\u4FE1\u606F\uFF0C\u90FD\u662F\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u57FA\u672C\u5B57\u6BB5\u5305\u62EC</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>skuId<span class="token operator">:</span><span class="token number">123123</span><span class="token punctuation">,</span> <span class="token comment">// \u5546\u54C1id</span>
check<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// \u662F\u5426\u9009\u4E2D</span>
title<span class="token operator">:</span><span class="token string">&quot;apple phone&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5546\u54C1\u6807\u9898</span>
defaultImage<span class="token operator">:</span>&#39;&#39;<span class="token punctuation">,</span> <span class="token comment">// \u5546\u54C1\u9ED8\u8BA4\u663E\u793A\u7684\u56FE\u7247</span>
price<span class="token operator">:</span><span class="token number">4999</span><span class="token punctuation">,</span> <span class="token comment">// \u5546\u54C1\u4EF7\u683C</span>
count<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// \u5546\u54C1\u6570\u91CF</span>
totalPrice<span class="token operator">:</span><span class="token number">4999</span> <span class="token comment">// \u8D2D\u7269\u8F66\u4E2D\u9009\u4E2D\u5546\u54C1\u603B\u4EF7\u683C</span>
skuSaleVo<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// \u3002\u3002\u3002\u3002</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53E6\u5916\uFF0C\u8D2D\u7269\u8F66\u4E2D\u4E0D\u6B62\u4E00\u6761\u6570\u636E\uFF0C\u56E0\u6B64\u6700\u7EC8\u4F1A\u662F\u5BF9\u8C61\u7684\u6570\u7EC4</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{...},{....},{....}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Redis\u67095\u79CD\u4E0D\u540C\u6570\u636E\u7ED3\u6784\uFF0C\u8FD9\u91CC\u9009\u62E9\u54EA\u4E00\u79CD \u6BD4\u8F83\u5408\u9002\u5462? Map&lt;String, List&lt;String&gt;&gt; \u9996\u5148<strong>\u4E0D\u540C\u7528\u6237\u5E94\u8BE5\u6709\u72EC\u7ACB\u7684\u8D2D\u7269\u8F66</strong>\u3002</p><p>\u56E0\u6B64\u8D2D\u7269\u8F66\u5E94\u8BE5\u4EE5\u7528\u6237\u7684\u4F5C\u4E3Akey\u6765\u5B58\u50A8\uFF0C<strong>Value\u662F\u7528\u6237\u7684\u6240\u6709\u8D2D\u7269\u8F66\u4FE1\u606F</strong>\u3002\u8FD9\u6837\u770B\u6765\u57FA\u672C\u7684 k-v \u7ED3\u6784\u5C31\u53EF\u4EE5\u4E86\u3002</p><p>\u4F46\u662F\uFF0C\u6211\u4EEC\u5BF9\u8D2D\u7269\u8F66\u4E2D\u7684\u5546\u54C1\u8FDB\u884C\u589E\u3001\u5220\u3001\u6539\u64CD\u4F5C\uFF0C<strong>\u57FA\u672C\u90FD\u9700\u8981\u6839\u636E\u5546\u54C1id\u8FDB\u884C\u5224\u65AD</strong>\uFF0C\u4E3A\u4E86\u65B9\u4FBF\u540E\u671F\u5904\u7406\uFF0C\u6211\u4EEC\u7684\u8D2D\u7269\u8F66\u4E5F\u5E94\u8BE5\u662F k-v \u7ED3\u6784\uFF0C<strong>key \u662F\u5546\u54C1 id, value \u624D\u662F\u8FD9\u4E2A\u5546\u54C1\u7684\u8D2D\u7269\u8F66\u4FE1\u606F\u3002</strong></p><p>\u7EFC\u4E0A\u6240\u8FF0\uFF0C\u6211\u4EEC\u7684\u8D2D\u7269\u8F66\u7ED3\u6784\u662F\u4E00\u4E00\u4E2A<strong>\u53CC\u5C42Map: Map&lt;String,Map&lt;String,String&gt;&gt;</strong>\uFF0C\u5728redis\u4E2D\u7C7B\u578B\u4E3A hash</p><p><strong>\u5916\u5934key\u5C31\u662F\u7528\u6237\u7684id,\u91CC\u9762\u7684key\u5C31\u662Fskuid</strong></p><p>redis\u4E2D\uFF1A</p><p>\u65B0\u589E\u5546\u54C1\uFF1Ahset gulimall:cart:7 <strong>(key)334488[\u5546\u54C1skuid] (value)\u5546\u54C1\u7684\u4FE1\u606F</strong></p><p>\u589E\u52A0\u5546\u54C1\u6570\u91CF\uFF1Ahincrby shopcar:uuid1024 334477 1</p><p>\u5546\u54C1\u603B\u6570\uFF1Ahlen shopcar:uuid</p><p>\u5168\u90E8\u9009\u62E9\uFF1Ahgetall shopcar:uuid1024</p><p><img src="http://qnimg.gisfsde.com/work/image-20201115155054434.png" alt="image-20201115155054434" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20210102202926973.png" alt="image-20210102202926973" loading="lazy"></p><h3 id="_12-2-vo\u7F16\u5199-threadlocal\u8EAB\u4EFD\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_12-2-vo\u7F16\u5199-threadlocal\u8EAB\u4EFD\u9A8C\u8BC1" aria-hidden="true">#</a> 12.2 Vo\u7F16\u5199 &amp; ThreadLocal\u8EAB\u4EFD\u9A8C\u8BC1</h3><h4 id="_12-2-1-vo-\u7F16\u5199" tabindex="-1"><a class="header-anchor" href="#_12-2-1-vo-\u7F16\u5199" aria-hidden="true">#</a> 12.2.1 Vo \u7F16\u5199</h4><p>\u8D2D\u7269\u8F66</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * \u6574\u4E2A\u8D2D\u7269\u8F66
 * \u9700\u8981\u8BA1\u7B97\u7684\u5C5E\u6027\uFF0C\u5FC5\u987B\u91CD\u5199\u4ED6\u7684get\u65B9\u6CD5\uFF0C\u4FDD\u8BC1\u6BCF\u6B21\u83B7\u53D6\u5C5E\u6027\u90FD\u4F1A\u8FDB\u884C\u8BA1\u7B97
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-13
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cart</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u9879
     */</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u6570\u91CF
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> countNum<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7C7B\u578B\u6570\u91CF
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> countType<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u603B\u4EF7
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> totalAmount<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     *  \u51CF\u514D\u4EF7\u683C
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> reduce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getCountType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>items <span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> items<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CartItem</span> item <span class="token operator">:</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                count<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BigDecimal</span> amount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1\u3001\u8BA1\u7B97\u8D2D\u7269\u9879\u603B\u4EF7</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>items <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> items<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CartItem</span> item <span class="token operator">:</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u62FF\u5230\u8D2D\u7269\u8F66\u4E2D\u5355\u4E2A\u5546\u54C1\u7684\u603B\u91D1\u989D</span>
                <span class="token class-name">BigDecimal</span> totalPrice <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u6DFB\u52A0\u5230\u8D2D\u7269\u603B\u4EF7\u4E2D</span>
                amount <span class="token operator">=</span> amount<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>totalPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2\u3001\u51CF\u53BB\u4F18\u60E0\u603B\u4EF7</span>
        <span class="token class-name">BigDecimal</span> subtract <span class="token operator">=</span> amount<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span><span class="token function">getReduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> subtract<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8D2D\u7269\u8F66\u4E2D\u7684\u5B9E\u4F53</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u8D2D\u7269\u9879
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-13
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CartItem</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u5546\u54C1id
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u8D2D\u7269\u8F66\u4E2D\u662F\u5426\u9009\u4E2D
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> check <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7684\u6807\u9898
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7684\u56FE\u7247
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> image<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7684\u5C5E\u6027
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> skuAttr<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7684\u4EF7\u683C
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> price<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7684\u6570\u91CF
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u8D2D\u7269\u8F66\u4EF7\u683C \u4F7F\u7528\u81EA\u5B9A\u4E49get\u3001set
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> totalPrice<span class="token punctuation">;</span>
     <span class="token doc-comment comment">/**
     *  \u8BA1\u7B97\u8D2D\u7269\u9879\u4EF7\u683C
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">getTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u4EF7\u683C\u4E58\u4EE5\u6570\u91CF</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_12-2-3-threadlocal-\u8EAB\u4EFD\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_12-2-3-threadlocal-\u8EAB\u4EFD\u9A8C\u8BC1" aria-hidden="true">#</a> 12.2.3 ThreadLocal \u8EAB\u4EFD\u9A8C\u8BC1</h4><p>\u9700\u6C42\u5206\u6790\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * \u6D4F\u89C8\u5668\u6709\u4E00\u4E2Acookie\uFF1Auser-key,\u6807\u8BC6\u7528\u6237\u8EAB\u4EFD\uFF0C\u4E00\u4E2A\u6708\u540E\u8FC7\u671F
     * \u5982\u679C\u7B2C\u4E00\u6B21\u4F7F\u7528jd\u7684\u8D2D\u7269\u8F66\u529F\u80FD\uFF0C\u90FD\u4F1A\u7ED9\u4E00\u4E2A\u4E34\u65F6\u7684\u7528\u6237\u8EAB\u4EFD
     * \u6D4F\u89C8\u5668\u4EE5\u540E\u4FDD\u5B58\uFF0C\u6BCF\u6B21\u8BBF\u95EE\u90FD\u4F1A\u5E26\u4E0A\u8FD9\u4E2Acookie
     *
     * \u767B\u5F55 session \u6709
     * \u6CA1\u767B\u5F55\uFF0C\u6309\u7167cookie\u4E2D\u7684user-key\u6765\u505A
     * \u7B2C\u4E00\u6B21\uFF1A\u5982\u679C\u6CA1\u6709\u4E34\u65F6\u7528\u6237\uFF0C\u5E2E\u5FD9\u521B\u5EFA\u4E00\u4E2A\u4E34\u65F6\u7528\u6237 --&gt; \u4F7F\u7528\u62E6\u622A\u5668
     * <span class="token keyword">@return</span> 
     */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">*</span><span class="token operator">*</span>
 <span class="token operator">*</span> \u5728\u6267\u884C\u76EE\u6807\u65B9\u6CD5\u4E4B\u524D<span class="token punctuation">,</span>\u5224\u65AD\u7528\u6237\u7684\u767B\u5F55\u72B6\u6001\uFF0C\u5E76\u5C01\u88C5\u7ED9<span class="token class-name">Controller</span>\u76EE\u6807\u8BF7\u6C42
 <span class="token operator">*</span> <span class="token annotation punctuation">@author</span> gcq
 <span class="token operator">*</span> <span class="token annotation punctuation">@Create</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">13</span>
 <span class="token operator">*</span><span class="token operator">/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CartInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> threadLocal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u76EE\u6807\u65B9\u6CD5\u6267\u884C\u4E4B\u524D
     * <span class="token keyword">@param</span> <span class="token parameter">request</span>
     * <span class="token keyword">@param</span> <span class="token parameter">response</span>
     * <span class="token keyword">@param</span> <span class="token parameter">handler</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u62FF\u5230session</span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u67E5\u770Bsession\u4E2D\u662F\u5426\u4FDD\u5B58\u4E86\u7528\u6237\u7684\u503C</span>
        <span class="token class-name">MemberRespVo</span> member <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MemberRespVo</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">AuthServerConstant</span><span class="token punctuation">.</span>LOGIN_USER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>member <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u7528\u6237\u767B\u5F55</span>
            userInfo<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>member<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Cookie</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cookies <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cookies <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> cookies<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cookie</span> cookie <span class="token operator">:</span> cookies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> name <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u62FF\u5230cookie\u540D\u5B57\u8FDB\u884C\u5224\u65AD\u5982\u679C\u5305\u542B user-key \u5C31\u590D\u5236\u5230userInfo\u4E2D</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">CartConstant</span><span class="token punctuation">.</span>TEMP_USER_COOKIE_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    userInfo<span class="token punctuation">.</span><span class="token function">setUserKey</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    userInfo<span class="token punctuation">.</span><span class="token function">setTempUser</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u5982\u679C\u6CA1\u6709\u4E34\u65F6\u7528\u6237\u4E00\u5B9A\u8981\u5206\u914D\u4E00\u4E2A\u4E34\u65F6\u7528\u6237</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getUserKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfo<span class="token punctuation">.</span><span class="token function">setUserKey</span><span class="token punctuation">(</span>uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u5168\u90E8\u653E\u884C</span>
        threadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u4E1A\u52A1\u6267\u884C\u4E4B\u540E,\u5206\u914D\u4E34\u65F6\u7528\u6237\uFF0C\u8BA9\u6D4F\u89C8\u5668\u4FDD\u5B58
     * <span class="token keyword">@param</span> <span class="token parameter">request</span>
     * <span class="token keyword">@param</span> <span class="token parameter">response</span>
     * <span class="token keyword">@param</span> <span class="token parameter">handler</span>
     * <span class="token keyword">@param</span> <span class="token parameter">modelAndView</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u62FF\u5230\u7528\u6237\u4FE1\u606F</span>
        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5982\u679C\u6CA1\u6709\u4E34\u65F6\u7528\u6237\u4E00\u5B9A\u8981\u4FDD\u5B58\u4E00\u4E2A\u4E34\u65F6\u7528\u6237</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>userInfo<span class="token punctuation">.</span><span class="token function">isTempUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u6301\u7EED\u7684\u5EF6\u957F\u4E34\u65F6\u7528\u6237\u7684\u8FC7\u671F\u65F6\u95F4</span>
            <span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token class-name">CartConstant</span><span class="token punctuation">.</span>TEMP_USER_COOKIE_NAME<span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span><span class="token function">getUserKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cookie<span class="token punctuation">.</span><span class="token function">setDomain</span><span class="token punctuation">(</span><span class="token string">&quot;gulimall.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cookie<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token class-name">CartConstant</span><span class="token punctuation">.</span>TEMP_USER_COOKIE_TIMEOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-3-\u6DFB\u52A0\u8D2D\u7269\u8F66" tabindex="-1"><a class="header-anchor" href="#_12-3-\u6DFB\u52A0\u8D2D\u7269\u8F66" aria-hidden="true">#</a> 12.3 \u6DFB\u52A0\u8D2D\u7269\u8F66</h3><p>\u5728\u9875\u9762\u70B9\u51FB\u52A0\u5165\u8D2D\u7269\u8F66\u540E\u5C06\u5546\u54C1\u6DFB\u52A0\u8FDB\u8D2D\u7269\u8F66</p><p><img src="http://qnimg.gisfsde.com/work/image-20201115155956396.png" alt="image-20201115155956396" loading="lazy"></p><p>\u9700\u6C42\u5206\u6790\uFF1A</p><p>\u9996\u5148\u9700\u8981\u5728\u9875\u9762\u62FF\u5230\u8981\u63D0\u4EA4\u7684\u53C2\u6570\uFF0Cskuid\uFF0C\u8D2D\u4E70\u6570\u91CF\uFF0C\u5E76\u63D0\u4EA4\u540E\u53F0\u5B8C\u6210\u8D2D\u7269\u8F66\u6570\u636E\u6DFB\u52A0</p><p>\u540E\u7AEF\u5982\u4F55\u5904\u7406\u8FD9\u4E2A\u6570\u636E\uFF1F</p><ol><li><strong>\u901A\u8FC7 <code>skuid</code> \u8FDC\u7A0B\u67E5\u8BE2\u8FD9\u4E2A\u5546\u54C1\u7684\u4FE1\u606F</strong></li><li><strong>\u8FDC\u7A0B\u67E5\u8BE2sku\u7EC4\u5408\u7684\u4FE1\u606F</strong></li><li><strong>\u5982\u679C\u8D2D\u7269\u8F66\u4E2D\u5DF2\u7ECF\u6709\u8BE5\u6570\u636E\u5982\u4F55\u8FDB\u884C\u63D0\u4EA4</strong>\uFF1F <ol><li><strong>\u5982\u679C\u6709\u8BE5\u6570\u636E\uFF0C\u90A3\u4E48\u5C31\u884C\u66F4\u6539</strong>\uFF0C\u6839\u636E skuid \u4ECE reids \u4E2D\u53D6\u51FA\u6570\u636E</li><li>\u5C06\u6570\u636E\u8F6C\u6362\u6210\u5BF9\u8C61\u7136\u540E\u52A0\u4E0A\u5BF9\u5E94\u7684\u6570\u91CF\uFF0C<strong>\u518D\u6B21\u8F6C\u6362\u4E3Ajson\u5B58\u5165redis</strong></li></ol></li><li><strong>\u524D\u7AEF\u9875\u9762\u9891\u7E41\u6DFB\u52A0\u8D2D\u7269\u8F66\u5982\u4F55\u89E3\u51B3\uFF1F</strong><ol><li>\u8BF7\u6C42\u53D1\u9001\u8FC7\u6765\u540E\u6211\u4EEC<strong>\u91CD\u5B9A\u5411\u5230\u5176\u4ED6\u7684\u9875\u9762\u7528\u6765\u663E\u793A\u6570\u636E</strong>\uFF0C\u8FD9\u65F6\u5019\u7528\u6237\u5237\u65B0\u7684\u8BDD\u4E5F\u662F\u5728\u5176\u4ED6\u9875\u9762\u8FDB\u884C\u5237\u65B0</li></ol></li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token doc-comment comment">/**
     * \u52A0\u5165\u5230\u8D2D\u7269\u8F66
     */</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#addToCartA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8D2D\u4E70\u7684\u6570\u91CF</span>
        <span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#numInput&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// skuid</span>
        <span class="token keyword">var</span> skuid <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">&quot;http://cart.gulimall.com/addToCart?skuId=&quot;</span> <span class="token operator">+</span> skuid <span class="token operator">+</span> <span class="token string">&quot;&amp;num=&quot;</span> <span class="token operator">+</span> num<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BF7\u6C42\u53D1\u9001\u5230Controller\u540E</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/addToCart&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> num<span class="token punctuation">,</span>
                        <span class="token class-name">RedirectAttributes</span>  res<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

    cartService<span class="token punctuation">.</span><span class="token function">addToCart</span><span class="token punctuation">(</span>skuId<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5C06\u6570\u636E\u62FC\u63A5\u5230url\u540E\u9762</span>
    res<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">,</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u91CD\u5B9A\u5411\u5230\u5BF9\u5E94\u7684\u5730\u5740</span>
    <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://cart.gulimall.com/addToCartSuccess.html&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * \u7ED9\u8D2D\u7269\u8F66\u91CC\u9762\u6DFB\u52A0\u5546\u54C1
     * <span class="token keyword">@param</span> <span class="token parameter">skuId</span> \u5546\u54C1id
     * <span class="token keyword">@param</span> <span class="token parameter">num</span> \u6570\u91CF
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">ExecutionException</span></span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">InterruptedException</span></span>
     * \u5982\u679C\u8FDC\u7A0B\u67E5\u8BE2\u6BD4\u8F83\u6162\uFF0C\u6BD4\u5982\u65B9\u6CD5\u5F53\u4E2D\u6709\u597D\u51E0\u4E2A\u8FDC\u7A0B\u67E5\u8BE2\uFF0C\u90FD\u8981\u597D\u51E0\u79D2\u4EE5\u4E0A\uFF0C\u7B49\u6574\u4E2A\u65B9\u6CD5\u8FD4\u56DE\u5C31\u9700\u8981\u5F88\u4E45\uFF0C\u8FD9\u5757\u4F60\u662F\u600E\u4E48\u5904\u7406\u7684?
     *  1\u3001\u4E3A\u4E86\u63D0\u4EA4\u8FDC\u7A0B\u67E5\u8BE2\u7684\u6548\u7387\uFF0C\u53EF\u4EE5\u4F7F\u7528\u7EBF\u7A0B\u6C60\u7684\u65B9\u5F0F\uFF0C\u5F02\u6B65\u8FDB\u884C\u8BF7\u6C42
     *  2\u3001\u8981\u505A\u7684\u64CD\u4F5C\u5C31\u662F\u5C06\u6240\u6709\u7684\u7EBF\u7A0B\u5168\u90E8\u653E\u5230\u81EA\u5DF1\u624B\u5199\u7684\u7EBF\u7A0B\u6C60\u91CC\u9762
     *  3\u3001\u6BCF\u4E00\u4E2A\u670D\u52A1\u90FD\u9700\u8981\u914D\u7F6E\u4E00\u4E2A\u81EA\u5DF1\u7684\u7EBF\u7A0B\u6C60
     *  4\u3001\u5B8C\u5168\u4F7F\u7528\u7EBF\u7A0B\u6C60\u6765\u63A7\u5236\u6240\u6709\u7684\u8BF7\u6C42
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> num<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u83B7\u53D6\u5230\u8981\u64CD\u4F5C\u7684\u8D2D\u7269\u8F66</span>
        <span class="token class-name">BoundHashOperations</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> cartOps <span class="token operator">=</span> <span class="token function">getCartOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1\u3001\u5982\u679C\u8D2D\u7269\u8F66\u4E2D\u5DF2\u6709\u8BE5\u5546\u54C1\u90A3\u4E48\u9700\u8981\u505A\u7684\u5C31\u662F\u4FEE\u6539\u5546\u54C1\u7684\u6570\u91CF\uFF0C\u5982\u679C\u6CA1\u6709\u8BE5\u5546\u54C1\u9700\u8981\u8FDB\u884C\u6DFB\u52A0\u8BE5\u5546\u54C1\u5230\u8D2D\u7269\u8F66\u4E2D</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> cartOps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>skuId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5546\u54C1id\u4F5C\u4E3A\u952E\uFF0C\u5148\u53BBRedis\u91CC\u9762\u67E5\u770B\u6709\u6CA1\u6709\u8FD9\u4E2A\u76F8\u540C\u7684\u5546\u54C1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u5982\u679C\u8FD4\u56DE\u4E3A\u7A7A\uFF0C\u90A3\u4E48\u8BF4\u660E\u8D2D\u7269\u8F66\u4E2D\u6CA1\u6709\u8FD9\u4E2A\u5546\u54C1\uFF0C\u90A3\u5C31\u8981\u6267\u884C\u6DFB\u52A0</span>
            <span class="token comment">// 2\u3001\u6DFB\u52A0\u5546\u54C1\u5230\u8D2D\u7269\u8F66</span>
            <span class="token comment">// \u7B2C\u4E00\u4E2A\u5F02\u6B65\u4EFB\u52A1,\u67E5\u8BE2\u5F53\u524D\u5546\u54C1\u4FE1\u606F</span>
            <span class="token class-name">CartItem</span> cartItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CartItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8D2D\u7269\u8F66\u4E2D\u6BCF\u4E00\u4E2A\u90FD\u662F\u4E00\u4E2A\u8D2D\u7269\u9879\uFF0C\u5C01\u88C5\u8D2D\u7269\u8F66\u7684\u5185\u5BB9</span>
            <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> completableFutureSkuInfo <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// 2.1\u3001\u8FDC\u7A0B\u67E5\u8BE2\u51FA\u5F53\u524D\u8981\u6DFB\u52A0\u7684\u5546\u54C1\u4FE1\u606F</span>
                <span class="token comment">// \u6DFB\u52A0\u54EA\u4E2A\u5546\u54C1\u5230\u8D2D\u7269\u8F66\uFF0C\u5148\u67E5\u8BE2\u5230\u8FD9\u4E2A\u5546\u54C1\u7684\u4FE1\u606F</span>
                <span class="token class-name">R</span> r <span class="token operator">=</span> productFeignService<span class="token punctuation">.</span><span class="token function">getSkuInfo</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u83B7\u53D6\u8FDC\u7A0B\u8FD4\u56DE\u7684\u6570\u636E\uFF0C\u8FDC\u7A0B\u6570\u636E\u90FD\u5C01\u88C5\u5728skuInfo\u4E2D</span>
                <span class="token class-name">SkuInfoVo</span> skuInfo <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;skuInfo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoVo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cartItem<span class="token punctuation">.</span><span class="token function">setCheck</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6DFB\u52A0\u5546\u54C1\u5230\u8D2D\u7269\u8F66\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u5546\u54C1\u4E00\u5B9A\u662F\u9009\u4E2D\u7684</span>
                cartItem<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuInfo<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u67E5\u8BE2\u7684\u662F\u54EA\u4E2A\u5546\u54C1\u7684id\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u5546\u54C1id\u5C31\u662F\u54EA\u4E2A</span>
                cartItem<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span>skuInfo<span class="token punctuation">.</span><span class="token function">getSkuDefaultImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5F53\u524D\u5546\u54C1\u7684\u56FE\u7247\u4FE1\u606F</span>
                cartItem<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>skuInfo<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5F53\u524D\u5546\u54C1\u7684\u4EF7\u683C</span>
                cartItem<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>skuInfo<span class="token punctuation">.</span><span class="token function">getSkuTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5F53\u524D\u5546\u54C1\u7684\u6807\u9898</span>
                cartItem<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5F53\u524D\u5546\u54C1\u6DFB\u52A0\u7684\u6570\u91CF</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 3\u3001\u7B2C\u4E8C\u4E2A\u5F02\u6B65\u4EFB\u52A1\uFF0C\u8FDC\u7A0B\u67E5\u8BE2sku\u7EC4\u5408\u4FE1\u606F</span>
            <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> completableFutureSkuAttr <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> skuSaleAttrValues <span class="token operator">=</span> productFeignService<span class="token punctuation">.</span><span class="token function">getSkuSaleAttrValues</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6839\u636Eskuid\u6765\u67E5</span>
                cartItem<span class="token punctuation">.</span><span class="token function">setSkuAttr</span><span class="token punctuation">(</span>skuSaleAttrValues<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8FDC\u7A0B\u67E5\u8BE2\u51FA\u6765\u5230sku\u7EC4\u5408\u4FE1\u606F\uFF0C\u9700\u8981\u5728\u8D2D\u7269\u8F66\u4E2D\u8FDB\u884C\u663E\u793A</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 4\u3001\u4E24\u4E2A\u5F02\u6B65\u4EFB\u52A1\u90FD\u5B8C\u6210\uFF0C\u624D\u80FD\u628A\u6570\u636E\u653E\u5230redis\u4E2D</span>
            <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>completableFutureSkuInfo<span class="token punctuation">,</span>completableFutureSkuAttr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u628A\u8D2D\u7269\u9879\u7684\u6570\u636E\u4FDD\u5B58redis\u4E2D</span>
            <span class="token class-name">String</span> cartItemJson <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
            cartOps<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>skuId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cartItemJson<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6DFB\u52A0\u5546\u54C1\u5230\u8D2D\u7269\u8F66\u4E2D</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5982\u679C\u8D2D\u7269\u8F66\u4E2D\u6709\u8FD9\u4E2A\u5546\u54C1\uFF0C\u90A3\u4E48\u9700\u8981\u505A\u7684\u5C31\u662F\u5C06\u5546\u54C1\u7684\u6570\u91CF\u8FDB\u884C\u66F4\u6539,\u4E5F\u5373\u662F\u65B0\u6DFB\u52A0\u7684\u5546\u54C1\u6570\u91CF\u52A0\u4E0A\u5F53\u524D\u8D2D\u7269\u8F66\u4E2D\u5546\u54C1\u6570\u91CF</span>
            <span class="token class-name">CartItem</span> cartItem <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token class-name">CartItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cartItem<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> cartItemJson <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u66F4\u65B0redis</span>
            cartOps<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>skuId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cartItemJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u89E3\u51B3\u5237\u65B0\u95EE\u9898</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u8DF3\u8F6C\u5230\u6210\u529F\u9875\u9762
 * <span class="token keyword">@param</span> <span class="token parameter">skuId</span>
 * <span class="token keyword">@param</span> <span class="token parameter">model</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/addToCartSuccess.html&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">addToCartSuccessPage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">,</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u91CD\u5B9A\u5411\u5230\u6210\u529F\u9875\u9762\uFF0C\u518D\u6B21\u67E5\u8BE2\u8D2D\u7269\u8F66\u6570\u636E</span>
    <span class="token class-name">CartItem</span> item <span class="token operator">=</span> cartService<span class="token punctuation">.</span><span class="token function">getCartItem</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-4-\u83B7\u53D6\u5408\u5E76\u8D2D\u7269\u8F66" tabindex="-1"><a class="header-anchor" href="#_12-4-\u83B7\u53D6\u5408\u5E76\u8D2D\u7269\u8F66" aria-hidden="true">#</a> 12.4 \u83B7\u53D6\u5408\u5E76\u8D2D\u7269\u8F66</h3><h4 id="_12-4-1-\u9700\u6C42\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_12-4-1-\u9700\u6C42\u5206\u6790" aria-hidden="true">#</a> 12.4.1 \u9700\u6C42\u5206\u6790</h4><ol><li><strong>\u5982\u679C\u7528\u6237\u767B\u5F55\uFF0C\u4E34\u65F6\u8D2D\u7269\u8F66\u7684\u6570\u636E\u5982\u4F55\u663E\u793A</strong>\uFF1F <ol><li>\u5C06\u4E34\u65F6\u8D2D\u7269\u8F66\u7684\u6570\u636E\u5408\u5E76\u5230\u7528\u6237\u8D2D\u7269\u8F66\u4E2D</li></ol></li><li><strong>\u5982\u4F55\u663E\u793A\u8D2D\u7269\u8F66\u7684\u6570\u636E\uFF1F</strong><ol><li>\u4ECE redis \u53D6\u51FA\u6570\u636E\u653E\u5230\u5BF9\u8C61\u4E2D\u5E76\u6E32\u67D3\u51FA\u6765</li></ol></li></ol><h4 id="_12-4-2-\u4EE3\u7801\u7F16\u5199" tabindex="-1"><a class="header-anchor" href="#_12-4-2-\u4EE3\u7801\u7F16\u5199" aria-hidden="true">#</a> 12.4.2 \u4EE3\u7801\u7F16\u5199</h4><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/cart.html&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">cartListPage</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Cart</span> cart <span class="token operator">=</span> cartService<span class="token punctuation">.</span><span class="token function">getCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;cart&quot;</span><span class="token punctuation">,</span>cart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;cartList&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><p>\u62FC\u88C5 <code>Key</code> \u4ECE <code>redis</code> \u4E2D\u67E5\u8BE2\u6570\u636E</p><p>\u4E34\u65F6\u8D2D\u7269\u8F66\u5982\u679C\u6709\u6570\u636E\uFF0C\u5F53\u524D\u72B6\u6001\u662F\u767B\u5F55\uFF0C\u90A3\u5C31\u5C06\u4E34\u65F6\u8D2D\u7269\u8F66\u7684\u6570\u636E\u5408\u5E76\u5230\u5F53\u524D\u7528\u6237\u7684\u8D2D\u7269\u8F66</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Cart</span> <span class="token function">getCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * \u9700\u6C42\u5206\u67901
         *   1\u3001\u5982\u679C\u7528\u6237\u767B\u5F55\u540E\uFF0C\u90A3\u4E48\u4E34\u65F6\u8D2D\u7269\u8F66\u7684\u6570\u636E\u5982\u4F55\u5904\u7406\uFF1F
         *      \u5C06\u4E34\u65F6\u8D2D\u7269\u8F66\u7684\u6570\u636E\uFF0C\u653E\u5230\u7528\u6237\u8D2D\u7269\u8F66\u4E2D\u8FDB\u884C\u5408\u5E76
         *   2\u3001\u5982\u4F55\u663E\u793A\u8D2D\u7269\u8F66\u4E2D\u7684\u6570\u636E\uFF1F
         *      \u4ECEredis\u4E2D\u67E5\u8BE2\u5230\u6570\u636E\u653E\u5230\u5BF9\u8C61\u4E2D\uFF0C\u8FD4\u56DE\u5230\u9875\u9762\u8FDB\u884C\u6E32\u67D3
         */</span>
        <span class="token class-name">Cart</span> cart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1\u3001\u8D2D\u7269\u8F66\u7684\u83B7\u53D6\u64CD\u4F5C\uFF0C\u5206\u4E3A\u767B\u5F55\u540E\u8D2D\u7269\u8F66 \u548C \u6CA1\u767B\u5F55\u8D2D\u7269\u8F66</span>
        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token class-name">CartIntercept</span><span class="token punctuation">.</span>threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u62FF\u5230\u5171\u4EAB\u6570\u636E</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u767B\u5F55\u540E\u7684\u8D2D\u7269\u8F66</span>
            <span class="token class-name">String</span> cartKey <span class="token operator">=</span> CART_PREFIX <span class="token operator">+</span> userInfo<span class="token punctuation">.</span><span class="token function">getUserKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> tempCartKey <span class="token operator">=</span> CART_PREFIX <span class="token operator">+</span> userInfo<span class="token punctuation">.</span><span class="token function">getUserKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u5982\u679C\u4E34\u65F6\u8D2D\u7269\u8F66\u4E2D\u8FD8\u6709\u6570\u636E\uFF0C\u90A3\u5C31\u9700\u8981\u5C06\u4E34\u65F6\u8D2D\u7269\u8F66\u5408\u5E76\u5230\u5DF2\u767B\u5F55\u8D2D\u7269\u8F66\u91CC\u9762</span>
            <span class="token comment">// \u5224\u65AD\u4E34\u65F6\u8D2D\u7269\u8F66\u4E2D\u662F\u5426\u6709\u6570\u636E</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span> cartItems <span class="token operator">=</span> <span class="token function">getCartItems</span><span class="token punctuation">(</span>tempCartKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cartItems <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u4E34\u65F6\u8D2D\u7269\u8F66\u4E2D\u6709\u6570\u636E\uFF0C\u9700\u8981\u5C06\u4E34\u65F6\u8D2D\u7269\u8F66\u7684\u6570\u636E\u5408\u5E76\u5230\u767B\u5F55\u540E\u7684\u8D2D\u7269\u8F66</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CartItem</span> item <span class="token operator">:</span> cartItems<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u62FF\u5230\u4E34\u65F6\u8D2D\u7269\u8F66\u7684\u6240\u6709\u6570\u636E\uFF0C\u5C06\u4ED6\u6DFB\u52A0\u5230\u5DF2\u767B\u5F55\u8D2D\u7269\u8F66\u91CC\u9762\u6765</span>
                    <span class="token comment">// \u8C03\u7528addToCart()\u8FD9\u4E2A\u65B9\u6CD5\uFF0C\u4ED6\u4F1A\u6839\u636E\u767B\u5F55\u72B6\u6001\u8FDB\u884C\u6DFB\u52A0\uFF0C\u5F53\u524D\u662F\u767B\u5F55\u72B6\u6001</span>
                    <span class="token comment">// \u6240\u4EE5\u8FD9\u4E2A\u65B9\u6CD5\u4F1A\u5C06\u4E34\u65F6\u8D2D\u7269\u8F66\u7684\u6570\u636E\u6DFB\u52A0\u5230\u5DF2\u767B\u5F55\u8D2D\u7269\u8F66\u4E2D</span>
                    <span class="token function">addToCart</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>item<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5408\u5E76\u4E34\u65F6\u548C\u767B\u5F55\u540E\u7684\u8D2D\u7269\u8F66</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// \u5408\u5E76\u5B8C\u6210\u540E\u8FD8\u9700\u8981\u5C06\u4E34\u65F6\u8D2D\u7269\u8F66\u4E2D\u7684\u6570\u636E\u5220\u9664</span>
                <span class="token function">clearCart</span><span class="token punctuation">(</span>tempCartKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// \u518D\u6B21\u83B7\u53D6\u7528\u6237\u767B\u5F55\u540E\u7684\u8D2D\u7269\u8F66\u3010\u5305\u542B\u4E34\u65F6\u8D2D\u7269\u8F66\u6570\u636E\u548C\u5DF2\u767B\u5F55\u8D2D\u7269\u8F66\u6570\u636E\u3011</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span> cartItemList <span class="token operator">=</span> <span class="token function">getCartItems</span><span class="token punctuation">(</span>cartKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            cart<span class="token punctuation">.</span><span class="token function">setItems</span><span class="token punctuation">(</span>cartItemList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u5C06\u591A\u4E2A\u8D2D\u7269\u9879\u8BBE\u7F6E\u5230\u8D2D\u7269\u8F66\u4E2D</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u6CA1\u6709\u767B\u5F55\u7684\u8D2D\u7269\u8F66\uFF0C\u62FF\u5230\u6CA1\u6709\u767B\u5F55\u8D2D\u7269\u8F66\u7684\u6570\u636E</span>
            <span class="token class-name">String</span> cartKey <span class="token operator">=</span> CART_PREFIX <span class="token operator">+</span> userInfo<span class="token punctuation">.</span><span class="token function">getUserKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u83B7\u53D6\u8D2D\u7269\u8F66\u4E2D\u7684\u6240\u6709\u8D2D\u7269\u9879</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span> cartItems <span class="token operator">=</span> <span class="token function">getCartItems</span><span class="token punctuation">(</span>cartKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            cart<span class="token punctuation">.</span><span class="token function">setItems</span><span class="token punctuation">(</span>cartItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> cart<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>getCaerItems</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * \u83B7\u53D6\u6307\u5B9A\u7528\u6237 (\u767B\u5F55\u7528\u6237/\u4E34\u65F6\u7528\u6237) \u8D2D\u7269\u8F66\u91CC\u9762\u7684\u6570\u636E
     * <span class="token keyword">@param</span> <span class="token parameter">cartKey</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCartItems</span><span class="token punctuation">(</span><span class="token class-name">String</span> cartKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BoundHashOperations</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> operations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">boundHashOps</span><span class="token punctuation">(</span>cartKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> values <span class="token operator">=</span> operations<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u62FF\u5230\u591A\u4E2A\u8D2D\u7269\u9879</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>values <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span> cartItemList <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>
                <span class="token class-name">CartItem</span> cartItem <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token class-name">CartItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> cartItem<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> cartItemList<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-5-\u9009\u4E2D\u8D2D\u7269\u9879-\u6539\u53D8\u8D2D\u7269\u9879\u7684\u6570\u91CF-\u5220\u9664\u8D2D\u7269\u9879" tabindex="-1"><a class="header-anchor" href="#_12-5-\u9009\u4E2D\u8D2D\u7269\u9879-\u6539\u53D8\u8D2D\u7269\u9879\u7684\u6570\u91CF-\u5220\u9664\u8D2D\u7269\u9879" aria-hidden="true">#</a> 12.5 \u9009\u4E2D\u8D2D\u7269\u9879 &amp; \u6539\u53D8\u8D2D\u7269\u9879\u7684\u6570\u91CF &amp; \u5220\u9664\u8D2D\u7269\u9879</h3><h4 id="_12-5-1-\u9700\u6C42\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_12-5-1-\u9700\u6C42\u5206\u6790" aria-hidden="true">#</a> 12.5.1 \u9700\u6C42\u5206\u6790\uFF1A</h4><h5 id="_1\u3001\u9009\u4E2D\u8D2D\u7269\u9879" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u9009\u4E2D\u8D2D\u7269\u9879" aria-hidden="true">#</a> 1\u3001\u9009\u4E2D\u8D2D\u7269\u9879</h5><ol><li>\u5728\u9875\u9762\u4E2D\u9009\u4E2D\u8D2D\u7269\u9879\u540E\uFF0C\u6570\u636E\u5E94\u8BE5\u8981\u548Credis\u4E2D\u7684\u6570\u636E\u8FDB\u884C\u540C\u6B65</li><li>\u9875\u9762\u9009\u4E2D\uFF0Creids\u4E2D\u6570\u636E\u5C31\u8981\u66F4\u6539</li></ol><h5 id="_2\u3001\u6539\u53D8\u8D2D\u7269\u9879\u6570\u91CF" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6539\u53D8\u8D2D\u7269\u9879\u6570\u91CF" aria-hidden="true">#</a> 2\u3001\u6539\u53D8\u8D2D\u7269\u9879\u6570\u91CF</h5><ol><li>\u8D2D\u7269\u8F66\u4E2D\uFF0C\u589E\u52A0\u4E86\u5546\u54C1\u7684\u6570\u91CF\uFF0C\u5BF9\u5E94\u7684\u4EF7\u683C\uFF0C\u603B\u4EF7\u4E5F\u9700\u8981\u8FDB\u884C\u6539\u53D8</li></ol><h5 id="_3\u3001\u5220\u9664\u8D2D\u7269\u9879" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5220\u9664\u8D2D\u7269\u9879" aria-hidden="true">#</a> 3\u3001\u5220\u9664\u8D2D\u7269\u9879</h5><ol><li>\u5728\u8D2D\u7269\u9879\u4E2D\u5220\u9664\u8BE5\u6761\u6570\u636E\uFF0C\u4ECEredis\u4E2D\u6839\u636Eskuid\u5220\u9664\u8FD9\u6761\u8BB0\u5F55</li></ol><h5 id="_4\u3001\u5C06\u6570\u636E\u4FEE\u6539\u6216\u5220\u9664\u540E-\u91CD\u65B0\u8DF3\u8F6C\u5230cart-html-\u91CD\u65B0\u52A0\u8F7D\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5C06\u6570\u636E\u4FEE\u6539\u6216\u5220\u9664\u540E-\u91CD\u65B0\u8DF3\u8F6C\u5230cart-html-\u91CD\u65B0\u52A0\u8F7D\u6570\u636E" aria-hidden="true">#</a> 4\u3001\u5C06\u6570\u636E\u4FEE\u6539\u6216\u5220\u9664\u540E\uFF0C\u91CD\u65B0\u8DF3\u8F6C\u5230cart.html \u91CD\u65B0\u52A0\u8F7D\u6570\u636E</h5><h4 id="_12-5-2-\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_12-5-2-\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 12.5.2 \u4EE3\u7801\u5B9E\u73B0</h4><p>\u524D\u7AEF\u9875\u9762\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u9009\u4E2D\u8D2D\u7269\u9879</span>
    $<span class="token punctuation">(</span><span class="token string">&quot;.itemCheck&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> skuId <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> check <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&quot;checked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;http://cart.gulimall.com/checkItem?skuId=&quot;</span> <span class="token operator">+</span> skuId <span class="token operator">+</span> <span class="token string">&quot;&amp;check=&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>check<span class="token operator">?</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// \u6539\u53D8\u8D2D\u7269\u9879\u6570\u91CF</span>
    $<span class="token punctuation">(</span><span class="token string">&quot;.countOpsBtn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> skuId <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> num <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;.countOpsNum&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;http://cart.gulimall.com/countItem?skuId=&quot;</span> <span class="token operator">+</span> skuId <span class="token operator">+</span> <span class="token string">&quot;&amp;num=&quot;</span> <span class="token operator">+</span> num<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> deleteId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5220\u9664\u8D2D\u7269\u9879</span>
    function <span class="token function">deleteItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;http://cart.gulimall.com/deleteItem?skuId=&quot;</span> <span class="token operator">+</span> deleteId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    $<span class="token punctuation">(</span><span class="token string">&quot;.deleteItemBtn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        deleteId <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
    * @\u9700\u6C42\u63CF\u8FF0: \u7CFB\u7EDF\u7BA1\u7406\u5458 \u8D2D\u7269\u8F66\u7EC4 \u6A21\u5757 \u7528\u6237\u9009\u4E2D\u8D2D\u7269\u9879\u66F4\u65B0redis\u4E2D\u5BF9\u8C61
    * @\u521B\u5EFA\u4EBA: 
    * @\u521B\u5EFA\u65F6\u95F4: 2021/01/04 15:37
    * @\u4FEE\u6539\u9700\u6C42:
    * @\u4FEE\u6539\u4EBA:
    * @\u4FEE\u6539\u65F6\u95F4:
    * @\u9700\u6C42\u601D\u8DEF:
    */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/checkItem&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkItem</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">,</span>
                            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;checked&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> checked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cartService<span class="token punctuation">.</span><span class="token function">checkItem</span><span class="token punctuation">(</span>skuId<span class="token punctuation">,</span>checked<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u91CD\u5B9A\u5411\u5230\u8D2D\u7269\u8F66\u9875\u9762\uFF0C\u91CD\u65B0\u83B7\u53D6\u8D2D\u7269\u8F66\u6570\u636E</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://cart.gulimall.com/cart.html&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
    * @\u9700\u6C42\u63CF\u8FF0: \u7CFB\u7EDF\u7BA1\u7406\u5458 \u8D2D\u7269\u8F66\u7EC4 \u6A21\u5757 \u7528\u6237\u66F4\u6539\u8D2D\u7269\u8F66\u4E2D\u8D2D\u7269\u9879\u7684\u6570\u91CF
    * @\u521B\u5EFA\u4EBA: 
    * @\u521B\u5EFA\u65F6\u95F4: 2021/01/04 16:05
    * @\u4FEE\u6539\u9700\u6C42:
    * @\u4FEE\u6539\u4EBA:
    * @\u4FEE\u6539\u65F6\u95F4:
    * @\u9700\u6C42\u601D\u8DEF:
    */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/updateItem&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">updateItem</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">,</span>
                             <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cartService<span class="token punctuation">.</span><span class="token function">updateItem</span><span class="token punctuation">(</span>skuId<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://cart.gulimall.com/cart.html&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
    * @\u9700\u6C42\u63CF\u8FF0: \u7CFB\u7EDF\u7BA1\u7406\u5458 \u8D2D\u7269\u8F66\u670D\u52A1 \u6A21\u5757 \u7528\u6237\u5220\u9664\u8D2D\u7269\u8F66\u4E2D\u7684\u8D2D\u7269\u9879
    * @\u521B\u5EFA\u4EBA: 
    * @\u521B\u5EFA\u65F6\u95F4: 2021/01/04 16:40
    * @\u4FEE\u6539\u9700\u6C42:
    * @\u4FEE\u6539\u4EBA:
    * @\u4FEE\u6539\u65F6\u95F4:
    * @\u9700\u6C42\u601D\u8DEF:
    */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/deleteItem&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">deleteItem</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cartService<span class="token punctuation">.</span><span class="token function">deleteItem</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://cart.gulimall.com/cart.html&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkItem</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> checked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u4ECEredis\u4E2D\u67E5\u51FA\u8D2D\u7269\u9879\u8BBE\u7F6E\u8D2D\u7269\u9879\u662F\u5426\u9009\u4E2D\u3002</span>
        <span class="token class-name">BoundHashOperations</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> cartOps <span class="token operator">=</span> <span class="token function">getCartOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> cart <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> cartOps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>skuId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CartItem</span> cartItem <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span> <span class="token class-name">CartItem</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cartItem<span class="token punctuation">.</span><span class="token function">setCheck</span><span class="token punctuation">(</span>checked <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> jsonStirng <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cartOps<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>skuId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>jsonStirng<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u66F4\u65B0redis</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateItem</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u7528\u6237\u5728\u9875\u9762\u5BF9\u67D0\u4E2A\u8D2D\u7269\u9879\u589E\u52A0\u6216\u51CF\u5C11\u8D2D\u7269\u9879\u7684\u6570\u91CF\uFF0C\u90A3\u4E48redis\u4E2D\u5E94\u8BE5\u4E5F\u8981\u8FDB\u884C\u66F4\u65B0</span>
        <span class="token class-name">CartItem</span> cartItem <span class="token operator">=</span> <span class="token function">getCartItem</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cartItem<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BoundHashOperations</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> cartOps <span class="token operator">=</span> <span class="token function">getCartOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cartOps<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>skuId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u66F4\u65B0redis\u4E2D\u6570\u636E</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteItem</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u83B7\u53D6\u5230\u5F53\u524D\u8D2D\u7269\u8F66\uFF0C\u7136\u540E\u6839\u636Eid\u5220\u9664\u8D2D\u7269\u8F66\u91CC\u9762\u7684\u8D2D\u7269\u9879</span>
        <span class="token class-name">BoundHashOperations</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> cartOps <span class="token operator">=</span> <span class="token function">getCartOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cartOps<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>skuId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_13\u3001\u6D88\u606F\u961F\u5217-mq" tabindex="-1"><a class="header-anchor" href="#_13\u3001\u6D88\u606F\u961F\u5217-mq" aria-hidden="true">#</a> 13\u3001\u6D88\u606F\u961F\u5217 - MQ</h1><h3 id="_13-1-rabbitmq" tabindex="-1"><a class="header-anchor" href="#_13-1-rabbitmq" aria-hidden="true">#</a> 13.1 RabbitMQ</h3><h4 id="\u5F02\u6B65\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#\u5F02\u6B65\u5904\u7406" aria-hidden="true">#</a> \u5F02\u6B65\u5904\u7406</h4><p>\u6D88\u606F\u53D1\u9001\u7684\u65F6\u95F4\u53D6\u51B3\u4E8E\u4E1A\u52A1\u6267\u884C\u7684\u6700\u957F\u7684\u65F6\u95F4</p><p><img src="http://qnimg.gisfsde.com/work/image-20210104205412477.png" alt="image-20210104205412477" loading="lazy"></p><h4 id="\u5E94\u7528\u89E3\u8026" tabindex="-1"><a class="header-anchor" href="#\u5E94\u7528\u89E3\u8026" aria-hidden="true">#</a> \u5E94\u7528\u89E3\u8026</h4><p>\u539F\u672C\u662F\u9700\u8981<strong>\u8BA2\u5355\u7CFB\u7EDF</strong>\u76F4\u63A5\u8C03\u7528<strong>\u5E93\u5B58\u7CFB\u7EDF</strong></p><p>\u53EA\u9700\u8981\u5C06\u8BF7\u6C42\u53D1\u9001\u7ED9\u6D88\u606F\u961F\u5217\uFF0C\u5176\u4ED6\u7684\u5C31\u4E0D\u9700\u8981\u53BB\u5904\u7406\u4E86\uFF0C\u8282\u7701\u4E86\u5904\u7406\u4E1A\u52A1\u903B\u8F91\u7684\u65F6\u95F4</p><p><img src="http://qnimg.gisfsde.com/work/image-20210104210738678.png" alt="image-20210104210738678" loading="lazy"></p><h4 id="\u6D41\u91CF\u6D88\u5CF0" tabindex="-1"><a class="header-anchor" href="#\u6D41\u91CF\u6D88\u5CF0" aria-hidden="true">#</a> \u6D41\u91CF\u6D88\u5CF0</h4><p>\u67D0\u4E00\u65F6\u523B\u5982\u679C\u8BF7\u6C42\u7279\u522B\u7684\u5927\uFF0C\u90A3\u5C31\u5148\u628A\u5B83\u653E\u5165\u6D88\u606F\u961F\u5217\uFF0C\u4ECE\u800C\u8FBE\u5230\u6D41\u91CF\u6D88\u5CF0\u7684\u4F5C\u7528</p><p><img src="http://qnimg.gisfsde.com/work/image-20210104210725093.png" alt="image-20210104210725093" loading="lazy"></p>`,112),Oe=s("\u6D41\u7A0B\u56FE\u5730\u5740\uFF1A"),Pe={href:"https://www.processon.com/view/link/5fbda8c35653bb1d54f7077b",target:"_blank",rel:"noopener noreferrer"},Te=s("https://www.processon.com/view/link/5fbda8c35653bb1d54f7077b"),Le=p(`<h3 id="_13-2-\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#_13-2-\u6982\u8FF0" aria-hidden="true">#</a> 13.2 \u6982\u8FF0</h3><ol><li>\u5927\u591A\u5E94\u7528\u4E2D\uFF0C\u53EF\u901A\u8FC7\u6D88\u606F\u670D\u52A1\u4E2D\u95F4\u4EF6\u6765\u63D0\u5347\u7CFB\u7EDF\u5F02\u6B65\u901A\u4FE1\uFF0C\u6269\u5C55\u89E3\u8026\u80FD\u529B</li><li>\u6D88\u606F\u670D\u52A1\u4E2D\u4E24\u4E2A\u91CD\u8981\u6982\u5FF5\uFF1A <ol><li><strong>\u6D88\u606F\u4EE3\u7406\uFF08message broker\uFF09</strong> \u548C <strong>\u76EE\u7684\u5730\uFF08destination\uFF09</strong></li></ol></li><li>\u5F53\u6D88\u606F\u53D1\u9001\u8005\u53D1\u9001\u6D88\u606F\u540E\uFF0C\u5C06\u7531\u6D88\u606F\u4EE3\u7406\u63A5\u7BA1\uFF0C\u6D88\u606F\u4EE3\u7406\u4FDD\u8BC1\u6D88\u606F\u4F20\u9012\u5230\u6307\u5B9A\u76EE\u7684\u5730</li><li>\u6D88\u606F\u961F\u5217\u4E3B\u8981\u6709\u4E24\u79CD\u5F62\u5F0F\u7684\u76EE\u7684\u5730 <ol><li><strong>\u961F\u5217\uFF08Queue\uFF09</strong>:\u70B9\u5BF9\u70B9\u6D88\u606F\u901A\u4FE1\uFF08point - to - point\uFF09</li><li><strong>\u4E3B\u9898\uFF08topic\uFF09</strong>\uFF1A\u53D1\u5E03\uFF08publish\uFF09/\u8BA2\u9605\uFF08subscribe\uFF09\u6D88\u606F\u901A\u4FE1</li></ol></li><li>\u70B9\u5BF9\u70B9\u5F0F\uFF1A <ol><li>\u6D88\u606F\u53D1\u9001\u8005\u53D1\u9001\u6D88\u606F\uFF0C\u6D88\u606F\u4EE3\u7406\u5C06\u5176\u653E\u5165\u4E00\u4E2A\u961F\u5217\u4E2D\uFF0C\u6D88\u606F\u63A5\u6536\u8005\u4ECE\u961F\u5217\u4E2D\u83B7\u53D6\u6D88\u606F\u5185\u5BB9\uFF0C\u6D88\u606F\u8BFB\u53D6\u540E\u88AB\u79FB\u51FA\u961F\u5217</li><li>\u6D88\u606F\u53EA\u6709\u552F\u4E00\u7684\u53D1\u9001\u8005\u548C\u63A5\u53D7\u8005\uFF0C\u5355\u5E76\u4E0D\u662F\u8BF4\u53EA\u80FD\u6709\u4E00\u4E2A\u63A5\u6536\u8005</li></ol></li><li>\u53D1\u5E03\u8BA2\u9605\u5F0F: <ol><li>\u53D1\u9001\u8005\uFF08\u53D1\u5E03\u8005\uFF09\u53D1\u5230\u6D88\u606F\u5230\u4E3B\u9898\uFF0C\u591A\u4E2A\u63A5\u6536\u8005\uFF08\u8BA2\u9605\u8005\uFF09\u76D1\u542C\uFF08\u8BA2\u9605\uFF09\u8FD9\u4E2A\u4E3B\u9898\uFF0C\u90A3\u4E48\u5C31\u4F1A\u5728\u6D88\u606F\u5230\u8FBE\u65F6\u540C\u65F6\u6536\u5230\u6D88\u606F</li></ol></li><li><strong>JMS\uFF08Java Message Service\uFF09 Java\u6D88\u606F\u670D\u52A1\uFF1A</strong><ol><li>\u57FA\u4E8EJVM\u6D88\u606F\u4EE3\u7406\u7684\u89C4\u8303\uFF0CActiveMQ\u3001HornetMQ\u662FJMS\u7684\u5B9E\u73B0</li></ol></li><li>AMQP\uFF08Advanced Message Queuing Protocol\uFF09 <ol><li>\u9AD8\u7EA7\u6D88\u606F\u961F\u5217\u534F\u8BAE\uFF0C\u4E5F\u662F\u4E00\u4E2A\u6D88\u606F\u4EE3\u7406\u7684\u89C4\u8303\uFF0C\u517C\u5BB9JMS</li><li>RabbitMQ\u662FAMQP\u7684\u5B9E\u73B0</li></ol></li><li>Spring \u652F\u6301 <ol><li>spring - jms\u63D0\u4F9B\u4E86\u5BF9JMS\u7684\u652F\u6301</li><li>spring - rabbit\u63D0\u4F9B\u4E86\u5BF9AMQP\u7684\u652F\u6301</li><li>\u9700\u8981ConnectionFactory\u7684\u5B9E\u73B0\u6765\u8FDE\u63A5\u6D88\u606F\u4EE3\u7406</li><li>\u63D0\u4F9B <strong>JmsTemplate</strong>\u3001<strong>RabbitTemplate</strong> \u6765\u53D1\u9001\u6D88\u606F</li><li>@JmsListener\uFF08JMS\uFF09\u3001@RabbitListener\uFF08AMQP\uFF09\u6CE8\u89E3\u5728\u65B9\u6CD5\u4E0A\u76D1\u542C\u6D88\u606F\u4EE3\u7406\u53D1\u5E03\u7684\u6D88\u606F</li><li>@EnableJms\u3001@EnableRabbit\u5F00\u542F\u652F\u6301</li></ol></li><li>Spring Boot \u81EA\u52A8\u914D\u7F6E <ol><li>JmsAutoConfiguration</li><li>RabbitAutoConfiguration</li></ol></li><li>\u5E02\u9762\u4E0A\u7684MQ\u4EA7\u54C1 <ol><li>ActiveMQ\u3001RabbitMQ\u3001RocketMQ\uFF0Ckafka</li></ol></li></ol><p><img src="http://qnimg.gisfsde.com/work/image-20201116091205853.png" alt="image-20201116091205853" loading="lazy"></p><h3 id="_13-3-rabbitmq\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_13-3-rabbitmq\u6982\u5FF5" aria-hidden="true">#</a> 13.3 RabbitMQ\u6982\u5FF5</h3><p>RabbitMQ\u7B80\u4ECB\uFF1A</p><p>RabbitMQ\u662F\u4E00\u7531erlang\u5F00\u53D1\u7684AMQP\uFF08Advanved Message Queue Protocol\uFF09\u7684\u5F00\u6E90\u5B9E\u73B0</p><p>\u6838\u5FC3\u6982\u5FF5</p><p><strong>Message</strong></p><p>\u6D88\u606F\uFF0C\u6D88\u606F\u662F\u4E0D\u5177\u540D\u7684\uFF0C\u5B83\u662F\u7531\u6D88\u606F\u5934\u548C\u6D88\u606F\u4F53\u7EC4\u6210\uFF0C\u6D88\u606F\u4F53\u662F\u4E0D\u900F\u660E\u7684\uFF0C\u800C\u6D88\u606F\u5934\u5219\u7531\u4E00\u7CFB\u5217\u7684\u53EF\u9009\u5C5E\u6027\u7EC4\u6210\uFF0C\u8FD9\u4E9B\u5C5E\u6027\u5305\u62EC <strong>routing - key \uFF08\u8DEF\u7531\u952E\uFF09</strong>\uFF0C<strong>priority\uFF08\u76F8\u5BF9\u4E8E\u5176\u4ED6\u6D88\u606F\u7684\u4F18\u5148\u6743\uFF09</strong>\uFF0C**delivery - mode\uFF08\u6307\u51FA\u8BE5\u6D88\u606F\u53EF\u80FD\u9700\u8981\u6301\u4E45\u6027\u5B58\u50A8\uFF09**\u7B49</p><p><strong>Publisher</strong></p><p>\u6D88\u606F\u7684\u751F\u4EA7\u8005\uFF0C\u4E5F\u662F\u4E00\u4E2A\u50CF\u4EA4\u6362\u5668\u53D1\u5E03\u6D88\u606F\u7684\u5BA2\u6237\u7AEF\u5E94\u7528\u7A0B\u5E8F</p><p><strong>Exchange</strong></p><p>\u4EA4\u6362\u5668\uFF0C\u7528\u6765\u63A5\u6536\u751F\u4EA7\u8005\u53D1\u9001\u7684\u6D88\u606F\u5E76\u5C06\u8FD9\u4E9B\u6D88\u606F\u8DEF\u7531\u7ED9\u670D\u52A1\u5668\u4E2D\u7684\u961F\u5217</p><p>Exchange\u67094\u79CD\u7C7B\u578B\uFF1A<strong>direct(\u9ED8\u8BA4)</strong>\u3001<strong>fanout</strong>\u3001<strong>topic</strong>\uFF0C\u548C<strong>heades</strong>\uFF0C\u4E0D\u540C\u7C7B\u578B\u7684 <strong>Exchange</strong> \u8F6C\u53D1\u6D88\u606F\u7684\u7B56\u7565\u6709\u6240\u533A\u522B</p><p><strong>Queue</strong></p><p>\u6D88\u606F\u961F\u5217\uFF0C\u7528\u6765\u4FDD\u5B58\u6D88\u606F\u76F4\u5230\u53D1\u9001\u7ED9<strong>\u6D88\u8D39\u8005</strong>\uFF0C<strong>\u4ED6\u662F\u6D88\u606F\u7684\u5BB9\u5668</strong>\uFF0C\u4E5F\u662F\u6D88\u606F\u7684\u91CD\u70B9\uFF0C\u4E00\u4E2A\u6D88\u606F\u53EF\u4EE5\u6295\u5165\u4E00\u4E2A\u6216\u591A\u4E2A\u961F\u5217\uFF0C\u6D88\u606F\u4E00\u76F4\u5728\u961F\u5217\u91CC\u9762\uFF0C\u7B49\u5F85\u6D88\u8D39\u8005\u8FDE\u63A5\u5230\u8FD9\u4E2A\u961F\u5217\u5C06\u5176\u53D6\u8D70</p><p><strong>Binding</strong></p><p>\u7ED1\u5B9A\uFF0C<strong>\u7528\u4E8E\u6D88\u606F\u961F\u5217\u548C\u4EA4\u6362\u5668\u4E4B\u95F4\u7684\u5173\u8054</strong>\uFF0C\u4E00\u4E2A\u7ED1\u5B9A\u5C31\u662F\u57FA\u4E8E\u8DEF\u7531\u952E\u5C06\u4EA4\u6362\u5668\u548C\u6D88\u606F\u961F\u5217\u8FDE\u63A5\u8D77\u6765\u7684\u89C4\u5219\uFF0C\u6240\u6709\u53EF\u4EE5\u5C06\u4EA4\u6362\u5668\u7406\u89E3\u6210\u4E00\u4E2A\u7531\u7ED1\u5B9A\u6784\u6210\u7684\u8DEF\u7531\u8868</p><p><strong>Connection</strong></p><p>\u7F51\u8DEF\u8FDE\u63A5\uFF0C\u6BD4\u5982\u4E00\u4E2ATCP\u8FDE\u63A5</p><p><strong>Channel</strong></p><p>\u4FE1\u9053\uFF0C\u591A\u8DEF\u590D\u7528\u8FDE\u63A5\u4E2D\u7684\u4E00\u4E2A\u72EC\u7ACB\u7684\u53CC\u5411\u6570\u636E\u6D41\u901A\u9053\uFF0C\u4FE1\u9053\u662F\u5EFA\u7ACB\u5728\u771F\u5B9E\u7684TCP\u8FDE\u63A5\u7684\u5185\u7684\u865A\u62DF\u8FDE\u63A5\uFF0CAMQP \u547D\u4EE4\u90FD\u662F\u901A\u8FC7\u4FE1\u606F\u5230\u53D1\u9001\u51FA\u53BB\u7684\uFF0C\u4E0D\u7BA1\u662F\u53D1\u5E03\u6D88\u606F\uFF0C\u8BA2\u9605\u961F\u5217\u8FD8\u662F\u63A5\u6536\u6D88\u606F\uFF0C\u8FD9\u4E9B\u52A8\u4F5C\u90FD\u662F\u901A\u8FC7\u961F\u5217\u5B8C\u6210\uFF0C\u56E0\u4E3A\u5BF9\u5E94\u64CD\u4F5C\u7CFB\u7EDF\u6765\u8BF4\u5EFA\u7ACB\u548C\u9500\u6BC1 TCP \u90FD\u662F\u975E\u5E38\u6602\u8D35\u7684\u5F00\u9500\uFF0C\u6240\u4EE5\u5F15\u5165\u4E86\u4FE1\u9053\u7684\u6982\u5FF5\uFF0C\u4EE5\u590D\u7528\u4E00\u6761TCP\u8FDE\u63A5</p><p><strong>Consumer</strong></p><p>\u6D88\u606F\u7684\u6D88\u8D39\u8005\uFF0C\u8868\u793A\u4E00\u4E2A\u6D88\u606F\u961F\u5217\u4E2D\u53D6\u5F97\u6D88\u606F\u7684\u5BA2\u6237\u7AEF\u5E94\u7528\u7A0B\u5E8F</p><p><strong>Virtual Host</strong></p><p>\u865A\u62DF\u4E3B\u673A\uFF0C\u8868\u793A\u4EA4\u6362\u5668\u3001\u6D88\u606F\u961F\u5217\u548C\u76F8\u5173\u5BF9\u8C61\u3002\u865A\u62DF\u4E3B\u673A\u662F\u5171\u4EAB\u76F8\u540C\u7684\u8EAB\u4EFD\u8BA4\u8BC1\u548C\u52A0\u5BC6\u73AF\u5883\u7684\u72EC\u7ACB\u670D\u52A1\u5668\u57DF\u3002\u6BCF\u4E2AVirtual host\u672C\u8D28\u4E0A\u5C31\u662F\u4E00\u4E2A mini \u7248\u7684RabbitMQ \u670D\u52A1\u5668,\u62E5\u6709\u81EA\u5DF1\u7684\u961F\u5217\u3001\u4EA4\u6362\u5668\u3001\u7ED1\u5B9A\u548C\u6743\u9650\u673A\u5236\u3002Virtual host \u662F AMQP \u6982\u5FF5\u7684\u57FA\u7840\uFF0C\u5FC5\u987B\u5728\u8FDE\u63A5\u65F6\u6307\u5B9A,RabbitMQ\u9ED8\u8BA4\u7684vhost\u662F/\u3002</p><p><strong>Broker</strong></p><p>\u8868\u793A\u6D88\u606F\u961F\u5217\u670D\u52A1\u5668\u5B9E\u4F53</p><p><img src="http://qnimg.gisfsde.com/work/image-20201116100431093.png" alt="image-20201116100431093" loading="lazy"></p><h3 id="_13-4-docker-\u5B89\u88C5rabbitmq" tabindex="-1"><a class="header-anchor" href="#_13-4-docker-\u5B89\u88C5rabbitmq" aria-hidden="true">#</a> 13.4 Docker \u5B89\u88C5RabbitMQ</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run -d --name rabbitmq -p <span class="token number">5671</span>:5671 -p <span class="token number">5672</span>:5672 -p <span class="token number">4369</span>:4369 -p <span class="token number">25672</span>:25672 -p <span class="token number">15671</span>:15671 -p <span class="token number">15672</span>:15672 rabbitmq:management

<span class="token number">4369</span>, <span class="token number">25672</span> <span class="token punctuation">(</span>Erlang\u53D1\u73B0<span class="token operator">&amp;</span>\u96C6\u7FA4\u7AEF\u53E3<span class="token punctuation">)</span>
<span class="token number">5672</span>, <span class="token number">5671</span> <span class="token punctuation">(</span>AMQP\u7AEF\u53E3<span class="token punctuation">)</span>
<span class="token number">15672</span> <span class="token punctuation">(</span>web\u7BA1\u7406\u540E\u53F0\u7AEF\u53E3<span class="token punctuation">)</span>
<span class="token number">61613</span>, <span class="token number">61614</span> <span class="token punctuation">(</span>STOMP\u534F\u8BAE\u7AEF\u53E3<span class="token punctuation">)</span>
<span class="token number">1883</span>, <span class="token number">8883</span> <span class="token punctuation">(</span>MQTT\u534F\u8BAE\u7AEF\u53E3<span class="token punctuation">)</span>
 <span class="token comment"># \u81EA\u52A8\u542F\u52A8</span>
<span class="token function">docker</span> update rabbitmq --restart<span class="token operator">=</span>always

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://qnimg.gisfsde.com/work/image-20201116102734767.png" alt="image-20201116102734767" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201116103446291.png" alt="image-20201116103446291" loading="lazy"></p><h3 id="_13-5-rabbitmq-\u8FD0\u884C\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_13-5-rabbitmq-\u8FD0\u884C\u673A\u5236" aria-hidden="true">#</a> 13.5 RabbitMQ \u8FD0\u884C\u673A\u5236</h3><p>AMQP \u4E2D\u7684\u6D88\u606F\u8DEF\u7531</p><p>AMQP \u4E2D\u6D88\u606F\u7684\u8DEF\u7531\u8FC7\u7A0B\u548C Java \u5F00\u53D1\u8005\u719F\u6089\u7684 JMS \u5B58\u5728\u4E00\u4E9B\u5DEE\u522B\uFF0CAMQP\u4E2D\u589E\u52A0\u4E86 <strong>Exchange</strong> \u548C <strong>Binding</strong> \u7684\u89D2\u8272 \u751F\u4EA7\u8005\u628A\u6D88\u606F\u53D1\u5E03\u5230 Exchange \u4E0A\uFF0C\u6D88\u606F\u6700\u7EC8\u5230\u8FBE\u961F\u5217\u5E76\u88AB\u6D88\u8D39\u8005\u63A5\u6536\uFF0C\u800C Binding \u51B3\u5B9A\u4EA4\u6362\u5668\u7684\u6D88\u606F\u5E94\u8BE5\u53D1\u9001\u7ED9\u90A3\u4E2A\u961F\u5217</p><p><img src="http://qnimg.gisfsde.com/work/image-20201116104235856.png" alt="image-20201116104235856" loading="lazy"></p><p><strong>Exchange \u7C7B\u578B</strong></p><p>Exchange \u5206\u53D1\u6D88\u606F\u65F6\u6839\u636E\u7C7B\u578B\u7684\u4E0D\u540C\u5206\u53D1\u7B56\u7565\u6709\u533A\u522B\uFF0C\u76EE\u524D\u5171\u56DB\u79CD\u7C7B\u578B\uFF1Adirect\u3001tanout\u3001topic\u3001headers header\u5339\u914DAMQP\u6D88\u606F\u7684 header \u800C\u4E0D\u662F\u8DEF\u7531\u952E\uFF0Cheaders \u4EA4\u6362\u5668\u548C direct \u4EA4\u6362\u5668\u5B8C\u5168\u4E00\u81F4\uFF0C\u4F46\u6027\u80FD\u5DEE\u80FD\u591A\uFF0C\u76EE\u524D\u51E0\u4E4E\u7528\u4E0D\u5230\u4E86\uFF0C\u6240\u4EE5\u76F4\u63A5\u770B\u53E6\u5916\u4E09\u79CD\u7C7B\u578B</p><p><img src="http://qnimg.gisfsde.com/work/image-20201116104546717.png" alt="image-20201116104546717" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201116104918897.png" alt="image-20201116104918897" loading="lazy"></p><h3 id="_13-6-rabbitmq-\u6574\u5408" tabindex="-1"><a class="header-anchor" href="#_13-6-rabbitmq-\u6574\u5408" aria-hidden="true">#</a> 13.6 RabbitMQ \u6574\u5408</h3><h4 id="_1\u3001\u5F15\u5165-spring-boot-starter-amqp" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5F15\u5165-spring-boot-starter-amqp" aria-hidden="true">#</a> 1\u3001\u5F15\u5165 Spring-boot-starter-amqp</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>      \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001application-yml\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_2\u3001application-yml\u914D\u7F6E" aria-hidden="true">#</a> 2\u3001application.yml\u914D\u7F6E</h4><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.56.10
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001\u6D4B\u8BD5rabbitmq" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u6D4B\u8BD5rabbitmq" aria-hidden="true">#</a> 3\u3001\u6D4B\u8BD5RabbitMQ</h4><h5 id="_1\u3001amqpadmin-\u7BA1\u7406\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#_1\u3001amqpadmin-\u7BA1\u7406\u7EC4\u4EF6" aria-hidden="true">#</a> 1\u3001AmqpAdmin:\u7BA1\u7406\u7EC4\u4EF6</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * \u521B\u5EFAExchange
     * 1\u3001\u5982\u4F55\u5229\u7528Exchange,Queue,Binding
     *      1\u3001\u4F7F\u7528AmqpAdmin\u8FDB\u884C\u521B\u5EFA
     * 2\u3001\u5982\u4F55\u6536\u53D1\u4FE1\u606F
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//	public DirectExchange(</span>
        <span class="token comment">//	String name, \u4EA4\u6362\u673A\u7684\u540D\u5B57</span>
        <span class="token comment">//	boolean durable, \u662F\u5426\u6301\u4E45</span>
        <span class="token comment">//	boolean autoDelete, \u662F\u5426\u81EA\u52A8\u5220\u9664</span>
        <span class="token comment">//	Map\\&lt;String, Object&gt; arguments)</span>
        <span class="token comment">//	{</span>
        <span class="token class-name">DirectExchange</span> directExchange <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">&quot;hello-java.exchange&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        amqpAdmin<span class="token punctuation">.</span><span class="token function">declareExchange</span><span class="token punctuation">(</span>directExchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Exchange[{}]\u521B\u5EFA\u6210\u529F\uFF1A&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello-java.exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u521B\u5EFA\u961F\u5217
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// public Queue(String name, boolean durable, boolean exclusive, boolean autoDelete, Map\\&lt;String, Object&gt; arguments) {</span>
        <span class="token class-name">Queue</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;hello-java-queue&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        amqpAdmin<span class="token punctuation">.</span><span class="token function">declareQueue</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Queue[{}]:&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;\u521B\u5EFA\u6210\u529F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
     * \u7ED1\u5B9A\u961F\u5217
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// public Binding(String destination, \u76EE\u7684\u5730</span>
        <span class="token comment">// DestinationType destinationType, \u76EE\u7684\u5730\u7C7B\u578B</span>
        <span class="token comment">// String exchange,\u4EA4\u6362\u673A</span>
        <span class="token comment">// String routingKey,//\u8DEF\u7531\u952E</span>
        <span class="token class-name">Binding</span> binding <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Binding</span><span class="token punctuation">(</span><span class="token string">&quot;hello-java-queue&quot;</span><span class="token punctuation">,</span>
                <span class="token class-name">Binding<span class="token punctuation">.</span>DestinationType</span><span class="token punctuation">.</span>QUEUE<span class="token punctuation">,</span>
                <span class="token string">&quot;hello-java.exchange&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;hello.java&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        amqpAdmin<span class="token punctuation">.</span><span class="token function">declareBinding</span><span class="token punctuation">(</span>binding<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Binding[{}]\u521B\u5EFA\u6210\u529F&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello-java-binding&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001rabbittemplate-\u6D88\u606F\u53D1\u9001\u5904\u7406\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#_2\u3001rabbittemplate-\u6D88\u606F\u53D1\u9001\u5904\u7406\u7EC4\u4EF6" aria-hidden="true">#</a> 2\u3001RabbitTemplate\uFF1A\u6D88\u606F\u53D1\u9001\u5904\u7406\u7EC4\u4EF6</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Autowired</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessageTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i \\<span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">OrderReturnReasonEntity</span> reasonEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderReturnReasonEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                reasonEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1l</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                reasonEntity<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                reasonEntity<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;\u54C8\u54C8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//</span>
                <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
                <span class="token comment">// \u53D1\u9001\u7684\u5BF9\u8C61\u7C7B\u578B\u7684\u6D88\u606F\uFF0C\u53EF\u4EE5\u662F\u4E00\u4E2Ajson</span>
                rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;hello-java.exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello.java&quot;</span><span class="token punctuation">,</span>reasonEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">OrderEntity</span> orderEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                orderEntity<span class="token punctuation">.</span><span class="token function">setOrderSn</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;hello-java.exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello.java&quot;</span><span class="token punctuation">,</span>orderEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u6D88\u606F\u53D1\u9001\u5B8C\u6210{}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-7-rabbitmq\u6D88\u606F\u786E\u8BA4\u673A\u5236-\u53EF\u9760\u5230\u8FBE" tabindex="-1"><a class="header-anchor" href="#_13-7-rabbitmq\u6D88\u606F\u786E\u8BA4\u673A\u5236-\u53EF\u9760\u5230\u8FBE" aria-hidden="true">#</a> 13.7 RabbitMQ\u6D88\u606F\u786E\u8BA4\u673A\u5236 - \u53EF\u9760\u5230\u8FBE</h3><ul><li>\u4FDD\u8BC1\u6D88\u606F\u4E0D\u4E22\u5931\uFF0C\u53EF\u9760\u62B5\u8FBE\uFF0C\u53EF\u4EE5\u4F7F\u7528\u4E8B\u52A1\u6D88\u606F\uFF0C\u6027\u80FD\u4E0B\u964D250\u500D\uFF0C\u4E3A\u6B64\u5F15\u5165\u786E\u8BA4\u673A\u5236</li><li><strong>publisher</strong> confirmCallback \u786E\u8BA4\u6A21\u5F0F</li><li><strong>publisher</strong> returnCallback \u672A\u6295\u9012\u5230 queue \u9000\u56DE</li><li><strong>consumer</strong> ack \u673A\u5236</li></ul><p><img src="http://qnimg.gisfsde.com/work/image-20201116163631107.png" alt="image-20201116163631107" loading="lazy"></p><h4 id="\u53EF\u9760\u62B5\u8FBE-confirmcallback" tabindex="-1"><a class="header-anchor" href="#\u53EF\u9760\u62B5\u8FBE-confirmcallback" aria-hidden="true">#</a> \u53EF\u9760\u62B5\u8FBE - ConfirmCallback</h4><p>spring.rabbitmq.publisher-confirms=true</p><p>\u5728\u521B\u5EFA <code>connectionFactory</code> \u7684\u65F6\u5019\u8BBE\u7F6E PublisherConfirms(true) \u9009\u9879\uFF0C\u5F00\u542F <code>confirmcallback</code>\u3002</p><p><code>CorrelationData</code> \u7528\u6765\u8868\u793A\u5F53\u524D\u6D88\u606F\u552F\u4E00\u6027</p><p>\u6D88\u606F\u53EA\u8981\u88AB broker \u63A5\u6536\u5230\u5C31\u4F1A\u6267\u884C confirmCallback,\u5982\u679C cluster \u6A21\u5F0F\uFF0C\u9700\u8981\u6240\u6709 broker \u63A5\u6536\u5230\u624D\u4F1A\u8C03\u7528 confirmCallback</p><p>\u88AB broker \u63A5\u6536\u5230\u53EA\u80FD\u8868\u793A message \u5DF2\u7ECF\u5230\u8FBE\u670D\u52A1\u5668\uFF0C\u5E76\u4E0D\u80FD\u4FDD\u8BC1\u6D88\u606F\u4E00\u5B9A\u4F1A\u88AB\u6295\u9012\u5230\u76EE\u6807 queue \u91CC\uFF0C\u6240\u4EE5\u9700\u8981\u7528\u5230\u63A5\u4E0B\u6765\u7684 returnCallback</p><h4 id="\u53EF\u9760\u62B5\u8FBE-returncallback" tabindex="-1"><a class="header-anchor" href="#\u53EF\u9760\u62B5\u8FBE-returncallback" aria-hidden="true">#</a> \u53EF\u9760\u62B5\u8FBE - ReturnCallback</h4><p>spring.rabbitmq.publisher-retuns=true</p><p>spring.rabbitmq.template.mandatory=true</p><p>confirm \u6A21\u5F0F\u53EA\u80FD\u4FDD\u8BC1\u6D88\u606F\u5230\u8FBE broker\uFF0C\u4E0D\u80FD\u4FDD\u8BC1\u6D88\u606F\u51C6\u786E\u6295\u9012\u5230\u76EE\u6807 queue \u91CC\u3002\u5728\u6709\u4E9B\u6A21\u5F0F\u4E1A\u52A1\u573A\u666F\u4E0B\uFF0C\u6211\u4EEC\u9700\u8981\u4FDD\u8BC1\u6D88\u606F\u4E00\u5B9A\u8981\u6295\u9012\u5230\u76EE\u6807 queue \u91CC\uFF0C\u6B64\u65F6\u5C31\u9700\u8981\u7528\u5230 return \u9000\u56DE\u6A21\u5F0F</p><p>\u8FD9\u6837\u5982\u679C\u672A\u80FD\u6295\u9012\u5230\u76EE\u6807 queue \u91CC\u5C06\u8C03\u7528 returnCallback\uFF0C\u53EF\u4EE5\u8BB0\u5F55\u4E0B\u8BE6\u7EC6\u5230\u6295\u9012\u6570\u636E\uFF0C\u5B9A\u671F\u7684\u5DE1\u68C0\u6216\u8005\u81EA\u52A8\u7EA0\u9519\u90FD\u9700\u8981\u8FD9\u4E9B\u6570\u636E</p><h4 id="\u53EF\u9760\u62B5\u8FBE-ack-\u6D88\u606F\u786E\u8BA4\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#\u53EF\u9760\u62B5\u8FBE-ack-\u6D88\u606F\u786E\u8BA4\u673A\u5236" aria-hidden="true">#</a> \u53EF\u9760\u62B5\u8FBE - Ack \u6D88\u606F\u786E\u8BA4\u673A\u5236</h4><ul><li>\u6D88\u8D39\u8005\u83B7\u53D6\u5230\u6D88\u606F\uFF0C\u6210\u529F\u5904\u7406\uFF0C\u53EF\u4EE5\u56DE\u590DAck\u7ED9Broker <ul><li>basic.ack \u7528\u4E8E\u80AF\u5B9A\u786E\u8BA4\uFF1Abroker \u5C06\u79FB\u9664\u6B64\u6D88\u606F</li><li>basic.nack \u7528\u4E8E\u5426\u5B9A\u786E\u8BA4\uFF1A\u53EF\u4EE5\u6307\u5B9A beoker \u662F\u5426\u4E22\u5F03\u6B64\u6D88\u606F\uFF0C\u53EF\u4EE5\u6279\u91CF</li><li>basic.reject\u7528\u4E8E\u5426\u5B9A\u786E\u8BA4\uFF0C\u540C\u4E0A\uFF0C\u4F46\u4E0D\u80FD\u6279\u91CF</li></ul></li><li>\u9ED8\u8BA4\uFF0C\u6D88\u606F\u88AB\u6D88\u8D39\u8005\u6536\u5230\uFF0C\u5C31\u4F1A\u4ECEbroker\u7684queue\u4E2D\u79FB\u9664</li><li>\u6D88\u8D39\u8005\u6536\u5230\u6D88\u606F\uFF0C\u9ED8\u8BA4\u81EA\u52A8ack\uFF0C\u4F46\u662F\u5982\u679C\u65E0\u6CD5\u786E\u5B9A\u6B64\u6D88\u606F\u662F\u5426\u88AB\u5904\u7406\u5B8C\u6210\uFF0C\u6216\u8005\u6210\u529F\u5904\u7406\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5F00\u542F\u624B\u52A8ack\u6A21\u5F0F <ul><li>\u6D88\u606F\u5904\u7406\u6210\u529F\uFF0Cack()\uFF0C\u63A5\u53D7\u4E0B\u4E00\u6761\u6D88\u606F\uFF0C\u6B64\u6D88\u606Fbroker\u5C31\u4F1A\u79FB\u9664</li><li>\u6D88\u606F\u5904\u7406\u5931\u8D25\uFF0Cnack()/reject() \u91CD\u65B0\u53D1\u9001\u7ED9\u5176\u4ED6\u4EBA\u8FDB\u884C\u5904\u7406\uFF0C\u6216\u8005\u5BB9\u9519\u5904\u7406\u540Eack</li><li>\u6D88\u606F\u4E00\u76F4\u6CA1\u6709\u8C03\u7528ack/nack\u65B9\u6CD5\uFF0Cbrocker\u8BA4\u4E3A\u6B64\u6D88\u606F\u6B63\u5728\u88AB\u5904\u7406\uFF0C\u4E0D\u4F1A\u6295\u9012\u7ED9\u522B\u4EBA\uFF0C\u6B64\u65F6\u5BA2\u6237\u7AEF\u65AD\u5F00\uFF0C\u6D88\u606F\u4E0D\u4F1A\u88ABbroker\u79FB\u9664\uFF0C\u4F1A\u6295\u9012\u7ED9\u522B\u4EBA</li></ul></li></ul><h3 id="_13-8-rabbitmq-\u5EF6\u65F6\u961F\u5217-\u5B9E\u73B0\u5B9A\u65F6\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_13-8-rabbitmq-\u5EF6\u65F6\u961F\u5217-\u5B9E\u73B0\u5B9A\u65F6\u4EFB\u52A1" aria-hidden="true">#</a> 13.8 RabbitMQ \u5EF6\u65F6\u961F\u5217(\u5B9E\u73B0\u5B9A\u65F6\u4EFB\u52A1)</h3><p><strong>\u573A\u666F:</strong></p><p>\u6BD4\u5982\u672A\u4ED8\u6B3E\u7684\u8BA2\u5355\uFF0C\u8D85\u8FC7\u4E00\u5B9A\u65F6\u95F4\u540E\uFF0C\u7CFB\u7EDF\u81EA\u52A8\u53D6\u6D88\u8BA2\u5355\u5E76\u91CA\u653E\u5360\u6709\u7269\u54C1</p><p><strong>\u5E38\u7528\u89E3\u51B3\u65B9\u6848\uFF1A</strong></p><p>Spring\u7684schedule \u5B9A\u65F6\u4EFB\u52A1\u8F6E\u8BE2\u6570\u636E\u5E93</p><p><strong>\u7F3A\u70B9\uFF1A</strong></p><p>\u6D88\u8017\u7CFB\u7EDF\u5185\u5B58\uFF0C\u589E\u52A0\u4E86\u6570\u636E\u5E93\u7684\u538B\u529B\uFF0C\u5B58\u5728\u8F83\u5927\u7684\u65F6\u95F4\u8BEF\u5DEE</p><p>**\u89E3\u51B3\uFF1A**rabbitmq\u7684\u6D88\u606FTTL\u548C\u6B7B\u4FE1Exchange\u7ED3\u5408</p><h4 id="\u4F7F\u7528\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u573A\u666F" aria-hidden="true">#</a> \u4F7F\u7528\u573A\u666F</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201120120737525.png" alt="image-20201120120737525" loading="lazy"></p><p>\u65F6\u6548\u95EE\u9898</p><p>\u4E0A\u4E00\u8F6E\u626B\u63CF\u521A\u597D\u626B\u63CF\uFF0C\u800C\u8FD9\u4E2A\u65F6\u5019\u521A\u597D\u4E0B\u4E86\u8BA2\u5355\uFF0C\u5C31\u6CA1\u6709\u626B\u63CF\u5230\uFF0C\u4E0B\u4E00\u8F6E\u626B\u63CF\u7684\u65F6\u5019\uFF0C\u8BA2\u5355\u8FD8\u6CA1\u6709\u8FC7\u671F\uFF0C\u7B49\u5230\u8BA2\u5355\u8FC7\u671F\u540E30\u5206\u949F\u624D\u88AB\u626B\u63CF\u5230</p><p><img src="http://qnimg.gisfsde.com/work/image-20201120120914320.png" alt="image-20201120120914320" loading="lazy"></p><h4 id="\u6D88\u606F\u7684ttl-time-to-live" tabindex="-1"><a class="header-anchor" href="#\u6D88\u606F\u7684ttl-time-to-live" aria-hidden="true">#</a> \u6D88\u606F\u7684TTL\uFF08Time To Live\uFF09</h4><ul><li>\u6D88\u606F\u7684TTL \u5C31\u662F<strong>\u6D88\u606F\u7684\u5B58\u6D3B\u65F6\u95F4</strong>\uFF0C</li><li>RabbitMQ\u53EF\u4EE5\u5BF9<strong>\u961F\u5217</strong>\u8FD8\u6709<strong>\u6D88\u606F</strong>\u5206\u522B\u8BBE\u7F6ETTL <ul><li>\u5BF9\u961F\u5217\u8BBE\u7F6E\u5C31\u662F\u6CA1\u6709\u6D88\u8D39\u8005\u8FDE\u7740\u7684\u4FDD\u6301\u65F6\u95F4\uFF0C<strong>\u4E5F\u53EF\u4EE5\u5BF9\u6BCF\u4E00\u4E2A\u6D88\u606F\u5355\u72EC\u7684\u8BBE\u7F6E\uFF0C\u8D85\u8FC7\u4E86\u8FD9\u4E2A\u65F6\u95F4\u6211\u4EEC\u53EF\u4EE5\u8BA4\u4E3A\u8FD9\u4E2A\u6D88\u606F\u4ED6\u6B7B\u4E86\uFF0C\u79F0\u4E4B\u4E3A\u6B7B\u4FE1</strong></li><li>\u5982\u679C\u961F\u5217\u8BBE\u7F6E\u4E86\uFF0C\u6D88\u606F\u4E5F\u8BBE\u7F6E\u4E86\uFF0C\u90A3\u4E48\u4F1A<strong>\u53D6\u5C0F</strong>\uFF0C\u6240\u4EE5\u4E00\u4E2A\u6D88\u606F\u5982\u679C\u88AB\u8DEF\u7531\u5230\u4E0D\u540C\u7684\u961F\u5217\u4E2D\uFF0C\u8FD9\u4E2A\u6D88\u606F\u6B7B\u4EA1\u65F6\u95F4\u6709\u53EF\u80FD\u4E0D\u4E00\u6837\u7684\uFF08\u4E0D\u540C\u961F\u5217\u8BBE\u7F6E\uFF09\uFF0C\u8FD9\u91CC\u8BB2\u7684\u662F\u5355\u4E2ATTL \u56E0\u4E3A\u4ED6\u662F\u5B9E\u73B0\u5EF6\u65F6\u4EFB\u52A1\u7684\u5173\u952E\uFF0C\u53EF\u4EE5\u901A\u8FC7<strong>\u8BBE\u7F6E\u6D88\u606F\u7684 expiration \u5B57\u6BB5\u6216\u8005 x-message-ttl</strong> \u6765\u8BBE\u7F6E\u65F6\u95F4\u4E24\u8005\u662F\u4E00\u6837\u7684\u6548\u679C</li></ul></li></ul><h4 id="dead-letter-exchange-dlx" tabindex="-1"><a class="header-anchor" href="#dead-letter-exchange-dlx" aria-hidden="true">#</a> Dead Letter Exchange\uFF08DLX\uFF09</h4><ul><li>\u4E00\u4E2A\u6D88\u606F\u5728\u6EE1\u8DB3\u5982\u4E0B\u6761\u4EF6\u4E0B\uFF0C\u4F1A\u8FDB<strong>\u6B7B\u4FE1\u8DEF\u7531</strong>\uFF0C\u8BB0\u4F4F\u8FD9\u91CC\u662F\u8DEF\u7531\u4E0D\u662F\u961F\u5217\uFF0C\u4E00\u4E2A\u8DEF\u7531\u53EF\u4EE5\u5BF9\u5E94\u5F88\u591A\u961F\u5217\uFF0C\uFF08\u4EC0\u4E48\u662F\u6B7B\u4FE1\uFF09 <ul><li>\u4E00\u4E2A\u6D88\u606F\u88ABConsumer\u62D2\u6536\u4E86\uFF0C\u5E76\u4E14reject\u65B9\u6CD5\u7684\u53C2\u6570\u91CCrequeue\u662Ffalse\u3002\u4E5F\u5C31\u662F\u8BF4\u4E0D\u88AB\u518D\u6B21\u653E\u5728\u961F\u5217\u91CC\uFF0C\u88AB\u5176\u4ED6\u6D88\u8D39\u8005\u4F7F\u7528\u3002(basic.reject/ basic.nack)</li><li>requeue= false\u4E0A\u9762\u7684\u6D88\u606F\u7684TTL\u5230\u4E86\uFF0C\u6D88\u606F\u8FC7\u671F\u4E86\u3002</li><li>\u961F\u5217\u7684\u957F\u5EA6\u9650\u5236\u6EE1\u4E86\u3002\u6392\u5728\u524D\u9762\u7684\u6D88\u606F\u4F1A\u88AB\u4E22\u5F03\u6216\u8005\u6254\u5230\u6B7B\u4FE1\u8DEF\u7531\u4E0A</li></ul></li><li>Dead Letter Exchange\u5176\u5B9E\u5C31\u662F\u4E00\u79CD\u666E\u901A\u7684exchange, \u548C\u521B\u5EFA\u5176\u4ED6exchange\u6CA1\u6709\u4E24\u6837\u3002\u53EA\u662F\u5728\u67D0\u4E00\u4E2A\u8BBE\u7F6E Dead Letter Exchange\u7684\u961F\u5217\u4E2D\u6709\u6D88\u606F\u8FC7\u671F\u4E86\u81EA\u52A8\u89E6\u53D1\u6D88\u606F\u7684\u8F6C\u53D1\uFF0C\u53D1\u9001\u5230Dead Letter Exchange\u4E2D\u53BB\u3002</li><li>\u6211\u4EEC\u65E2\u53EF\u4EE5\u63A7\u5236\u6D88\u606F\u5728\u4E00\u6BB5\u65F6\u95F4\u540E\u53D8\u6210\u6B7B\u4FE1\uFF0C \u53C8\u53EF\u4EE5\u63A7\u5236\u53D8\u6210\u6B7B\u4FE1\u7684\u6D88\u606F\u88AB\u8DEF\u7531\u5230\u67D0\u4E00\u4E2A\u6307\u5B9A\u7684\u4EA4\u6362\u673A\uFF0C \u7ED3\u5408C\u8005\uFF0C\u5176\u5B9E\u5C31\u53EF\u4EE5\u5B9E\u73B0\u4E00\u4E2A\u5EF6\u65F6\u961F\u5217</li></ul><h4 id="\u5EF6\u65F6\u961F\u5217\u5B9E\u73B0-1" tabindex="-1"><a class="header-anchor" href="#\u5EF6\u65F6\u961F\u5217\u5B9E\u73B0-1" aria-hidden="true">#</a> \u5EF6\u65F6\u961F\u5217\u5B9E\u73B0 - 1</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201120132805292.png" alt="image-20201120132805292" loading="lazy"></p><p>\u5EF6\u65F6\u961F\u5217\u5B9E\u73B0 - 2</p><p><img src="http://qnimg.gisfsde.com/work/image-20201120132922164.png" alt="image-20201120132922164" loading="lazy"></p><p>\u4EE3\u7801\u5B9E\u73B0\uFF1A</p><p>\u4E0B\u5355\u573A\u666F</p><p><img src="http://qnimg.gisfsde.com/work/image-20201120133054368.png" alt="image-20201120133054368" loading="lazy"></p><p>\u6A21\u5F0F\u5347\u7EA7</p><p><img src="http://qnimg.gisfsde.com/work/image-20201120133258725.png" alt="image-20201120133258725" loading="lazy"></p><p>\u4EE3\u7801\u5B9E\u73B0\uFF1A</p><p>SpringBoot\u53EF\u4EE5\u4F7F\u7528@Bean \u6765\u521D\u59CB\u5316Queue\u3001exchange\u3001Biding\u7B49</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u76D1\u542C\u961F\u5217\u4FE1\u606F
 * <span class="token keyword">@param</span> <span class="token parameter">orderEntity</span>
 */</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;order.release.order.queue&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token class-name">OrderEntity</span> orderEntity<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6536\u5230\u8FC7\u671F\u7684\u8BA2\u5355\u4FE1\u606F\uFF0C\u51C6\u5907\u5173\u95ED\u8BA2\u5355&quot;</span> <span class="token operator">+</span> orderEntity<span class="token punctuation">.</span><span class="token function">getOrderSn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u786E\u8BA4\u63A5\u6536\u5230\u6D88\u606F\uFF0C\u4E0D\u6279\u91CF\u63A5\u6536</span>
    channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * \u5BB9\u5668\u4E2D\u7684 Binding\u3001Queue\u3001exchange \u90FD\u4F1A\u81EA\u52A8\u521B\u5EFA\uFF0C(RabbitMQ\u6CA1\u6709\u7684\u60C5\u51B5\u4E0B)
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">orderDelayQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u7279\u6B8A\u53C2\u6570</span>
    <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u8BBE\u7F6E\u4EA4\u6362\u5668</span>

    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-exchange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;order-event-exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u8DEF\u7531\u952E</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-routing-key&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order.release.order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u6D88\u606F\u8FC7\u671F\u65F6\u95F4</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-message-ttl&quot;</span><span class="token punctuation">,</span><span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Queue</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;order.delay.queue&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> queue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * \u521B\u5EFA\u961F\u5217
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">orderReleaseOrderQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Queue</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;order.release.order.queue&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> queue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * \u521B\u5EFA\u4EA4\u6362\u673A
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Exchange</span> <span class="token function">orderEventExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TopicExchange</span><span class="token punctuation">(</span><span class="token string">&quot;order-event-exchange&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * \u7ED1\u5B9A\u5173\u7CFB \u5C06delay.queue\u548Cevent-exchange\u8FDB\u884C\u7ED1\u5B9A
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">orderCreateOrderBingding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Binding</span><span class="token punctuation">(</span><span class="token string">&quot;order.delay.queue&quot;</span><span class="token punctuation">,</span>
                <span class="token class-name">Binding<span class="token punctuation">.</span>DestinationType</span><span class="token punctuation">.</span>QUEUE<span class="token punctuation">,</span>
                <span class="token string">&quot;order-event-exchange&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;order.create.order&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * \u5C06 release.queue \u548C event-exchange\u8FDB\u884C\u7ED1\u5B9A
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">orderReleaseOrderBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Binding</span><span class="token punctuation">(</span><span class="token string">&quot;order.release.order.queue&quot;</span><span class="token punctuation">,</span>
            <span class="token class-name">Binding<span class="token punctuation">.</span>DestinationType</span><span class="token punctuation">.</span>QUEUE<span class="token punctuation">,</span>
            <span class="token string">&quot;order-event-exchange&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;order.release.order&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-9-\u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u53EF\u9760\u6027-\u6D88\u606F\u4E22\u5931-\u6D88\u606F\u91CD\u590D" tabindex="-1"><a class="header-anchor" href="#_13-9-\u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u53EF\u9760\u6027-\u6D88\u606F\u4E22\u5931-\u6D88\u606F\u91CD\u590D" aria-hidden="true">#</a> 13.9 \u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u53EF\u9760\u6027 - \u6D88\u606F\u4E22\u5931 &amp; \u6D88\u606F\u91CD\u590D</h3><h4 id="_1\u3001\u6D88\u606F\u4E22\u5931" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6D88\u606F\u4E22\u5931" aria-hidden="true">#</a> 1\u3001\u6D88\u606F\u4E22\u5931</h4><ul><li><strong>\u6D88\u606F\u53D1\u9001\u51FA\u53BB\uFF0C\u7531\u4E8E\u7F51\u7EDC\u95EE\u9898\u6CA1\u6709\u62B5\u8FBE\u670D\u52A1\u5668</strong><ul><li>\u505A\u597D\u5BB9\u9519\u65B9\u6CD5(try-Catch) \uFF0C\u53D1\u9001\u6D88\u606F\u53EF\u80FD\u4F1A\u7F51\u7EDC\u5931\u8D25\uFF0C\u5931\u8D25\u540E\u8981\u6709\u91CD\u8BD5\u673A\u5236\uFF0C\u53EF\u8BB0\u5F55\u5230\u6570\u636E\u5E93\uFF0C\u91C7\u7528\u5B9A\u671F\u626B\u63CF\u91CD\u53D1\u7684\u65B9\u5F0F</li><li>\u505A\u597D\u65E5\u5FD7\u8BB0\u5F55\uFF0C\u6BCF\u4E2A\u6D88\u606F\u72B6\u6001\u662F\u5426\u90FD\u88AB\u670D\u52A1\u5668\u6536\u5230\u90FD\u5E94\u8BE5\u8BB0\u5F55</li><li>\u505A\u597D\u5B9A\u671F\u91CD\u53D1\uFF0C\u5982\u679C\u6D88\u606F\u6CA1\u6709\u53D1\u9001\u6210\u529F\uFF0C\u5B9A\u671F\u53BB\u6570\u636E\u5E93\u626B\u63CF\u672A\u6210\u529F\u7684\u6D88\u606F\u8FDB\u884C\u91CD\u53D1</li></ul></li><li><strong>\u6D88\u606F\u62B5\u8FBEBroker, Broker\u8981\u5C06\u6D88\u606F\u5199\u5165\u78C1\u76D8(\u6301\u4E45\u5316)\u624D\u7B97\u6210\u529F\u3002\u6B64\u65F6Broker\u5C1A\u672A\u6301\u4E45\u5316\u5B8C\u6210\uFF0C\u5B95\u673A\u3002</strong><ul><li>publisher\u4E5F\u5FC5\u987B\u52A0\u5165\u786E\u8BA4\u56DE\u8C03\u673A\u5236\uFF0C\u786E\u8BA4\u6210\u529F\u7684\u6D88\u606F\uFF0C\u4FEE\u6539\u6570\u636E\u5E93\u6D88\u606F\u72B6\u6001\u3002</li></ul></li><li><strong>\u81EA\u52A8ACK\u7684\u72B6\u6001\u4E0B\u3002\u6D88\u8D39\u8005\u6536\u5230\u6D88\u606F\uFF0C\u4F46\u6CA1\u6765\u5F97\u53CA\u6D88\u606F\u7136\u540E\u5B95\u673A</strong><ul><li>\u4E00\u5B9A\u5F00\u542F\u624B\u52A8ACK\uFF0C\u6D88\u8D39\u6210\u529F\u624D\u79FB\u9664\uFF0C\u5931\u8D25\u6216\u8005\u6CA1\u6765\u5F97\u53CA\u5904\u7406\u5C31noAck\u5E76\u91CD\u65B0\u5165\u961F</li></ul></li></ul><h4 id="_2\u3001\u6D88\u606F\u91CD\u590D" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6D88\u606F\u91CD\u590D" aria-hidden="true">#</a> 2\u3001\u6D88\u606F\u91CD\u590D</h4><ul><li><strong>\u6D88\u606F\u6D88\u8D39\u6210\u529F\uFF0C\u4E8B\u52A1\u5DF2\u7ECF\u63D0\u4EA4\uFF0Cack\u65F6\uFF0C\u673A\u5668\u5B95\u673A\u3002\u5BFC\u81F4\u6CA1\u6709ack\u6210\u529F\uFF0CBroker\u7684\u6D88\u606F\u91CD\u65B0\u7531unack\u53D8\u4E3Aready,\u5E76\u53D1\u9001\u7ED9\u5176\u4ED6\u6D88\u8D39\u8005</strong></li><li><strong>\u6D88\u606F\u6D88\u8D39\u5931\u8D25\uFF0C\u7531\u4E8E\u91CD\u8BD5\u673A\u5236\uFF0C\u81EA\u52A8\u53C8\u5C06\u6D88\u606F\u53D1\u9001\u51FA\u53BB</strong></li><li><strong>\u6210\u529F\u6D88\u8D39\uFF0Cack\u65F6\u5B95\u673A\uFF0C\u6D88\u606F\u7531unack\u53D8\u4E3Aready, Broker\u53C8\u91CD\u65B0\u53D1\u9001</strong><ul><li>\u6D88\u8D39\u8005\u7684\u4E1A\u52A1\u6D88\u8D39\u63A5\u53E3\u5E94\u8BE5\u8BBE\u8BA1\u4E3A<strong>\u5E42\u7B49\u6027</strong>\u7684\u3002\u6BD4\u5982\u6263\u5E93\u5B58\u6709\u5DE5\u4F5C\u5355\u7684\u72B6\u6001\u6807\u5FD7</li><li>\u4F7F\u7528<strong>\u9632\u91CD\u8868</strong>(redis/mysq|) \uFF0C\u53D1\u9001\u6D88\u606F\u6BCF\u4E00 \u4E2A\u90FD\u6709\u4E1A\u52A1\u7684\u552F\u4E00 \u6807\u8BC6\uFF0C\u5904\u7406\u8FC7\u5C31\u4E0D\u7528\u5904\u7406</li><li>rabbitMQ\u7684\u6BCF\u4E00\u4E2A\u6D88\u606F\u90FD\u6709redelivered\u5B57\u6BB5\uFF0C \u53EF\u4EE5\u83B7\u53D6<strong>\u662F\u5426\u662F\u88AB\u91CD\u65B0\u6295\u9012\u8FC7\u6765\u7684</strong>\uFF0C\u800C\u4E0D\u662F\u7B2C\u4E00\u6B21\u6295\u9012\u8FC7\u6765\u7684</li></ul></li></ul><h4 id="_3\u3001\u6D88\u606F\u79EF\u538B" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u6D88\u606F\u79EF\u538B" aria-hidden="true">#</a> 3\u3001\u6D88\u606F\u79EF\u538B</h4><ul><li><strong>\u6D88\u8D39\u8005\u79EF\u538B</strong></li><li><strong>\u6D88\u8D39\u8005\u6D88\u8D39\u80FD\u529B\u4E0D\u8DB3\u79EF\u538B</strong></li><li><strong>\u53D1\u9001\u8005\u53D1\u9001\u6D41\u91CF\u592A\u5927</strong><ul><li>\u4E0A\u7EBF\u66F4\u591A\u6D88\u8D39\u8005\uFF0C\u8FDB\u884C\u6B63\u5E38\u6D88\u8D39</li><li>\u4E0A\u7EBF\u4E13\u95E8\u7684\u961F\u5217\u6D88\u8D39\u670D\u52A1\uFF0C\u5C06\u6D88\u606F\u5148\u6279\u91CF\u53D6\u51FA\u6765\uFF0C\u8BB0\u5F55\u6570\u636E\u5E93\uFF0C\u79BB\u7EBF\u6162\u6162\u5904\u7406</li></ul></li></ul><h1 id="_14\u3001\u8BA2\u5355" tabindex="-1"><a class="header-anchor" href="#_14\u3001\u8BA2\u5355" aria-hidden="true">#</a> 14\u3001\u8BA2\u5355</h1><h3 id="_14-1-\u8BA2\u5355\u4E2D\u5FC3" tabindex="-1"><a class="header-anchor" href="#_14-1-\u8BA2\u5355\u4E2D\u5FC3" aria-hidden="true">#</a> 14.1 \u8BA2\u5355\u4E2D\u5FC3</h3><p>1\u3001\u8BA2\u5355\u4E2D\u5FC3</p><p>\u7535\u5546\u7CFB\u5217\u6D89\u53CA\u5230 3 \u6D41\uFF0C\u5206\u522B\u4E3A\u4FE1\u606F\u6D41\u3001\u8D44\u91D1\u6D41\u3001\u7269\u6D41\uFF0C\u800C\u8BA2\u5355\u7CFB\u7EDF\u4F5C\u4E3A\u4E2D\u67A2\u5C06\u4E09\u8005\u6709\u673A\u7684\u96C6\u5408\u8D77\u6765</p><p>\u8BA2\u5355\u6A21\u5757\u662F\u7535\u5546\u7CFB\u7EDF\u7684\u67A2\u7EBD\uFF0C\u5728\u8BA2\u5355\u8FD9\u4E2A\u6A21\u5757\u4E0A\u83B7\u53D6\u591A\u4E2A\u6A21\u5757\u7684\u6570\u636E\u548C\u4FE1\u606F\uFF0C\u540C\u65F6\u5BF9\u8FD9\u4E9B\u4FE1\u606F\u8FDB\u884C\u52A0\u5DE5\u5904\u7406\u540E\u6D41\u5411\u4E0B\u4E2A\u73AF\u8282\uFF0C\u8FD9\u4E00\u7CFB\u5217\u5C31\u6784\u6210\u4E86\u8BA2\u5355\u7684\u4FE1\u606F\u758F\u901A</p><h4 id="_1\u3001\u8BA2\u5355\u6784\u6210" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u8BA2\u5355\u6784\u6210" aria-hidden="true">#</a> 1\u3001\u8BA2\u5355\u6784\u6210</h4><p><img src="http://qnimg.gisfsde.com/work/image-20201117102129127.png" alt="image-20201117102129127" loading="lazy"></p><h5 id="_1\u3001\u7528\u6237\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7528\u6237\u4FE1\u606F" aria-hidden="true">#</a> 1\u3001\u7528\u6237\u4FE1\u606F</h5><p>\u7528\u6237\u4FE1\u606F\u5305\u62EC\u662F\u7528\u6237\u8D26\u53F7\u3001\u7528\u6237\u7B49\u7EA7\u3001\u7528\u6237\u7684\u6536\u8D27\u5730\u5740\u3001\u6536\u8D27\u4EBA\u3001\u6536\u8D27\u4EBA\u7535\u8BDD\u3001\u7528\u6237\u8D26\u53F7\u9700\u8981\u7ED1\u5B9A\u624B\u673A\u53F7\u7801\uFF0C\u4F46\u662F\u7528\u6237\u7ED1\u5B9A\u7684\u624B\u673A\u53F7\u7801\u4E0D\u4E00\u5B9A\u662F\u6536\u8D27\u4FE1\u606F\u4E0A\u7684\u7535\u8BDD\u3002\u7528\u6237\u53EF\u4EE5\u6DFB\u52A0\u591A\u4E2A\u6536\u8D27\u4FE1\u606F\uFF0C\u7528\u6237\u7B49\u7EA7\u4FE1\u606F\u53EF\u4EE5\u7528\u6765\u548C\u4FC3\u9500\u7CFB\u7EDF\u8FDB\u884C\u5339\u914D\uFF0C\u83B7\u53D6\u5546\u54C1\u6298\u6263\uFF0C\u540C\u65F6\u7528\u6237\u7B49\u7EA7\u8FD8\u53EF\u4EE5\u83B7\u53D6\u79EF\u5206\u7684\u5956\u52B1\u7B49</p><h5 id="_2\u3001\u8BA2\u5355\u57FA\u7840\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u8BA2\u5355\u57FA\u7840\u4FE1\u606F" aria-hidden="true">#</a> 2\u3001\u8BA2\u5355\u57FA\u7840\u4FE1\u606F</h5><p>\u8BA2\u5355\u57FA\u7840\u4FE1\u606F\u662F\u8BA2\u5355\u6D41\u8F6C\u7684\u6838\u5FC3\uFF0C\u5176\u5305\u62EC\u8BA2\u5355\u7C7B\u578B\uFF0C\u7236/\u5B50\u8BA2\u5355\u3001\u8BA2\u5355\u7F16\u53F7\u3001\u8BA2\u5355\u72B6\u6001\u3001\u8BA2\u5355\u6D41\u8F6C\u65F6\u95F4\u7B49</p><ol><li>\u8BA2\u5355\u7C7B\u578B\u5305\u62EC\u5B9E\u4F53\u8BA2\u5355\u548C\u865A\u62DF\u8BA2\u5355\u5546\u54C1\u7B49\uFF0C\u8FD9\u4E2A\u6839\u636E\u5546\u57CE\u5546\u54C1\u548C\u670D\u52A1\u7C7B\u578B\u8FDB\u884C\u533A\u5206</li><li>\u540C\u65F6\u8BA2\u5355\u90FD\u9700\u8981\u505A\u7236\u5B50\u8BA2\u5355\u5904\u7406\uFF0C\u4E4B\u524D\u5728\u521D\u521B\u516C\u53F8\u4E00\u76F4\u53EA\u6709\u4E00\u4E2A\u8BA2\u5355\uFF0C\u6CA1\u6709\u505A\u7236\u5B50\u8BA2\u5355\u5904\u7406\u540E\u671F\u9700</li><li>\u8981\u8FDB\u884C\u62C6\u5355\u7684\u65F6\u5019\u5C31\u6BD4\u8F83\u9EBB\u70E6\uFF0C\u5C24\u5176\u662F\u591A\u5546\u6237\u5546\u573A\uFF0C\u548C\u4E0D\u540C\u4ED3\u5E93\u5546\u54C1\u7684\u65F6\u5019\uFF0C\u7236\u5B50\u8BA2\u5355\u5C31\u662F\u4E3A\u540E\u671F\u505A\u62C6\u5355\u51C6\u5907\u7684\u3002</li><li>\u8BA2\u5355\u7F16\u53F7\u4E0D\u591A\u8BF4\u4E86\uFF0C\u9700\u8981\u5F3A\u8C03\u7684\u4E00\u70B9\u662F\u7236\u5B50\u8BA2\u5355\u90FD\u9700\u8981\u6709\u8BA2\u5355\u7F16\u53F7\uFF0C\u9700\u8981\u5B8C\u5584\u7684\u65F6\u5019\u53EF\u4EE5\u5BF9\u8BA2\u5355\u7F16\u53F7\u7684\u6BCF\u4E2A\u5B57\u6BB5\u8FDB\u884C\u7EDF\u4E00\u5B9A\u4E49\u548C\u8BE0\u91CA\u3002</li><li>\u8BA2\u5355\u72B6\u6001\u8BB0\u5F55\u8BA2\u5355\u6BCF\u6B21\u6D41\u8F6C\u8FC7\u7A0B\uFF0C\u540E\u9762\u4F1A\u5BF9\u8BA2\u5355\u72B6\u6001\u8FDB\u884C\u5355\u72EC\u7684\u8BF4\u660E\u3002</li><li>\u8BA2\u5355\u6D41\u8F6C\u65F6\u95F4\u9700\u8981\u8BB0\u5F55\u4E0B\u5355\u65F6\u95F4\uFF0C\u652F\u4ED8\u65F6\u95F4\uFF0C\u53D1\u8D27\u65F6\u95F4\uFF0C\u7ED3\u675F\u65F6\u95F4/\u5173\u95ED\u65F6\u95F4\u7B49\u7B49</li></ol><h5 id="_3\u3001\u5546\u54C1\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5546\u54C1\u4FE1\u606F" aria-hidden="true">#</a> 3\u3001\u5546\u54C1\u4FE1\u606F</h5><p>\u5546\u54C1\u4FE1\u606F\u4ECE\u5546\u54C1\u5E93\u4E2D\u83B7\u53D6\u5546\u54C1\u7684SKU\u4FE1\u606F\u3001\u56FE\u7247\u3001\u540D\u79F0\u3001\u5C5E\u6027\u89C4\u683C\u3001\u5546\u54C1\u5355\u4EF7\u3001\u5546\u6237\u4FE1\u606F\u7B49\uFF0C\u4ECE\u7528\u6237</p><p>\u4E0B\u5355\u884C\u4E3A\u8BB0\u5F55\u7684\u7528\u6237\u4E0B\u5355\u6570\u91CF\uFF0C\u5546\u54C1\u5408\u8BA1\u4EF7\u683C\u7B49</p><h5 id="_4\u3001\u4F18\u60E0\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u4F18\u60E0\u4FE1\u606F" aria-hidden="true">#</a> 4\u3001\u4F18\u60E0\u4FE1\u606F</h5><p>\u4F18\u60E0\u4FE1\u606F\u8BB0\u5F55\u7528\u6237\u53C2\u4E0E\u8FC7\u7684\u4F18\u60E0\u6D3B\u52A8\uFF0C\u5305\u62EC\u4F18\u60E0\u4FC3\u9500\u6D3B\u52A8\uFF0C\u6BD4\u5982\u6EE1\u51CF\u3001\u6EE1\u8D60\u3001\u79D2\u6740\u7B49\uFF0C\u7528\u6237\u4F7F\u7528\u7684\u4F18</p><p>\u60E0\u5377\u4FE1\u606F\uFF0C\u4F18\u60E0\u5377\u6EE1\u8DB3\u6761\u4EF6\u7684\u4F18\u60E0\u5377\u9700\u8981\u5C55\u793A\u51FA\u6765\uFF0C\u53E6\u5916\u865A\u62DF\u5E01\u62B5\u6263\u4FE1\u606F\u7B49\u8FDB\u884C\u8BB0\u5F55</p><p>\u4E3A\u4EC0\u4E48\u628A\u4F18\u60E0\u4FE1\u606F\u5355\u72EC\u62FF\u51FA\u6765\u800C\u4E0D\u653E\u5728\u652F\u4ED8\u4FE1\u606F\u91CC\u9762\u5462?</p><p>\u56E0\u4E3A\u4F18\u60E0\u4FE1\u606F\u53EA\u662F\u8BB0\u5F55\u7528\u6237\u4F7F\u7528\u7684\u6761\u76EE\uFF0C\u800C\u652F\u4ED8\u4FE1\u606F\u9700\u8981\u52A0\u5165\u6570\u636E\u8FDB\u884C\u8BA1\u7B97\uFF0C\u6240\u4EE5\u505A\u4E3A\u533A\u5206\u3002</p><h5 id="_5\u3001\u652F\u4ED8\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u652F\u4ED8\u4FE1\u606F" aria-hidden="true">#</a> 5\u3001\u652F\u4ED8\u4FE1\u606F</h5><p>\u652F\u4ED8\u6D41\u6C34\u5355\u53F7\uFF0C\u8FD9\u4E2A\u6D41\u6C34\u5355\u53F7\u662F\u5728\u5524\u8D77\u7F51\u5173\u652F\u4ED8\u540E\u652F\u4ED8\u901A\u9053\u8FD4\u56DE\u7ED9\u7535\u5546\u4E1A\u52A1\u5E73\u53F0\u7684\u652F\u4ED8\u6D41\u6C34\u53F7\uFF0C\u8D22\u52A1</p><p>\u901A\u8FC7\u8BA2\u5355\u53F7\u548C\u6D41\u6C34\u5355\u53F7\u4E0E\u652F\u4ED8\u901A\u9053\u8FDB\u884C\u5BF9\u8D26\u4F7F\u7528\u3002</p><p>\u652F\u4ED8\u65B9\u5F0F\u7528\u6237\u4F7F\u7528\u7684\u652F\u4ED8\u65B9\u5F0F\uFF0C\u6BD4\u5982\u5FAE\u4FE1\u652F\u4ED8\u3001\u652F\u4ED8\u5B9D\u652F\u4ED8\u3001\u94B1\u5305\u652F\u4ED8\u3001\u5FEB\u6377\u652F\u4ED8\u7B49\u3002\u652F\u4ED8\u65B9\u5F0F\u6709\u65F6\u5019\u53EF\u80FD\u6709\u4E24\u4E2A\u4E00-\u4F59\u989D\u652F\u4ED8+\u7B2C\u4E09\u65B9\u652F\u4ED8\u3002</p><p>\u5546\u54C1\u603B\u91D1\u989D\uFF0C\u6BCF\u4E2A\u5546\u54C1\u52A0\u603B\u540E\u7684\u91D1\u989D:\u8FD0\u8D39\uFF0C\u7269\u6D41\u4EA7\u751F\u7684\u8D39\u7528;\u4F18\u60E0\u603B\u91D1\u989D\uFF0C\u5305\u62EC\u4FC3\u9500\u6D3B\u52A8\u7684\u4F18\u60E0\u91D1\u989D\uFF0C</p><p>\u4F18\u60E0\u5238\u4F18\u60E0\u91D1\u989D\uFF0C\u865A\u62DF\u79EF\u5206\u6216\u8005\u865B\u62DF\u5E01\u62B5\u6263\u7684\u91D1\u984D\uFF0C\u4F1A\u5458\u6298\u6263\u7684\u91D1\u989D\u7B49\u4E4B\u548C;\u5B9E\u4ED8\u91D1\u989D\uFF0C\u7528\u6237\u5B9E\u9645\u9700\u8981</p><p>\u4ED8\u6B3E\u7684\u91D1\u989D\u3002</p><p><strong>\u7528\u6237\u5B9E\u4ED8\u91D1\u989D=\u5546\u54C1\u603B\u91D1\u989D+\u8FD0\u8D39 - \u4F18\u60E0\u603B\u91D1\u989D</strong></p><h5 id="_6\u3001\u7269\u6D41\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u7269\u6D41\u4FE1\u606F" aria-hidden="true">#</a> 6\u3001\u7269\u6D41\u4FE1\u606F</h5><p>\u7269\u6D41\u4FE1\u606F\u5305\u62EC\u914D\u9001\u65B9\u5F0F\uFF0C\u7269\u6D41\u516C\u53F8\uFF0C\u7269\u6D41\u5355\u53F7\uFF0C\u7269\u6D41\u72B6\u6001\uFF0C\u7269\u6D41\u72B6\u6001\u53EF\u4EE5\u901A\u8FC7\u7B2C\u4E09\u65B9\u63A5\u53E3\u6765 \u83B7\u53D6\u548C\u5411\u7528\u6237\u5C55\u793A\u7269\u6D41\u6BCF\u4E2A\u72B6\u6001\u8282\u70B9\u3002</p><h4 id="_2\u3001\u8BA2\u5355\u72B6\u6001" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u8BA2\u5355\u72B6\u6001" aria-hidden="true">#</a> 2\u3001\u8BA2\u5355\u72B6\u6001</h4><h5 id="_1\u3001\u5F85\u4ED8\u6B3E" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5F85\u4ED8\u6B3E" aria-hidden="true">#</a> 1\u3001\u5F85\u4ED8\u6B3E</h5><p>\u7528\u6237\u63D0\u4EA4\u8BA2\u5355\u540E\uFF0C\u8BA2\u5355\u8FDB\u884C\u9884\u4E0B\u5355\uFF0C\u76EE\u524D\u4E3B\u6D41\u7535\u5546\u7F51\u7AD9\u90FD\u4F1A\u5524\u8D77\u652F\u4ED8\uFF0C\u4FBF\u4E8E\u7528\u6237\u5FEB\u901F\u5B8C\u6210\u652F \u4ED8\uFF0C\u9700\u8981\u6CE8\u610F\u7684\u662F\u5F85\u4ED8\u6B3E\u72B6\u6001\u4E0B\u53EF\u4EE5\u5BF9\u5E93\u5B58\u8FDB\u884C\u9501\u5B9A\uFF0C\u9501\u5B9A\u5E93\u5B58\u9700\u8981\u914D\u7F6E\u652F\u4ED8\u8D85\u65F6\u65F6\u95F4\uFF0C\u8D85 \u65F6\u540E\u5C06\u81EA\u52A8\u53D6\u6D88\u8BA2\u5355\uFF0C\u8BA2\u5355\u53D8\u66F4\u5173\u95ED\u72B6\u6001\u3002</p><h5 id="_2\u3001\u5DF2\u4ED8\u6B3E-\u4EE3\u53D1\u8D27" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5DF2\u4ED8\u6B3E-\u4EE3\u53D1\u8D27" aria-hidden="true">#</a> 2\u3001\u5DF2\u4ED8\u6B3E/\u4EE3\u53D1\u8D27</h5><p>\u7528\u6237\u5B8C\u6210\u8BA2\u5355\u652F\u4ED8\uFF0C\u8BA2\u5355\u7CFB\u7EDF\u9700\u8981\u8BB0\u5F55\u652F\u4ED8\u65F6\u95F4\uFF0C\u652F\u4ED8\u6D41\u6C34\u5355\u53F7\u4FBF\u4E8E\u5BF9\u8D26\uFF0C\u8BA2\u5355\u4E0B\u653E\u5230WMS\u7CFB\u7EDF\uFF0C\u4ED3\u5E93\u8FDB\u884C\u8C03\u52A8\u3001\u914D\u8D27\u3001\u5206\u62E3\uFF0C\u51FA\u5E93\u7B49\u64CD\u4F5C</p><h5 id="_3\u3001\u5F85\u6536\u8D27-\u5DF2\u53D1\u8D27" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5F85\u6536\u8D27-\u5DF2\u53D1\u8D27" aria-hidden="true">#</a> 3\u3001\u5F85\u6536\u8D27/\u5DF2\u53D1\u8D27</h5><p>\u4ED3\u5E93\u5C06\u5546\u54C1\u51FA\u5E93\u540E\uFF0C\u8BA2\u5355\u8FDB\u5165\u7269\u6D41\u73AF\u8282\uFF0C\u8BA2\u5355\u7CFB\u7EDF\u9700\u8981\u540C\u6B65\u7269\u6D41\u4FE1\u606F\uFF0C\u4FBF\u4E8E\u7528\u6237\u5B9E\u65F6\u719F\u6089\u5546\u54C1\u7684\u7269\u6D41\u72B6\u6001</p><h5 id="_4\u3001\u5DF2\u5B8C\u6210" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5DF2\u5B8C\u6210" aria-hidden="true">#</a> 4\u3001\u5DF2\u5B8C\u6210</h5><p>\u7528\u6237\u786E\u8BA4\u6536\u8D27\u540E\u5417\uFF0C\u8BA2\u5355\u4EA4\u6613\u5B8C\u6210\uFF0C\u540E\u7EED\u652F\u4ED8\u5219\u8FDB\u884C\u8BA1\u7B97\uFF0C\u5982\u679C\u8BA2\u5355\u5B58\u5728\u95EE\u9898\u8FDB\u5165\u552E\u540E\u72B6\u6001</p><h5 id="_5\u3001\u5DF2\u53D6\u6D88" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u5DF2\u53D6\u6D88" aria-hidden="true">#</a> 5\u3001\u5DF2\u53D6\u6D88</h5><p>\u4ED8\u6B3E\u4E4B\u524D\u53D6\u6D88\u8BA2\u5355\uFF0C\u5305\u62EC\u8D85\u65F6\u672A\u4ED8\u6B3E\u6216\u7528\u6237\u5546\u6237\u53D6\u6D88\u8BA2\u5355\u90FD\u4F1A\u4EA7\u751F\u8FD9\u79CD\u8BA2\u5355\u72B6\u6001</p><h5 id="_6\u3001\u552E\u540E\u4E2D" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u552E\u540E\u4E2D" aria-hidden="true">#</a> 6\u3001\u552E\u540E\u4E2D</h5><p>\u7528\u6237\u5728\u4ED8\u6B3E\u540E\u7533\u8BF7\u9000\u6B3E\uFF0C\u6216\u5546\u5BB6\u53D1\u8D27\u540E\u7528\u6237\u7533\u8BF7\u9000\u8D27</p><p>\u552E\u540E\u4E5F\u540C\u6837\u5B58\u5728\u5404\u79CD\u72B6\u6001\uFF0C\u5F53\u53D1\u8D77\u552E\u540E\u7533\u8BF7\u540E\u751F\u6210\u552E\u540E\u8BA2\u5355\uFF0C\u552E\u540E\u8BA2\u5355\u72B6\u6001\u4E3A\u5F85\u5BA1\u6838\uFF0C\u7B49\u5F85</p><p>\u5546\u5BB6\u5BA1\u6838\uFF0C\u5546\u5BB6\u5BA1\u6838\u901A\u8FC7\u540E\u8BA2\u5355\u72B6\u6001\u53D8\u66F4\u4E3A\u5F85\u9000\u8D27\uFF0C\u7B49\u5F85\u7528\u6237\u5C06\u5546\u54C1\u5BC4\u56DE\uFF0C\u5546\u5BB6\u6536\u8D27\u540E\u8BA2\u5355</p><p>\u72B6\u6001\u66F4\u65B0\u4E3A\u5F85\u9000\u6B3E\u72B6\u6001\uFF0C\u9000\u6B3E\u5230\u7528\u6237\u539F\u8D26\u6237\u540E\u8BA2\u5355\u72B6\u6001\u66F4\u65B0\u4E3A\u552E\u540E\u6210\u529F\u3002</p><h3 id="_14-2-\u8BA2\u5355\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_14-2-\u8BA2\u5355\u6D41\u7A0B" aria-hidden="true">#</a> 14.2 \u8BA2\u5355\u6D41\u7A0B</h3><p>\u8BA2\u5355\u6D41\u7A0B\u662F\u6307\u4ECE\u8BA2\u5355\u4EA7\u751F\u5230\u5B8C\u6210\u6574\u4E2A\u6D41\u8F6C\u7684\u8FC7\u7A0B\uFF0C\u4ECE\u800C\u884C\u7A0B\u4E86-\u5957\u6807\u51C6\u6D41\u7A0B\u89C4\u5219\u3002\u800C\u4E0D\u540C\u7684\u4EA7\u54C1\u7C7B\u578B\u6216\u4E1A\u52A1\u7C7B\u578B\u5728\u7CFB\u7EDF\u4E2D\u7684\u6D41\u7A0B\u4F1A\u5343\u5DEE\u4E07\u522B\uFF0C\u6BD4\u5982\u4E0A\u9762\u63D0\u5230\u7684\u7EBF\u4E0A\u5B9E\u7269\u8BA2\u5355\u548C\u865A\u62DF\u8BA2\u5355\u7684\u6D41\u7A0B\uFF0C\u7EBF\u4E0A\u5B9E\u7269\u8BA2\u5355\u4E0E020\u8BA2\u5355\u7B49\uFF0C\u6240\u4EE5\u9700\u8981\u6839\u636E\u4E0D\u540C\u7684\u7C7B\u578B\u8FDB\u884C\u6784\u5EFA\u8BA2\u5355\u6D41\u7A0B\u3002\u4E0D\u7BA1\u7C7B\u578B\u5982\u4F55\u8BA2\u5355\u90FD\u5305\u62EC\u6B63\u5411\u6D41\u7A0B\u548C\u9006\u5411\u6D41\u7A0B\uFF0C\u5BF9\u5E94\u7684\u573A\u666F\u5C31\u662F\u8D2D\u4E70\u5546\u54C1\u548C\u9000\u6362\u8D27\u6D41\u7A0B\uFF0C\u6B63\u5411\u6D41\u7A0B\u5C31\u662F\u4E00\u4E00\u4E2A\u6B63\u5E38\u7684\u7F51\u8D2D\u6B65\u9AA4:\u8BA2\u5355\u751F\u6210&gt;\u652F\u4ED8\u8BA2\u5355-&gt;\u5356\u5BB6\u53D1\u8D27\u4E00\u786E\u8BA4\u6536\u8D27&gt;\u4EA4\u6613\u6210\u529F\u3002\u800C\u6BCF\u4E2A\u6B65\u9AA4\u7684\u80CC\u540E\uFF0C\u8BA2\u5355\u662F\u5982\u4F55\u5728\u591A\u7CFB\u7EDF\u4E4B\u95F4\u4EA4\u4E92\u6D41\u8F6C\u7684\uFF0C</p><p>\u53EF\u6982\u62EC\u5982\u4E0B\u56FE</p><p><img src="http://qnimg.gisfsde.com/work/image-20201117104613032.png" alt="image-20201117104613032" loading="lazy"></p><p>1\u3001\u8BA2\u5355\u521B\u5EFA\u4E0E\u652F\u4ED8</p><ol><li>\u8BA2\u5355\u521B\u5EFA\u524D\u9700\u8981\u9884\u89C8\u8BA2\u5355\uFF0C\u9009\u62E9\u6536\u8D27\u4FE1\u606F\u7B49</li><li>\u8BA2\u5355\u521B\u5EFA\u9700\u8981\u9501\u5B9A\u5E93\u5B58\uFF0C\u5E93\u5B58\u6709\u624D\u53EF\u521B\u5EFA\uFF0C\u5426\u5219\u4E0D\u80FD\u521B\u5EFA</li><li>\u8BA2\u5355\u521B\u5EFA\u540E\u8D85\u65F6\u672A\u652F\u4ED8\u9700\u8981\u89E3\u9501\u5E93\u5B58</li><li>\u652F\u4ED8\u6210\u529F\u540E\uFF0C\u9700\u8981\u8FDB\u884C\u62C6\u5355\uFF0C\u6839\u636E\u5546\u54C1\u6253\u5305\u65B9\u5F0F\uFF0C\u6240\u5728\u4ED3\u5E93\uFF0C\u7269\u6D41\u7B49\u8FDB\u884C\u62C6\u5355</li><li>\u652F\u4ED8\u7684\u6BCF\u7B14\u6D41\u6C34\u90FD\u9700\u8981\u8BB0\u5F55\uFF0C\u4EE5\u5F85\u67E5\u8D26</li><li>\u8BA2\u5355\u521B\u5EFA\uFF0C\u652F\u4ED8\u6210\u529F\u7B49\u72B6\u6001\u90FD\u9700\u8981\u7ED9MQ\u53D1\u9001\u6D88\u606F\uFF0C\u65B9\u4FBF\u5176\u4ED6\u7CFB\u7EDF\u611F\u77E5\u8BA2\u9605</li></ol><p>2\u3001\u9006\u5411\u6D41\u7A0B</p><ol><li>\u4FEE\u6539\u8BA2\u5355\uFF0C\u7528\u6237\u6CA1\u6709\u63D0\u4EA4\u8BA2\u5355\uFF0C\u53EF\u4EE5\u5BF9\u8BA2\u5355\u4E00\u4E9B\u4FE1\u606F\u8FDB\u884C\u4FEE\u6539\uFF0C\u6BD4\u5982\u914D\u9001\u4FE1\u606F\uFF0C\u4F18\u60E0\u4FE1\u606F\uFF0C\u53CA\u5176\u4ED6\u4E00\u4E9B\u8BA2\u5355\u53EF\u4FEE\u6539\u8303\u56F4\u7684\u5185\u5BB9\uFF0C\u6B64\u65F6\u53EA\u9700\u5BF9\u6570\u636E\u8FDB\u884C\u53D8\u66F4\u5373\u53EF\u3002</li><li>\u8BA2\u5355\u53D6\u6D88**\uFF0C\u7528\u6237\u4E3B\u52A8\u53D6\u6D88\u8BA2\u5355\u548C\u7528\u6237\u8D85\u65F6\u672A\u652F\u4ED8**\uFF0C\u4E24\u79CD\u60C5\u51B5\u4E0B\u8BA2\u5355\u90FD\u4F1A\u53D6\u6D88\u8BA2\u5355\uFF0C\u800C\u8D85\u65F6\u60C5\u51B5\u662F\u7CFB\u7EDF\u81EA\u52A8\u5173\u95ED\u8BA2\u5355\uFF0C\u6240\u4EE5\u5728\u8BA2\u5355\u652F\u4ED8\u7684\u54CD\u5E94\u673A\u5236\u4E0A\u9762\u8981\u505A\u652F\u4ED8\u7684</li></ol><h3 id="_14-3-\u5E42\u7B49\u6027\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_14-3-\u5E42\u7B49\u6027\u5904\u7406" aria-hidden="true">#</a> 14.3 \u5E42\u7B49\u6027\u5904\u7406</h3><h3 id="_14-4-\u8BA2\u5355\u4E1A\u52A1" tabindex="-1"><a class="header-anchor" href="#_14-4-\u8BA2\u5355\u4E1A\u52A1" aria-hidden="true">#</a> 14.4 \u8BA2\u5355\u4E1A\u52A1</h3><h4 id="_1\u3001\u642D\u5EFA\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u642D\u5EFA\u73AF\u5883" aria-hidden="true">#</a> 1\u3001\u642D\u5EFA\u73AF\u5883</h4><p>\u5728\u8BA2\u5355\u670D\u52A1\u4E0B\u51C6\u5907\u597D\u9875\u9762</p><p><img src="http://qnimg.gisfsde.com/work/image-20210105095210202.png" alt="image-20210105095210202" loading="lazy"></p><p>\u53EF\u4EE5\u53D1\u73B0\u8BA2\u5355\u7ED3\u7B97\u9875\uFF0C\u5305\u542B\u4EE5\u4E0B\u4FE1\u606F:</p><p>1.\u6536\u8D27\u4EBA\u4FE1\u606F:\u6709\u66F4\u591A\u5730\u5740\uFF0C\u5373\u6709\u591A\u4E2A\u6536\u8D27\u5730\u5740\uFF0C\u5176\u4E2D\u6709\u4E00\u4E2A\u9ED8\u8BA4\u6536\u8D27\u5730\u5740</p><p>2.\u652F\u4ED8\u65B9\u5F0F:\u8D27\u5230\u4ED8\u6B3E\u4E0B\u5728\u7EBF\u652F\u4ED8\uFF0C\u4E0D\u9700\u8981\u540E\u53F0\u63D0\u4F9B</p><p>3.\u9001\u8D27\u6E05\u5355:\u914D\u9001\u65B9\u5F0F(\u4E0D\u505A)\u53CA\u5546\u54C1\u5217\u8868(\u6839\u636E\u8D2D\u7269\u8F66\u9009\u4E2D\u7684skuld\u5230\u6570\u636E\u5E93\u4E2D\u67E5\u8BE2)</p><p>4.\u53D1\u7968:\u4E0D\u505A</p><p>5.\u4F18\u60E0:\u67E5\u8BE2\u7528\u6237\u9886\u53D6\u7684\u4F18\u60E0\u5238(\u4E0D\u505A)\u53CA\u53EF\u7528\u79EF\u5206(\u4EAC\u8C46)</p><h5 id="_1-1\u3001\u6574\u5408springsession" tabindex="-1"><a class="header-anchor" href="#_1-1\u3001\u6574\u5408springsession" aria-hidden="true">#</a> 1.1\u3001\u6574\u5408SpringSession</h5><p><strong>1\u3001\u5F15\u5165pom</strong></p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>  <span class="token comment">&lt;!--\u6574\u5408spring session \u89E3\u51B3session\u95EE\u9898--&gt;</span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.session\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-session-data-redis\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2\u3001\u914D\u7F6E\u6587\u4EF6\u6DFB\u52A0</strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">Spring</span><span class="token punctuation">:</span>
	<span class="token key atrule">session</span><span class="token punctuation">:</span>
    	<span class="token key atrule">store-type</span><span class="token punctuation">:</span> redis
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3\u3001\u542F\u52A8\u7C7B\u52A0\u6CE8\u89E3</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableRedisHttpSession</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>4\u3001\u4FEE\u6539\u9875\u9762\u4E2D\u767B\u5F55</strong></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>						\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
							\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${session.loginUser != null }<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aa<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>[[\${session.loginUser.nickname}]]\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
							\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${session.loginUser == null }<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://auth.gulimall.com/login.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u4F60\u597D\u8BF7\u767B\u5F55\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
						\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
						\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
							\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${session.loginUser == null }<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://auth.gulimall.com/reg.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li_2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u514D\u8D39\u6CE8\u518C\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
						\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1-2\u3001\u8BA2\u5355\u767B\u5F55\u62E6\u622A" tabindex="-1"><a class="header-anchor" href="#_1-2\u3001\u8BA2\u5355\u767B\u5F55\u62E6\u622A" aria-hidden="true">#</a> 1.2\u3001\u8BA2\u5355\u767B\u5F55\u62E6\u622A</h5><p>\u4EFB\u4F55\u8BF7\u6C42\u90FD\u9700\u8981\u5148\u7ECF\u8FC7\u62E6\u622A\u5668\u7684\u9A8C\u8BC1\uFF0C\u624D\u80FD\u53BB\u6267\u884C\u76EE\u6807\u65B9\u6CD5\uFF0C\u8FD9\u91CC\u662F\u7528\u6237\u662F\u5426\u767B\u5F55\uFF0C\u7528\u6237\u767B\u5F55\u4E86\u5219\u653E\u884C\uFF0C\u5426\u5219\u8DF3\u8F6C\u5230\u767B\u9646\u9875\u9762</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token doc-comment comment">/**
     * \u76EE\u6807\u65B9\u6CD5\u6267\u884C\u4E4B\u524D
     * <span class="token keyword">@param</span> <span class="token parameter">request</span>
     * <span class="token keyword">@param</span> <span class="token parameter">response</span>
     * <span class="token keyword">@param</span> <span class="token parameter">handler</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> requestURI <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6307\u5B9A\u7684\u8BF7\u6C42\u4E0D\u62E6\u622A</span>
        <span class="token keyword">boolean</span> match1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AntPathMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">&quot;/order/order/status/**&quot;</span><span class="token punctuation">,</span> requestURI<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> match2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AntPathMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">&quot;/payed/notify&quot;</span><span class="token punctuation">,</span> requestURI<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>match1 <span class="token operator">||</span> match2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">MemberRespVo</span> memberRespVo<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MemberRespVo</span><span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">AuthServerConstant</span><span class="token punctuation">.</span>LOGIN_USER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>memberRespVo <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u7528\u6237\u767B\u9646\u4E86</span>
            loginUser<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>memberRespVo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u653E\u5230\u5171\u4EAB\u6570\u636E\u4E2D</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// \u7528\u6237\u6CA1\u767B\u5F55</span>
            <span class="token comment">// \u7ED9\u524D\u7AEF\u663E\u793A\u63D0\u793A\u4FE1\u606F</span>
            request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;\u8BF7\u5148\u8FDB\u884C\u767B\u5F55&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u91CD\u5B9A\u5411\u5230\u767B\u5F55\u9875\u9762</span>
            response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">&quot;http://auth.gulimall.com/login.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u8BA2\u5355\u786E\u8BA4\u9875" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u8BA2\u5355\u786E\u8BA4\u9875" aria-hidden="true">#</a> 2\u3001\u8BA2\u5355\u786E\u8BA4\u9875</h4><p><img src="http://qnimg.gisfsde.com/work/image-20210105142735857.png" alt="image-20210105142735857" loading="lazy"></p><p><strong>\u6839\u636E\u56FE\u7247\u4E2D\u5546\u54C1\u4FE1\u606F\u62BD\u53D6\u6210Vo</strong></p><h5 id="_2-1\u3001\u62BD\u53D6vo" tabindex="-1"><a class="header-anchor" href="#_2-1\u3001\u62BD\u53D6vo" aria-hidden="true">#</a> 2.1\u3001\u62BD\u53D6Vo</h5><p><strong>\u8BA2\u5355\u786E\u8BA4OrderConfirmVo</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * \u8BA2\u5355\u786E\u8BA4\u9875\u9700\u8981\u7684\u6570\u636E
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-17
 */</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderConfirmVo</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u6536\u8D27\u5730\u5740\uFF0Cums_member_receive_address</span>
    <span class="token annotation punctuation">@Getter</span> <span class="token annotation punctuation">@Setter</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberAddressVo</span><span class="token punctuation">&gt;</span></span> address<span class="token punctuation">;</span>

    <span class="token comment">// \u6240\u6709\u9009\u4E2D\u7684\u8D2D\u7269\u9879</span>
    <span class="token annotation punctuation">@Getter</span> <span class="token annotation punctuation">@Setter</span>
    <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemVo</span><span class="token punctuation">&gt;</span></span> item<span class="token punctuation">;</span>

    <span class="token comment">// \u53D1\u7968\u8BB0\u5F55...</span>

    <span class="token doc-comment comment">/**
     * \u4F18\u60E0\u5377\u4FE1\u606F
     */</span>
    <span class="token annotation punctuation">@Getter</span> <span class="token annotation punctuation">@Setter</span>
    <span class="token class-name">Integer</span> integration<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u8BA2\u5355\u603B\u989D
     */</span>
    <span class="token class-name">BigDecimal</span> total<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BigDecimal</span> sum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">OrderItemVo</span> orderItemVo <span class="token operator">:</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">BigDecimal</span> multiply <span class="token operator">=</span> orderItemVo<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>orderItemVo<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                sum <span class="token operator">=</span> sum<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>multiply<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Getter</span> <span class="token annotation punctuation">@Setter</span>
    <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> stocks<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5E94\u4ED8\u4EF7\u683C
     */</span>
    <span class="token class-name">BigDecimal</span> payPrice<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">getPayPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BigDecimal</span> sum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">OrderItemVo</span> orderItemVo <span class="token operator">:</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">BigDecimal</span> multiply <span class="token operator">=</span> orderItemVo<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>orderItemVo<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                sum <span class="token operator">=</span> sum<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>multiply<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Setter</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u904D\u5386item \u62FF\u5230\u5546\u54C1\u7684\u6570\u91CF
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">OrderItemVo</span> orderItemVo <span class="token operator">:</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                i<span class="token operator">+=</span>orderItemVo<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Getter</span> <span class="token annotation punctuation">@Setter</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderToken<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5546\u54C1\u9879orderItemVo</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5546\u54C1\u9879
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-17
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderItemVo</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1id
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u8D2D\u7269\u8F66\u4E2D\u662F\u5426\u9009\u4E2D
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> check <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7684\u6807\u9898
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7684\u56FE\u7247
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> image<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7684\u5C5E\u6027
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> skuAttr<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7684\u4EF7\u683C
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> price<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u5546\u54C1\u7684\u6570\u91CF
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u8D2D\u7269\u8F66\u4EF7\u683C \u4F7F\u7528\u81EA\u5B9A\u4E49get\u3001set
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> totalPrice<span class="token punctuation">;</span>


    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> weight<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u7528\u6237\u5730\u5740MemberAddressVo</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u7528\u6237\u5730\u5740\u4FE1\u606F
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-17
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberAddressVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * member_id
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> memberId<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u6536\u8D27\u4EBA\u59D3\u540D
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u7535\u8BDD
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u90AE\u653F\u7F16\u7801
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> postCode<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u7701\u4EFD/\u76F4\u8F96\u5E02
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> province<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u57CE\u5E02
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u533A
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> region<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u8BE6\u7EC6\u5730\u5740(\u8857\u9053)
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> detailAddress<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u7701\u5E02\u533A\u4EE3\u7801
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> areacode<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u662F\u5426\u9ED8\u8BA4
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> defaultStatus<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-2\u3001\u8BA2\u5355\u786E\u8BA4\u9875\u6570\u636E\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_2-2\u3001\u8BA2\u5355\u786E\u8BA4\u9875\u6570\u636E\u67E5\u8BE2" aria-hidden="true">#</a> 2.2\u3001\u8BA2\u5355\u786E\u8BA4\u9875\u6570\u636E\u67E5\u8BE2</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>   <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">OrderConfirmVo</span> <span class="token function">confirmOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">OrderConfirmVo</span> confirmVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderConfirmVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MemberRespVo</span> memberRespVo <span class="token operator">=</span> <span class="token class-name">OrderInterceptor</span><span class="token punctuation">.</span>loginUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u83B7\u53D6\u5F53\u524D\u767B\u5F55\u540E\u7684\u7528\u6237</span>
        <span class="token comment">// \u5F02\u6B65\u4EFB\u52A1\u6267\u884C\u4E4B\u524D\uFF0C\u5148\u5171\u4EAB\u6570\u636E</span>
        <span class="token class-name">RequestAttributes</span> requestAttributes <span class="token operator">=</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1\u3001\u7B2C\u4E00\u4E2A\u5F02\u6B65\u4EFB\u52A1 \u8FDC\u7A0B\u67E5\u8BE2\u7528\u6237\u5730\u5740\u4FE1\u606F</span>
        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> memberFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5728\u4E3B\u7EBF\u7A0B\u4E2D\u62FF\u5230\u539F\u6765\u7684\u6570\u636E\uFF0C\u5728\u7236\u7EBF\u7A0B\u91CC\u9762\u5171\u4EABRequestContextHolder</span>
            <span class="token comment">// \u53EA\u6709\u5171\u4EAB\uFF0C\u62E6\u622A\u5176\u4E2D\u624D\u4F1A\u6709\u6570\u636E</span>
            <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">setRequestAttributes</span><span class="token punctuation">(</span>requestAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u6839\u636E\u4F1A\u5458id\u67E5\u51FA\u4E4B\u524D\u4F1A\u5458\u4FDD\u5B58\u8FC7\u7684\u6536\u8D27\u5730\u5740\u4FE1\u606F</span>
            <span class="token comment">// \u8FDC\u7A0B\u67E5\u8BE2\u4F1A\u5458\u670D\u52A1\u7684\u6536\u83B7\u5730\u5740\u4FE1\u606F</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberAddressVo</span><span class="token punctuation">&gt;</span></span> address <span class="token operator">=</span> memberFeignService<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span>memberRespVo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;address:{}&quot;</span><span class="token punctuation">,</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
            confirmVo<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2\u3001\u7B2C\u4E8C\u4E2A\u5F02\u6B65\u4EFB\u52A1\u8FDC\u7A0B\u67E5\u8BE2\u8D2D\u7269\u8F66\u4E2D\u9009\u4E2D\u7ED9\u7684\u8D2D\u7269\u9879</span>
        <span class="token class-name">CompletableFuture</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> addressFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u6BCF\u4E00\u4E2A\u7EBF\u7A0B\u90FD\u6765\u5171\u4EAB\u4E4B\u524D\u7684\u8BF7\u6C42\u6570\u636E</span>
            <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">setRequestAttributes</span><span class="token punctuation">(</span>requestAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8FDC\u7A0B\u67E5\u8BE2\u8D2D\u7269\u8F66\u4E2D\u7684\u8D2D\u7269\u9879\u4FE1\u606F\uFF0C\u7528\u6765\u7ED3\u8D26</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemVo</span><span class="token punctuation">&gt;</span></span> currentUserCartItem <span class="token operator">=</span> cartFeignServicea<span class="token punctuation">.</span><span class="token function">getCurrentUserCartItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u83B7\u53D6\u5F53\u524D\u7528\u6237\u7684\u8D2D\u7269\u9879\u6570\u636E</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;currentUserCartItem:{}&quot;</span><span class="token punctuation">,</span>currentUserCartItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
            confirmVo<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>currentUserCartItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u67E5\u8BE2\u5230\u8D2D\u7269\u9879\u4FE1\u606F\u540E\uFF0C\u518D\u770B\u67E5\u8BE2\u8D2D\u7269\u7684\u5E93\u5B58\u4FE1\u606F</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// \u53EA\u8981\u4E0A\u9762\u4EFB\u52A1\u6267\u884C\u5B8C\u6210\uFF0C\u5C31\u5F00\u59CB\u6267\u884CthenRunAsync\u7684\u4EFB\u52A1</span>
            <span class="token comment">// 3\u3001\u5546\u54C1\u662F\u5426\u6709\u5E93\u5B58</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemVo</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> confirmVo<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u6279\u91CF\u67E5\u8BE2\u6BCF\u4E00\u4E2A\u5546\u54C1\u7684\u4FE1\u606F</span>
            <span class="token comment">// \u6536\u96C6\u597D\u5546\u54C1id</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> item<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8FDC\u7A0B\u67E5\u8BE2\u8D2D\u7269\u9879\u5BF9\u5E94\u7684\u5E93\u5B58\u4FE1\u606F</span>
            <span class="token class-name">R</span> data <span class="token operator">=</span> wareFeignService<span class="token punctuation">.</span><span class="token function">hasStock</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u5F97\u5230\u6BCF\u4E00\u4E2A\u5546\u54C1\u7684\u5E93\u5B58\u72B6\u6001\u4FE1\u606F</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuHasStockVo</span><span class="token punctuation">&gt;</span></span> hasStockVo <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token operator">&lt;</span><span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuHasStockVo</span><span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>hasStockVo <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> stockMap <span class="token operator">=</span> hasStockVo<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">SkuHasStockVo</span><span class="token operator">::</span><span class="token function">getSkuId</span><span class="token punctuation">,</span> <span class="token class-name">SkuHasStockVo</span><span class="token operator">::</span><span class="token function">getHasStock</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                confirmVo<span class="token punctuation">.</span><span class="token function">setStocks</span><span class="token punctuation">(</span>stockMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;stockMap:{}&quot;</span><span class="token punctuation">,</span>stockMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 4\u3001\u67E5\u8BE2\u79EF\u5206\u4FE1\u606F</span>
        <span class="token class-name">Integer</span> integration <span class="token operator">=</span> confirmVo<span class="token punctuation">.</span><span class="token function">getIntegration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        confirmVo<span class="token punctuation">.</span><span class="token function">setIntegration</span><span class="token punctuation">(</span>integration<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u7B49\u4E24\u4E2A\u5F02\u6B65\u4EFB\u52A1\u90FD\u5B8C\u6210</span>
        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>memberFuture<span class="token punctuation">,</span> addressFuture<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// 4\u3001\u9632\u91CD\u4EE4\u724C</span>
        <span class="token doc-comment comment">/**
         * \u63A5\u53E3\u5E42\u7B49\u6027\u5C31\u662F\u7528\u6237\u5BF9\u540C\u4E00\u64CD\u4F5C\u53D1\u8D77\u7684\u4E00\u6B21\u8BF7\u6C42\u548C\u591A\u6B21\u8BF7\u6C42\u7ED3\u679C\u662F\u4E00\u81F4\u7684
         * \u4E0D\u4F1A\u56E0\u4E3A\u591A\u6B21\u70B9\u51FB\u800C\u4EA7\u751F\u4E86\u526F\u4F5C\u7528\uFF0C\u6BD4\u5982\u652F\u4ED8\u573A\u666F\uFF0C\u7528\u6237\u8D2D\u4E70\u4E86\u5546\u54C1\uFF0C\u652F\u4ED8\u6263\u6B3E\u6210\u529F\uFF0C
         * \u4F46\u662F\u8FD4\u56DE\u7ED3\u679C\u7684\u65F6\u5019\u51FA\u73B0\u4E86\u7F51\u7EDC\u5F02\u5E38\uFF0C\u6B64\u65F6\u94B1\u5DF2\u7ECF\u6263\u4E86\uFF0C\u7528\u6237\u518D\u6B21\u70B9\u51FB\u6309\u94AE\uFF0C
         * \u6B64\u65F6\u5C31\u4F1A\u8FDB\u884C\u7B2C\u4E8C\u6B21\u6263\u6B3E\uFF0C\u8FD4\u56DE\u7ED3\u679C\u6210\u529F\uFF0C\u7528\u6237\u67E5\u8BE2\u4F59\u989D\u53D1\u73B0\u591A\u6263\u94B1\u4E86\uFF0C
         * \u6D41\u6C34\u8BB0\u5F55\u4E5F\u53D8\u6210\u4E86\u4E24\u6761\u3002\u3002\u3002\u8FD9\u5C31\u6CA1\u6709\u4FDD\u8BC1\u63A5\u53E3\u5E42\u7B49\u6027
         */</span>
        <span class="token comment">// \u5148\u662F\u518D\u9875\u9762\u4E2D\u751F\u6210\u4E00\u4E2A\u968F\u673A\u7801\u628A\u4ED6\u53EB\u505Atoken\u5148\u5B58\u5230redis\u4E2D\uFF0C\u7136\u540E\u653E\u5230\u5BF9\u8C61\u4E2D\u5728\u9875\u9762\u8FDB\u884C\u6E32\u67D3\u3002</span>
        <span class="token comment">// \u7528\u6237\u63D0\u4EA4\u8868\u5355\u7684\u65F6\u5019\uFF0C\u5E26\u7740\u8FD9\u4E2Atoken\u548Credis\u91CC\u9762\u53BB\u5339\u914D\u5982\u679C\u4E00\u76F4\u90A3\u4E48\u53EF\u4EE5\u6267\u884C\u4E0B\u9762\u6D41\u7A0B\u3002</span>
        <span class="token comment">// \u5339\u914D\u6210\u529F\u540E\u518Dredis\u4E2D\u5220\u9664\u8FD9\u4E2Atoken\uFF0C\u4E0B\u6B21\u8BF7\u6C42\u518D\u8FC7\u6765\u7684\u65F6\u5019\u5C31\u5339\u914D\u4E0D\u4E0A\u76F4\u63A5\u8FD4\u56DE</span>
        <span class="token comment">// \u751F\u6210\u9632\u91CD\u4EE4\u724C</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5B58\u5230redis\u4E2D \u8BBE\u7F6E30\u5206\u949F\u8D85\u65F6</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">OrderConstant</span><span class="token punctuation">.</span>USER_ORDER_TOKEN_PREFIX <span class="token operator">+</span> memberRespVo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>token<span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u653E\u5230\u9875\u9762\u8FDB\u884C\u663E\u793Atoken\uFF0C\u7136\u540E\u8BA2\u5355\u4E2D\u5E26\u7740token\u6765\u8BF7\u6C42</span>
        confirmVo<span class="token punctuation">.</span><span class="token function">setOrderToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> confirmVo<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001\u521B\u5EFA\u8BA2\u5355" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u521B\u5EFA\u8BA2\u5355" aria-hidden="true">#</a> 3\u3001\u521B\u5EFA\u8BA2\u5355</h4><h5 id="_1\u3001orderwebcontroller" tabindex="-1"><a class="header-anchor" href="#_1\u3001orderwebcontroller" aria-hidden="true">#</a> 1\u3001OrderWebController</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
    * @\u9700\u6C42\u63CF\u8FF0: \u7CFB\u7EDF\u7BA1\u7406\u5458 \u8BA2\u5355\u7EC4 \u6A21\u5757 \u7528\u6237\u4E0B\u5355\u529F\u80FD
    * @\u521B\u5EFA\u4EBA: \u90ED\u627F\u4E7E
    * @\u521B\u5EFA\u65F6\u95F4: 2021/01/06 12:01
    * @\u4FEE\u6539\u9700\u6C42:
    * @\u4FEE\u6539\u4EBA:
    * @\u4FEE\u6539\u65F6\u95F4:
    * @\u9700\u6C42\u601D\u8DEF:
    */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/submitOrder&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">submitOrder</span><span class="token punctuation">(</span><span class="token class-name">OrderSubmitVo</span> vo<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">,</span> <span class="token class-name">RedirectAttributes</span> redirectAttributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SubmitOrderResponseVo</span> responseVo <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">submitOrder</span><span class="token punctuation">(</span>vo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;======================\u8BA2\u5355\u521B\u5EFA\u6210\u529F{}:&quot;</span><span class="token punctuation">,</span>responseVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6839\u636Evo\u4E2D\u5B9A\u4E49\u7684\u72B6\u6001\u7801\u6765\u9A8C\u8BC1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>responseVo<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u8BA2\u5355\u521B\u5EFA\u6210\u529F</span>
            <span class="token comment">// \u4E0B\u5355\u6210\u529F\u8FD4\u56DE\u5230\u652F\u4ED8\u9875</span>
            model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;submitOrderResp&quot;</span><span class="token punctuation">,</span>responseVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;pay&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// \u4E0B\u5355\u5931\u8D25</span>
            <span class="token comment">// \u6839\u636E\u72B6\u6001\u7801\u9A8C\u8BC1\u5BF9\u5E94\u7684\u72B6\u6001</span>
            <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;\u4E0B\u5355\u5931\u8D25&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>responseVo<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> msg <span class="token operator">+=</span> <span class="token string">&quot;\u8BA2\u5355\u4FE1\u606F\u8FC7\u671F\uFF0C\u8BF7\u5237\u65B0\u540E\u518D\u6B21\u63D0\u4EA4&quot;</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> msg <span class="token operator">+=</span> <span class="token string">&quot;\u8BA2\u5355\u5546\u54C1\u4EF7\u683C\u53D1\u751F\u53D8\u5316\uFF0C\u8BF7\u786E\u8BA4\u540E\u518D\u6B21\u63D0\u4EA4&quot;</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> msg <span class="token operator">+=</span> <span class="token string">&quot;\u5E93\u5B58\u9501\u5B9A\u5931\u8D25\uFF0C\u5546\u54C1\u5E93\u5B58\u4E0D\u8DB3&quot;</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            redirectAttributes<span class="token punctuation">.</span><span class="token function">addFlashAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u91CD\u65B0\u56DE\u5230\u8BA2\u5355\u786E\u8BA4\u9875\u9762</span>
            <span class="token keyword">return</span> <span class="token string">&quot;redirect:http://order.gulimall.com/toTrade&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001service" tabindex="-1"><a class="header-anchor" href="#_2\u3001service" aria-hidden="true">#</a> 2\u3001Service</h5><p>\u5177\u4F53\u4E1A\u52A1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Transactional</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SubmitOrderResponseVo</span> <span class="token function">submitOrder</span><span class="token punctuation">(</span><span class="token class-name">OrderSubmitVo</span> vo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5148\u5C06\u53C2\u6570\u653E\u5230\u5171\u4EAB\u53D8\u91CF\u4E2D\uFF0C\u65B9\u4FBF\u4E4B\u540E\u65B9\u6CD5\u4F7F\u7528\u8BE5\u53C2\u6570</span>
        confirmVoThreadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>vo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u63A5\u6536\u8FD4\u56DE\u6570\u636E</span>
        <span class="token class-name">SubmitOrderResponseVo</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubmitOrderResponseVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u901A\u8FC7\u62E6\u622A\u5668\u62FF\u5230\u7528\u6237\u7684\u6570\u636E</span>
        <span class="token class-name">MemberRespVo</span> memberRespVo <span class="token operator">=</span> <span class="token class-name">LoginInterceptor</span><span class="token punctuation">.</span>loginUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * \u4E0D\u4F7F\u7528\u539F\u5B50\u6027\u9A8C\u8BC1\u4EE4\u724C
         *      1\u3001\u7528\u6237\u5E26\u7740\u4E24\u4E2A\u8BA2\u5355\uFF0C\u63D0\u4EA4\u901F\u5EA6\u975E\u5E38\u5FEB\uFF0C\u4E24\u4E2A\u8BA2\u5355\u7684\u4EE4\u724C\u90FD\u662F123\uFF0C\u53BBredis\u91CC\u9762\u67E5\u67E5\u5230\u7684\u4E5F\u662F123\u3002
         *          \u4E24\u4E2A\u5BF9\u6BD4\u90FD\u901A\u8FC7\uFF0C\u7136\u540E\u6765\u5220\u9664\u4EE4\u724C\uFF0C\u90A3\u4E48\u5C31\u4F1A\u51FA\u73B0\u7528\u6237\u91CD\u590D\u63D0\u4EA4\u7684\u95EE\u9898\uFF0C
         *      2\u3001\u7B2C\u4E00\u6B21\u5DEE\u7684\u5FEB\uFF0C\u7B2C\u4E8C\u6B21\u67E5\u7684\u6162\uFF0C\u53EA\u8981\u6CA1\u5220\u5C31\u4F1A\u51FA\u73B0\u8FD9\u4E9B\u95EE\u9898
         *      3\u3001\u56E0\u6B64\u4EE4\u724C\u7684\u3010\u9A8C\u8BC1\u548C\u5220\u9664\u5FC5\u987B\u4FDD\u8BC1\u539F\u5B50\u6027\u3011
         *      String orderToken = vo.getOrderToken();
         *      String redisToken = redisTemplate.opsForValue().get(OrderConstant.USER_ORDER_TOKEN_PREFIX + memberRespVo.getId());
         *         if (orderToken != null &amp;&amp; orderToken.equals(redisToken)) <span class="token punctuation">{</span>
         *             // \u4EE4\u724C\u9A8C\u8BC1\u901A\u8FC7 \u8FDB\u884C\u5220\u9664
         *             redisTemplate.delete(OrderConstant.USER_ORDER_TOKEN_PREFIX + memberRespVo.getId());
         *         <span class="token punctuation">}</span> else <span class="token punctuation">{</span>
         *             // \u4E0D\u901A\u8FC7
         *         <span class="token punctuation">}</span>
         */</span>
        <span class="token comment">// \u9A8C\u8BC1\u4EE4\u724C\u3010\u4EE4\u724C\u7684\u5BF9\u6BD4\u548C\u5220\u9664\u5FC5\u987B\u4FDD\u8BC1\u539F\u5B50\u6027\u3011</span>
        <span class="token comment">// \u56E0\u6B64\u4F7F\u7528redis\u4E2D\u811A\u672C\u6765\u8FDB\u884C\u9A8C\u8BC1\u5E76\u5220\u9664\u4EE4\u724C</span>
        <span class="token comment">// 0\u3010\u5220\u9664\u5931\u8D25/\u9A8C\u8BC1\u5931\u8D25\u3011 1\u3010\u5220\u9664\u6210\u529F\u3011</span>
        <span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token string">&quot;if redis.call(&#39;get&#39;,KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;,KEYS[1]) else return 0 end&quot;</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * redis lur\u811A\u672C\u547D\u4EE4\u89E3\u6790
         * if redis.call(&#39;get&#39;,KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;,KEYS[1]) else return 0 end
         *  1\u3001redis\u8C03\u7528get\u65B9\u6CD5\u6765\u83B7\u53D6\u4E00\u4E2Akey\u7684\u503C\uFF0C\u5982\u679C\u8FD9\u4E2Aget\u51FA\u6765\u7684\u503C\u7B49\u4E8E\u6211\u4EEC\u4F20\u8FC7\u6765\u7684\u503C
         *  2\u3001\u7136\u540E\u5C31\u6267\u884C\u5220\u9664\uFF0C\u6839\u636E\u8FD9\u4E2Akey\u8FDB\u884C\u5220\u9664\uFF0C\u5220\u9664\u6210\u529F\u8FD4\u56DE1\uFF0C\u9A8C\u8BC1\u5931\u8D25\u8FD4\u56DE0
         *  3\u3001\u5220\u9664\u5426\u5219\u5C31\u662F0
         *  \u603B\u7ED3\uFF1A\u76F8\u540C\u7684\u8FDB\u884C\u5220\u9664\uFF0C\u4E0D\u76F8\u540C\u7684\u8FD4\u56DE0
         * \u811A\u672C\u5927\u81F4\u610F\u601D
         */</span>
        <span class="token comment">// \u62FF\u5230\u4EE4\u724C</span>
        <span class="token class-name">String</span> orderToken <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getOrderToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * 	public \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> T execute(RedisScript\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>T</span><span class="token punctuation">&gt;</span></span> script // redis\u7684\u811A\u672C
         * 	    , List\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>K</span><span class="token punctuation">&gt;</span></span> keys // \u5BF9\u5E94\u7684key \u53C2\u6570\u4E2D\u4F7F\u7528\u4E86Array.asList \u5C06\u53C2\u6570\u8F6C\u6210list\u96C6\u5408
         * 	    , Object... args) <span class="token punctuation">{</span> // \u8981\u5220\u9664\u7684\u503C
         */</span>
        <span class="token comment">// \u539F\u5B50\u9A8C\u8BC1\u548C\u5220\u9664</span>
        <span class="token class-name">Long</span> result <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>script<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">OrderConstant</span><span class="token punctuation">.</span>USER_ORDER_TOKEN_PREFIX <span class="token operator">+</span> memberRespVo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">,</span> orderToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result  <span class="token operator">==</span> <span class="token number">0L</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u9A8C\u8BC1\u4EE4\u724C\u9A8C\u8BC1\u5931\u8D25</span>
            <span class="token comment">// \u9A8C\u8BC1\u5931\u8D25\u76F4\u63A5\u8FD4\u56DE\u7ED3\u679C</span>
            response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// \u539F\u5B50\u9A8C\u8BC1\u4EE4\u724C\u6210\u529F</span>
            <span class="token comment">// \u4E0B\u5355 \u521B\u5EFA\u8BA2\u5355\u3001\u9A8C\u8BC1\u4EE4\u724C\u3001\u9A8C\u8BC1\u4EF7\u683C\u3001\u9A8C\u8BC1\u5E93\u5B58</span>
            <span class="token comment">// 1\u3001\u521B\u5EFA\u8BA2\u5355\u3001\u8BA2\u5355\u9879\u4FE1\u606F</span>
            <span class="token class-name">OrderCreateTo</span> order <span class="token operator">=</span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2\u3001\u5E94\u4ED8\u603B\u989D</span>
            <span class="token class-name">BigDecimal</span> payAmount <span class="token operator">=</span> order<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPayAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u5E94\u4ED8\u4EF7\u683C</span>
            <span class="token class-name">BigDecimal</span> payPrice <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getPayPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token doc-comment comment">/**
             * \u7535\u5546\u9879\u76EE\u5BF9\u4ED8\u6B3E\u7684\u91D1\u989D\u7CBE\u786E\u5230\u5C0F\u6570\u70B9\u540E\u9762\u4E24\u4F4D
             * \u8BA2\u5355\u521B\u5EFA\u597D\u7684\u5E94\u4ED8\u603B\u989D \u548C\u8D2D\u7269\u8F66\u4E2D\u8BA1\u7B97\u597D\u7684\u5E94\u4ED8\u4EF7\u683C\u6C42\u51FA\u7EDD\u5BF9\u503C\u3002
             */</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>payAmount<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>payPrice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> \\<span class="token operator">&lt;</span> <span class="token number">0.01</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u91D1\u989D\u5BF9\u6BD4\u6210\u529F \u4FDD\u5B58\u8BA2\u5355</span>
                <span class="token function">saveOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u521B\u5EFA\u9501\u5B9A\u5E93\u5B58Vo</span>
                <span class="token class-name">WareSkuLockedVo</span> wareSkuLockedVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WareSkuLockedVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u51C6\u5907\u597D\u5546\u54C1\u9879</span>
                <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemVo</span><span class="token punctuation">&gt;</span></span> lock <span class="token operator">=</span> order<span class="token punctuation">.</span><span class="token function">getOrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>orderItemEntity <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token class-name">OrderItemVo</span> orderItemVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItemVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// \u5546\u54C1\u8D2D\u4E70\u6570\u91CF</span>
                    orderItemVo<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>orderItemEntity<span class="token punctuation">.</span><span class="token function">getSkuQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// skuid \u7528\u6765\u67E5\u8BE2\u5546\u54C1\u4FE1\u606F</span>
                    orderItemVo<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>orderItemEntity<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// \u5546\u54C1\u6807\u9898</span>
                    orderItemVo<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>orderItemEntity<span class="token punctuation">.</span><span class="token function">getSkuName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> orderItemVo<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u8BA2\u5355\u53F7</span>
                wareSkuLockedVo<span class="token punctuation">.</span><span class="token function">setOrderSn</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrderSn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u5546\u54C1\u9879</span>
                wareSkuLockedVo<span class="token punctuation">.</span><span class="token function">setLocks</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u8FDC\u7A0B\u8C03\u7528\u5E93\u5B58\u670D\u52A1\u9501\u5B9A\u5E93\u5B58</span>
                <span class="token class-name">R</span> r <span class="token operator">=</span> wareFeignService<span class="token punctuation">.</span><span class="token function">orderLockStock</span><span class="token punctuation">(</span>wareSkuLockedVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u5E93\u5B58\u9501\u5B9A\u6210\u529F</span>
                    <span class="token comment">// \u5C06\u8BA2\u5355\u5BF9\u8C61\u653E\u5230\u8FD4\u56DEVo\u4E2D</span>
                    response<span class="token punctuation">.</span><span class="token function">setOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// \u8BBE\u7F6E\u72B6\u6001\u7801</span>
                    response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// \u8BA2\u5355\u521B\u5EFA\u6210\u529F\u53D1\u9001\u6D88\u606F\u7ED9MQ</span>
                    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;order-event-exchange&quot;</span>
                            <span class="token punctuation">,</span><span class="token string">&quot;order.create.order&quot;</span>
                            <span class="token punctuation">,</span>order<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u8FDC\u7A0B\u9501\u5B9A\u5E93\u5B58\u5931\u8D25</span>
                    response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u5546\u54C1\u4EF7\u683C\u6BD4\u8F83\u5931\u8D25</span>
                response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> response<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 <span class="token doc-comment comment">/**
     * \u521B\u5EFA\u8BA2\u5355\u548C\u8BA2\u5355\u9879
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderCreateTo</span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">OrderCreateTo</span> orderCreateTo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderCreateTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1\u3001\u751F\u6210\u8BA2\u5355\u53F7</span>
        <span class="token class-name">String</span> orderSn <span class="token operator">=</span> <span class="token class-name">IdWorker</span><span class="token punctuation">.</span><span class="token function">getTimeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2\u3001\u6784\u5EFA\u8BA2\u5355</span>
        <span class="token class-name">OrderEntity</span> orderEntity <span class="token operator">=</span> <span class="token function">buildOrder</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3\u3001\u6784\u5EFA\u8BA2\u5355\u9879</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemEntity</span><span class="token punctuation">&gt;</span></span> itemEntities <span class="token operator">=</span> <span class="token function">builderOrderItems</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4\u3001\u8BBE\u7F6E\u4EF7\u683C\u3001\u79EF\u5206\u76F8\u5173\u4FE1\u606F</span>
        <span class="token function">computPrice</span><span class="token punctuation">(</span>orderEntity<span class="token punctuation">,</span>itemEntities<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5\u3001\u8BBE\u7F6E\u8BA2\u5355\u9879</span>
        orderCreateTo<span class="token punctuation">.</span><span class="token function">setOrderItem</span><span class="token punctuation">(</span>itemEntities<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6\u3001\u8BBE\u7F6E\u8BA2\u5355</span>
        orderCreateTo<span class="token punctuation">.</span><span class="token function">setOrder</span><span class="token punctuation">(</span>orderEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> orderCreateTo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token doc-comment comment">/**
     * \u6784\u5EFA\u8BA2\u5355
     * <span class="token keyword">@param</span> <span class="token parameter">orderSn</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderEntity</span> <span class="token function">buildOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderSn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u62FF\u5230\u5171\u4EAB\u6570\u636E</span>
        <span class="token class-name">OrderSubmitVo</span> orderSubmitVo <span class="token operator">=</span> confirmVoThreadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u7528\u6237\u767B\u5F55\u767B\u5F55\u6570\u636E</span>
        <span class="token class-name">MemberRespVo</span> memberRespVo <span class="token operator">=</span> <span class="token class-name">LoginInterceptor</span><span class="token punctuation">.</span>loginUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">OrderEntity</span> orderEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E\u8BA2\u5355\u53F7</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setOrderSn</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u7528\u6237id</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setMemberId</span><span class="token punctuation">(</span>memberRespVo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6839\u636E\u7528\u6237\u6536\u8D27\u5730\u5740id\u67E5\u8BE2\u51FA\u7528\u6237\u7684\u6536\u83B7\u5730\u5740\u4FE1\u606F</span>
        <span class="token class-name">R</span> fare <span class="token operator">=</span> wareFeignService<span class="token punctuation">.</span><span class="token function">getFare</span><span class="token punctuation">(</span>orderSubmitVo<span class="token punctuation">.</span><span class="token function">getAddrId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FareVo</span> data <span class="token operator">=</span> fare<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FareVo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5C06\u67E5\u8BE2\u5230\u7684\u4F1A\u5458\u6536\u8D27\u5730\u5740\u4FE1\u606F\u8BBE\u7F6E\u5230\u8BA2\u5355\u5BF9\u8C61\u4E2D</span>
        <span class="token comment">// \u8FD0\u8D39\u91D1\u989D</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setFreightAmount</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getFare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u57CE\u5E02</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setReceiverCity</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getMemberAddressVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BE6\u7EC6\u5730\u533A</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setReceiverDetailAddress</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getMemberAddressVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDetailAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6536\u8D27\u4EBA\u59D3\u540D</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setReceiverName</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getMemberAddressVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6536\u8D27\u4EBA\u624B\u673A\u53F7</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setReceiverPhone</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getMemberAddressVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u533A</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setReceiverRegion</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getMemberAddressVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u7701\u4EFD\u76F4\u8F96\u5E02</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setReceiverProvince</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getMemberAddressVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProvince</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BA2\u5355\u521A\u521B\u5EFA\u72B6\u6001\u8BBE\u7F6E\u4E3A \u5F85\u4ED8\u6B3E\uFF0C\u7528\u6237\u652F\u4ED8\u6210\u529F\u540E\u5C06\u8BE5\u8BE5\u72B6\u6001\u6539\u6210\u5DF2\u4ED8\u6B3E</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">OrderStatusEnum</span><span class="token punctuation">.</span>CREATE_NEW<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u81EA\u52A8\u786E\u8BA4\u65F6\u95F4</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setAutoConfirmDay</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> orderEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
     * \u6784\u5EFA\u8BA2\u5355\u9879
     * <span class="token keyword">@param</span> <span class="token parameter">orderSn</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">builderOrderItems</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderSn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u83B7\u53D6\u8D2D\u7269\u8F66\u4E2D\u9009\u4E2D\u7684\u5546\u54C1</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemVo</span><span class="token punctuation">&gt;</span></span> currentUserCartItem <span class="token operator">=</span> cartFeignServicea<span class="token punctuation">.</span><span class="token function">getCurrentUserCartItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentUserCartItem <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> currentUserCartItem<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemEntity</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> currentUserCartItem<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>orderItemVo <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u6784\u5EFA\u8BA2\u5355\u9879</span>
                <span class="token class-name">OrderItemEntity</span> itemEntity <span class="token operator">=</span> <span class="token function">builderOrderItem</span><span class="token punctuation">(</span>orderItemVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                itemEntity<span class="token punctuation">.</span><span class="token function">setOrderSn</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> itemEntity<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> collect<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token doc-comment comment">/**
     * \u6784\u5EFA\u8BA2\u5355\u9879\u4FE1\u606F
     * <span class="token keyword">@param</span> <span class="token parameter">cartItem</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderItemEntity</span> <span class="token function">builderOrderItem</span><span class="token punctuation">(</span><span class="token class-name">OrderItemVo</span> cartItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">OrderItemEntity</span> itemEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItemEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1\u3001\u6839\u636Eskuid\u67E5\u8BE2\u5173\u8054\u7684spuinfo\u4FE1\u606F</span>
        <span class="token class-name">Long</span> skuId <span class="token operator">=</span> cartItem<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">R</span> spuinfo <span class="token operator">=</span> productFeignService<span class="token punctuation">.</span><span class="token function">getSpuInfoBySkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SpuInfoVo</span> spuInfoVo <span class="token operator">=</span> spuinfo<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuInfoVo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2\u3001\u8BBE\u7F6E\u5546\u54C1\u9879spu\u4FE1\u606F</span>
        <span class="token comment">// \u54C1\u724C\u4FE1\u606F</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setSpuBrand</span><span class="token punctuation">(</span>spuInfoVo<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u54C1\u5206\u7C7B\u4FE1\u606F</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setCategoryId</span><span class="token punctuation">(</span>spuInfoVo<span class="token punctuation">.</span><span class="token function">getCatalogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// spuid</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spuInfoVo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// spu_name \u5546\u54C1\u540D\u5B57</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setSpuName</span><span class="token punctuation">(</span>spuInfoVo<span class="token punctuation">.</span><span class="token function">getSpuName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3\u3001\u8BBE\u7F6E\u5546\u54C1sku\u4FE1\u606F</span>
        <span class="token comment">// skuid</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u54C1\u6807\u9898</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setSkuName</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u54C1\u56FE\u7247</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setSkuPic</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u54C1sku\u4EF7\u683C</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setSkuPrice</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u54C1\u5C5E\u6027\u4EE5 ; \u62C6\u5206</span>
        <span class="token class-name">String</span> skuAttr <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">collectionToDelimitedString</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getSkuAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setSkuAttrsVals</span><span class="token punctuation">(</span>skuAttr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u54C1\u8D2D\u4E70\u6570\u91CF</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setSkuQuantity</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4\u3001\u8BBE\u7F6E\u5546\u54C1\u4F18\u60E0\u4FE1\u606F\u3010\u4E0D\u505A\u3011</span>
        <span class="token comment">// 5\u3001\u8BBE\u7F6E\u5546\u54C1\u79EF\u5206\u4FE1\u606F</span>
        <span class="token comment">// \u8D60\u9001\u79EF\u5206 \u79FB\u5F03\u5C0F\u6570\u503C</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setGiftIntegration</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8D60\u9001\u6210\u957F\u503C</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setGiftGrowth</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6\u3001\u8BA2\u5355\u9879\u7684\u4EF7\u683C\u4FE1\u606F</span>
        <span class="token comment">// \u8FD9\u91CC\u9700\u8981\u8BA1\u7B97\u5546\u54C1\u7684\u5206\u89E3\u4FE1\u606F</span>
        <span class="token comment">// \u5546\u54C1\u4FC3\u9500\u5206\u89E3\u91D1\u989D</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setPromotionAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u4F18\u60E0\u5238\u4F18\u60E0\u5206\u89E3\u91D1\u989D</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setCouponAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u79EF\u5206\u4F18\u60E0\u5206\u89E3\u91D1\u989D</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setIntegrationAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u54C1\u4EF7\u683C\u4E58\u4EE5\u5546\u54C1\u8D2D\u4E70\u6570\u91CF=\u603B\u91D1\u989D(\u672A\u5305\u542B\u4F18\u60E0\u4FE1\u606F)</span>
        <span class="token class-name">BigDecimal</span> origin <span class="token operator">=</span> itemEntity<span class="token punctuation">.</span><span class="token function">getSkuPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getSkuQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u603B\u4EF7\u683C\u51CF\u53BB\u4F18\u60E0\u5377-\u79EF\u5206\u4F18\u60E0-\u5546\u54C1\u4FC3\u9500\u91D1\u989D = \u603B\u91D1\u989D</span>
        origin<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getPromotionAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getCouponAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getIntegrationAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BE5\u5546\u54C1\u7ECF\u8FC7\u4F18\u60E0\u540E\u7684\u5206\u89E3\u91D1\u989D</span>
        itemEntity<span class="token punctuation">.</span><span class="token function">setRealAmount</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> itemEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token doc-comment comment">/**
     * \u8BA1\u7B97\u8BA2\u5355\u6D89\u53CA\u5230\u7684\u79EF\u5206\u3001\u4F18\u60E0\u5377\u62B5\u6263\u3001\u4FC3\u9500\u4F18\u60E0\u4FE1\u606F\u7B49\u4FE1\u606F
     * <span class="token keyword">@param</span> <span class="token parameter">orderEntity</span>
     * <span class="token keyword">@param</span> <span class="token parameter">itemEntities</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderEntity</span> <span class="token function">computPrice</span><span class="token punctuation">(</span><span class="token class-name">OrderEntity</span> orderEntity<span class="token punctuation">,</span> <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemEntity</span><span class="token punctuation">&gt;</span></span> itemEntities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1\u3001\u5B9A\u4E49\u597D\u76F8\u5173\u91D1\u989D\uFF0C\u7136\u540E\u904D\u5386\u8D2D\u7269\u9879\u8FDB\u884C\u8BA1\u7B97</span>
        <span class="token comment">// \u603B\u4EF7\u683C</span>
        <span class="token class-name">BigDecimal</span> total <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u76F8\u5173\u4F18\u60E0\u4FE1\u606F</span>
        <span class="token comment">// \u4F18\u60E0\u5377\u62B5\u6263\u91D1\u989D</span>
        <span class="token class-name">BigDecimal</span> coupon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u79EF\u5206\u4F18\u60E0\u91D1\u989D</span>
        <span class="token class-name">BigDecimal</span> integration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u4FC3\u9500\u4F18\u60E0\u91D1\u989D</span>
        <span class="token class-name">BigDecimal</span> promotion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u79EF\u5206</span>
        <span class="token class-name">BigDecimal</span> gift <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6210\u957F\u503C</span>
        <span class="token class-name">BigDecimal</span> growth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u904D\u5386\u8BA2\u5355\u9879\u5C06\u6240\u6709\u7684\u4F18\u60E0\u4FE1\u606F\u8FDB\u884C\u76F8\u52A0</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">OrderItemEntity</span> itemEntity <span class="token operator">:</span> itemEntities<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            coupon <span class="token operator">=</span> coupon<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getCouponAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u4F18\u60E0\u5377\u62B5\u6263</span>
            integration <span class="token operator">=</span> integration<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getIntegrationAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u79EF\u5206\u4F18\u60E0\u5206\u89E3\u91D1\u989D</span>
            promotion <span class="token operator">=</span> promotion<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getPromotionAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5546\u54C1\u4FC3\u9500\u5206\u89E3\u91D1\u989D</span>
            gift <span class="token operator">=</span> gift<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getGiftIntegration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8D60\u9001\u79EF\u5206</span>
            growth <span class="token operator">=</span> growth<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getGiftGrowth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8D60\u9001\u6210\u957F\u503C</span>
            total <span class="token operator">=</span> total<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getRealAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u4F18\u60E0\u540E\u7684\u603B\u91D1\u989D</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2\u3001\u8BBE\u7F6E\u8BA2\u5355\u91D1\u989D</span>
        <span class="token comment">// \u8BA2\u5355\u603B\u91D1\u989D</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5E94\u4ED8\u603B\u989D = \u8BA2\u5355\u603B\u989D + \u8FD0\u8D39\u4FE1\u606F</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setPayAmount</span><span class="token punctuation">(</span>total<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderEntity<span class="token punctuation">.</span><span class="token function">getFreightAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u4FC3\u9500\u4F18\u5316\u91D1\u989D\uFF08\u4FC3\u9500\u4EF7\u3001\u6EE1\u51CF\u3001\u9636\u68AF\u4EF7\uFF09</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setPromotionAmount</span><span class="token punctuation">(</span>promotion<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u4F18\u60E0\u5238\u62B5\u6263\u91D1\u989D</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setCouponAmount</span><span class="token punctuation">(</span>coupon<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3\u3001\u8BBE\u7F6E\u79EF\u5206\u4FE1\u606F</span>
        <span class="token comment">// \u8BA2\u5355\u8D2D\u4E70\u540E\u53EF\u4EE5\u83B7\u5F97\u7684\u6210\u957F\u503C</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setGrowth</span><span class="token punctuation">(</span>growth<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u79EF\u5206\u62B5\u6263\u91D1\u989D</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setIntegrationAmount</span><span class="token punctuation">(</span>integration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u53EF\u4EE5\u83B7\u5F97\u7684\u79EF\u5206</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setIntegration</span><span class="token punctuation">(</span>gift<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5220\u9664\u72B6\u6001\u30100-&gt;\u672A\u5220\u9664\uFF1B1-&gt;\u5DF2\u5220\u9664\u3011</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setDeleteStatus</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> orderEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3\u3001\u5E93\u5B58\u81EA\u52A8\u89E3\u9501-mq" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5E93\u5B58\u81EA\u52A8\u89E3\u9501-mq" aria-hidden="true">#</a> 3\u3001\u5E93\u5B58\u81EA\u52A8\u89E3\u9501---&gt;MQ</h5><h6 id="\u5E93\u5B58\u89E3\u9501\u3001stockreleaselistener" tabindex="-1"><a class="header-anchor" href="#\u5E93\u5B58\u89E3\u9501\u3001stockreleaselistener" aria-hidden="true">#</a> \u5E93\u5B58\u89E3\u9501\u3001StockReleaseListener</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>ware<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>common<span class="token punctuation">.</span>to<span class="token punctuation">.</span>mq<span class="token punctuation">.</span></span><span class="token class-name">OrderTo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>common<span class="token punctuation">.</span>to<span class="token punctuation">.</span>mq<span class="token punctuation">.</span></span><span class="token class-name">StockLockedTo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>ware<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">WareSkuService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u76D1\u542C\u5E93\u5B58\u5EF6\u65F6\u961F\u5217
 * <span class="token keyword">@author</span> gcq
 * @Create 2021-01-07
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;stock.release.stock.queue&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StockReleaseListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">WareSkuService</span> wareSkuService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u76D1\u542C\u5E93\u5B58\u961F\u5217
     * <span class="token keyword">@param</span> <span class="token parameter">lockedTo</span>
     * <span class="token keyword">@param</span> <span class="token parameter">message</span>
     */</span>
    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleStockLockedRelease</span><span class="token punctuation">(</span><span class="token class-name">StockLockedTo</span> lockedTo<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6536\u5230\u89E3\u9501\u5E93\u5B58\u7684\u4FE1\u606F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            wareSkuService<span class="token punctuation">.</span><span class="token function">unLockStock</span><span class="token punctuation">(</span>lockedTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u5E93\u5B58\u89E3\u9501\u6210\u529F\u6CA1\u6709\u629B\u51FA\u5F02\u5E38\uFF0C\u81EA\u52A8ack\u673A\u5236\u786E\u8BA4</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u91CD\u53D1</span>
            channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u8BA2\u5355\u91CA\u653E
     *  \u8BA2\u535530\u5206\u949F\u672A\u652F\u4ED8\uFF0C\u8BA2\u5355\u5173\u95ED\u540E\u53D1\u9001\u7684\u6D88\u606F
     */</span>
    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerOrderCloseRelease</span><span class="token punctuation">(</span><span class="token class-name">OrderTo</span> orderTo<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BA2\u5355\u5173\u95ED\u51C6\u5907\u89E3\u9501\u5E93\u5B58......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            wareSkuService<span class="token punctuation">.</span><span class="token function">unLockStock</span><span class="token punctuation">(</span>orderTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * \u89E3\u9501\u5E93\u5B58
     * <span class="token keyword">@param</span> <span class="token parameter">lockedTo</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unLockStock</span><span class="token punctuation">(</span><span class="token class-name">StockLockedTo</span> lockedTo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5DE5\u4F5C\u5355\u8BE6\u60C5</span>
        <span class="token class-name">StockDetailTo</span> detail <span class="token operator">=</span> lockedTo<span class="token punctuation">.</span><span class="token function">getDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5DE5\u4F5C\u5355\u8BE6\u60C5id</span>
        <span class="token class-name">Long</span> detailId <span class="token operator">=</span> detail<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u67E5\u8BE2\u5230\u5E93\u5B58\u5DE5\u4F5C\u5355\u8BE6\u60C5</span>
        <span class="token class-name">WareOrderTaskDetailEntity</span> taskDetailEntity <span class="token operator">=</span> wareOrderTaskDetailService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>detailId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>taskDetailEntity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u89E3\u9501\u5E93\u5B58</span>
            <span class="token comment">// \u5E93\u5B58\u5DE5\u4F5C\u5355id</span>
            <span class="token class-name">Long</span> id <span class="token operator">=</span> lockedTo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u67E5\u8BE2\u5230\u5E93\u5B58\u5DE5\u4F5C\u5355</span>
            <span class="token class-name">WareOrderTaskEntity</span> <span class="token class-name">TaskEntity</span> <span class="token operator">=</span> wareOrderTaskService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u62FF\u5230\u8BA2\u5355\u53F7</span>
            <span class="token class-name">String</span> orderSn <span class="token operator">=</span> <span class="token class-name">TaskEntity</span><span class="token punctuation">.</span><span class="token function">getOrderSn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u6839\u636E\u8BA2\u5355\u53F7\u67E5\u8BE2\u8BA2\u5355\u7684\u72B6\u6001</span>
            <span class="token class-name">R</span> orderStatus <span class="token operator">=</span> orderFeignService<span class="token punctuation">.</span><span class="token function">getOrderStatus</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>orderStatus<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">OrderVo</span> data <span class="token operator">=</span> orderStatus<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeReference</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderVo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// \u8BA2\u5355\u72B6\u6001\u4E3A\u5DF2\u5173\u95ED,\u90A3\u4E48\u5C31\u9700\u8981\u89E3\u9501\u5E93\u5B58</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> data<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u5E93\u5B58\u5DE5\u4F5C\u5355\u9501\u5B9A\u72B6\u6001\u4E3A\u9501\u5B9A\u624D\u8FDB\u884C\u89E3\u9501</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>taskDetailEntity<span class="token punctuation">.</span><span class="token function">getLockStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">unLockStock</span><span class="token punctuation">(</span>detail<span class="token punctuation">.</span><span class="token function">getSkuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> detail<span class="token punctuation">.</span><span class="token function">getWareId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> detail<span class="token punctuation">.</span><span class="token function">getSkuNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> detailId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u6D88\u606F\u88AB\u62D2\u7EDD\u540E\u91CD\u65B0\u653E\u5230\u961F\u5217\u91CC\u9762\uFF0C\u8BA9\u522B\u4EBA\u7EE7\u7EED\u6D88\u8D39\u89E3\u9501</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FDC\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4\u3001\u652F\u4ED8" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u652F\u4ED8" aria-hidden="true">#</a> 4\u3001\u652F\u4ED8</h4><p>\u9009\u62E9\u7684\u662F\u652F\u4ED8\u5B9D\u652F\u4ED8\uFF0C\u6839\u636E\u8001\u5E08\u6240\u63D0\u4F9B\u7684\u7D20\u6750 <strong>alipayTemplate\u3001PayVo\u3001PaySyncVo</strong>,\u5F15\u5165\u5230\u9879\u76EE\u4E2D\u8FDB\u884C\u5F00\u53D1</p><h5 id="_1\u3001controller" tabindex="-1"><a class="header-anchor" href="#_1\u3001controller" aria-hidden="true">#</a> 1\u3001Controller</h5><p>\u8DF3\u8F6C\u5230\u652F\u4ED8\u5B9D\u652F\u4ED8\u9875\u9762\uFF0C<strong>\u652F\u4ED8\u5B8C\u6210\u540E\u8DF3\u8F6C\u5230\u652F\u4ED8\u6210\u529F\u7684\u56DE\u8C03\u9875\u9762</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 1\u3001\u8DF3\u8F6C\u5230\u652F\u4ED8\u9875\u9762
     * 2\u3001\u7528\u6237\u652F\u4ED8\u6210\u529F\u540E\uFF0C\u6211\u4EEC\u8981\u8DF3\u8F6C\u5230\u7528\u6237\u7684\u8BA2\u5355\u5217\u8868\u9875
     * produces \u660E\u786E\u65B9\u6CD5\u4F1A\u8FD4\u56DE\u4EC0\u4E48\u7C7B\u578B\uFF0C\u8FD9\u91CC\u8FD4\u56DE\u7684\u662Fhtml\u9875\u9762
     * <span class="token keyword">@param</span> <span class="token parameter">orderSn</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">AlipayApiException</span></span>
     */</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/payOrder&quot;</span><span class="token punctuation">,</span>produces <span class="token operator">=</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">payOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;orderSn&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> orderSn<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AlipayApiException</span> <span class="token punctuation">{</span>
<span class="token comment">//        PayVo payVo = new PayVo();</span>
<span class="token comment">//        payVo.setBody(); // \u5546\u54C1\u63CF\u8FF0</span>
<span class="token comment">//        payVo.setSubject(); //\u8BA2\u5355\u540D\u79F0</span>
<span class="token comment">//        payVo.setOut_trade_no(); // \u8BA2\u5355\u53F7</span>
<span class="token comment">//        payVo.setTotal_amount(); //\u603B\u91D1\u989D</span>
        <span class="token class-name">PayVo</span> payvo <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">payOrder</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5C06\u8FD4\u56DE\u652F\u4ED8\u5B9D\u7684\u652F\u4ED8\u9875\u9762\uFF0C\u9700\u8981\u5C06\u8FD9\u4E2A\u9875\u9762\u8FDB\u884C\u663E\u793A</span>
        <span class="token class-name">String</span> pay <span class="token operator">=</span> alipayTemplate<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span>payvo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> pay<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001service-1" tabindex="-1"><a class="header-anchor" href="#_2\u3001service-1" aria-hidden="true">#</a> 2\u3001Service</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * \u8BA1\u7B97\u5546\u54C1\u652F\u4ED8\u9700\u8981\u7684\u4FE1\u606F
     * <span class="token keyword">@param</span> <span class="token parameter">orderSn</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PayVo</span> <span class="token function">payOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderSn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PayVo</span> payVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PayVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OrderEntity</span> orderEntity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOrderByOrderSn</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u6839\u636E\u8BA2\u5355\u53F7\u67E5\u8BE2\u5230\u5546\u54C1</span>
        <span class="token comment">// \u6570\u636E\u5E93\u4E2D\u4ED8\u6B3E\u91D1\u989D\u5C0F\u6570\u67094\u4F4D\uFF0C\u4F46\u662F\u652F\u4ED8\u5B9D\u53EA\u63A5\u53D72\u4F4D\uFF0C\u6240\u4EE5\u5411\u4E0A\u53D6\u6574\u4E24\u4F4D\u6570</span>
        <span class="token class-name">BigDecimal</span> decimal <span class="token operator">=</span> orderEntity<span class="token punctuation">.</span><span class="token function">getPayAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ROUND_UP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        payVo<span class="token punctuation">.</span><span class="token function">setTotal_amount</span><span class="token punctuation">(</span>decimal<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u6237\u8BA2\u5355\u53F7</span>
        payVo<span class="token punctuation">.</span><span class="token function">setOut_trade_no</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u67E5\u8BE2\u51FA\u8BA2\u5355\u9879\uFF0C\u7528\u6765\u8BBE\u7F6E\u5546\u54C1\u7684\u63CF\u8FF0\u548C\u5546\u54C1\u540D\u79F0</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemEntity</span><span class="token punctuation">&gt;</span></span> itemEntities <span class="token operator">=</span> orderItemService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;order_sn&quot;</span><span class="token punctuation">,</span> orderSn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OrderItemEntity</span> itemEntity <span class="token operator">=</span> itemEntities<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BA2\u5355\u540D\u79F0\u4F7F\u7528\u5546\u54C1\u9879\u7684\u540D\u5B57</span>
        payVo<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getSkuName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u54C1\u7684\u63CF\u8FF0\u4F7F\u7528\u5546\u54C1\u9879\u7684\u5C5E\u6027</span>
        payVo<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getSkuAttrsVals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> payVo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3\u3001\u652F\u4ED8\u6210\u529F\u540E\u8DF3\u8F6C\u9875\u9762" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u652F\u4ED8\u6210\u529F\u540E\u8DF3\u8F6C\u9875\u9762" aria-hidden="true">#</a> 3\u3001\u652F\u4ED8\u6210\u529F\u540E\u8DF3\u8F6C\u9875\u9762</h5><p>\u652F\u4ED8\u6210\u529F\u540E\u8DF3\u8F6C\u5230<strong>\u8BA2\u5355\u9875\u9762</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
    * @\u9700\u6C42\u63CF\u8FF0: \u7CFB\u7EDF\u7BA1\u7406\u5458 \u4F1A\u5458\u670D\u52A1\u7EC4 \u6A21\u5757 \u7528\u6237\u652F\u4ED8\u6210\u529F\u540E\u8DF3\u8F6C\u5230\u8BE5\u9875\u9762
    * @\u521B\u5EFA\u4EBA: 
    * @\u521B\u5EFA\u65F6\u95F4: 2021/01/08 11:13
    * @\u4FEE\u6539\u9700\u6C42:
    * @\u4FEE\u6539\u4EBA:
    * @\u4FEE\u6539\u65F6\u95F4:
    * @\u9700\u6C42\u601D\u8DEF:
    */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/memberOrder.html&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">memberList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;pageNum&quot;</span><span class="token punctuation">,</span>defaultValue <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> pageNum<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u51C6\u5907\u5206\u9875\u53C2\u6570</span>
        <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span>pageNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8FDC\u7A0B\u67E5\u8BE2\u5F53\u524D\u7528\u6237\u7684\u6240\u6709\u8BA2\u5355</span>
        <span class="token class-name">R</span> r <span class="token operator">=</span> orderFeignService<span class="token punctuation">.</span><span class="token function">listwithItem</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * \u67E5\u8BE2\u5F53\u524D\u7528\u6237\u6240\u6709\u8BA2\u5355
     * <span class="token keyword">@param</span> <span class="token parameter">params</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PageUtils</span> <span class="token function">queryPageWithItem</span><span class="token punctuation">(</span><span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5F53\u524D\u7528\u6237\u767B\u5F55\u6570\u636E</span>
        <span class="token class-name">MemberRespVo</span> memberRespVo <span class="token operator">=</span> <span class="token class-name">LoginInterceptor</span><span class="token punctuation">.</span>loginUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u67E5\u8BE2\u5F53\u524D\u7528\u6237\u6240\u6709\u7684\u8BA2\u5355\u8BB0\u5F55</span>
        <span class="token class-name">IPage</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderEntity</span><span class="token punctuation">&gt;</span></span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">Query</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;member_id&quot;</span><span class="token punctuation">,</span>memberRespVo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderEntity</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u62FF\u5230\u5206\u9875\u67E5\u8BE2\u7ED3\u679C</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderEntity</span><span class="token punctuation">&gt;</span></span> orderEntityList <span class="token operator">=</span> records<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u6839\u636E\u8BA2\u5355\u53F7\u67E5\u8BE2\u5F53\u8BA2\u5355\u53F7\u5BF9\u5E94\u7684\u8BA2\u5355\u9879</span>
            <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemEntity</span><span class="token punctuation">&gt;</span></span> itemEntities <span class="token operator">=</span> orderItemService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;order_sn&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">getOrderSn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            item<span class="token punctuation">.</span><span class="token function">setOrderEntityItem</span><span class="token punctuation">(</span>itemEntities<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u91CD\u65B0\u8BBE\u7F6E\u5206\u9875\u6570\u636E</span>
        page<span class="token punctuation">.</span><span class="token function">setRecords</span><span class="token punctuation">(</span>orderEntityList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageUtils</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\u9875\u9762\u6E32\u67D3\u6570\u636E</p><p>\u652F\u4ED8\u5B9D\u6587\u6863\u5730\u5740:</p>`,217),Ve={href:"https://opendocs.alipay.com/open/270/105900",target:"_blank",rel:"noopener noreferrer"},De=s("https://opendocs.alipay.com/open/270/105900"),Be=p(`<p><img src="http://qnimg.gisfsde.com/work/image-20210108143131033.png" alt="image-20210108143131033" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20210105093259313.png" alt="image-20210105093259313" loading="lazy"></p><h4 id="_5\u3001\u6536\u5355" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u6536\u5355" aria-hidden="true">#</a> 5\u3001\u6536\u5355</h4><h5 id="\u8BA2\u5355-orderlistener" tabindex="-1"><a class="header-anchor" href="#\u8BA2\u5355-orderlistener" aria-hidden="true">#</a> \u8BA2\u5355\uFF1AOrderListener</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;order.release.order.queue&quot;</span><span class="token punctuation">)</span> <span class="token comment">// \u76D1\u542C\u8BA2\u5355\u7684\u91CA\u653E\u961F\u5217\uFF0C\u80FD\u5230\u8FD9\u4E2A\u91CC\u9762\u7684\u6D88\u606F\u90FD\u662F30\u5206\u949F\u540E\u8FC7\u6765\u7684</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u8BA2\u5355\u5B9A\u65F6\u5173\u5355
     *      \u5546\u54C1\u4E0B\u5355\u540E\uFF0C\u4F1A\u5411MQ\u4E2D\u53D1\u9001\u4E00\u6761\u6D88\u606F\u544A\u8BC9MQ\u8BA2\u5355\u521B\u5EFA\u6210\u529F\u3002
     *      \u90A3\u4E48\u8BA2\u5355\u521B\u5EFA30\u5206\u949F\u540E\u7528\u6237\u8FD8\u6CA1\u6709\u4E0B\u5355\uFF0CMQ\u5C31\u4F1A\u5173\u95ED\u8BE5\u8BA2\u5355
     * <span class="token keyword">@param</span> <span class="token parameter">orderEntity</span> \u8BA2\u5355\u5BF9\u8C61
     * <span class="token keyword">@param</span> <span class="token parameter">channel</span> \u4FE1\u9053
     * <span class="token keyword">@param</span> <span class="token parameter">message</span> \u4EA4\u6362\u673A
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
     */</span>
    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token class-name">OrderEntity</span> orderEntity<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6536\u5230\u8FC7\u671F\u7684\u8BA2\u5355\u4FE1\u606F\uFF0C\u51C6\u5907\u5173\u95ED\u8BA2\u5355\uFF1A&quot;</span> <span class="token operator">+</span> orderEntity<span class="token punctuation">.</span><span class="token function">getOrderSn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            orderService<span class="token punctuation">.</span><span class="token function">closeOrder</span><span class="token punctuation">(</span>orderEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u5173\u95ED\u8BA2\u5355\u6210\u529F\u540E\uFF0Cack\u4FE1\u606F\u786E\u8BA4</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>   <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeOrder</span><span class="token punctuation">(</span><span class="token class-name">OrderEntity</span> orderEntity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8BA2\u535530\u5206\u949F\u7684\u65F6\u95F4\u53EF\u80FD\u6709\u5C5E\u6027\u53D8\u52A8\uFF0C\u6240\u4EE5\u9700\u8981\u6839\u636E\u5C5E\u6027\u518D\u6B21\u67E5\u8BE2\u4E00\u6B21</span>
        <span class="token class-name">OrderEntity</span> entity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>orderEntity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5F53\u524D\u72B6\u6001\u4E3A\u5F85\u4ED8\u6B3E\uFF0C\u8BF4\u660E\u7528\u623730\u5206\u949F\u5185\u8FD8\u6CA1\u6709\u4ED8\u6B3E</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">OrderStatusEnum</span><span class="token punctuation">.</span>CREATE_NEW<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">OrderEntity</span> updateOrder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u6839\u636E\u8BA2\u5355id\u66F4\u65B0</span>
            updateOrder<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u8BA2\u5355\u72B6\u6001\u6539\u6210\u5DF2\u53D6\u6D88</span>
            updateOrder<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">OrderStatusEnum</span><span class="token punctuation">.</span>CANCLED<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u6839\u636E\u8BA2\u5355\u5BF9\u8C61\u66F4\u65B0</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>updateOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u51C6\u5907\u5171\u4EAB\u5BF9\u8C61\u7528\u4E8E\u53D1\u9001\u5230MQ\u4E2D</span>
            <span class="token class-name">OrderTo</span> orderTo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u62F7\u8D1D\u5C5E\u6027</span>
            <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>entity<span class="token punctuation">,</span>orderTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;order-event-exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order.release.other&quot;</span><span class="token punctuation">,</span>orderTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://qnimg.gisfsde.com/work/image-20210105093437013.png" alt="image-20210105093437013" loading="lazy"></p><ul><li>\u8BA2\u5355\u5728\u652F\u4ED8\u9875\uFF0C\u4E0D\u652F\u4ED8\uFF0C\u4E00\u76F4\u5237\u65B0\uFF0C\u8BA2\u5355\u8FC7\u671F\u4E86\u624D\u652F\u4ED8\uFF0C\u8BA2\u5355\u72B6\u6001\u6539\u4E3A\u5DF2\u652F\u4ED8\u4E86\uFF0C\u4F46\u662F\u5E93\u5B58\u89E3\u9501\u4E86\u3002 <ul><li>\u4F7F\u7528\u652F\u4ED8\u5B9D\u81EA\u52A8\u6536\u5355\u529F\u80FD\u89E3\u51B3\u3002\u53EA\u8981\u4E00\u6BB5\u65F6\u95F4\u4E0D\u652F\u4ED8\uFF0C\u5C31\u4E0D\u80FD\u652F\u4ED8\u4E86\u3002</li></ul></li><li>\u7531\u4E8E\u65F6\u5EF6\u7B49\u95EE\u9898\u3002\u8BA2\u5355\u89E3\u9501\u5B8C\u6210\uFF0C\u6B63\u5728\u89E3\u9501\u5E93\u5B58\u7684\u65F6\u5019\uFF0C\u5F02\u6B65\u901A\u77E5\u624D\u5230 <ul><li>\u8BA2\u5355\u89E3\u9501\uFF0C\u624B\u52A8\u8C03\u7528\u6536\u5355</li></ul></li><li>\u7F51\u7EDC\u963B\u585E\u95EE\u9898\uFF0C\u8BA2\u5355\u652F\u4ED8\u6210\u529F\u7684\u5F02\u6B65\u901A\u77E5\u4E00\u76F4\u4E0D\u5230\u8FBE <ul><li>\u67E5\u8BE2\u8BA2\u5355\u5217\u8868\u65F6\uFF0Cajax\u83B7\u53D6\u5F53\u524D\u672A\u652F\u4ED8\u7684\u8BA2\u5355\u72B6\u6001\uFF0C\u67E5\u8BE2\u8BA2\u5355\u72B6\u6001\u65F6\uFF0C\u518D\u83B7\u53D6\u4E00\u4E0B\u652F\u4ED8\u5B9D\u6B64\u8BA2\u5355\u7684\u72B6\u6001</li></ul></li><li>\u5176\u4ED6\u5404\u79CD\u95EE\u9898 <ul><li>\u6BCF\u5929\u665A\u4E0A\u95F2\u65F6\u4E0B\u8F7D\u652F\u4ED8\u5B9D\u5BF9\u8D26\u5355\uFF0C\u4E00 \u4E00 \u8FDB\u884C\u5BF9\u8D26</li></ul></li></ul><h1 id="_15\u3001\u5E42\u7B49\u6027" tabindex="-1"><a class="header-anchor" href="#_15\u3001\u5E42\u7B49\u6027" aria-hidden="true">#</a> 15\u3001\u5E42\u7B49\u6027</h1><h3 id="_15-1-\u4EC0\u4E48\u662F\u5E42\u7B49\u6027" tabindex="-1"><a class="header-anchor" href="#_15-1-\u4EC0\u4E48\u662F\u5E42\u7B49\u6027" aria-hidden="true">#</a> 15.1 \u4EC0\u4E48\u662F\u5E42\u7B49\u6027</h3><p><strong>\u63A5\u53E3\u5E42\u7B49\u6027\u5C31\u662F\u7528\u6237\u5BF9\u540C\u4E00\u64CD\u4F5C\u53D1\u8D77\u7684\u4E00\u6B21\u8BF7\u6C42\u548C\u591A\u6B21\u8BF7\u6C42\u7ED3\u679C\u662F\u4E00\u81F4\u7684</strong>\uFF0C\u4E0D\u4F1A\u56E0\u4E3A\u591A\u6B21\u70B9\u51FB\u800C\u4EA7\u751F\u4E86\u526F\u4F5C\u7528\uFF0C\u6BD4\u5982\u652F\u4ED8\u573A\u666F\uFF0C\u7528\u6237\u8D2D\u4E70\u4E86\u5546\u54C1\uFF0C\u652F\u4ED8\u6263\u6B3E\u6210\u529F\uFF0C\u4F46\u662F\u8FD4\u56DE\u7ED3\u679C\u7684\u65F6\u5019\u51FA\u73B0\u4E86\u7F51\u7EDC\u5F02\u5E38\uFF0C\u6B64\u65F6\u94B1\u5DF2\u7ECF\u6263\u4E86\uFF0C\u7528\u6237\u518D\u6B21\u70B9\u51FB\u6309\u94AE\uFF0C\u6B64\u65F6\u5C31\u4F1A\u8FDB\u884C\u7B2C\u4E8C\u6B21\u6263\u6B3E\uFF0C\u8FD4\u56DE\u7ED3\u679C\u6210\u529F\uFF0C\u7528\u6237\u67E5\u8BE2\u4F59\u989D\u53D1\u73B0\u591A\u6263\u94B1\u4E86\uFF0C\u6D41\u6C34\u8BB0\u5F55\u4E5F\u53D8\u6210\u4E86\u4E24\u6761\u3002\u3002\u3002\u8FD9\u5C31\u6CA1\u6709\u4FDD\u8BC1\u63A5\u53E3\u5E42\u7B49\u6027</p><h3 id="_15-2-\u90A3\u4E9B\u60C5\u51B5\u9700\u8981\u9632\u6B62" tabindex="-1"><a class="header-anchor" href="#_15-2-\u90A3\u4E9B\u60C5\u51B5\u9700\u8981\u9632\u6B62" aria-hidden="true">#</a> 15.2 \u90A3\u4E9B\u60C5\u51B5\u9700\u8981\u9632\u6B62</h3><p>\u7528\u6237\u591A\u6B21\u70B9\u51FB\u6309\u94AE</p><p>\u7528\u6237\u9875\u9762\u56DE\u9000\u518D\u6B21\u63D0\u4EA4</p><p>\u5FAE\u670D\u52A1\u4E92\u76F8\u8C03\u7528\uFF0C\u7531\u4E8E\u7F51\u7EDC\u95EE\u9898\uFF0C\u5BFC\u81F4\u8BF7\u6C42\u5931\u8D25\uFF0Cfeign\u89E6\u53D1\u91CD\u8BD5\u673A\u5236</p><p>\u5176\u4ED6\u4E1A\u52A1\u60C5\u51B5</p><h3 id="_15-3-\u4EC0\u4E48\u60C5\u51B5\u4E0B\u9700\u8981\u5E42\u7B49" tabindex="-1"><a class="header-anchor" href="#_15-3-\u4EC0\u4E48\u60C5\u51B5\u4E0B\u9700\u8981\u5E42\u7B49" aria-hidden="true">#</a> 15.3 \u4EC0\u4E48\u60C5\u51B5\u4E0B\u9700\u8981\u5E42\u7B49</h3><p>\u4EE5 SQL \u4E3A\u4F8B\uFF0C\u6709\u4E9B\u64CD\u4F5C\u65F6\u5929\u7136<strong>\u5E42\u7B49</strong>\u7684</p><p>SELECT * FROM table WHERE id =? \u65E0\u8BBA\u6267\u884C\u591A\u5C11\u6B21\u90FD\u4E0D\u4F1A\u6539\u53D8\u72B6\u6001\u662F\u5929\u7136\u7684<strong>\u5E42\u7B49</strong></p><p>UPDATE tab1 SET col1=1 WHERE col2=2 \u65E0\u8BBA\u6267\u884C\u6210\u529F\u591A\u5C11\u72B6\u6001\u90FD\u662F\u4E00\u81F4\u7684\uFF0C\u4E5F\u662F<strong>\u5E42\u7B49</strong>\u64CD\u4F5C</p><p>delete from user where userid=1 \u591A\u6B21\u64CD\u4F5C\uFF0C\u7ED3\u679C\u4E00\u6837\uFF0C\u5177\u5907<strong>\u5E42\u7B49</strong>\u6027</p><p>insert into user(userid,name) values(1,&#39; a&#39; ) \u5982userid\u4E3A\u552F\u4E00\u4E3B\u952E\uFF0C\u5373\u91CD\u590D\u4E0A\u9762\u7684\u4E1A\u52A1\uFF0C\u53EA\u4F1A\u63D2\u5165\u4E00\u6761\u7528\u6237\u8BB0\u5F55\uFF0C\u5177\u5907<strong>\u5E42\u7B49</strong>\u6027</p><hr><p>UPDATE tab1 SET col1=col1+1 WHERE col2=2,\u6BCF\u6B21\u6267\u884C\u7684\u7ED3\u679C\u90FD\u4F1A\u53D1\u751F\u53D8\u5316\uFF0C\u4E0D\u662F<strong>\u5E42\u7B49</strong>\u7684\u3002insert into user(userid,name) values(,a&quot;)\u5982userid\u4E0D\u662F\u4E3B\u952E\uFF0C\u53EF\u4EE5\u91CD\u590D\uFF0C\u90A3\u4E0A\u9762\u4E1A\u52A1\u591A\u6B21\u64CD\u4F5C\uFF0C\u6570\u636E\u90FD\u4F1A\u65B0\u589E\u591A\u6761\uFF0C\u4E0D\u5177\u5907<strong>\u5E42\u7B49</strong>\u6027\u3002</p><h3 id="_15-4-\u5E42\u7B49\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_15-4-\u5E42\u7B49\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 15.4 \u5E42\u7B49\u89E3\u51B3\u65B9\u6848</h3><h4 id="_1\u3001token-\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_1\u3001token-\u673A\u5236" aria-hidden="true">#</a> 1\u3001token \u673A\u5236</h4><p>1\u3001\u670D\u52A1\u7AEF\u63D0\u4F9B\u4E86\u53D1\u9001 <code>token</code> \u7684\u63A5\u53E3\uFF0C\u6211\u4EEC\u5728\u5206\u6790\u4E1A\u52A1\u7684\u65F6\u5019\uFF0C\u54EA\u4E9B\u4E1A\u52A1\u662F\u5B58\u5728\u5E42\u7B49\u6027\u95EE\u9898\u7684\uFF0C\u5C31\u5FC5\u987B\u5728\u6267\u884C\u4E1A\u52A1\u524D\uFF0C\u5148\u83B7\u53D6 <code>token</code>\uFF0C\u670D\u52A1\u5668\u4F1A\u628A <code>token</code> \u4FDD\u5B58\u5230 redis \u4E2D</p><p>2\u3001\u7136\u540E\u8C03\u7528\u4E1A\u52A1\u63A5\u53E3\u8BF7\u6C42\u65F6\uFF0C \u628A <code>token</code> \u643A\u5E26\u8FC7\u53BB\uFF0C\u4E00\u822C\u653E\u5728\u8BF7\u6C42\u5934\u90E8</p><p>3\u3001\u670D\u52A1\u5668\u5224\u65AD <code>token</code> \u662F\u5426\u5B58\u5728 <code>redis</code>\uFF0C\u5B58\u5728\u8868\u793A\u7B2C\u4E00\u6B21\u8BF7\u6C42\uFF0C\u7136\u540E\u5220\u9664 <code>token</code>\uFF0C\u7EE7\u7EED\u6267\u884C\u4E1A\u52A1</p><p>4\u3001\u5982\u679C\u5224\u65AD <code>token</code> \u4E0D\u5B58\u5728 <code>redis</code> \u4E2D\uFF0C\u5C31\u8868\u793A\u91CD\u590D\u64CD\u4F5C\uFF0C\u76F4\u63A5\u8FD4\u56DE\u91CD\u590D\u6807\u8BB0\u7ED9 <code>client</code>\uFF0C\u8FD9\u6837\u5C31\u4FDD\u8BC1\u4E86\u4E1A\u52A1\u4EE3\u7801\uFF0C\u4E0D\u88AB\u91CD\u590D\u6267\u884C</p><p>\u5371\u9669\u6027\uFF1A</p><p><strong>1\u3001\u5148\u5220\u9664 token \u8FD8\u662F\u540E\u5220\u9664 token\uFF1A</strong></p><ol><li>\u5148\u5220\u9664\u53EF\u80FD\u5BFC\u81F4\uFF0C\u4E1A\u52A1\u786E\u5B9E\u6CA1\u6709\u6267\u884C\uFF0C\u91CD\u8BD5\u8FD8\u5F97\u5E26\u4E0A\u4E4B\u524D\u7684 token, \u7531\u4E8E\u9632\u91CD\u8BBE\u8BA1\u5BFC\u81F4\uFF0C\u8BF7\u6C42\u8FD8\u662F\u4E0D\u80FD\u6267\u884C</li><li>\u540E\u5220\u9664\u53EF\u80FD\u5BFC\u81F4\uFF0C\u4E1A\u52A1\u5904\u7406\u6210\u529F\uFF0C\u4F46\u662F\u670D\u52A1\u95EA\u65AD\uFF0C\u51FA\u73B0\u8D85\u65F6\uFF0C\u6CA1\u6709\u5220\u9664\u6389token\uFF0C\u522B\u4EBA\u7EE7\u7EED\u91CD\u8BD5\uFF0C\u5BFC\u81F4\u4E1A\u52A1\u88AB\u6267\u884C\u4E24\u6B21</li><li>\u6211\u4EEC\u6700\u540E\u8BBE\u8BA1\u4E3A\u5148\u5220\u9664 token\uFF0C\u5982\u679C\u4E1A\u52A1\u8C03\u7528\u5931\u8D25\uFF0C\u5C31\u91CD\u65B0\u83B7\u53D6 token \u518D\u6B21\u8BF7\u6C42</li></ol><p><strong>2\u3001Token \u83B7\u53D6\uFF0C\u6BD4\u8F83 \u548C\u5220\u9664 \u5FC5\u987B\u662F\u539F\u5B50\u6027</strong></p><ol><li>redis.get\uFF08token\uFF09\uFF0Ctoken.equals\u3001redis.del\uFF08token\uFF09,\u5982\u679C\u8BF4\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u90FD\u4E0D\u662F\u539F\u5B50\uFF0C\u53EF\u80FD\u5BFC\u81F4\uFF0C\u5728\u9AD8\u5E76\u53D1\u4E0B\uFF0C\u90FD get \u540C\u6837\u7684\u6570\u636E\uFF0C\u5224\u65AD\u90FD\u6210\u529F\uFF0C\u7EE7\u7EED\u4E1A\u52A1\u5E76\u53D1\u6267\u884C</li><li>\u53EF\u4EE5\u5728 redis \u4F7F\u7528 lua \u811A\u672C\u5B8C\u6210\u8FD9\u4E2A\u64CD\u4F5C</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token string">&quot;if redis.call(&#39;get&#39;,KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;,KEYS[1]) else return 0 end&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2\u3001\u5404\u79CD\u9501\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5404\u79CD\u9501\u673A\u5236" aria-hidden="true">#</a> 2\u3001\u5404\u79CD\u9501\u673A\u5236</h4><h5 id="_1\u3001\u6570\u636E\u5E93\u60B2\u89C2\u9501" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6570\u636E\u5E93\u60B2\u89C2\u9501" aria-hidden="true">#</a> 1\u3001\u6570\u636E\u5E93\u60B2\u89C2\u9501</h5><p>select * from xxx where id = 1 for update;</p><p>for update \u67E5\u8BE2\u7684\u65F6\u5019\u9501\u5B9A\u8FD9\u6761\u8BB0\u5F55 \u522B\u4EBA\u9700\u8981\u7B49\u5F85</p><p>\u60B2\u89C2\u9501\u4F7F\u7528\u7684\u65F6\u5019\u4E00\u822C\u4F34\u968F\u4E8B\u52A1\u4E00\u8D77\u4F7F\u7528\uFF0C\u6570\u636E\u9501\u5B9A\u65F6\u95F4\u53EF\u80FD\u4F1A\u5F88\u957F\uFF0C\u9700\u8981\u6839\u636E\u5B9E\u9645\u60C5\u51B5\u9009\u7528\uFF0C\u53E6\u5916\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0Cid\u5B57\u6BB5\u4E00\u5B9A\u662F\u4E3B\u952E\u6216\u552F\u4E00\u7D22\u5F15\uFF0C\u4E0D\u7136\u53EF\u80FD\u9020\u6210\u9501\u8868\u7684\u7ED3\u679C\uFF0C\u5904\u7406\u8D77\u6765\u4F1A\u975E\u5E38\u9EBB\u70E6</p><h5 id="_2\u3001\u6570\u636E\u5E93\u7684\u4E50\u89C2\u9501" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6570\u636E\u5E93\u7684\u4E50\u89C2\u9501" aria-hidden="true">#</a> 2\u3001\u6570\u636E\u5E93\u7684\u4E50\u89C2\u9501</h5><p>\u8FD9\u79CD\u65B9\u6CD5\u9002\u5408\u5728\u66F4\u65B0\u7684\u573A\u666F\u4E2D</p><p>update t_goods set count = count - 1,version = version + 1 where good_id = 2 and version = 1</p><p>\u6839\u636E version \u7248\u672C\uFF0C\u4E5F\u5C31\u662F\u5728\u64CD\u4F5C\u6570\u636E\u5E93\u5B58\u524D\u5148\u83B7\u53D6\u5F53\u524D\u5546\u54C1\u7684 version \u7248\u672C\u53F7\uFF0C\u7136\u540E\u64CD\u4F5C\u7684\u65F6\u5019\u5E26\u4E0A version \u7248\u672C\u53F7\uFF0C\u6211\u4EEC\u68B3\u7406\u4E0B\uFF0C\u6211\u4EEC\u7B2C\u4E00\u6B21\u64CD\u4F5C\u5E93\u5B58\u65F6\uFF0C\u5F97</p><p>\u5230 version \u4E3A 1\uFF0C\u8C03\u7528\u5E93\u5B58\u670D\u52A1 version = 2\uFF0C\u4F46\u8FD4\u56DE\u7ED9\u8BA2\u5355\u670D\u52A1\u51FA\u73B0\u4E86\u95EE\u9898\uFF0C\u8BA2\u5355\u670D\u52A1\u53C8\u4E00\u6B21\u8C03\u7528\u4E86\u5E93\u5B58\u670D\u52A1\uFF0C\u5F53\u8BA2\u5355\u670D\u52A1\u4F20\u7684 version \u8FD8\u662F 1\uFF0C\u518D\u6267\u884C\u4E0A\u9762\u7684</p><p>sql \u8BED\u53E5 \u5C31\u4E0D\u4F1A\u6267\u884C\uFF0C\u56E0\u4E3A version \u5DF2\u7ECF\u53D8\u6210 2 \u4E86\uFF0Cwhere \u6761\u4EF6\u4E0D\u6210\u7ACB\uFF0C\u8FD9\u6837\u5C31\u4FDD\u8BC1\u4E86\u4E0D\u7BA1\u8C03\u7528\u51E0\u6B21\uFF0C\u53EA\u4F1A\u771F\u6B63\u5904\u7406\u4E00\u6B21\uFF0C\u4E50\u89C2\u9501\u4E3B\u8981\u4F7F\u7528\u4E8E\u5904\u7406\u8BFB\u591A\u5199\u5C11\u7684\u95EE\u9898</p><h5 id="_3\u3001\u4E1A\u52A1\u5C42\u5206\u5E03\u9501" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u4E1A\u52A1\u5C42\u5206\u5E03\u9501" aria-hidden="true">#</a> 3\u3001\u4E1A\u52A1\u5C42\u5206\u5E03\u9501</h5><p>\u5982\u679C\u591A\u4E2A\u673A\u5668\u53EF\u80FD\u5728\u540C\u4E00\u65F6\u95F4\u5904\u7406\u76F8\u540C\u7684\u6570\u636E\uFF0C\u6BD4\u5982\u591A\u53F0\u673A\u5668\u5B9A\u65F6\u4EFB\u52A1\u62FF\u5230\u4E86\u76F8\u540C\u7684\u6570\u636E\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u52A0\u5206\u5E03\u5F0F\u9501\uFF0C\u9501\u5B9A\u6B64\u6570\u636E\uFF0C\u5904\u7406\u5B8C\u6210\u540E\u540E\u91CA\u653E\u9501\uFF0C\u83B7\u53D6\u9501\u5FC5\u987B\u5148\u5224\u65AD\u8FD9\u4E2A\u6570\u636E\u662F\u5426\u88AB\u5904\u7406\u8FC7</p><h4 id="_3\u3001\u5404\u79CD\u552F\u4E00\u7EA6\u675F" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5404\u79CD\u552F\u4E00\u7EA6\u675F" aria-hidden="true">#</a> 3\u3001\u5404\u79CD\u552F\u4E00\u7EA6\u675F</h4><h5 id="_1\u3001\u6570\u636E\u5E93\u552F\u4E00\u7EA6\u675F" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6570\u636E\u5E93\u552F\u4E00\u7EA6\u675F" aria-hidden="true">#</a> 1\u3001\u6570\u636E\u5E93\u552F\u4E00\u7EA6\u675F</h5><p>\u63D2\u5165\u6570\u636E\uFF0C\u5E94\u8BE5\u6309\u7167\u552F\u4E00\u7D22\u5F15\u8FDB\u884C\u63D2\u5165\uFF0C\u6BD4\u5982\u8BA2\u5355\u53F7\uFF0C\u76F8\u540C\u8BA2\u5355\u5C31\u4E0D\u53EF\u80FD\u6709\u4E24\u6761\u8BA2\u5355\u63D2\u5165\uFF0C\u6211\u4EEC\u5728\u6570\u636E\u5E93\u5C42\u9762\u9632\u6B62\u91CD\u590D</p><p>\u8FD9\u4E2A\u673A\u5236\u5229\u7528\u4E86\u6570\u636E\u5E93\u7684\u4E3B\u952E\u552F\u4E00\u7EA6\u675F\u7684\u7279\u6027\uFF0C\u89E3\u51B3\u4E86 insert\u573A \u666F\u65F6\u5E42\u7B49\u95EE\u9898\uFF0C\u4F46\u4E3B\u952E\u7684\u8981\u6C42\u4E0D\u662F\u81EA\u589E\u7684\u4E3B\u952E\uFF0C\u8FD9\u6837\u5C31\u9700\u8981\u4E1A\u52A1\u751F\u6210\u5168\u5C40\u552F\u4E00\u7684\u4E3B\u952E</p><p>\u5982\u679C\u662F\u5206\u5E93\u5206\u8868\u573A\u666F\u4E0B\uFF0C\u8DEF\u7531\u89C4\u5219\u8981\u4FDD\u8BC1\u76F8\u540C\u8BF7\u6C42\u4E0B\uFF0C\u843D\u5730\u5728\u540C\u4E00\u4E2A\u6570\u636E\u5E93\u548C\u540C\u4E00\u8868\u4E2D\uFF0C\u8981\u4E0D\u7136\u6570\u636E\u5E93\u4E3B\u952E\u7EA6\u675F\u5C31\u4E0D\u8D77\u6548\u679C\u4E86\uFF0C\u56E0\u4E3A\u662F\u4E0D\u540C\u7684\u6570\u636E\u5E93\u548C\u8868\u4E3B\u952E\u4E0D\u76F8\u5173</p><h5 id="_2\u3001redis-set-\u9632\u91CD" tabindex="-1"><a class="header-anchor" href="#_2\u3001redis-set-\u9632\u91CD" aria-hidden="true">#</a> 2\u3001redis set \u9632\u91CD</h5><p>\u5F88\u591A\u6570\u636E\u9700\u8981\u5904\u7406\uFF0C\u53EA\u80FD\u88AB\u5904\u7406\u4E00\u6B21\uFF0C\u6BD4\u5982\u6211\u4EEC\u53EF\u4EE5\u8BA1\u7B97\u6570\u636E\u7684 MD5 \u5C06\u5176\u653E\u5165 redis \u7684</p><p>set,\u6BCF\u6B21\u5904\u7406\u6570\u636E\uFF0C\u5148\u770B\u8FD9\u4E2A MD5 \u662F\u5426\u5DF2\u7ECF\u5B58\u5728\uFF0C\u5B58\u5728\u5C31\u4E0D\u5904\u7406</p><h4 id="_4\u3001\u9632\u91CD\u8868" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u9632\u91CD\u8868" aria-hidden="true">#</a> 4\u3001\u9632\u91CD\u8868</h4><p>\u4F7F\u7528\u8BA2\u5355\u8868 <code>orderNo</code> \u505A\u4E3A\u53BB\u91CD\u8868\u7684\u552F\u4E00\u7D22\u5F15\uFF0C\u628A\u552F\u4E00\u7D22\u5F15\u63D2\u5165\u53BB\u91CD\u8868\uFF0C\u518D\u8FDB\u884C\u4E1A\u52A1\u64CD\u4F5C\uFF0C\u4E14\u4ED6\u4EEC\u5728\u540C\u4E00\u4E2A\u4E8B\u52A1\u4E2D\uFF0C\u8FD9\u6837\u5C31\u4FDD\u8BC1\u4E86\u91CD\u590D\u8BF7\u6C42\u65F6\uFF0C\u56E0\u4E3A\u53BB\u91CD\u8868\u6709\u552F\u4E00</p><p>\u7EA6\u675F\uFF0C\u5BFC\u81F4\u8BF7\u6C42\u5931\u8D25\uFF0C\u907F\u514D\u4E86\u5E42\u7B49\u6027\u7B49\u95EE\u9898\uFF0C\u53BB\u91CD\u8868\u548C\u4E1A\u52A1\u8868\u5E94\u8BE5\u5728\u540C\u4E00\u4E2A\u5E93\u4E2D\uFF0C\u8FD9\u6837\u5C31\u4FDD\u8BC1\u4E86\u5728\u540C\u4E00\u4E2A\u4E8B\u52A1\uFF0C\u5373\u4F7F\u4E1A\u52A1\u64CD\u4F5C\u5931\u8D25\uFF0C\u4E5F\u4F1A\u628A\u53BB\u91CD\u8868\u7684\u6570\u636E\u56DE\u6EDA\uFF0C\u8FD9</p><p>\u4E2A\u5F88\u597D\u7684\u4FDD\u8BC1\u4E86\u6570\u636E\u7684\u4E00\u81F4\u6027\uFF0C</p><p>redis\u9632\u91CD\u4E5F\u7B97</p><h4 id="_5\u3001\u5168\u5C40\u8BF7\u6C42\u552F\u4E00id" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u5168\u5C40\u8BF7\u6C42\u552F\u4E00id" aria-hidden="true">#</a> 5\u3001\u5168\u5C40\u8BF7\u6C42\u552F\u4E00id</h4><p>\u8C03\u7528\u63A5\u53E3\u65F6\uFF0C\u751F\u6210\u4E00\u4E2A\u552F\u4E00\u7684id\uFF0Credis \u5C06\u6570\u636E\u4FDD\u5B58\u5230\u96C6\u5408\u4E2D\uFF08\u53BB\u91CD\uFF09\uFF0C\u5B58\u5728\u5373\u5904\u7406\u8FC7\uFF0C\u53EF\u4EE5\u4F7F\u7528 nginx \u8BBE\u7F6E\u6BCF\u4E00\u4E2A\u8BF7\u6C42\u4E00\u4E2A\u552F\u4E00id</p><p>proxy_set_header X-Request-Id $Request_id</p><h1 id="_16\u3001\u672C\u5730\u4E8B\u52A1" tabindex="-1"><a class="header-anchor" href="#_16\u3001\u672C\u5730\u4E8B\u52A1" aria-hidden="true">#</a> 16\u3001\u672C\u5730\u4E8B\u52A1</h1><h3 id="_16-1-\u4E8B\u52A1\u7684\u57FA\u672C\u6027\u8D28" tabindex="-1"><a class="header-anchor" href="#_16-1-\u4E8B\u52A1\u7684\u57FA\u672C\u6027\u8D28" aria-hidden="true">#</a> 16.1 \u4E8B\u52A1\u7684\u57FA\u672C\u6027\u8D28</h3><p>\u6570\u636E\u5E93\u4E8B\u7269\u7684\u51E0\u4E2A\u7279\u6027\uFF1A\u539F\u5B50\u6027\uFF08Atomiccity\uFF09\u3001\u4E00\u81F4\u6027\uFF08Consistetcy\uFF09\u3001\u9694\u79BB\u6027\u6216\u72EC\u7ACB\u6027\uFF08Isolation\uFF09\u548C\u6301\u4E45\u6027\uFF08Durabilily\uFF09\uFF0C\u7B80\u79F0ACID</p><ul><li>**\u539F\u5B50\u6027\uFF1A**\u4E00\u7CFB\u5217\u64CD\u4F5C\u6574\u4F53\u4E0D\u53EF\u62C6\u5206\uFF0C\u8981\u4E48\u540C\u65F6\u6210\u529F\u8981\u4E48\u540C\u65F6\u5931\u8D25</li><li><strong>\u4E00\u81F4\u6027</strong>\uFF1A\u6570\u636E\u5728\u4E1A\u52A1\u7684\u524D\u540E\uFF0C\u4E1A\u52A1\u6574\u4F53\u4E00\u81F4 <ul><li>\u8F6C\u8D26 A:1000 B:1000 \u8F6C200 \u4E8B\u52A1\u6210\u529F A\uFF1A800 B\uFF1A1200</li></ul></li><li>**\u9694\u79BB\u6027\uFF1A**\u4E8B\u7269\u4E4B\u95F4\u9700\u8981\u76F8\u4E92\u9694\u79BB</li><li>**\u6301\u4E45\u6027\uFF1A**\u4E00\u65E6\u4E8B\u52A1\u6210\u529F\uFF0C\u6570\u636E\u4E00\u5B9A\u4F1A\u843D\u76D8\u5728\u6570\u636E\u5E93</li></ul><p>\u5728\u4EE5\u5F80\u7684\u5355\u4F53\u5E94\u7528\u4E2D\uFF0C\u6211\u4EEC\u591A\u4E2A\u4E1A\u52A1\u64CD\u4F5C\u4F7F\u7528\u540C\u4E00\u6761\u8FDE\u63A5\u64CD\u4F5C\u4E0D\u540C\u7684\u8868\uFF0C\u4E00\u65E6\u6709\u5F02\u5E38\u6211\u4EEC\u5F88\u5BB9\u6613\u6574\u4F53\u56DE\u6EDA</p><p><img src="http://qnimg.gisfsde.com/work/image-20201119115615054.png" alt="image-20201119115615054" loading="lazy"></p><p><strong>Business</strong>\uFF1A\u6211\u4EEC\u5177\u4F53\u7684\u4E1A\u52A1\u4EE3\u7801 <strong>Storage</strong>\uFF1A\u5E93\u5B58\u4E1A\u52A1\u4EE3\u7801;\u6263\u5E93\u5B58 <strong>Order</strong>\uFF1A\u8BA2\u5355\u4E1A\u52A1\u4EE3\u7801;\u4FDD\u5B58\u8BA2\u5355 <strong>Account</strong>\uFF1A\u8D26\u53F7\u4E1A\u52A1\u4EE3\u7801:\u51CF\u8D26\u6237\u4F59\u989D \u6BD4\u5982\u4E70\u4E1C\u897F\u4E1A\u52A1\uFF0C\u6263\u5E93\u5B58\uFF0C\u4E0B\u8BA2\u5355\uFF0C\u8D26\u6237\u6263\u6B3E\uFF0C\u662F\u4E00\u4E2A\u6574\u4F53\uFF1B\u5FC5\u987B\u540C\u65F6\u6210\u529F\u6216\u8005\u5931\u8D25</p><p>\u4E00\u4E2A\u4E8B\u52A1\u5F00\u59CB\uFF0C\u4EE3\u8868\u4EE5\u4E0B\u7684\u6240\u6709\u64CD\u4F5C\u90FD\u5728\u540C\u4E00\u4E2A\u8FDE\u63A5\u91CC\u9762</p><h3 id="_16-2-\u4E8B\u7269\u7684\u9694\u79BB\u7EA7\u522B" tabindex="-1"><a class="header-anchor" href="#_16-2-\u4E8B\u7269\u7684\u9694\u79BB\u7EA7\u522B" aria-hidden="true">#</a> 16.2 \u4E8B\u7269\u7684\u9694\u79BB\u7EA7\u522B</h3><ul><li><strong>READ UNCOMMITEED(\u8BFB\u672A\u63D0\u4EA4)</strong><ul><li>\u8BE5\u9694\u79BB\u7EA7\u522B\u7684\u4E8B\u52A1\u4F1A\u8BFB\u5230\u5176\u4ED6\u672A\u63D0\u4EA4\u4E8B\u52A1\u7684\u6570\u636E\uFF0C\u6B64\u73B0\u8C61\u4E5F\u79F0\u4E3A\u810F\u8BFB</li></ul></li><li><strong>READ COMMITTED\uFF08\u8BFB\u63D0\u4EA4\uFF09</strong><ul><li>\u4E00\u4E2A\u4E8B\u7269\u53EF\u4EE5\u8BFB\u53D6\u53E6\u4E00\u4E2A\u5DF2\u63D0\u4EA4\u7684\u4E8B\u52A1\uFF0C\u591A\u6B21\u8BFB\u53D6\u4F1A\u9020\u6210\u4E0D\u4E00\u6837\u7684\u7ED3\u679C\uFF0C\u6B64\u73B0\u8C61\u79F0\u4E3A\u4E0D\u53EF\u91CD\u590D\u8BFB\uFF0C\u590D\u8BFB\u95EE\u9898\uFF0COracle \u548CSQL Server \u7684\u9ED8\u8BA4\u9694\u79BB\u7EA7\u522B</li></ul></li><li><strong>REPEATABLE READ\uFF08\u53EF\u91CD\u590D\u8BFB\uFF09</strong><ul><li>\u8BE5\u9694\u79BB\u7EA7\u522B\u662F MySQL \u9ED8\u8BA4\u7684\u9694\u79BB\u7EA7\u522B\uFF0C\u5728\u540C\u4E00\u4E2A\u4E8B\u7269\u4E2D\uFF0CSELECT \u7684\u7ED3\u679C\u662F\u4E8B\u52A1\u5F00\u59CB\u65F6\u65F6\u95F4\u70B9\u7684\u72B6\u6001\uFF0C\u56E0\u6B64\uFF0C\u540C\u6837\u7684 SELECT \u64CD\u4F5C\u8BFB\u5230\u7684\u7ED3\u679C\u4F1A\u662F\u4E00\u81F4</li><li>\u4F46\u662F\u4F1A\u6709\u5E7B\u8BFB\u4E00\u81F4,MySQL\u7684 InnoDB \u5F15\u64CE\u53EF\u4EE5\u901A\u8FC7 next-key locks \u673A\u5236 \u6765\u907F\u514D\u5E7B\u8BFB</li></ul></li><li><strong>SERIALIZABLE\uFF08\u5E8F\u5217\u5316\uFF09</strong><ul><li>\u5728\u8BE5\u9694\u79BB\u7EA7\u522B\u4E0B\u4E8B\u52A1\u90FD\u662F\u4E32\u884C\u987A\u5E8F\u6267\u884C\u7684\uFF0CMySQL \u6570\u636E\u5E93\u7684 InnoDB \u5F15\u64CE\u4F1A\u7ED9\u8BFB\u64CD\u4F5C\u9690\u58EB\u52A0\u4E00\u628A\u8BFB\u5171\u4EAB\u9501\uFF0C\u4ECE\u800C\u907F\u514D\u4E86\u810F\u8BFB\u3001\u4E0D\u53EF\u91CD\u590D\u8BFB\u3001\u5E7B\u8BFB\u7B49\u95EE\u9898</li></ul></li></ul><p>\u8D8A\u5927\u7684\u9694\u79BB\u7EA7\u522B\uFF0C\u5E76\u53D1\u80FD\u529B\u8D8A\u4F4E</p><h3 id="_16-3-\u4E8B\u52A1\u4F20\u64AD\u884C\u4E3A" tabindex="-1"><a class="header-anchor" href="#_16-3-\u4E8B\u52A1\u4F20\u64AD\u884C\u4E3A" aria-hidden="true">#</a> 16.3 \u4E8B\u52A1\u4F20\u64AD\u884C\u4E3A</h3><p>**PROPAGATION_REQUIRED\uFF1A**\u5982\u679C\u5F53\u524D\u6CA1\u4E8B\u4E8B\u52A1\uFF0C\u5C31\u521B\u5EFA\u4E00\u4E2A\u65B0\u4E8B\u52A1\uFF0C\u5982\u679C\u5F53\u524D\u5B58\u5728\u4E8B\u52A1\uFF0C\u5C31\u52A0\u5165\u8BE5\u4E8B\u52A1\uFF0C\u8BE5\u8BBE\u7F6E\u65F6\u6700\u5E38\u4F7F\u7528\u7684\u914D\u7F6E</p><p>**PROPAGATION_SUPPORTS\uFF1A**\u652F\u6301\u5F53\u524D\u4E8B\u52A1\u3002\u5982\u679C\u5F53\u524D\u5B58\u5728\u4E8B\u52A1\uFF0C\u5C31\u52A0\u5165\u8BE5\u4E8B\u52A1\uFF0C\u5982\u679C\u5F53\u524D\u4E0D\u5B58\u5728\u4E8B\u52A1\uFF0C\u5C31\u4EE5\u975E\u4E8B\u52A1\u6267\u884C</p><p>**PROPAGATION_MANDATORY\uFF1A**\u652F\u6301\u5F53\u524D\u4E8B\u52A1\uFF0C\u5982\u679C\u5F53\u524D\u5B58\u5728\u4E8B\u52A1\uFF0C\u5C31\u52A0\u5165\u8BE5\u4E8B\u52A1\uFF0C\u5982\u679C\u5F53\u524D\u4E0D\u5B58\u5728\u8BE5\u4E8B\u52A1\uFF0C\u5C31\u629B\u51FA\u5F02\u5E38</p><p>**PROPAGATION_REQUIRES_NEW\uFF1A**\u521B\u5EFA\u65B0\u4E8B\u52A1\uFF0C\u65E0\u8BBA\u5F53\u524D\u5B58\u4E0D\u5B58\u5728\u4E8B\u52A1\uFF0C\u90FD\u521B\u5EFA\u65B0\u4E8B\u52A1</p><p>**PROPAGATION_NOT_SUPPORTED\uFF1A**\u4EE5\u975E\u4E8B\u52A1\u7684\u65B9\u5F0F\u6267\u884C\u64CD\u4F5C\uFF0C\u5982\u679C\u5F53\u524D\u5B58\u5728\u4E8B\u52A1\uFF0C\u5C31\u628A\u5F53\u524D\u4E8B\u52A1\u6302\u8D77</p><p>**PROPAGATION_NEVER\uFF1A**\u4EE5\u975E\u4E8B\u52A1\u65B9\u5F0F\u8FD0\u884C\uFF0C\u5982\u679C\u5F53\u524D\u5B58\u5728\u4E8B\u52A1\uFF0C\u5219\u629B\u51FA\u5F02\u5E38</p><p>**PROPAGATION_NESTED\uFF1A**\u5982\u679C\u5F53\u524D\u5B58\u5728\u4E8B\u52A1\uFF0C\u5C31\u5D4C\u5957\u5728\u8BE5\u4E8B\u52A1\u5185\u6267\u884C\uFF0C\u5982\u679C\u5F53\u524D\u6CA1\u6709\u4E8B\u52A1\uFF0C\u5219\u6267\u884CPROPAGATION_REQUIRED\u76F8\u5173\u64CD\u4F5C</p><h3 id="_16-4-springboot-\u4E8B\u52A1\u5173\u952E\u70B9" tabindex="-1"><a class="header-anchor" href="#_16-4-springboot-\u4E8B\u52A1\u5173\u952E\u70B9" aria-hidden="true">#</a> 16.4 SpringBoot \u4E8B\u52A1\u5173\u952E\u70B9</h3><p>\u5728\u540C\u4E00\u4E2A\u4E8B\u7269\u5185\u7F16\u5199\u4E24\u4E2A\u65B9\u6CD5\uFF0C\u5185\u90E8\u8C03\u7528\u7684\u65F6\u5019\uFF0C\u4F1A\u5BFC\u81F4\u4E8B\u52A1\u5931\u6548\uFF0C\u539F\u56E0\u662F\u6CA1\u6709\u7528\u5230\u4EE3\u7406\u5BF9\u8C61\u7684\u7F18\u6545</p><p>\u89E3\u51B3</p><p>0)\u3001\u5BFC\u5165spring-boot-starter-aop 1)\u3001@EnableTransactionManagement(proxyTargetClass= true) 2)\u3001@EnableAspectJAutoProxy(lexposeProxy-true) 3)\u3001AopContext.currentProxy() \u8C03\u7528\u65B9\u6CD5</p><h4 id="_1\u3001\u4E8B\u7269\u7684\u81EA\u52A8\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u4E8B\u7269\u7684\u81EA\u52A8\u914D\u7F6E" aria-hidden="true">#</a> 1\u3001\u4E8B\u7269\u7684\u81EA\u52A8\u914D\u7F6E</h4><h4 id="_2\u3001\u4E8B\u7269\u7684\u5751" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4E8B\u7269\u7684\u5751" aria-hidden="true">#</a> 2\u3001\u4E8B\u7269\u7684\u5751</h4><h1 id="_17\u3001\u5206\u5E03\u5F0F\u4E8B\u52A1" tabindex="-1"><a class="header-anchor" href="#_17\u3001\u5206\u5E03\u5F0F\u4E8B\u52A1" aria-hidden="true">#</a> 17\u3001\u5206\u5E03\u5F0F\u4E8B\u52A1</h1><h3 id="_17-1-\u4E3A\u4EC0\u4E48\u8981\u6709\u5206\u5E03\u5F0F\u4E8B\u52A1" tabindex="-1"><a class="header-anchor" href="#_17-1-\u4E3A\u4EC0\u4E48\u8981\u6709\u5206\u5E03\u5F0F\u4E8B\u52A1" aria-hidden="true">#</a> 17.1 \u4E3A\u4EC0\u4E48\u8981\u6709\u5206\u5E03\u5F0F\u4E8B\u52A1</h3><p>\u5206\u5E03\u5F0F\u7CFB\u7EDF\u7ECF\u5E38\u51FA\u73B0\u7684\u5F02\u5E38</p><p>\u673A\u5668\u5B95\u673A\u3001\u7F51\u7EDC\u5F02\u5E38\u3001\u6D88\u606F\u4E22\u5931\u3001\u6D88\u606F\u4E71\u5E8F\u3001\u4E0D\u53EF\u9760\u7684TCP\u3001\u5B58\u50A8\u6570\u636E\u4E22\u5931....</p><p><img src="http://qnimg.gisfsde.com/work/image-20201119170602679.png" alt="image-20201119170602679" loading="lazy"></p><p>\u5206\u5E03\u5F0F\u4E8B\u52A1\u662F\u4F01\u4E1A\u4E2D\u96C6\u6210\u7684\u4E00\u4E2A\u96BE\u70B9\uFF0C\u4E5F\u662F\u6BCF\u4E00\u4E2A\u5206\u5E03\u5F0F\u7CFB\u7EDF\u67B6\u6784\u4E2D\u90FD\u4F1A\u6D89\u53CA\u5230\u7684\u4E00\u4E2A\u4E1C\u897F\uFF0C\u7279\u522B\u662F\u5728\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\uFF0C\u51E0\u4E4E\u662F\u65E0\u6CD5\u907F\u514D\u7684</p><h3 id="_17-2-cap-\u5B9A\u7406\u4E0E-base-\u7406\u8BBA" tabindex="-1"><a class="header-anchor" href="#_17-2-cap-\u5B9A\u7406\u4E0E-base-\u7406\u8BBA" aria-hidden="true">#</a> 17.2 CAP \u5B9A\u7406\u4E0E BASE \u7406\u8BBA</h3><h4 id="_1\u3001cap-\u5B9A\u7406" tabindex="-1"><a class="header-anchor" href="#_1\u3001cap-\u5B9A\u7406" aria-hidden="true">#</a> 1\u3001CAP \u5B9A\u7406</h4><p>CAP \u539F\u5219\u53C8\u79F0 CAP \u5B9A\u7406\u6307\u7684\u662F\u5728\u4E00\u4E2A\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D</p><ul><li><strong>\u4E00\u81F4\u6027\uFF08Consistency\uFF09</strong><ul><li>\u5728\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u6240\u6709\u6570\u636E\u5907\u4EFD\uFF0C\u5728\u540C\u4E00\u65F6\u523B\u662F\u5426\u662F\u540C\u6837\u7684\u503C\uFF0C\uFF08\u7B49\u540C\u4E8E\u6240\u6709\u8282\u70B9\u8BBF\u95EE\u540C\u4E00\u4EFD\u6700\u65B0\u6570\u636E\u7684\u526F\u672C\uFF09</li></ul></li><li><strong>\u53EF\u7528\u6027\uFF08Avaliability\uFF09</strong><ul><li>\u5728\u96C6\u7FA4\u4E2D\u4E00\u90E8\u5206\u8282\u70B9\u6545\u969C\u540E\uFF0C\u96C6\u7FA4\u6574\u4F53\u662F\u5426\u8FD8\u80FD\u54CD\u5E94\u5BA2\u6237\u7AEF\u7684\u8BFB\u5199\u8BF7\u6C42\uFF0C\uFF08\u5BF9\u6570\u636E\u66F4\u65B0\u5177\u5907\u9AD8\u53EF\u7528\u6027\uFF09</li></ul></li><li><strong>\u5206\u533A\u5BB9\u9519\u6027\uFF08Partition tolerance\uFF09</strong><ul><li>\u5927\u591A\u6570\u5206\u5E03\u5F0F\u7CFB\u7EDF\u90FD\u5206\u5E03\u5728\u591A\u4E2A\u5B50\u7F51\u7EDC\uFF0C\u6BCF\u4E2A\u81EA\u7F51\u7EDC\u53EB\u505A\u4E00\u4E2A\u533A\uFF08partition\uFF09\u3002\u5206\u533A\u5BB9\u9519\u6027\u7684\u610F\u601D\u662F\uFF0C\u533A\u95F4\u901A\u4FE1\u53EF\u80FD\u5931\u8D25\uFF0C\u6BD4\u5982\uFF0C\u4E00\u53F0\u670D\u52A1\u5668\u653E\u5728\u4E2D\u56FD\u53E6\u4E00\u53F0\u670D\u52A1\u5668\u653E\u5728\u7F8E\u56FD\uFF0C\u8FD9\u5C31\u662F\u4E24\u4E2A\u533A\uFF0C\u5B83\u4EEC\u4E4B\u95F4\u53EF\u80FD\u65E0\u6CD5\u901A\u4FE1</li></ul></li></ul><p>CAP \u7684\u539F\u5219\u662F\uFF0C\u8FD9\u4E09\u4E2A\u8981\u7D20\u6700\u591A\u53EA\u80FD\u6EE1\u8DB3\u4E24\u4E2A\u70B9\uFF0C<strong>\u4E0D\u53EF\u80FD\u4E09\u8005\u517C\u987E</strong></p><p><img src="http://qnimg.gisfsde.com/work/image-20201119194354467.png" alt="image-20201119194354467" loading="lazy"></p><p>\u4E00\u822C\u6765\u8BF4\uFF0C\u5206\u533A\u5BB9\u9519\u65E0\u6CD5\u907F\u514D\uFF0C\u56E0\u6B64\u6211\u4EEC\u53EF\u4EE5\u8BA4\u4E3A CAP \u7684 P \u603B\u662F\u6210\u7ACB\uFF0CCAP \u5B9A\u7406\u544A\u8BC9\u6211\u4EEC \u5269\u4E0B\u7684 C \u548C A \u65E0\u6CD5\u540C\u65F6\u505A\u5230</p><p>\u5206\u5E03\u5F0F\u5B9E\u73B0\u4E00\u81F4\u6027\u7684 raft \u7B97\u6CD5</p>`,105),Me={href:"http://thesecretlivesofdata.com/raft/",target:"_blank",rel:"noopener noreferrer"},Ue=s("http://thesecretlivesofdata.com/raft/"),Ne=p('<h4 id="_2\u3001\u9762\u4E34\u7684\u95EE" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u9762\u4E34\u7684\u95EE" aria-hidden="true">#</a> 2\u3001\u9762\u4E34\u7684\u95EE</h4><p>\u5BF9\u4E8E\u5927\u591A\u6570\u4E92\u8054\u7F51\u5E94\u7528\u7684\u573A\u666F\u3001\u4E3B\u673A\u4F17\u591A\u3001\u90E8\u7F72\u5206\u6563\uFF0C\u800C\u4E14\u96C6\u7FA4\u89C4\u6A21\u8D8A\u6765\u8D8A\u5927\uFF0C\u6240\u4EE5\u8282\u70B9\u6545\u969C\uFF0C\u7F51\u7EDC\u6545\u969C\u662F\u5E38\u6001\uFF0C\u800C\u4E14\u8981\u4FDD\u8BC1\u670D\u52A1\u53EF\u7528\u6027\u8FBE\u523099.999%\uFF0C\u5373\u4FDD\u8BC1P \u548C A,\u820D\u5F03C</p><h4 id="_3\u3001base-\u7406\u8BBA" tabindex="-1"><a class="header-anchor" href="#_3\u3001base-\u7406\u8BBA" aria-hidden="true">#</a> 3\u3001BASE \u7406\u8BBA</h4><p>\u662F\u5BF9CAP\u7684\u5EF6\u7533\uFF0C\u601D\u60F3\u5373\u662F\u65E0\u6CD5\u505A\u5230\u5F3A\u4E00\u81F4\u6027\uFF08CAP\u7684\u4E00\u81F4\u6027\u5C31\u662F\u5F3A\u4E00\u81F4\u6027\uFF09\uFF0C\u4F46\u53EF\u4EE5\u91C7\u7528\u9002\u5F53\u7684\u5F31\u4E00\u81F4\u6027\uFF0C\u5373<strong>\u6700\u7EC8\u4E00\u81F4\u6027</strong></p><p>BASE \u662F\u6307</p><ul><li>\u57FA\u672C\u53EF\u7528\uFF08Basically Avaliable\uFF09 <ul><li>\u57FA\u672C\u53EF\u7528\u662F\u6307\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u5728\u51FA\u73B0\u6545\u969C\u7684\u65F6\u5019\uFF0C\u5141\u8BB8\u635F\u5931\u90E8\u5206\u53EF\u7528\u6027\uFF08\u5217\u5165\u54CD\u5E94\u65F6\u95F4\uFF0C\u529F\u80FD\u4E0A\u7684\u53EF\u7528\u6027\uFF09\u5141\u8BB8\u635F\u5931\u90E8\u5206\u53EF\u7528\u6027\u3002\u9700\u8981\u6CE8\u610F\u7684\u662F\u57FA\u672C\u53EF\u7528\u4E0D\u7B49\u4EF7\u4E8E\u7CFB\u7EDF\u4E0D\u53EF\u7528</li><li>\u54CD\u5E94\u65F6\u95F4\u4E0A\u7684\u635F\u5931\uFF0C\u6B63\u5E38\u60C5\u51B5\u4E0B\u641C\u7D22\u5F15\u64CE\u9700\u8981\u57280.5\u79D2\u4E4B\u5185\u8FD4\u56DE\u7ED9\u7528\u6237\u76F8\u5E94\u7684\u67E5\u8BE2\u7ED3\u679C\uFF0C\u4F46\u7531\u4E8E\u51FA\u73B0\u6545\u969C\uFF08\u6BD4\u5982\u7CFB\u7EDF\u90E8\u5206\u673A\u623F\u65AD\u7535\u65AD\u7F51\u6545\u969C\uFF09\uFF0C\u67E5\u8BE2\u7684\u7ED3\u679C\u54CD\u5E94\u65F6\u95F4\u589E\u52A0\u5230\u4E861~2\u79D2</li><li>\u529F\u80FD\u4E0A\u7684\u635F\u5931\uFF0C\u8D2D\u7269\u7F51\u7AD9\u53CC\u5341\u4E00\u8D2D\u7269\u9AD8\u5CF0\uFF0C\u4E3A\u4E86\u4FDD\u8BC1\u7CFB\u7EDF\u7684\u7A33\u5B9A\u6027\uFF0C\u90E8\u5206\u6D88\u8D39\u8005\u4F1A\u88AB\u5F15\u5165\u5230\u4E00\u4E2A\u964D\u7EA7\u9875\u9762</li></ul></li><li><strong>\u8F6F\u72B6\u6001\uFF08Soft State\uFF09</strong><ul><li>\u8F6F\u72B6\u6001\u662F\u6307\u5141\u8BB8 \u7CFB\u7EDF\u5B58\u5728\u4E2D\u95F4\u72B6\u6001\uFF0C\u800C\u8BE5\u4E2D\u95F4\u72B6\u6001\u4E0D\u4F1A\u5F71\u54CD\u7CFB\u7EDF\u6574\u4F53\u53EF\u7528\u6027\u3002\u5206\u5E03\u5F0F\u5B58\u50A8\u4E2D\u4E00\u822C\u4E00\u4EFD\u6570\u636E\u4F1A\u6709 \u591A\u4E2A\u526F\u672C\uFF0C\u5141\u8BB8\u4E0D\u540C\u526F\u672C\u540C\u6B65\u7684\u5EF6\u65F6\u5C31\u662F\u8F6F\u72B6\u6001\u7684\u4F53\u73B0\u3002mysglreplication\u7684\u5F02\u6B65\u590D\u5236\u4E5F\u662F\u4E00\u79CD\u4F53\u73B0\u3002</li></ul></li><li><strong>\u6700\u7EC8\u4E00\u81F4\u6027( Eventual Consistency)</strong><ul><li>\u6700\u7EC8\u81F4\u6027\u662F\u6307\u7CFB\u7EDF\u4E2D\u7684\u6240\u6709\u6570\u636E\u526F\u672C\u7ECF\u8FC7\u4E00\u5B9A\u65F6\u95F4\u540E\uFF0C\u6700\u7EC8\u80FD\u591F\u8FBE\u5230\u4E00 \u81F4\u7684\u72B6\u6001\u3002\u5F31\u4E00\u81F4\u6027\u548C\u5F3A\u4E00\u81F4\u6027\u76F8\u53CD\uFF0C\u6700\u7EC8-\u81F4\u6027\u662F\u5F31\u4E00\u81F4\u6027\u7684\u4E00\u79CD\u7279\u6B8A\u60C5\u51B5\u3002</li></ul></li></ul><h4 id="_4\u3001\u5F3A\u4E00\u81F4\u6027\u3001\u5F31\u4E00\u81F4\u6027\u3001\u6700\u7EC8\u4E00\u81F4\u6027" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5F3A\u4E00\u81F4\u6027\u3001\u5F31\u4E00\u81F4\u6027\u3001\u6700\u7EC8\u4E00\u81F4\u6027" aria-hidden="true">#</a> 4\u3001\u5F3A\u4E00\u81F4\u6027\u3001\u5F31\u4E00\u81F4\u6027\u3001\u6700\u7EC8\u4E00\u81F4\u6027</h4><p>\u4ECE\u5BA2\u6237\u7AEF\u89D2\u5EA6\uFF0C\u591A\u8FDB\u7A0B\u5E76\u53D1\u8BBF\u95EE\u65F6\uFF0C\u66F4\u65B0\u8FC7\u7684\u6570\u636E\u5728\u4E0D\u540C\u8FDB\u7A0B\u5982\u4F55\u83B7\u53D6\u7684\u4E0D\u540C\u7B56\u7565\uFF0C\u51B3\u5B9A\u4E86\u4E0D\u540C\u7684\u4E00\u81F4\u6027\u3002\u5BF9\u4E8E\u5173\u7CFB\u578B\u6570\u636E\u5E93\uFF0C\u8981\u6C42\u66F4\u65B0\u8FC7\u7684\u6570\u636E\u80FD\u88AB\u540E\u7EED\u7684\u8BBF\u95EE\u90FD\u80FD\u770B\u5230\uFF0C\u8FD9\u662F\u5F3A\u4E00\u81F4\u6027\u3002\u5982\u679C\u80FD\u5BB9\u5FCD\u540E\u7EED\u7684\u90E8\u5206\u6216\u8005\u5168\u90E8\u8BBF\u95EE\u4E0D\u5230\uFF0C\u5219\u662F\u5F31\u4E00\u81F4\u6027\u3002\u5982\u679C\u7ECF\u8FC7\u4E00\u6BB5\u65F6\u95F4\u540E\u8981\u6C42\u80FD\u8BBF\u95EE\u5230\u66F4\u65B0\u540E\u7684\u6570\u636E\uFF0C\u5219\u662F\u6700\u7EC8\u4E00\u81F4\u6027</p><h3 id="_17-3-\u5206\u5E03\u5F0F\u4E8B\u52A1\u7684\u51E0\u79CD\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_17-3-\u5206\u5E03\u5F0F\u4E8B\u52A1\u7684\u51E0\u79CD\u65B9\u6848" aria-hidden="true">#</a> 17.3 \u5206\u5E03\u5F0F\u4E8B\u52A1\u7684\u51E0\u79CD\u65B9\u6848</h3><h4 id="_1\u30012pc-\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1\u30012pc-\u6A21\u5F0F" aria-hidden="true">#</a> 1\u30012PC \u6A21\u5F0F</h4><p>\u6570\u636E\u5E93\u652F\u6301\u7684 2PC[2 phase commit \u4E8C\u9636\u63D0\u4EA4]\uFF0C\u53C8\u53EB XA Transactions</p><p>MySQL \u4ECE5.5\u7248\u672C\u5F00\u59CB\u652F\u6301\uFF0CSql Server 2005 \u5F00\u59CB\u652F\u6301\uFF0Coracle7 \u5F00\u59CB\u652F\u6301</p><p>\u5176\u4E2D\uFF0CXA \u662F\u4E00\u4E2A\u4E24\u9636\u6BB5\u63D0\u4EA4\u534F\u8BAE\uFF0C\u8BE5\u534F\u8BAE\u5206\u4E3A\u4E24\u4E2A\u9636\u6BB5\uFF1A</p><p>\u7B2C\u4E00\u9636\u6BB5\uFF1A\u4E8B\u52A1\u534F\u8C03\u5668\u8981\u6C42\u6BCF\u4E2A\u6D89\u53CA\u5230\u4E8B\u52A1\u7684\u6570\u636E\u5E93\u9884\u63D0\u4EA4\uFF08precommit\uFF09\u6B64\u64CD\u4F5C\uFF0C\u5E76\u53CD\u5E94\u662F\u5426\u53EF\u4EE5\u63D0\u4EA4</p><p>\u7B2C\u4E8C\u9636\u6BB5\uFF1A\u4E8B\u52A1\u534F\u8C03\u5668\u8981\u6C42\u6BCF\u4E2A\u6570\u636E\u5E93\u63D0\u4EA4\u6570\u636E</p><p>\u5176\u4E2D\uFF0C\u5982\u679C\u6709\u4EFB\u4F55\u4E00\u4E2A\u6570\u636E\u5E93\u5426\u8BA4\u8FD9\u6B21\u63D0\u4EA4\uFF0C\u90A3\u4E48\u6240\u6709\u6570\u636E\u5E93\u90FD\u4F1A\u8981\u6C42\u56DE\u6EDA\u4ED6\u4EEC\u5728\u6B64\u4E8B\u52A1\u4E2D\u7684\u90A3\u90E8\u5206\u4FE1\u606F</p><p><img src="http://qnimg.gisfsde.com/work/image-20201120090516086.png" alt="image-20201120090516086" loading="lazy"></p><ul><li>XA\u534F\u8BAE\u6BD4\u8F83\u7B80\u5355\uFF0C\u800C\u4E14\u4E00\u65E6\u5546\u4E1A\u6570\u636E\u5E93\u5B9E\u73B0\u4E86XA\u534F\u8BAE\uFF0C\u4F7F\u7528\u5206\u5E03\u5F0F\u4E8B\u52A1\u7684\u6210\u672C\u4E5F\u6BD4\u8F83\u4F4E\u3002</li><li>XA\u6027\u80FD\u4E0D\u7406\u60F3\uFF0C\u7279\u522B\u662F\u5728\u4EA4\u6613\u4E0B\u5355\u94FE\u8DEF\uFF0C\u5F80\u5F80\u5E76\u53D1\u91CF\u5F88\u9AD8\uFF0CXA\u65E0\u6CD5\u6EE1\u8DB3\u9AD8\u5E76\u53D1\u573A\u666F</li><li>XA\u76EE\u524D\u5728\u5546\u4E1A\u6570\u636E\u5E93\u652F\u6301\u7684\u6BD4\u8F83\u7406\u60F3\uFF0C\u5728mysq!\u6570\u636E\u5E93\u4E2D\u652F\u6301\u7684\u4E0D\u592A\u7406\u60F3\uFF0Cmysgl\u7684</li><li>XA\u5B9E\u73B0\uFF0C\u6CA1\u6709\u8BB0\u5F55prepare\u9636\u6BB5\u65E5\u5FD7\uFF0C\u4E3B\u5907\u5207\u6362\u56DE\u5BFC\u81F4\u4E3B\u5E93\u4E0E\u5907\u5E93\u6570\u636E\u4E0D\u4E00\u81F4\u3002</li><li>\u8BB8\u591AnosgI\u4E5F\u6CA1\u6709\u652F\u6301XA\uFF0C\u8FD9\u8BA9XA\u7684\u5E94\u7528\u573A\u666F\u53D8\u5F97\u975E\u5E38\u72ED\u9698\u3002</li><li>\u4E5F\u67093PC,\u5F15\u5165\u4E86\u8D85\u65F6\u673A\u5236(\u65E0\u8BBA\u534F\u8C03\u8005\u8FD8\u662F\u53C2\u4E0E\u8005\uFF0C\u5728\u5411\u5BF9\u65B9\u53D1\u9001\u8BF7\u6C42\u540E\uFF0C\u82E5\u957F\u65F6\u95F4\u672A\u6536\u5230\u56DE\u5E94\u5219\u505A\u51FA\u76F8\u5E94\u5904\u7406)</li></ul><h4 id="_2\u3001\u67D4\u6027\u4E8B\u52A1-tcc-\u4E8B\u52A1" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u67D4\u6027\u4E8B\u52A1-tcc-\u4E8B\u52A1" aria-hidden="true">#</a> 2\u3001\u67D4\u6027\u4E8B\u52A1 - TCC \u4E8B\u52A1</h4><p>\u521A\u6027\u4E8B\u52A1:\u9075\u5FAAACID\u539F\u5219\uFF0C\u5F3A\u4E00\u81F4\u6027\u3002 \u67D4\u6027\u4E8B\u52A1:\u9075\u5FAABASE\u7406\u8BBA\uFF0C\u6700\u7EC8\u4E00\u81F4\u6027; \u4E0E\u521A\u6027\u4E8B\u52A1\u4E0D\u540C\uFF0C\u67D4\u6027\u4E8B\u52A1\u5141\u8BB8\u4E00\u5B9A\u65F6\u95F4\u5185\uFF0C\u4E0D\u540C\u8282\u70B9\u7684\u6570\u636E\u4E0D\u4E00\u81F4\uFF0C\u4F46\u8981\u6C42\u6700\u7EC8\u4E00\u81F4\u3002</p><p><img src="http://qnimg.gisfsde.com/work/image-20201120090923734.png" alt="image-20201120090923734" loading="lazy"></p><p>\u4E00\u9636\u6BB5 prepare \u884C\u4E3A:\u8C03\u7528\u81EA\u5B9A\u4E49\u7684 prepare \u903B\u8F91\u3002 \u4E8C\u9636\u6BB5 commit \u884C\u4E3A:\u8C03\u7528\u81EA\u5B9A\u4E49\u7684 commit \u903B\u8F91\u3002 \u4E8C\u9636\u6BB5 rollback\u884C\u4E3A:\u8C03\u7528\u81EA\u5B9A\u4E49\u7684 rollback \u903B\u8F91\u3002 \u6240\u8C13TCC\u6A21\u5F0F\uFF0C\u662F\u6307\u652F\u6301\u628A\u81EA\u5B9A\u4E49\u7684\u5206\u652F\u4E8B\u52A1\u7EB3\u5165\u5230\u5168\u5C40\u4E8B\u52A1\u7684\u7BA1\u7406\u4E2D\u3002</p><h4 id="_3\u3001\u67D4\u6027\u4E8B\u52A1-\u6700\u5927\u52AA\u529B\u901A\u77E5\u578B\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u67D4\u6027\u4E8B\u52A1-\u6700\u5927\u52AA\u529B\u901A\u77E5\u578B\u65B9\u6848" aria-hidden="true">#</a> 3\u3001\u67D4\u6027\u4E8B\u52A1 - \u6700\u5927\u52AA\u529B\u901A\u77E5\u578B\u65B9\u6848</h4><p>\u6309\u89C4\u5F8B\u8FDB\u884C\u901A\u77E5\uFF0C<strong>\u4E0D\u4FDD\u8BC1\u6570\u636E\u5B9A\u80FD\u901A\u77E5\u6210\u529F\uFF0C \u4F46\u4F1A\u63D0\u4F9B\u53EF\u67E5\u8BE2\u64CD\u4F5C\u63A5\u53E3\u8FDB\u884C\u6838\u5BF9</strong>\u3002\u8FD9\u79CD\u65B9\u6848\u4E3B\u8981\u7528\u5728\u4E0E\u7B2C\u4E09\u65B9\u7CFB\u7EDF\u901A\u8BAF\u65F6\uFF0C\u6BD4\u5982:\u8C03\u7528\u5FAE\u4FE1\u6216\u652F\u4ED8\u5B9D\u652F\u4ED8\u540E\u7684\u652F\u4ED8\u7ED3\u679C\u901A\u77E5\u3002\u8FD9\u79CD\u65B9\u6848\u4E5F\u662F\u7ED3\u5408MQ\u8FDB\u884C\u5B9E\u73B0\uFF0C\u4F8B\u5982:\u901A\u8FC7MQ\u53D1\u9001http\u8BF7\u6C42\uFF0C\u8BBE\u7F6E\u6700\u5927\u901A\u77E5\u6B21\u6570\u3002\u8FBE\u5230\u901A\u77E5\u6B21\u6570\u540E\u5373\u4E0D\u518D\u901A\u77E5\u3002</p><p>\u6848\u4F8B:\u94F6\u884C\u901A\u77E5\u3001\u5546\u6237\u901A\u77E5\u7B49(\u5404\u5927\u4EA4\u6613\u4E1A\u52A1\u5E73\u53F0\u95F4\u7684\u5546\u6237\u901A\u77E5:\u591A\u6B21\u901A\u77E5\u3001\u67E5\u8BE2\u6821\u5BF9\u3001\u5BF9\u8D26\u6587\u4EF6)\uFF0C\u652F\u4ED8\u5B9D\u7684\u652F\u4ED8\u6210\u529F\u5F02\u6B65\u56DE\u8C03</p><h4 id="_4\u3001\u67D4\u6027\u4E8B\u52A1-\u53EF\u9760\u4FE1\u606F-\u6700\u7EC8\u4E00\u81F4\u6027\u65B9\u6848-\u5F02\u6B65\u901A\u77E5\u578B" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u67D4\u6027\u4E8B\u52A1-\u53EF\u9760\u4FE1\u606F-\u6700\u7EC8\u4E00\u81F4\u6027\u65B9\u6848-\u5F02\u6B65\u901A\u77E5\u578B" aria-hidden="true">#</a> 4\u3001\u67D4\u6027\u4E8B\u52A1 - \u53EF\u9760\u4FE1\u606F + \u6700\u7EC8\u4E00\u81F4\u6027\u65B9\u6848\uFF08\u5F02\u6B65\u901A\u77E5\u578B\uFF09</h4><p>\u5B9E\u73B0:\u4E1A\u52A1\u5904\u7406\u670D\u52A1\u5728\u4E1A\u52A1\u4E8B\u52A1\u63D0\u4EA4\u4E4B\u524D\uFF0C\u5411\u5B9E\u65F6\u6D88\u606F\u670D\u52A1\u8BF7\u6C42\u53D1\u9001\u6D88\u606F\uFF0C\u5B9E\u65F6\u6D88\u606F\u670D\u52A1\u53EA\u8BB0\u5F55\u6D88\u606F\u6570\u636E\uFF0C\u800C\u4E0D\u662F\u771F\u6B63\u7684\u53D1\u9001\u3002\u4E1A\u52A1\u5904\u7406\u670D\u52A1\u5728\u4E1A\u52A1\u4E8B\u52A1\u63D0\u4EA4\u4E4B\u540E\uFF0C\u5411\u5B9E\u65F6\u6D88\u606F\u670D\u52A1\u786E\u8BA4\u53D1\u9001\u3002\u53EA\u6709\u5728\u5F97\u5230\u786E\u8BA4\u53D1\u9001\u6307\u4EE4\u540E\uFF0C\u5B9E\u65F6\u6D88\u606F\u670D\u52A1\u624D\u4F1A\u771F\u6B63\u53D1\u9001\u3002</p><h1 id="_18\u3001\u652F\u4ED8\u5B9D\u652F\u4ED8" tabindex="-1"><a class="header-anchor" href="#_18\u3001\u652F\u4ED8\u5B9D\u652F\u4ED8" aria-hidden="true">#</a> 18\u3001\u652F\u4ED8\u5B9D\u652F\u4ED8</h1><h3 id="_1\u3001\u8FDB\u5165\u8682\u8681\u91D1\u670D\u5F00\u653E\u5E73\u53F0" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u8FDB\u5165\u8682\u8681\u91D1\u670D\u5F00\u653E\u5E73\u53F0" aria-hidden="true">#</a> 1\u3001\u8FDB\u5165\u8682\u8681\u91D1\u670D\u5F00\u653E\u5E73\u53F0</h3>',29),ze={href:"https://open.alipay.com/platform/home.htm",target:"_blank",rel:"noopener noreferrer"},Fe=s("https://open.alipay.com/platform/home.htm"),Ge=n("p",null,"2\u3001\u4E0B\u8F7D\u652F\u4ED8\u5B9D\u5B98\u65B9Demo\uFF0C\u8FDB\u884C\u914D\u7F6E\u548C\u6D4B\u8BD5",-1),Qe=n("p",null,"\u6587\u6863\u5730\u5740\uFF1A",-1),He={href:"https://openhome.alipay.com/docCenter/docCenter.htm",target:"_blank",rel:"noopener noreferrer"},We=s("https://openhome.alipay.com/docCenter/docCenter.htm"),Je=s(" \u521B\u5EFA\u5E94\u7528\u5BF9\u5E94\u6587\u6863"),Ke={href:"https://opendocs.alipay.com/open/200/105304",target:"_blank",rel:"noopener noreferrer"},$e=s("https://opendocs.alipay.com/open/200/105304"),Xe=s(" \u7F51\u9875\u79FB\u52A8\u5E94\u7528\u6587\u6863"),Ye={href:"https://opendocs.alipay.com/open/54/cyz7do",target:"_blank",rel:"noopener noreferrer"},Ze=s("https://opendocs.alipay.com/open/54/cyz7do"),no=s(" \u76F8\u5173Demo"),so=p('<p><img src="http://qnimg.gisfsde.com/work/image-20201122123349754.png" alt="image-20201122123349754" loading="lazy"></p><p><img src="http://qnimg.gisfsde.com/work/image-20201122114005616.png" alt="image-20201122114005616" loading="lazy">\u5BC6\u7801</p><p>\u521B\u5EFA\u5E94\u7528</p><p><img src="http://qnimg.gisfsde.com/work/image-20201122113922427.png" alt="image-20201122113922427" loading="lazy"></p><h3 id="_3\u3001\u4F7F\u7528\u6C99\u7BB1\u8FDB\u884C\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u4F7F\u7528\u6C99\u7BB1\u8FDB\u884C\u6D4B\u8BD5" aria-hidden="true">#</a> 3\u3001\u4F7F\u7528\u6C99\u7BB1\u8FDB\u884C\u6D4B\u8BD5</h3>',5),ao={href:"https://openhome.alipay.com/platform/appDaily.htm?tab=info",target:"_blank",rel:"noopener noreferrer"},to=s("https://openhome.alipay.com/platform/appDaily.htm?tab=info"),po=p('<p><img src="http://qnimg.gisfsde.com/work/image-20201122125716179.png" alt="image-20201122125716179" loading="lazy"></p><h3 id="_4\u3001\u4EC0\u4E48\u662F\u516C\u94A5\u3001\u79C1\u94A5\u3001\u52A0\u5BC6\u3001\u7B7E\u540D\u548C\u9A8C\u7B7E" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u4EC0\u4E48\u662F\u516C\u94A5\u3001\u79C1\u94A5\u3001\u52A0\u5BC6\u3001\u7B7E\u540D\u548C\u9A8C\u7B7E" aria-hidden="true">#</a> 4\u3001\u4EC0\u4E48\u662F\u516C\u94A5\u3001\u79C1\u94A5\u3001\u52A0\u5BC6\u3001\u7B7E\u540D\u548C\u9A8C\u7B7E?</h3><p>1\u3001\u516C\u94A5\u79C1\u94A5 \u516C\u94A5\u548C\u79C1\u94A5\u662F\u4E00\u4E00\u4E2A\u76F8\u5BF9\u6982\u5FF5</p><p>\u5B83\u4EEC\u7684\u516C\u79C1\u6027\u662F\u76F8\u5BF9\u4E8E\u751F\u6210\u8005\u6765\u8BF4\u7684\u3002</p><p>\u4E00\u5BF9\u5BC6\u94A5\u751F\u6210\u540E\uFF0C\u4FDD\u5B58\u5728\u751F\u6210\u8005\u624B\u91CC\u7684\u5C31\u662F\u79C1\u94A5\uFF0C\u751F\u6210\u8005\u53D1\u5E03\u51FA\u53BB\u5927\u5BB6\u7528\u7684\u5C31\u662F\u516C\u94A5</p><p><img src="http://qnimg.gisfsde.com/work/image-20201122174141878.png" alt="image-20201122174141878" loading="lazy"></p><h3 id="_5\u3001\u652F\u4ED8\u5B9D\u652F\u4ED8\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u652F\u4ED8\u5B9D\u652F\u4ED8\u6D41\u7A0B" aria-hidden="true">#</a> 5\u3001\u652F\u4ED8\u5B9D\u652F\u4ED8\u6D41\u7A0B</h3>',7),eo={href:"https://opendocs.alipay.com/open/270/105898",target:"_blank",rel:"noopener noreferrer"},oo=s("https://opendocs.alipay.com/open/270/105898"),co=p(`<h4 id="_1\u3001\u5F15\u5BFC\u7528\u6237\u8FDB\u5165\u5230\u652F\u4ED8\u5B9D\u9875\u9762" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5F15\u5BFC\u7528\u6237\u8FDB\u5165\u5230\u652F\u4ED8\u5B9D\u9875\u9762" aria-hidden="true">#</a> 1\u3001\u5F15\u5BFC\u7528\u6237\u8FDB\u5165\u5230\u652F\u4ED8\u5B9D\u9875\u9762</h4><h5 id="_1\u3001pom-xml" tabindex="-1"><a class="header-anchor" href="#_1\u3001pom-xml" aria-hidden="true">#</a> 1\u3001pom.xml</h5><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--\u652F\u4ED8\u5B9D\u6A21\u5757--&gt;</span>
 \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alipay.sdk\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>alipay-sdk-java\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.9.28.ALL\\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        \\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001\u5C06\u7D20\u6750\u63D0\u4F9B\u7684\u6587\u4EF6\u5F15\u5165\u5230\u9879\u76EE\u4E2D" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5C06\u7D20\u6750\u63D0\u4F9B\u7684\u6587\u4EF6\u5F15\u5165\u5230\u9879\u76EE\u4E2D" aria-hidden="true">#</a> 2\u3001\u5C06\u7D20\u6750\u63D0\u4F9B\u7684\u6587\u4EF6\u5F15\u5165\u5230\u9879\u76EE\u4E2D</h5><p><strong>AlipayTemplate\u3001PayVo\u3001PaySyncVo</strong></p><h6 id="alipaytemplate" tabindex="-1"><a class="header-anchor" href="#alipaytemplate" aria-hidden="true">#</a> AlipayTemplate</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>order<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AlipayApiException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AlipayClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">DefaultAlipayClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alipay<span class="token punctuation">.</span>api<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">AlipayTradePagePayRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>order<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">PayVo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;alipay&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AlipayTemplate</span> <span class="token punctuation">{</span>

    <span class="token comment">//\u5728\u652F\u4ED8\u5B9D\u521B\u5EFA\u7684\u5E94\u7528\u7684id</span>
    <span class="token keyword">private</span>   <span class="token class-name">String</span> app_id <span class="token operator">=</span> <span class="token string">&quot;2016092200568607&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5546\u6237\u79C1\u94A5\uFF0C\u60A8\u7684PKCS8\u683C\u5F0FRSA2\u79C1\u94A5</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> merchant_private_key <span class="token operator">=</span> <span class="token string">&quot;XXX&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// \u652F\u4ED8\u5B9D\u516C\u94A5,\u67E5\u770B\u5730\u5740\uFF1Ahttps://openhome.alipay.com/platform/keyManage.htm \u5BF9\u5E94APPID\u4E0B\u7684\u652F\u4ED8\u5B9D\u516C\u94A5\u3002</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> alipay_public_key <span class="token operator">=</span> <span class="token string">&quot;XXX&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// \u670D\u52A1\u5668[\u5F02\u6B65\u901A\u77E5]\u9875\u9762\u8DEF\u5F84  \u9700http://\u683C\u5F0F\u7684\u5B8C\u6574\u8DEF\u5F84\uFF0C\u4E0D\u80FD\u52A0?id=123\u8FD9\u7C7B\u81EA\u5B9A\u4E49\u53C2\u6570\uFF0C\u5FC5\u987B\u5916\u7F51\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE</span>
    <span class="token comment">// \u652F\u4ED8\u5B9D\u4F1A\u6084\u6084\u7684\u7ED9\u6211\u4EEC\u53D1\u9001\u4E00\u4E2A\u8BF7\u6C42\uFF0C\u544A\u8BC9\u6211\u4EEC\u652F\u4ED8\u6210\u529F\u7684\u4FE1\u606F</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> notify_url <span class="token operator">=</span> <span class="token string">&quot;http://member.gulimall.com/memberOrder.html&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9875\u9762\u8DF3\u8F6C\u540C\u6B65\u901A\u77E5\u9875\u9762\u8DEF\u5F84 \u9700http://\u683C\u5F0F\u7684\u5B8C\u6574\u8DEF\u5F84\uFF0C\u4E0D\u80FD\u52A0?id=123\u8FD9\u7C7B\u81EA\u5B9A\u4E49\u53C2\u6570\uFF0C\u5FC5\u987B\u5916\u7F51\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE</span>
    <span class="token comment">//\u540C\u6B65\u901A\u77E5\uFF0C\u652F\u4ED8\u6210\u529F\uFF0C\u4E00\u822C\u8DF3\u8F6C\u5230\u6210\u529F\u9875</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> return_url <span class="token operator">=</span> <span class="token string">&quot;http://member.gulimall.com/memberOrder.html&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// \u7B7E\u540D\u65B9\u5F0F</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> sign_type <span class="token operator">=</span> <span class="token string">&quot;RSA2&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5B57\u7B26\u7F16\u7801\u683C\u5F0F</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> charset <span class="token operator">=</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// \u8BA2\u5355\u8D85\u65F6\u65F6\u95F4\uFF0C\u5230\u8FBE\u8D85\u65F6\u65F6\u95F4\u540E\u81EA\u52A8\u5173\u95ED\u8BA2\u5355\u4E0D\u80FD\u518D\u7EE7\u7EED\u652F\u4ED8</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> timeout <span class="token operator">=</span> <span class="token string">&quot;30m&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// \u652F\u4ED8\u5B9D\u7F51\u5173\uFF1B https://openapi.alipaydev.com/gateway.do</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> gatewayUrl <span class="token operator">=</span> <span class="token string">&quot;https://openapi.alipaydev.com/gateway.do&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span>  <span class="token class-name">String</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token class-name">PayVo</span> vo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AlipayApiException</span> <span class="token punctuation">{</span>

        <span class="token comment">//AlipayClient alipayClient = new DefaultAlipayClient(AlipayTemplate.gatewayUrl, AlipayTemplate.app_id, AlipayTemplate.merchant_private_key, &quot;json&quot;, AlipayTemplate.charset, AlipayTemplate.alipay_public_key, AlipayTemplate.sign_type);</span>
        <span class="token comment">//1\u3001\u6839\u636E\u652F\u4ED8\u5B9D\u7684\u914D\u7F6E\u751F\u6210\u4E00\u4E2A\u652F\u4ED8\u5BA2\u6237\u7AEF</span>
        <span class="token class-name">AlipayClient</span> alipayClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAlipayClient</span><span class="token punctuation">(</span>gatewayUrl<span class="token punctuation">,</span>
                app_id<span class="token punctuation">,</span> merchant_private_key<span class="token punctuation">,</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
                charset<span class="token punctuation">,</span> alipay_public_key<span class="token punctuation">,</span> sign_type<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2\u3001\u521B\u5EFA\u4E00\u4E2A\u652F\u4ED8\u8BF7\u6C42 //\u8BBE\u7F6E\u8BF7\u6C42\u53C2\u6570</span>
        <span class="token class-name">AlipayTradePagePayRequest</span> alipayRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradePagePayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alipayRequest<span class="token punctuation">.</span><span class="token function">setReturnUrl</span><span class="token punctuation">(</span>return_url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        alipayRequest<span class="token punctuation">.</span><span class="token function">setNotifyUrl</span><span class="token punctuation">(</span>notify_url<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u5546\u6237\u8BA2\u5355\u53F7\uFF0C\u5546\u6237\u7F51\u7AD9\u8BA2\u5355\u7CFB\u7EDF\u4E2D\u552F\u4E00\u8BA2\u5355\u53F7\uFF0C\u5FC5\u586B</span>
        <span class="token class-name">String</span> out_trade_no <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getOut_trade_no</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4ED8\u6B3E\u91D1\u989D\uFF0C\u5FC5\u586B</span>
        <span class="token class-name">String</span> total_amount <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getTotal_amount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u8BA2\u5355\u540D\u79F0\uFF0C\u5FC5\u586B</span>
        <span class="token class-name">String</span> subject <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5546\u54C1\u63CF\u8FF0\uFF0C\u53EF\u7A7A</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// timeout_express \u8BA2\u5355\u652F\u4ED8\u8D85\u65F6\u65F6\u95F4</span>
        alipayRequest<span class="token punctuation">.</span><span class="token function">setBizContent</span><span class="token punctuation">(</span><span class="token string">&quot;{\\&quot;out_trade_no\\&quot;:\\&quot;&quot;</span><span class="token operator">+</span> out_trade_no <span class="token operator">+</span><span class="token string">&quot;\\&quot;,&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;\\&quot;total_amount\\&quot;:\\&quot;&quot;</span><span class="token operator">+</span> total_amount <span class="token operator">+</span><span class="token string">&quot;\\&quot;,&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;\\&quot;subject\\&quot;:\\&quot;&quot;</span><span class="token operator">+</span> subject <span class="token operator">+</span><span class="token string">&quot;\\&quot;,&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;\\&quot;body\\&quot;:\\&quot;&quot;</span><span class="token operator">+</span> body <span class="token operator">+</span><span class="token string">&quot;\\&quot;,&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;\\&quot;timeout_express\\&quot;:\\&quot;&quot;</span> <span class="token operator">+</span> timeout <span class="token operator">+</span> <span class="token string">&quot;\\&quot;,&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;\\&quot;product_code\\&quot;:\\&quot;FAST_INSTANT_TRADE_PAY\\&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> result <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">pageExecute</span><span class="token punctuation">(</span>alipayRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u4F1A\u6536\u5230\u652F\u4ED8\u5B9D\u7684\u54CD\u5E94\uFF0C\u54CD\u5E94\u7684\u662F\u4E00\u4E2A\u9875\u9762\uFF0C\u53EA\u8981\u6D4F\u89C8\u5668\u663E\u793A\u8FD9\u4E2A\u9875\u9762\uFF0C\u5C31\u4F1A\u81EA\u52A8\u6765\u5230\u652F\u4ED8\u5B9D\u7684\u6536\u94F6\u53F0\u9875\u9762</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u652F\u4ED8\u5B9D\u7684\u54CD\u5E94\uFF1A&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="payvo" tabindex="-1"><a class="header-anchor" href="#payvo" aria-hidden="true">#</a> PayVo</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>order<span class="token punctuation">.</span>vo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u652F\u4ED8\u4F7F\u7528Vo
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> out_trade_no<span class="token punctuation">;</span> <span class="token comment">// \u5546\u6237\u8BA2\u5355\u53F7 \u5FC5\u586B</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> subject<span class="token punctuation">;</span> <span class="token comment">// \u8BA2\u5355\u540D\u79F0 \u5FC5\u586B</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> total_amount<span class="token punctuation">;</span>  <span class="token comment">// \u4ED8\u6B3E\u91D1\u989D \u5FC5\u586B</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> body<span class="token punctuation">;</span> <span class="token comment">// \u5546\u54C1\u63CF\u8FF0 \u53EF\u7A7A</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="payasyncvo" tabindex="-1"><a class="header-anchor" href="#payasyncvo" aria-hidden="true">#</a> payAsyncVo</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>order<span class="token punctuation">.</span>vo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u652F\u4ED8\u5B9D\u56DE\u8C03\u53C2\u6570Vo
 */</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayAsyncVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> gmt_create<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> charset<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> gmt_payment<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> notify_time<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> subject<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sign<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> buyer_id<span class="token punctuation">;</span><span class="token comment">//\u652F\u4ED8\u8005\u7684id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> body<span class="token punctuation">;</span><span class="token comment">//\u8BA2\u5355\u7684\u4FE1\u606F</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> invoice_amount<span class="token punctuation">;</span><span class="token comment">//\u652F\u4ED8\u91D1\u989D</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> version<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> notify_id<span class="token punctuation">;</span><span class="token comment">//\u901A\u77E5id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fund_bill_list<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> notify_type<span class="token punctuation">;</span><span class="token comment">//\u901A\u77E5\u7C7B\u578B\uFF1B trade_status_sync</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> out_trade_no<span class="token punctuation">;</span><span class="token comment">//\u8BA2\u5355\u53F7</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> total_amount<span class="token punctuation">;</span><span class="token comment">//\u652F\u4ED8\u7684\u603B\u989D</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> trade_status<span class="token punctuation">;</span><span class="token comment">//\u4EA4\u6613\u72B6\u6001  TRADE_SUCCESS</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> trade_no<span class="token punctuation">;</span><span class="token comment">//\u6D41\u6C34\u53F7</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> auth_app_id<span class="token punctuation">;</span><span class="token comment">//</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> receipt_amount<span class="token punctuation">;</span><span class="token comment">//\u5546\u5BB6\u6536\u5230\u7684\u6B3E</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> point_amount<span class="token punctuation">;</span><span class="token comment">//</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> app_id<span class="token punctuation">;</span><span class="token comment">//\u5E94\u7528id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> buyer_pay_amount<span class="token punctuation">;</span><span class="token comment">//\u6700\u7EC8\u652F\u4ED8\u7684\u91D1\u989D</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sign_type<span class="token punctuation">;</span><span class="token comment">//\u7B7E\u540D\u7C7B\u578B</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> seller_id<span class="token punctuation">;</span><span class="token comment">//\u5546\u5BB6\u7684id</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3\u3001\u7F16\u5199\u4E1A\u52A1\u8DF3\u8F6C\u5230\u652F\u4ED8\u9875\u9762" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u7F16\u5199\u4E1A\u52A1\u8DF3\u8F6C\u5230\u652F\u4ED8\u9875\u9762" aria-hidden="true">#</a> 3\u3001\u7F16\u5199\u4E1A\u52A1\u8DF3\u8F6C\u5230\u652F\u4ED8\u9875\u9762</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> gcq
 * @Create 2021-01-08
 */</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayWebController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">AlipayTemplate</span> alipayTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 1\u3001\u8DF3\u8F6C\u5230\u652F\u4ED8\u9875\u9762
     * 2\u3001\u7528\u6237\u652F\u4ED8\u6210\u529F\u540E\uFF0C\u6211\u4EEC\u8981\u8DF3\u8F6C\u5230\u7528\u6237\u7684\u8BA2\u5355\u5217\u8868\u9875
     * produces \u660E\u786E\u65B9\u6CD5\u4F1A\u8FD4\u56DE\u4EC0\u4E48\u7C7B\u578B\uFF0C\u8FD9\u91CC\u8FD4\u56DE\u7684\u662Fhtml\u9875\u9762
     * <span class="token keyword">@param</span> <span class="token parameter">orderSn</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">AlipayApiException</span></span>
     */</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/payOrder&quot;</span><span class="token punctuation">,</span>produces <span class="token operator">=</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">payOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;orderSn&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> orderSn<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AlipayApiException</span> <span class="token punctuation">{</span>
<span class="token comment">//        PayVo payVo = new PayVo();</span>
<span class="token comment">//        payVo.setBody(); // \u5546\u54C1\u63CF\u8FF0</span>
<span class="token comment">//        payVo.setSubject(); //\u8BA2\u5355\u540D\u79F0</span>
<span class="token comment">//        payVo.setOut_trade_no(); // \u8BA2\u5355\u53F7</span>
<span class="token comment">//        payVo.setTotal_amount(); //\u603B\u91D1\u989D</span>
        <span class="token class-name">PayVo</span> payvo <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">payOrder</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5C06\u8FD4\u56DE\u652F\u4ED8\u5B9D\u7684\u652F\u4ED8\u9875\u9762\uFF0C\u9700\u8981\u5C06\u8FD9\u4E2A\u9875\u9762\u8FDB\u884C\u663E\u793A</span>
        <span class="token class-name">String</span> pay <span class="token operator">=</span> alipayTemplate<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span>payvo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> pay<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="service" tabindex="-1"><a class="header-anchor" href="#service" aria-hidden="true">#</a> Service</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token doc-comment comment">/**
     * \u8BA1\u7B97\u5546\u54C1\u652F\u4ED8\u9700\u8981\u7684\u4FE1\u606F
     * <span class="token keyword">@param</span> <span class="token parameter">orderSn</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PayVo</span> <span class="token function">payOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderSn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PayVo</span> payVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PayVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OrderEntity</span> orderEntity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOrderByOrderSn</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6839\u636E\u8BA2\u5355\u53F7\u67E5\u8BE2\u5230\u5546\u54C1</span>
        <span class="token comment">// \u6570\u636E\u5E93\u4E2D\u4ED8\u6B3E\u91D1\u989D\u5C0F\u6570\u67094\u4F4D\uFF0C\u4F46\u662F\u652F\u4ED8\u5B9D\u53EA\u63A5\u53D72\u4F4D\uFF0C\u6240\u4EE5\u5411\u4E0A\u53D6\u6574\u4E24\u4F4D\u6570</span>
        <span class="token class-name">BigDecimal</span> decimal <span class="token operator">=</span> orderEntity<span class="token punctuation">.</span><span class="token function">getPayAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ROUND_UP<span class="token punctuation">)</span><span class="token punctuation">;</span>
        payVo<span class="token punctuation">.</span><span class="token function">setTotal_amount</span><span class="token punctuation">(</span>decimal<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u6237\u8BA2\u5355\u53F7</span>
        payVo<span class="token punctuation">.</span><span class="token function">setOut_trade_no</span><span class="token punctuation">(</span>orderSn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u67E5\u8BE2\u51FA\u8BA2\u5355\u9879\uFF0C\u7528\u6765\u8BBE\u7F6E\u5546\u54C1\u7684\u63CF\u8FF0\u548C\u5546\u54C1\u540D\u79F0</span>
        <span class="token class-name">List</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemEntity</span><span class="token punctuation">&gt;</span></span> itemEntities <span class="token operator">=</span> orderItemService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItemEntity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;order_sn&quot;</span><span class="token punctuation">,</span> orderSn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OrderItemEntity</span> itemEntity <span class="token operator">=</span> itemEntities<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BA2\u5355\u540D\u79F0\u4F7F\u7528\u5546\u54C1\u9879\u7684\u540D\u5B57</span>
        payVo<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getSkuName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5546\u54C1\u7684\u63CF\u8FF0\u4F7F\u7528\u5546\u54C1\u9879\u7684\u5C5E\u6027</span>
        payVo<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span>itemEntity<span class="token punctuation">.</span><span class="token function">getSkuAttrsVals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> payVo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6700\u540E\u751F\u6210\u9875\u9762</p><p><img src="http://qnimg.gisfsde.com/work/image-20210108162512457.png" alt="image-20210108162512457" loading="lazy"></p><h4 id="_2\u3001\u7528\u6237\u70B9\u51FB\u4ED8\u6B3E" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u7528\u6237\u70B9\u51FB\u4ED8\u6B3E" aria-hidden="true">#</a> 2\u3001\u7528\u6237\u70B9\u51FB\u4ED8\u6B3E</h4><p><img src="http://qnimg.gisfsde.com/work/image-20210108162541917.png" alt="image-20210108162541917" loading="lazy"></p><h4 id="_3\u3001\u4ED8\u6B3E\u6210\u529F\u540E\u8DF3\u8F6C\u5230\u6210\u529F\u9875\u9762" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u4ED8\u6B3E\u6210\u529F\u540E\u8DF3\u8F6C\u5230\u6210\u529F\u9875\u9762" aria-hidden="true">#</a> 3\u3001\u4ED8\u6B3E\u6210\u529F\u540E\u8DF3\u8F6C\u5230\u6210\u529F\u9875\u9762</h4><p>&lt;span style=&quot;color:red&quot;&gt;\u8DF3\u8F6C\u7684\u9875\u9762\u662F\u6839\u636EAlipayTemplate\u5B9A\u4E49\u7684\u56DE\u8C03\u5730\u5740\u6765\u8FDB\u884C\u8DF3\u8F6C&lt;/span&gt;</p><ul><li>notify_url\uFF1A<strong>\u652F\u4ED8\u6210\u529F\u5F02\u6B65\u56DE\u8C03\uFF0C\u8FD4\u56DE\u652F\u4ED8\u6210\u529F\u76F8\u5173\u7684\u4FE1\u606F</strong></li><li>return_url\uFF1A<strong>\u540C\u6B65\u901A\u77E5\uFF0C\u652F\u4ED8\u6210\u529F\u540E\u9875\u9762\u8DF3\u8F6C\u5230\u90A3\u91CC</strong></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>   <span class="token comment">// \u670D\u52A1\u5668[\u5F02\u6B65\u901A\u77E5]\u9875\u9762\u8DEF\u5F84  \u9700http://\u683C\u5F0F\u7684\u5B8C\u6574\u8DEF\u5F84\uFF0C\u4E0D\u80FD\u52A0?id=123\u8FD9\u7C7B\u81EA\u5B9A\u4E49\u53C2\u6570\uFF0C\u5FC5\u987B\u5916\u7F51\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE</span>
    <span class="token comment">// \u652F\u4ED8\u5B9D\u4F1A\u6084\u6084\u7684\u7ED9\u6211\u4EEC\u53D1\u9001\u4E00\u4E2A\u8BF7\u6C42\uFF0C\u544A\u8BC9\u6211\u4EEC\u652F\u4ED8\u6210\u529F\u7684\u4FE1\u606F</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> notify_url <span class="token operator">=</span> <span class="token string">&quot;http://member.gulimall.com/memberOrder.html&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// \u9875\u9762\u8DF3\u8F6C\u540C\u6B65\u901A\u77E5\u9875\u9762\u8DEF\u5F84 \u9700http://\u683C\u5F0F\u7684\u5B8C\u6574\u8DEF\u5F84\uFF0C\u4E0D\u80FD\u52A0?id=123\u8FD9\u7C7B\u81EA\u5B9A\u4E49\u53C2\u6570\uFF0C\u5FC5\u987B\u5916\u7F51\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE</span>
    <span class="token comment">//\u540C\u6B65\u901A\u77E5\uFF0C\u652F\u4ED8\u6210\u529F\uFF0C\u4E00\u822C\u8DF3\u8F6C\u5230\u6210\u529F\u9875</span>
    <span class="token keyword">private</span>  <span class="token class-name">String</span> return_url <span class="token operator">=</span> <span class="token string">&quot;http://member.gulimall.com/memberOrder.html&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u8FD9\u91CC\u8DF3\u8F6C\u5230\u7684<strong>\u4F1A\u5458\u670D\u52A1\u7684\u8BA2\u5355\u9875\u9762</strong>\uFF0C\u9700\u8981\u81EA\u5DF1\u5904\u7406\u8BF7\u6C42,<strong>\u5DF2\u572814.4.4.3\u8282\u5B8C\u6210\u8BE5\u529F\u80FD</strong></p></blockquote><p><img src="http://qnimg.gisfsde.com/work/image-20210108162610017.png" alt="image-20210108162610017" loading="lazy"></p><h5 id="_1\u3001\u652F\u4ED8\u6210\u529F\u540E\u5F02\u6B65\u56DE\u8C03\u63A5\u53E3\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u652F\u4ED8\u6210\u529F\u540E\u5F02\u6B65\u56DE\u8C03\u63A5\u53E3\u5904\u7406" aria-hidden="true">#</a> 1\u3001\u652F\u4ED8\u6210\u529F\u540E\u5F02\u6B65\u56DE\u8C03\u63A5\u53E3\u5904\u7406</h5><p>&lt;span style=&quot;color:blue;font-size:18px&quot;&gt;\u9700\u8981\u6709\u670D\u52A1\u5668\u6216\u914D\u7F6E\u4E86\u5185\u7F51\u7A7F\u900F\u624D\u80FD\u63A5\u6536\u5230\u8BE5\u65B9\u6CD5&lt;/span&gt;</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u652F\u4ED8\u5B9D\u6210\u529F\u5F02\u6B65\u56DE\u8C03
 * <span class="token keyword">@author</span> gcq
 * @Create 2021-01-08
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderPayedListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">AlipayTemplate</span> alipayTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u652F\u4ED8\u5B9D\u5F02\u6B65\u901A\u77E5\u56DE\u8C03\u63A5\u53E3,\u9700\u8981\u62E5\u6709\u5185\u7F51\u7A7F\u900F\u6216\u670D\u52A1\u5668
     * <span class="token keyword">@param</span> <span class="token parameter">request</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/payed/notify&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handleAlipayed</span><span class="token punctuation">(</span><span class="token class-name">PayAsyncVo</span> vo<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span><span class="token punctuation">,</span> <span class="token class-name">AlipayApiException</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * \u91CD\u8981\u4E00\u6B65\u9A8C\u7B7E\u540D
         *  \u9632\u6B62\u522B\u4EBA\u901A\u8FC7postman\u7ED9\u6211\u4EEC\u53D1\u9001\u4E00\u4E2A\u8BF7\u6C42\uFF0C\u544A\u8BC9\u6211\u4EEC\u8BF7\u6C42\u6210\u529F\uFF0C\u4E3A\u4E86\u9632\u6B62\u8FD9\u79CD\u6548\u679C\u901A\u8FC7\u9A8C\u7B7E
         */</span>
        <span class="token class-name">Map</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span>\\<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> requestParams <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span>\\<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> requestParams<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> requestParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> valueStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i \\<span class="token operator">&lt;</span> values<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                valueStr <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> values<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> valueStr <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                        <span class="token operator">:</span> valueStr <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//\u4E71\u7801\u89E3\u51B3\uFF0C\u8FD9\u6BB5\u4EE3\u7801\u5728\u51FA\u73B0\u4E71\u7801\u65F6\u4F7F\u7528</span>
            valueStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>valueStr<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;ISO-8859-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> valueStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u652F\u4ED8\u5B9D\u9A8C\u7B7E \u9632\u6B62\u6076\u610F\u63D0\u4EA4</span>
        <span class="token keyword">boolean</span> signVerified <span class="token operator">=</span> <span class="token class-name">AlipaySignature</span><span class="token punctuation">.</span><span class="token function">rsaCheckV1</span><span class="token punctuation">(</span>params
                <span class="token punctuation">,</span> alipayTemplate<span class="token punctuation">.</span><span class="token function">getAlipay_public_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">,</span> alipayTemplate<span class="token punctuation">.</span><span class="token function">getCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">,</span> alipayTemplate<span class="token punctuation">.</span><span class="token function">getSign_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>signVerified<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> result <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">handleAlipayed</span><span class="token punctuation">(</span>vo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handleAlipayed</span><span class="token punctuation">(</span><span class="token class-name">PayAsyncVo</span> vo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u4FDD\u5B58\u4EA4\u6613\u6D41\u6C34\u4FE1\u606F,\u6BCF\u4E2A\u6708\u548C\u652F\u4ED8\u5B9D\u8FDB\u884C\u5BF9\u8D26</span>
        <span class="token class-name">PaymentInfoEntity</span> infoEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentInfoEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E\u6838\u5FC3\u5B57\u6BB5</span>
        infoEntity<span class="token punctuation">.</span><span class="token function">setOrderSn</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getOut_trade_no</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        infoEntity<span class="token punctuation">.</span><span class="token function">setAlipayTradeNo</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getTrade_no</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        infoEntity<span class="token punctuation">.</span><span class="token function">setPaymentStatus</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getTrade_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        infoEntity<span class="token punctuation">.</span><span class="token function">setCallbackTime</span><span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getNotify_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u4FDD\u5B58\u8BA2\u5355\u6D41\u6C34</span>
        paymentInfoService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>infoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * \u652F\u4ED8\u5B9D\u4EA4\u6613\u72B6\u6001\u8BF4\u660E
         *      https://opendocs.alipay.com/open/270/105902
         */</span>
        <span class="token comment">// TRADE_FINISHED \u4EA4\u6613\u7ED3\u675F\u3001\u4E0D\u53EF\u9000\u6B3E</span>
        <span class="token comment">// TRADE_SUCCESS \u4EA4\u6613\u652F\u4ED8\u6210\u529F</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vo<span class="token punctuation">.</span><span class="token function">getTrade_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TRADE_SUCCESS&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> vo<span class="token punctuation">.</span><span class="token function">getTrade_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TRADE_FINISHED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> outTradeNo <span class="token operator">=</span> vo<span class="token punctuation">.</span><span class="token function">getOut_trade_no</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u652F\u4ED8\u5B9D\u56DE\u8C03\u6210\u529F\u540E\uFF0C\u66F4\u6539\u8BA2\u5355\u7684\u652F\u4ED8\u72B6\u6001\u4F4D\u5DF2\u652F\u4ED8</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">.</span><span class="token function">updateOrderStatus</span><span class="token punctuation">(</span>outTradeNo<span class="token punctuation">,</span><span class="token class-name">OrderStatusEnum</span><span class="token punctuation">.</span>PAYED<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6\u3001\u5185\u7F51\u7A7F\u900F" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u5185\u7F51\u7A7F\u900F" aria-hidden="true">#</a> 6\u3001\u5185\u7F51\u7A7F\u900F</h3><h4 id="_1\u3001\u7B80\u4ECB-3" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7B80\u4ECB-3" aria-hidden="true">#</a> 1\u3001\u7B80\u4ECB</h4><p>\u5185\u7F51\u7A7F\u900F\u529F\u80FD\u53EF\u4EE5\u5141\u8BB8\u6211\u4EEC\u4F7F\u7528\u5916\u7F51\u7684\u7F51\u5740\u6765\u8BBF\u95EE\u4E3B\u673A \u6B63\u5E38\u7684\u5916\u7F51\u9700\u8981\u8BBF\u95EE\u6211\u4EEC\u9879\u76EE\u7684\u6D41\u7A0B\u662F:</p><p>1\u3001\u4E70\u670D\u52A1\u5668\u5E76\u4E14\u6709\u516C\u7F51\u56FA\u5B9AIP</p><p>2\u3001\u4E70\u57DF\u540D\u6620\u5C04\u5230\u670D\u52A1\u5668\u7684IP</p><p>3\u3001\u57DF\u540D\u9700\u8981\u8FDB\u884C\u5907\u6848\u548C\u5BA1\u6838</p><h4 id="_2\u3001\u4F7F\u7528\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4F7F\u7528\u573A\u666F" aria-hidden="true">#</a> 2\u3001\u4F7F\u7528\u573A\u666F</h4><p>1\u3001\u5F00\u53D1\u6D4B\u8BD5(\u5FAE\u4FE1\u3001\u652F\u4ED8\u5B9D)</p><p>2\u3001\u667A\u6167\u4E92\u8054</p><p>3\u3001\u8FDC\u7A0B\u63A7\u5236</p><p>4\u3001\u79C1\u6709\u4E91</p><h4 id="_3\u3001\u5185\u7F51\u7A7F\u900F\u5E38\u7528\u7684\u8F6F\u4EF6" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5185\u7F51\u7A7F\u900F\u5E38\u7528\u7684\u8F6F\u4EF6" aria-hidden="true">#</a> 3\u3001\u5185\u7F51\u7A7F\u900F\u5E38\u7528\u7684\u8F6F\u4EF6</h4>`,42),io=s("1\u3001natapp:"),lo={href:"https://natapp.cn/",target:"_blank",rel:"noopener noreferrer"},uo=s("https://natapp.cn/"),ro=s(" 2\u3001\u7EED\u65AD: www.zhexi.tech 3\u3001\u82B1\u751F\u58F3: "),ko={href:"https://www.oray.com/",target:"_blank",rel:"noopener noreferrer"},mo=s("https://www.oray.com/"),vo=p('<h1 id="_19\u3001\u79D2\u6740" tabindex="-1"><a class="header-anchor" href="#_19\u3001\u79D2\u6740" aria-hidden="true">#</a> 19\u3001\u79D2\u6740</h1><h3 id="_19-1-\u79D2\u6740\u4E1A\u52A1" tabindex="-1"><a class="header-anchor" href="#_19-1-\u79D2\u6740\u4E1A\u52A1" aria-hidden="true">#</a> 19.1 \u79D2\u6740\u4E1A\u52A1</h3><p>\u79D2\u6740\u5177\u6709\u77AC\u95F4\u9AD8\u5E76\u53D1\u7684\u7279\u70B9\uFF0C\u9488\u5BF9\u8FD9\u4E00\u7279\u70B9\uFF0C\u5FC5\u987B\u8981\u505A\u5230\u9650\u6D41 + \u5F02\u6B65 + \u7F13\u5B58\uFF08\u9875\u9762\u9759\u6001\u5316\uFF09 + <strong>\u72EC\u7ACB\u90E8\u7F72</strong></p><p>\u9650\u6D41\u65B9\u5F0F\uFF1A</p><p>1\u3001\u524D\u7AEF\u9650\u6D41\uFF0C\u4E00\u4E9B\u9AD8\u5E76\u53D1\u7684\u7F51\u7AD9\u76F4\u63A5\u5728\u524D\u7AEF\u9875\u9762\u5F00\u59CB\u9650\u6D41\uFF0C\u5217\u5982\uFF1A\u5C0F\u7C73\u7684\u9A8C\u8BC1\u7801</p><p>2\u3001nginx\u9650\u6D41\uFF0C\u76F4\u63A5\u8D1F\u8F7D\u90E8\u5206\u8BF7\u6C42\u5230\u9519\u8BEF\u7684\u9759\u6001\u9875\u9762\uFF0C\u4EE4\u724C\u7B97\u6CD5\u3001\u6F0F\u6597\u7B97\u6CD5</p><p>3\u3001\u7F51\u5173\u9650\u6D41\u3001\u9650\u6D41\u7684\u8FC7\u6EE4\u5668</p><p>4\u3001\u4EE3\u7801\u4E2D\u4F7F\u7528\u5206\u5E03\u5F0F\u4FE1\u53F7\u91CF</p><p>5\u3001rabbitmq\u9650\u6D41\uFF08\u80FD\u8005\u591A\u52B3 channel.basicQos(1)\uFF09\u4FDD\u8BC1\u53D1\u6325\u670D\u52A1\u5668\u7684\u6240\u7528\u6027\u80FD</p><h3 id="_19-2-\u79D2\u6740\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_19-2-\u79D2\u6740\u6D41\u7A0B" aria-hidden="true">#</a> 19.2 \u79D2\u6740\u6D41\u7A0B</h3><p>\u53C2\u8003\u4EAC\u4E1C\u79D2\u6740\u6D41\u7A0B</p><p>\u89C1\u79D2\u6740\u6D41\u7A0B\u56FE</p>',12),go=s("\u5B8C\u6574\u6D41\u7A0B\u56FE\u5730\u5740\uFF1A"),bo={href:"https://www.processon.com/view/link/5fbda8c35653bb1d54f7077b",target:"_blank",rel:"noopener noreferrer"},ho=s("https://www.processon.com/view/link/5fbda8c35653bb1d54f7077b"),yo=p('<h4 id="\u79D2\u6740\u65B9\u5F0F\u4E00" tabindex="-1"><a class="header-anchor" href="#\u79D2\u6740\u65B9\u5F0F\u4E00" aria-hidden="true">#</a> \u79D2\u6740\u65B9\u5F0F\u4E00</h4><p><img src="http://qnimg.gisfsde.com/work/image-20210108164514905.png" alt="image-20210108164514905" loading="lazy"></p><h4 id="\u79D2\u6740\u65B9\u5F0F2" tabindex="-1"><a class="header-anchor" href="#\u79D2\u6740\u65B9\u5F0F2" aria-hidden="true">#</a> \u79D2\u6740\u65B9\u5F0F2</h4><p><img src="http://qnimg.gisfsde.com/work/image-20210108164555957.png" alt="image-20210108164555957" loading="lazy"></p><h3 id="_19-3-\u9650\u6D41" tabindex="-1"><a class="header-anchor" href="#_19-3-\u9650\u6D41" aria-hidden="true">#</a> 19.3 \u9650\u6D41</h3><h3 id="_19-4-\u79D2\u6740\u6838\u5FC3\u4E1A\u52A1" tabindex="-1"><a class="header-anchor" href="#_19-4-\u79D2\u6740\u6838\u5FC3\u4E1A\u52A1" aria-hidden="true">#</a> 19.4 \u79D2\u6740\u6838\u5FC3\u4E1A\u52A1</h3><h1 id="_20\u3001\u5B9A\u65F6\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_20\u3001\u5B9A\u65F6\u4EFB\u52A1" aria-hidden="true">#</a> 20\u3001\u5B9A\u65F6\u4EFB\u52A1</h1><h3 id="_20-1-cron\u8868\u8FBE\u5F0F" tabindex="-1"><a class="header-anchor" href="#_20-1-cron\u8868\u8FBE\u5F0F" aria-hidden="true">#</a> 20.1 cron\u8868\u8FBE\u5F0F</h3><p>\u8BED\u6CD5\uFF1A\u79D2 \u5206 \u65F6 \u65E5 \u6708 \u5468 \u5E74\uFF08Spring\u4E0D\u652F\u6301\uFF09</p>',9),fo={href:"http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/crontrigger.html",target:"_blank",rel:"noopener noreferrer"},qo=s("http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/crontrigger.html"),wo=p(`<p>\u7279\u6B8A\u5B57\u7B26\uFF1A</p><ul><li><code>*</code>\uFF08 <em>\u201C\u6240\u6709\u503C\u201D</em>\uFF09-\u7528\u4E8E\u9009\u62E9\u5B57\u6BB5\u4E2D\u7684\u6240\u6709\u503C\u3002\u4F8B\u5982\uFF0C\u5206\u949F\u5B57\u6BB5\u4E2D\u7684\u201C ***** \u201D\u8868\u793A*\u201C\u6BCF\u5206\u949F\u201D*\u3002</li><li><code>\uFF1F</code>\uFF08 <em>\u201C\u65E0\u7279\u5B9A\u503C\u201D</em>\uFF09-\u5F53\u60A8\u9700\u8981\u5728\u5141\u8BB8\u4F7F\u7528\u5B57\u7B26\u7684\u4E24\u4E2A\u5B57\u6BB5\u4E4B\u4E00\u4E2D\u6307\u5B9A\u67D0\u4E2A\u5185\u5BB9\u800C\u5728\u53E6\u4E00\u4E2A\u4E0D\u5141\u8BB8\u7684\u5B57\u6BB5\u4E2D\u6307\u5B9A\u67D0\u4E9B\u5185\u5BB9\u65F6\u5F88\u6709\u7528\u3002\u4F8B\u5982\uFF0C\u5982\u679C\u6211\u5E0C\u671B\u5728\u67D0\u4E2A\u6708\u7684\u67D0\u4E2A\u7279\u5B9A\u65E5\u671F\uFF08\u4F8B\u5982\uFF0C\u7B2C10\u5929\uFF09\u89E6\u53D1\u89E6\u53D1\u5668\uFF0C\u4F46\u4E0D\u5728\u4E4E\u4E00\u5468\u4E2D\u7684\u54EA\u4E00\u5929\u53D1\u751F\uFF0C\u5219\u5C06\u201C 10\u201D\u8BBE\u7F6E\u4E3A\u6708\u5B57\u6BB5\uFF0C\u4EE5\u53CA\u201C\uFF1F\u201D \u5728\u201C\u661F\u671F\u51E0\u201D\u5B57\u6BB5\u4E2D\u3002\u8BF7\u53C2\u9605\u4E0B\u9762\u7684\u793A\u4F8B\u4EE5\u8FDB\u884C\u6F84\u6E05\u3002</li><li><code>--</code>\u7528\u4E8E\u6307\u5B9A\u8303\u56F4\u3002\u4F8B\u5982\uFF0C\u5C0F\u65F6\u5B57\u6BB5\u4E2D\u7684\u201C 10-12\u201D\u8868\u793A*\u201C\u5C0F\u65F610\u300111\u548C12\u201D*\u3002</li><li><code>\uFF0C</code> -\u7528\u4E8E\u6307\u5B9A\u5176\u4ED6\u503C\u3002\u4F8B\u5982\uFF0C\u201C\u661F\u671F\u51E0\u201D\u5B57\u6BB5\u4E2D\u7684\u201C MON\uFF0CWED\uFF0CFRI\u201D\u8868\u793A*\u201C\u661F\u671F\u4E00\uFF0C\u661F\u671F\u4E09\u548C\u661F\u671F\u4E94\u7684\u65E5\u5B50\u201D*\u3002</li><li><code>/</code> -\u7528\u4E8E\u6307\u5B9A\u589E\u91CF\u3002\u4F8B\u5982\uFF0C\u79D2\u5B57\u6BB5\u4E2D\u7684\u201C 0/15\u201D\u8868\u793A*\u201C\u79D2<em>0\u300115\u300130</em>\u548C45\u201D<em>\u3002\u79D2\u5B57\u6BB5\u4E2D\u7684\u201C 5/15\u201D\u8868\u793A</em>\u201C\u79D2<em>5\u300120\u300135</em>\u548C50\u201D<em>\u3002\u60A8\u8FD8\u53EF\u4EE5\u5728\u201C <strong>\u201D\u5B57\u7B26</strong>\u540E\u6307\u5B9A\u201C /\u201D <strong>-\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u201C</strong> \u201D\u7B49\u6548\u4E8E\u5728\u201C /\u201D\u4E4B\u524D\u4F7F\u7528\u201C 0\u201D\u3002\u6BCF\u6708\u65E5\u671F\u5B57\u6BB5\u4E2D\u7684\u201C 1/3\u201D\u8868\u793A</em>\u201C\u4ECE\u8BE5\u6708\u7684\u7B2C\u4E00\u5929\u5F00\u59CB\u6BCF\u4E09\u5929\u89E6\u53D1\u4E00\u6B21\u201D*\u3002</li><li><code>L</code>\uFF08 <em>\u201C\u6700\u540E\u4E00\u4E2A\u201D</em>\uFF09-\u5728\u5141\u8BB8\u4F7F\u7528\u7684\u4E24\u4E2A\u5B57\u6BB5\u4E2D\u90FD\u6709\u4E0D\u540C\u7684\u542B\u4E49\u3002\u4F8B\u5982\uFF0C\u201C\u6708\u201D\u5B57\u6BB5\u4E2D\u7684\u503C\u201C L\u201D\u8868\u793A*\u201C<em>\u6708</em>\u7684\u6700\u540E\u4E00\u5929\u201D\uFF0C\u5373<em>\u975EJanuary\u5E74\u76841\u670831\u65E5\uFF0C2\u670828\u65E5\u3002\u5982\u679C\u5355\u72EC\u7528\u4E8E\u661F\u671F\u51E0\u5B57\u6BB5\uFF0C\u5219\u4EC5\u8868\u793A\u201C 7\u201D\u6216\u201C SAT\u201D\u3002\u4F46\u662F\uFF0C\u5982\u679C\u5728\u661F\u671F\u51E0\u5B57\u6BB5\u4E2D\u4F7F\u7528\u53E6\u4E00\u4E2A\u503C\uFF0C\u5219\u8868\u793A</em>\u201C\u8BE5\u6708\u7684\u6700\u540Exxx\u5929\u201D<em>\uFF0C\u4F8B\u5982\u201C 6L\u201D\u8868\u793A</em>\u201C\u8BE5\u6708\u7684\u6700\u540E\u4E00\u4E2A\u661F\u671F\u4E94\u201D*\u3002\u60A8\u8FD8\u53EF\u4EE5\u6307\u5B9A\u4E0E\u8BE5\u6708\u6700\u540E\u4E00\u5929\u7684\u504F\u79FB\u91CF\uFF0C\u4F8B\u5982\u201C L-3\u201D\uFF0C\u8FD9\u8868\u793A\u65E5\u5386\u6708\u7684\u5012\u6570\u7B2C\u4E09\u5929\u3002 <em>\u4F7F\u7528\u201C L\u201D\u9009\u9879\u65F6\uFF0C\u4E0D\u8981\u6307\u5B9A\u5217\u8868\u6216\u503C\u7684\u8303\u56F4\u5F88\u91CD\u8981\uFF0C\u56E0\u4E3A\u8FD9\u6837\u4F1A\u5BFC\u81F4\u6DF7\u6DC6/\u610F\u5916\u7ED3\u679C\u3002</em></li><li><code>W</code>\uFF08 <em>\u201C\u5DE5\u4F5C\u65E5\u201D</em>\uFF09-\u7528\u4E8E\u6307\u5B9A\u6700\u63A5\u8FD1\u7ED9\u5B9A\u65E5\u671F\u7684\u5DE5\u4F5C\u65E5\uFF08\u661F\u671F\u4E00\u81F3\u661F\u671F\u4E94\uFF09\u3002\u4F8B\u5982\uFF0C\u5982\u679C\u60A8\u8981\u6307\u5B9A\u201C 15W\u201D\u4F5C\u4E3A\u201C\u6708\u65E5\u201D\u5B57\u6BB5\u7684\u503C\uFF0C\u5219\u542B\u4E49\u662F\uFF1A <em>\u201C\u79BB\u670815\u65E5\u6700\u8FD1\u7684\u5DE5\u4F5C\u65E5\u201D</em>\u3002\u56E0\u6B64\uFF0C\u5982\u679C15\u53F7\u662F\u661F\u671F\u516D\uFF0C\u5219\u89E6\u53D1\u5668\u5C06\u572814\u53F7\u661F\u671F\u4E94\u89E6\u53D1\u3002\u5982\u679C15\u65E5\u662F\u661F\u671F\u65E5\uFF0C\u5219\u89E6\u53D1\u5668\u5C06\u572816\u65E5\u661F\u671F\u4E00\u89E6\u53D1\u3002\u5982\u679C15\u53F7\u662F\u661F\u671F\u4E8C\uFF0C\u90A3\u4E48\u5B83\u5C06\u572815\u53F7\u661F\u671F\u4E8C\u89E6\u53D1\u3002\u4F46\u662F\uFF0C\u5982\u679C\u60A8\u5C06\u201C 1W\u201D\u6307\u5B9A\u4E3A\u6708\u4EFD\u7684\u503C\uFF0C\u5E76\u4E14\u7B2C\u4E00\u4E2A\u662F\u661F\u671F\u516D\uFF0C\u5219\u89E6\u53D1\u5668\u5C06\u5728\u7B2C3\u4E2A\u661F\u671F\u4E00\u89E6\u53D1\uFF0C\u56E0\u4E3A\u5B83\u4E0D\u4F1A\u201C\u8DF3\u8FC7\u201D\u4E00\u4E2A\u6708\u65E5\u7684\u8FB9\u754C\u3002\u4EC5\u5F53\u6708\u4EFD\u4E2D\u7684\u67D0\u5929\u662F\u4E00\u5929\uFF0C\u800C\u4E0D\u662F\u8303\u56F4\u6216\u5929\u6570\u5217\u8868\u65F6\uFF0C\u624D\u53EF\u4EE5\u6307\u5B9A\u201C W\u201D\u5B57\u7B26\u3002</li></ul><blockquote><p>\u201C L\u201D\u548C\u201C W\u201D\u5B57\u7B26\u4E5F\u53EF\u4EE5\u5728\u201C\u6708\u65E5\u201D\u5B57\u6BB5\u4E2D\u7EC4\u5408\u4EE5\u4EA7\u751F\u201C LW\u201D\uFF0C\u8FD9\u8868\u793A*\u201C\u6BCF\u6708\u7684\u6700\u540E\u4E00\u4E2A\u5DE5\u4F5C\u65E5\u201D *\u3002</p></blockquote><ul><li><code>\uFF03</code> -\u7528\u4E8E\u6307\u5B9A\u6BCF\u6708\u7684\u7B2C\u201C XXX\u201D\u5929\u3002\u4F8B\u5982\uFF0C\u201C\u661F\u671F\u51E0\u201D\u5B57\u6BB5\u4E2D\u7684\u503C\u201C 6\uFF033\u201D\u8868\u793A*\u201C\u8BE5\u6708\u7684\u7B2C\u4E09\u4E2A\u661F\u671F\u4E94\u201D<em>\uFF08\u7B2C6\u5929=\u661F\u671F\u4E94\uFF0C\u201C\uFF033\u201D =\u8BE5</em>\u6708\u7684\u7B2C\u4E09\u4E2A\u661F\u671F\u4E94*\uFF09\u3002\u5176\u4ED6\u793A\u4F8B\uFF1A\u201C 2\uFF031\u201D =\u8BE5\u6708\u7684\u7B2C\u4E00\u4E2A\u661F\u671F\u4E00\uFF0C\u201C 4\uFF035\u201D =\u8BE5\u6708\u7684\u7B2C\u4E94\u4E2A\u661F\u671F\u4E09\u3002\u8BF7\u6CE8\u610F\uFF0C\u5982\u679C\u60A8\u6307\u5B9A\u201C\uFF035\u201D\uFF0C\u5E76\u4E14\u8BE5\u6708\u7684\u6307\u5B9A\u661F\u671F\u51E0\u4E2D\u6CA1\u67095\u4E2A\uFF0C\u5219\u8BE5\u6708\u5C06\u4E0D\u4F1A\u89E6\u53D1\u3002</li></ul><blockquote><p>\u6CD5\u5B9A\u5B57\u7B26\u4EE5\u53CA\u6708\u4EFD\u548C\u661F\u671F\u51E0\u7684\u540D\u79F0\u4E0D\u533A\u5206\u5927\u5C0F\u5199\u3002<code>MON</code> \u4E0E<code>mon</code>\u76F8\u540C\u3002</p></blockquote><h3 id="_20-2-cron-\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_20-2-cron-\u793A\u4F8B" aria-hidden="true">#</a> 20.2 cron \u793A\u4F8B</h3><p>\u9605\u8BFB\u6280\u5DE7\uFF1A\u79D2 \u5206 \u65F6 \u65E5 \u6708 \u5468</p><p><img src="http://qnimg.gisfsde.com/work/image-20201123095544841.png" alt="image-20201123095544841" loading="lazy"></p><p>\u4F7F\u7528\u8C37\u6B4C\u7FFB\u8BD1\u540E\u4E2D\u6587\u610F\u601D\u662F\u8FD9\u6837\u7684</p><p><img src="http://qnimg.gisfsde.com/work/image-20201123095718609.png" alt="image-20201123095718609" loading="lazy"></p><h3 id="_20-3-springboot\u6574\u5408\u5B9A\u65F6\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_20-3-springboot\u6574\u5408\u5B9A\u65F6\u4EFB\u52A1" aria-hidden="true">#</a> 20.3 SpringBoot\u6574\u5408\u5B9A\u65F6\u4EFB\u52A1</h3><p>\u5B9A\u65F6\u4EFB\u52A1\u76F8\u5173\u6CE8\u89E3:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableAsync</span> <span class="token comment">// \u542F\u7528Spring\u5F02\u6B65\u4EFB\u52A1\u652F\u6301</span>
<span class="token annotation punctuation">@EnableScheduling</span> <span class="token comment">// \u542F\u7528Spring\u7684\u8BA1\u5212\u4EFB\u52A1\u6267\u884C\u529F\u80FD</span>
<span class="token annotation punctuation">@Async</span> \u5F02\u6B65
<span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">&quot;* * * * * ?&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> gcq
 * @Create 2020-11-23
 *
 * \u5B9A\u65F6\u4EFB\u52A1
 *      1\u3001@EnableScheduling \u5F00\u542F\u5B9A\u65F6\u4EFB\u52A1
 *      2\u3001Scheduled \u5F00\u542F\u4E00\u4E2A\u5B9A\u65F6\u4EFB\u52A1
 *      3\u3001\u81EA\u52A8\u914D\u7F6E\u7C7B TaskSchedulingAutoConfiguration \u5C5E\u6027\u7ED1\u5B9A\u5728TaskExecutionProperties
 *
 * \u5F02\u6B65\u4EFB\u52A1
 *      1\u3001@EnableAsync \u5F00\u542F\u5F02\u6B65\u4EFB\u52A1\u529F\u80FD
 *      2\u3001@Async \u7ED9\u5E0C\u671B\u5F02\u6B65\u6267\u884C\u7684\u65B9\u6CD5\u4E0A\u6807\u6CE8
 *      3\u3001\u81EA\u52A8\u914D\u7F6E\u7C7B TaskExecutionAutoConfiguration
 *
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@EnableAsync</span> <span class="token comment">// \u542F\u7528Spring\u5F02\u6B65\u4EFB\u52A1\u652F\u6301</span>
<span class="token annotation punctuation">@EnableScheduling</span> <span class="token comment">// \u542F\u7528Spring\u7684\u8BA1\u5212\u4EFB\u52A1\u6267\u884C\u529F\u80FD</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSchedule</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 1\u3001Spring\u4E2D6\u4F4D\u7EC4\u6210\uFF0C\u4E0D\u5141\u8BB8\u7B2C7\u4F4D\u7684\u5E74
     * 2\u3001\u5728\u5468\u51E0\u7684\u4F4D\u7F6E\uFF0C1-7\u4EE3\u8868\u5468\u4E00\u5230\u5468\u65E5\uFF1AMON-SUN
     * 3\u3001\u5B9A\u65F6\u4EFB\u52A1\u5E94\u8BE5\u963B\u585E\uFF0C\u9ED8\u8BA4\u662F\u963B\u585E\u7684
     *      1\u3001\u53EF\u4EE5\u8BA9\u4E1A\u52A1\u4EE5\u5F02\u6B65\u7684\u65B9\u5F0F\u8FD0\u884C\uFF0C\u81EA\u5DF1\u63D0\u4EA4\u5230\u7EBF\u7A0B\u6C60
     *          CompletableFuture.runAsync(() -&gt; <span class="token punctuation">{</span>
     *              xxxService.hello();
     *          <span class="token punctuation">}</span>)
     *      2\u3001\u652F\u6301\u5B9A\u65F6\u4EFB\u52A1\u7EBF\u7A0B\u6C60\uFF0C\u8BBE\u7F6E TaskSchedulingProperties
     *          spring.task.scheduling.pool.size=5
     *      3\u3001\u8BA9\u5B9A\u65F6\u4EFB\u52A1\u5F02\u6B65\u6267\u884C
     *          \u5F02\u6B65\u6267\u884C
     *     \u89E3\u51B3\uFF1A\u4F7F\u7528\u5F02\u6B65 + \u5B9A\u65F6\u4EFB\u52A1\u6765\u5B8C\u6210\u5B9A\u65F6\u4EFB\u52A1\u4E0D\u963B\u585E\u7684\u529F\u80FD
     */</span>
<span class="token comment">//    @Async \u5F02\u6B65</span>
<span class="token comment">//    @Scheduled(cron = &quot;* * * * * ?&quot;)</span>
<span class="token comment">//    public void hello() {</span>
<span class="token comment">//        log.info(&quot;hello...&quot;);</span>
<span class="token comment">//    }</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_20-4-\u5206\u5E03\u5F0F\u5B9A\u65F6\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_20-4-\u5206\u5E03\u5F0F\u5B9A\u65F6\u4EFB\u52A1" aria-hidden="true">#</a> 20.4 \u5206\u5E03\u5F0F\u5B9A\u65F6\u4EFB\u52A1</h3><h3 id="_20-5\u5B9A\u65F6\u4EFB\u52A1\u7684\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_20-5\u5B9A\u65F6\u4EFB\u52A1\u7684\u95EE\u9898" aria-hidden="true">#</a> 20.5\u5B9A\u65F6\u4EFB\u52A1\u7684\u95EE\u9898</h3><h3 id="_20-6-\u6269\u5C55-\u5206\u5E03\u5F0F\u8C03\u6574" tabindex="-1"><a class="header-anchor" href="#_20-6-\u6269\u5C55-\u5206\u5E03\u5F0F\u8C03\u6574" aria-hidden="true">#</a> 20.6 \u6269\u5C55 - \u5206\u5E03\u5F0F\u8C03\u6574</h3><h1 id="_21\u3001\u79D2\u6740-\u9AD8\u5E76\u53D1-\u7CFB\u7EDF\u5173\u6CE8\u7684\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_21\u3001\u79D2\u6740-\u9AD8\u5E76\u53D1-\u7CFB\u7EDF\u5173\u6CE8\u7684\u95EE\u9898" aria-hidden="true">#</a> 21\u3001\u79D2\u6740\uFF08\u9AD8\u5E76\u53D1\uFF09\u7CFB\u7EDF\u5173\u6CE8\u7684\u95EE\u9898</h1><h3 id="_21-1-\u670D\u52A1\u5355\u4E00\u804C\u8D23" tabindex="-1"><a class="header-anchor" href="#_21-1-\u670D\u52A1\u5355\u4E00\u804C\u8D23" aria-hidden="true">#</a> 21.1 \u670D\u52A1\u5355\u4E00\u804C\u8D23</h3><p>\u79D2\u6740\u670D\u52A1\u5373\u4F7F\u81EA\u5DF1\u625B\u4E0D\u4F4F\u538B\u529B\uFF0C\u6302\u6389\uFF0C\u4E0D\u8981\u5F71\u54CD\u522B\u4EBA</p><h3 id="_21-2-\u79D2\u6740\u94FE\u63A5\u52A0\u5BC6" tabindex="-1"><a class="header-anchor" href="#_21-2-\u79D2\u6740\u94FE\u63A5\u52A0\u5BC6" aria-hidden="true">#</a> 21.2 \u79D2\u6740\u94FE\u63A5\u52A0\u5BC6</h3><p>\u9632\u6B62\u6076\u610F\u653B\u51FB\u6A21\u62DF\u79D2\u6740\u8BF7\u6C42\uFF0C1000\u6B21/s\u653B\u51FB \u9632\u6B62\u8FDE\u63A5\u66B4\u9732\uFF0C\u81EA\u5DF1\u5DE5\u4F5C\u4EBA\u5458\uFF0C\u63D0\u524D\u79D2\u6740\u5546\u54C1</p><h3 id="_21-3-\u5E93\u5B58\u9884\u70ED-\u5FEB\u901F\u6263\u51CF" tabindex="-1"><a class="header-anchor" href="#_21-3-\u5E93\u5B58\u9884\u70ED-\u5FEB\u901F\u6263\u51CF" aria-hidden="true">#</a> 21.3 \u5E93\u5B58\u9884\u70ED + \u5FEB\u901F\u6263\u51CF</h3><p>\u63D0\u524D\u628A\u6570\u636E\u52A0\u8F7D\u7F13\u5B58\u4E2D\uFF0C</p><h3 id="_21-4-\u52A8\u9759\u5206\u79BB" tabindex="-1"><a class="header-anchor" href="#_21-4-\u52A8\u9759\u5206\u79BB" aria-hidden="true">#</a> 21.4 \u52A8\u9759\u5206\u79BB</h3><p>nginx\u505A\u597D\u52A8\u9759\u5206\u79BB\uFF0C\u4FDD\u8BC1\u79D2\u6740\u548C\u5546\u54C1\u8BE6\u60C5\u9875\u7684\u52A8\u6001\u8BF7\u6C42\u624D\u6253\u5230\u540E\u7AEF\u7684\u670D\u52A1\u96C6\u7FA4</p><p>\u4F7F\u7528 CDN \u7F51\u7EDC\uFF0C\u5206\u62C5\u670D\u52A1\u5668\u538B\u529B</p><h3 id="_21-5-\u6076\u610F\u8BF7\u6C42\u62E6\u622A" tabindex="-1"><a class="header-anchor" href="#_21-5-\u6076\u610F\u8BF7\u6C42\u62E6\u622A" aria-hidden="true">#</a> 21.5 \u6076\u610F\u8BF7\u6C42\u62E6\u622A</h3><p>\u8BC6\u522B\u975E\u6CD5\u653B\u51FB\u7684\u8BF7\u6C42\u5E76\u8FDB\u884C\u62E6\u622A \uFF0C\u7F51\u7BA1\u5C42</p><h3 id="_21-6-\u6D41\u91CF\u9519\u5CF0" tabindex="-1"><a class="header-anchor" href="#_21-6-\u6D41\u91CF\u9519\u5CF0" aria-hidden="true">#</a> 21.6 \u6D41\u91CF\u9519\u5CF0</h3><p>\u4F7F\u7528\u5404\u79CD\u624B\u6BB5\uFF0C\u5C06\u6D41\u91CF\u5206\u62C5\u5230\u66F4\u5927\u5BBD\u5EA6\u7684\u65F6\u95F4\u70B9\uFF0C\u6BD4\u5982\u9A8C\u8BC1\u7801\uFF0C\u52A0\u5165\u8D2D\u7269\u8F66</p><h3 id="_21-7-\u9650\u6D41-\u7194\u65AD-\u964D\u7EA7" tabindex="-1"><a class="header-anchor" href="#_21-7-\u9650\u6D41-\u7194\u65AD-\u964D\u7EA7" aria-hidden="true">#</a> 21.7 \u9650\u6D41 &amp; \u7194\u65AD &amp; \u964D\u7EA7</h3><p>\u524D\u7AEF\u9650\u6D41 + \u540E\u7AEF\u9650\u6D41</p><p>\u9650\u5236\u6B21\u6570\uFF0C\u9650\u5236\u603B\u91CF\uFF0C\u5FEB\u901F\u5931\u8D25\u964D\u7EA7\u8FD0\u884C\uFF0C\u7194\u65AD\u9694\u79BB\u9632\u6B62\u96EA\u5D29</p><h3 id="_21-8-\u961F\u5217\u6D88\u5CF0" tabindex="-1"><a class="header-anchor" href="#_21-8-\u961F\u5217\u6D88\u5CF0" aria-hidden="true">#</a> 21.8 \u961F\u5217\u6D88\u5CF0</h3><p>1\u4E07\u4E2A\u8BF7\u6C42\uFF0C\u6BCF\u4E2A1000\u4EF6\u88AB\u79D2\u6740\uFF0C\u53CC11\u6240\u6709\u79D2\u6740\u6210\u529F\u7684\u8BF7\u6C42\uFF0C\u8FDB\u5165\u961F\u5217\uFF0C\u6162\u6162\u521B\u5EFA\u8BA2\u5355\uFF0C\u6263\u51CF\u5E93\u5B58\u5373\u53EF</p>`,37);function _o(So,xo){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,n("blockquote",null,[r,n("p",null,[k,d,m,v,g,b,h,y,n("a",f,[q,t(a)]),w,n("a",_,[S,t(a)]),x,E,I])]),C,n("p",null,[A,n("a",j,[R,t(a)])]),O,n("p",null,[P,n("a",T,[L,t(a)]),V]),D,n("p",null,[n("a",B,[M,t(a)]),U]),n("p",null,[n("a",N,[z,t(a)]),F]),G,n("p",null,[Q,n("a",H,[W,t(a)])]),J,n("p",null,[K,n("a",$,[X,t(a)]),Y]),Z,n("p",null,[n("a",nn,[sn,t(a)])]),an,n("ol",null,[n("li",null,[tn,n("p",null,[n("a",pn,[en,t(a)])]),on]),cn]),ln,n("p",null,[un,n("a",rn,[kn,t(a)])]),dn,n("p",null,[n("a",mn,[vn,t(a)])]),gn,n("p",null,[n("a",bn,[hn,t(a)])]),yn,n("p",null,[n("a",fn,[qn,t(a)])]),wn,n("table",null,[_n,n("tbody",null,[n("tr",null,[Sn,n("td",null,[n("a",xn,[En,t(a)]),In,n("a",Cn,[An,t(a)])])]),n("tr",null,[jn,n("td",null,[n("a",Rn,[On,t(a)]),Pn,n("a",Tn,[Ln,t(a)])])]),n("tr",null,[Vn,n("td",null,[n("a",Dn,[Bn,t(a)]),Mn,n("a",Un,[Nn,t(a)])])])])]),zn,n("p",null,[n("a",Fn,[Gn,t(a)])]),n("p",null,[n("a",Qn,[Hn,t(a)])]),Wn,n("p",null,[n("a",Jn,[Kn,t(a)]),$n]),Xn,n("p",null,[Yn,n("a",Zn,[ns,t(a)]),ss,n("a",as,[ts,t(a)]),ps]),es,os,cs,is,ls,us,rs,ks,ds,n("p",null,[ms,n("a",vs,[gs,t(a)])]),bs,n("p",null,[hs,n("a",ys,[fs,t(a)])]),qs,n("h2",ws,[_s,Ss,n("a",xs,[Es,t(a)])]),n("p",null,[Is,n("a",Cs,[As,t(a)])]),js,n("h2",Rs,[Os,Ps,n("a",Ts,[Ls,t(a)])]),Vs,n("h3",Ds,[Bs,Ms,n("a",Us,[Ns,t(a)]),zs]),Fs,n("p",null,[n("a",Gs,[Qs,t(a)])]),Hs,n("p",null,[Ws,n("a",Js,[Ks,t(a)])]),n("p",null,[$s,n("a",Xs,[Ys,t(a)])]),Zs,n("p",null,[na,n("a",sa,[aa,t(a)])]),n("p",null,[ta,n("a",pa,[ea,t(a)])]),oa,n("p",null,[ca,n("a",ia,[la,t(a)])]),ua,n("p",null,[ra,n("a",ka,[da,t(a)])]),ma,n("p",null,[va,n("a",ga,[ba,t(a)])]),ha,n("p",null,[n("a",ya,[fa,t(a)])]),qa,n("p",null,[n("a",wa,[_a,t(a)])]),Sa,n("p",null,[n("a",xa,[Ea,t(a)])]),Ia,n("p",null,[n("a",Ca,[Aa,t(a)])]),ja,Ra,n("p",null,[Oa,n("a",Pa,[Ta,t(a)]),La]),Va,Da,n("h3",Ba,[Ma,Ua,n("a",Na,[za,t(a)])]),Fa,n("h2",Ga,[Qa,Ha,n("a",Wa,[Ja,t(a)])]),Ka,n("p",null,[n("a",$a,[Xa,t(a)])]),Ya,n("p",null,[Za,n("a",nt,[st,t(a)])]),at,n("p",null,[tt,n("a",pt,[et,t(a)])]),ot,n("ul",null,[n("li",null,[ct,n("a",it,[lt,t(a)]),ut]),rt,kt]),dt,n("p",null,[mt,n("a",vt,[gt,t(a)])]),bt,n("p",null,[n("a",ht,[yt,t(a)])]),ft,qt,wt,_t,St,n("p",null,[xt,n("a",Et,[It,t(a)])]),n("p",null,[Ct,n("a",At,[jt,t(a)])]),Rt,n("p",null,[n("a",Ot,[Pt,t(a)])]),Tt,n("p",null,[n("a",Lt,[Vt,t(a)])]),Dt,n("p",null,[Bt,n("a",Mt,[Ut,t(a)])]),Nt,n("p",null,[n("a",zt,[Ft,t(a)])]),Gt,n("p",null,[Qt,n("a",Ht,[Wt,t(a)])]),n("p",null,[Jt,n("a",Kt,[$t,t(a)])]),Xt,n("p",null,[n("a",Yt,[Zt,t(a)]),np]),sp,n("p",null,[ap,n("a",tp,[pp,t(a)])]),ep,n("p",null,[op,n("a",cp,[ip,t(a)])]),lp,n("p",null,[up,n("a",rp,[kp,t(a)])]),dp,n("p",null,[mp,n("a",vp,[gp,t(a)])]),n("p",null,[bp,n("a",hp,[yp,t(a)])]),fp,n("p",null,[qp,n("a",wp,[_p,t(a)])]),Sp,n("p",null,[xp,n("a",Ep,[Ip,t(a)])]),Cp,n("p",null,[Ap,n("a",jp,[Rp,t(a)])]),Op,n("p",null,[Pp,n("a",Tp,[Lp,t(a)])]),Vp,n("p",null,[Dp,n("a",Bp,[Mp,t(a)])]),Up,Np,n("p",null,[zp,n("a",Fp,[Gp,t(a)])]),Qp,n("p",null,[Hp,n("a",Wp,[Jp,t(a)])]),Kp,n("p",null,[$p,n("a",Xp,[Yp,t(a)])]),Zp,ne,se,n("p",null,[n("a",ae,[te,t(a)])]),pe,ee,n("p",null,[oe,n("a",ce,[ie,t(a)])]),le,ue,n("p",null,[n("a",re,[ke,t(a)])]),de,n("p",null,[n("a",me,[ve,t(a)])]),ge,n("p",null,[n("a",be,[he,t(a)])]),ye,n("ul",null,[fe,n("li",null,[qe,n("ul",null,[n("li",null,[n("a",we,[_e,t(a)]),Se]),n("li",null,[n("a",xe,[Ee,t(a)]),Ie]),n("li",null,[n("a",Ce,[Ae,t(a)]),je])])])]),Re,n("p",null,[Oe,n("a",Pe,[Te,t(a)])]),Le,n("p",null,[n("a",Ve,[De,t(a)])]),Be,n("p",null,[n("a",Me,[Ue,t(a)])]),Ne,n("p",null,[n("a",ze,[Fe,t(a)])]),Ge,Qe,n("p",null,[n("a",He,[We,t(a)]),Je]),n("p",null,[n("a",Ke,[$e,t(a)]),Xe]),n("p",null,[n("a",Ye,[Ze,t(a)]),no]),so,n("p",null,[n("a",ao,[to,t(a)])]),po,n("p",null,[n("a",eo,[oo,t(a)])]),co,n("p",null,[io,n("a",lo,[uo,t(a)]),ro,n("a",ko,[mo,t(a)])]),vo,n("p",null,[go,n("a",bo,[ho,t(a)])]),yo,n("p",null,[n("a",fo,[qo,t(a)])]),wo])}var Co=e(l,[["render",_o],["__file","GuLimall.html.vue"]]);export{Co as default};
